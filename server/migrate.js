"use strict";var RA=Object.create;var tc=Object.defineProperty;var IA=Object.getOwnPropertyDescriptor;var $A=Object.getOwnPropertyNames;var PA=Object.getPrototypeOf,LA=Object.prototype.hasOwnProperty;var l=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var kA=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of $A(e))!LA.call(r,i)&&i!==t&&tc(r,i,{get:()=>e[i],enumerable:!(n=IA(e,i))||n.enumerable});return r};var rc=(r,e,t)=>(t=r!=null?RA(PA(r)):{},kA(e||!r||!r.__esModule?tc(t,"default",{value:r,enumerable:!0}):t,r));var xs=l(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0});var Cs=class extends Error{};vs.TimeoutError=Cs});var nc=l(As=>{"use strict";Object.defineProperty(As,"__esModule",{value:!0});var Ts=class{constructor(e){this._value=e.value,this._error=e.error}value(){return this._value}reason(){return this._error}isRejected(){return!!this._error}isFulfilled(){return!!this._value}};As.PromiseInspection=Ts});var Tn=l(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});var ic=nc();function MA(){let r=null,e=null;return{promise:new Promise((n,i)=>{r=n,e=i}),resolve:r,reject:e}}be.defer=MA;function BA(){return Date.now()}be.now=BA;function jA(r,e){return Math.abs(e-r)}be.duration=jA;function DA(r){return typeof r>"u"?!0:sc(r)}be.checkOptionalTime=DA;function sc(r){return typeof r=="number"&&r===Math.round(r)&&r>0}be.checkRequiredTime=sc;function FA(r){return new Promise(e=>setTimeout(e,r))}be.delay=FA;function QA(r){return r.then(e=>new ic.PromiseInspection({value:e})).catch(e=>new ic.PromiseInspection({error:e}))}be.reflect=QA;function UA(r){try{let e=r();return Promise.resolve(e)}catch(e){return Promise.reject(e)}}be.tryPromise=UA});var oc=l(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});var An=xs(),HA=Tn(),Ss=class{constructor(e){this.timeoutMillis=e,this.deferred=HA.defer(),this.possibleTimeoutCause=null,this.isRejected=!1,this.promise=WA(this.deferred.promise,e).catch(t=>(t instanceof An.TimeoutError&&(this.possibleTimeoutCause?t=new An.TimeoutError(this.possibleTimeoutCause.message):t=new An.TimeoutError("operation timed out for an unknown reason")),this.isRejected=!0,Promise.reject(t)))}abort(){this.reject(new Error("aborted"))}reject(e){this.deferred.reject(e)}resolve(e){this.deferred.resolve(e)}};Ns.PendingOperation=Ss;function WA(r,e){return new Promise((t,n)=>{let i=setTimeout(()=>n(new An.TimeoutError),e);r.then(s=>{clearTimeout(i),t(s)}).catch(s=>{clearTimeout(i),n(s)})})}});var uc=l(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});var ac=Tn(),br=class{constructor(e){this.resource=e,this.resource=e,this.timestamp=ac.now(),this.deferred=ac.defer()}get promise(){return this.deferred.promise}resolve(){return this.deferred.resolve(void 0),new br(this.resource)}};Os.Resource=br});var cc=l(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});var Sn=oc(),VA=uc(),G=Tn(),GA=require("events"),lc=require("timers"),Rs=class{constructor(e){if(this.destroyed=!1,this.emitter=new GA.EventEmitter,e=e||{},!e.create)throw new Error("Tarn: opt.create function most be provided");if(!e.destroy)throw new Error("Tarn: opt.destroy function most be provided");if(typeof e.min!="number"||e.min<0||e.min!==Math.round(e.min))throw new Error("Tarn: opt.min must be an integer >= 0");if(typeof e.max!="number"||e.max<=0||e.max!==Math.round(e.max))throw new Error("Tarn: opt.max must be an integer > 0");if(e.min>e.max)throw new Error("Tarn: opt.max is smaller than opt.min");if(!G.checkOptionalTime(e.acquireTimeoutMillis))throw new Error("Tarn: invalid opt.acquireTimeoutMillis "+JSON.stringify(e.acquireTimeoutMillis));if(!G.checkOptionalTime(e.createTimeoutMillis))throw new Error("Tarn: invalid opt.createTimeoutMillis "+JSON.stringify(e.createTimeoutMillis));if(!G.checkOptionalTime(e.destroyTimeoutMillis))throw new Error("Tarn: invalid opt.destroyTimeoutMillis "+JSON.stringify(e.destroyTimeoutMillis));if(!G.checkOptionalTime(e.idleTimeoutMillis))throw new Error("Tarn: invalid opt.idleTimeoutMillis "+JSON.stringify(e.idleTimeoutMillis));if(!G.checkOptionalTime(e.reapIntervalMillis))throw new Error("Tarn: invalid opt.reapIntervalMillis "+JSON.stringify(e.reapIntervalMillis));if(!G.checkOptionalTime(e.createRetryIntervalMillis))throw new Error("Tarn: invalid opt.createRetryIntervalMillis "+JSON.stringify(e.createRetryIntervalMillis));let t={create:!0,validate:!0,destroy:!0,log:!0,min:!0,max:!0,acquireTimeoutMillis:!0,createTimeoutMillis:!0,destroyTimeoutMillis:!0,idleTimeoutMillis:!0,reapIntervalMillis:!0,createRetryIntervalMillis:!0,propagateCreateError:!0};for(let n of Object.keys(e))if(!t[n])throw new Error(`Tarn: unsupported option opt.${n}`);this.creator=e.create,this.destroyer=e.destroy,this.validate=typeof e.validate=="function"?e.validate:()=>!0,this.log=e.log||(()=>{}),this.acquireTimeoutMillis=e.acquireTimeoutMillis||3e4,this.createTimeoutMillis=e.createTimeoutMillis||3e4,this.destroyTimeoutMillis=e.destroyTimeoutMillis||5e3,this.idleTimeoutMillis=e.idleTimeoutMillis||3e4,this.reapIntervalMillis=e.reapIntervalMillis||1e3,this.createRetryIntervalMillis=e.createRetryIntervalMillis||200,this.propagateCreateError=!!e.propagateCreateError,this.min=e.min,this.max=e.max,this.used=[],this.free=[],this.pendingCreates=[],this.pendingAcquires=[],this.pendingDestroys=[],this.pendingValidations=[],this.destroyed=!1,this.interval=null,this.eventId=1}numUsed(){return this.used.length}numFree(){return this.free.length}numPendingAcquires(){return this.pendingAcquires.length}numPendingValidations(){return this.pendingValidations.length}numPendingCreates(){return this.pendingCreates.length}acquire(){let e=this.eventId++;this._executeEventHandlers("acquireRequest",e);let t=new Sn.PendingOperation(this.acquireTimeoutMillis);return this.pendingAcquires.push(t),t.promise=t.promise.then(n=>(this._executeEventHandlers("acquireSuccess",e,n),n)).catch(n=>(this._executeEventHandlers("acquireFail",e,n),Nt(this.pendingAcquires,t),Promise.reject(n))),this._tryAcquireOrCreate(),t}release(e){this._executeEventHandlers("release",e);for(let t=0,n=this.used.length;t<n;++t){let i=this.used[t];if(i.resource===e)return this.used.splice(t,1),this.free.push(i.resolve()),this._tryAcquireOrCreate(),!0}return!1}isEmpty(){return[this.numFree(),this.numUsed(),this.numPendingAcquires(),this.numPendingValidations(),this.numPendingCreates()].reduce((e,t)=>e+t)===0}check(){let e=G.now(),t=[],n=this.min-this.used.length,i=this.free.length-n,s=0;this.free.forEach(o=>{G.duration(e,o.timestamp)>=this.idleTimeoutMillis&&s<i?(s++,this._destroy(o.resource)):t.push(o)}),this.free=t,this.isEmpty()&&this._stopReaping()}destroy(){let e=this.eventId++;return this._executeEventHandlers("poolDestroyRequest",e),this._stopReaping(),this.destroyed=!0,G.reflect(Promise.all(this.pendingCreates.map(t=>G.reflect(t.promise))).then(()=>new Promise((t,n)=>{if(this.numPendingValidations()===0){t();return}let i=setInterval(()=>{this.numPendingValidations()===0&&(lc.clearInterval(i),t())},100)})).then(()=>Promise.all(this.used.map(t=>G.reflect(t.promise)))).then(()=>Promise.all(this.pendingAcquires.map(t=>(t.abort(),G.reflect(t.promise))))).then(()=>Promise.all(this.free.map(t=>G.reflect(this._destroy(t.resource))))).then(()=>Promise.all(this.pendingDestroys.map(t=>t.promise))).then(()=>{this.free=[],this.pendingAcquires=[]})).then(t=>(this._executeEventHandlers("poolDestroySuccess",e),this.emitter.removeAllListeners(),t))}on(e,t){this.emitter.on(e,t)}removeListener(e,t){this.emitter.removeListener(e,t)}removeAllListeners(e){this.emitter.removeAllListeners(e)}_tryAcquireOrCreate(){this.destroyed||(this._hasFreeResources()?this._doAcquire():this._shouldCreateMoreResources()&&this._doCreate())}_hasFreeResources(){return this.free.length>0}_doAcquire(){for(;this._canAcquire();){let e=this.pendingAcquires.shift(),t=this.free.pop();if(t===void 0||e===void 0){let i="this.free was empty while trying to acquire resource";throw this.log(`Tarn: ${i}`,"warn"),new Error(`Internal error, should never happen. ${i}`)}this.pendingValidations.push(e),this.used.push(t);let n=new Sn.PendingOperation(this.acquireTimeoutMillis);e.promise.catch(i=>{n.abort()}),n.promise.catch(i=>(this.log("Tarn: resource validator threw an exception "+i.stack,"warn"),!1)).then(i=>{try{i&&!e.isRejected?(this._startReaping(),e.resolve(t.resource)):(Nt(this.used,t),i?this.free.push(t):(this._destroy(t.resource),setTimeout(()=>{this._tryAcquireOrCreate()},0)),e.isRejected||this.pendingAcquires.unshift(e))}finally{Nt(this.pendingValidations,e)}}),this._validateResource(t.resource).then(i=>{n.resolve(i)}).catch(i=>{n.reject(i)})}}_canAcquire(){return this.free.length>0&&this.pendingAcquires.length>0}_validateResource(e){try{return Promise.resolve(this.validate(e))}catch(t){return Promise.reject(t)}}_shouldCreateMoreResources(){return this.used.length+this.pendingCreates.length<this.max&&this.pendingCreates.length<this.pendingAcquires.length}_doCreate(){let e=this.pendingAcquires.slice();this._create().promise.then(()=>(this._tryAcquireOrCreate(),null)).catch(n=>{this.propagateCreateError&&this.pendingAcquires.length!==0&&this.pendingAcquires[0].reject(n),e.forEach(i=>{i.possibleTimeoutCause=n}),G.delay(this.createRetryIntervalMillis).then(()=>this._tryAcquireOrCreate())})}_create(){let e=this.eventId++;this._executeEventHandlers("createRequest",e);let t=new Sn.PendingOperation(this.createTimeoutMillis);return t.promise=t.promise.catch(n=>{throw Nt(this.pendingCreates,t)&&this._executeEventHandlers("createFail",e,n),n}),this.pendingCreates.push(t),zA(this.creator).then(n=>t.isRejected?(this.destroyer(n),null):(Nt(this.pendingCreates,t),this.free.push(new VA.Resource(n)),t.resolve(n),this._executeEventHandlers("createSuccess",e,n),null)).catch(n=>(t.isRejected||(Nt(this.pendingCreates,t)&&this._executeEventHandlers("createFail",e,n),t.reject(n)),null)),t}_destroy(e){let t=this.eventId++;this._executeEventHandlers("destroyRequest",t,e);let n=new Sn.PendingOperation(this.destroyTimeoutMillis);return Promise.resolve().then(()=>this.destroyer(e)).then(()=>{n.resolve(e)}).catch(s=>{n.reject(s)}),this.pendingDestroys.push(n),n.promise.then(s=>(this._executeEventHandlers("destroySuccess",t,e),s)).catch(s=>this._logDestroyerError(t,e,s)).then(s=>{let o=this.pendingDestroys.findIndex(a=>a===n);return this.pendingDestroys.splice(o,1),s})}_logDestroyerError(e,t,n){this._executeEventHandlers("destroyFail",e,t,n),this.log("Tarn: resource destroyer threw an exception "+n.stack,"warn")}_startReaping(){this.interval||(this._executeEventHandlers("startReaping"),this.interval=setInterval(()=>this.check(),this.reapIntervalMillis))}_stopReaping(){this.interval!==null&&(this._executeEventHandlers("stopReaping"),lc.clearInterval(this.interval)),this.interval=null}_executeEventHandlers(e,...t){this.emitter.listeners(e).forEach(i=>{try{i(...t)}catch(s){this.log(`Tarn: event handler "${e}" threw an exception ${s.stack}`,"warn")}})}};Is.Pool=Rs;function Nt(r,e){let t=r.indexOf(e);return t===-1?!1:(r.splice(t,1),!0)}function zA(r){return new Promise((e,t)=>{let n=(i,s)=>{i?t(i):e(s)};G.tryPromise(()=>r(n)).then(i=>{i&&e(i)}).catch(i=>{t(i)})})}});var pc=l((Nn,dc)=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});var hc=cc();Nn.Pool=hc.Pool;var fc=xs();Nn.TimeoutError=fc.TimeoutError;dc.exports={Pool:hc.Pool,TimeoutError:fc.TimeoutError}});var Rn=l((P7,wc)=>{var On=/[\0\b\t\n\r\x1a"'\\]/g,mc={"\0":"\\0","\b":"\\b","	":"\\t","\n":"\\n","\r":"\\r","":"\\Z",'"':'\\"',"'":"\\'","\\":"\\\\"};function JA(r){return function e(t,n={}){return r(t,e,n)}}function KA(r={}){let e=r.escapeDate||bc,t=r.escapeArray||$s,n=r.escapeBuffer||yc,i=r.escapeString||Ps,s=r.escapeObject||gc,o=r.wrap||JA;function a(u,c,h){if(u==null)return"NULL";switch(typeof u){case"boolean":return u?"true":"false";case"number":return u+"";case"object":if(u instanceof Date)u=e(u,c,h);else return Array.isArray(u)?t(u,c,h):Buffer.isBuffer(u)?n(u,c,h):s(u,c,h)}return i(u,c,h)}return o?o(a):a}function gc(r,e,t){return r&&typeof r.toSQL=="function"?r.toSQL(t):JSON.stringify(r)}function $s(r,e,t){let n="";for(let i=0;i<r.length;i++){let s=r[i];Array.isArray(s)?n+=(i===0?"":", ")+"("+$s(s,e,t)+")":n+=(i===0?"":", ")+e(s,t)}return n}function yc(r){return"X"+Ps(r.toString("hex"))}function Ps(r,e,t){let n=On.lastIndex=0,i="",s;for(;s=On.exec(r);)i+=r.slice(n,s.index)+mc[s[0]],n=On.lastIndex;return n===0?"'"+r+"'":n<r.length?"'"+i+r.slice(n)+"'":"'"+i+"'"}function bc(r,e,t={}){let n=t.timeZone||"local",i=new Date(r),s,o,a,u,c,h,f;if(n==="local")s=i.getFullYear(),o=i.getMonth()+1,a=i.getDate(),u=i.getHours(),c=i.getMinutes(),h=i.getSeconds(),f=i.getMilliseconds();else{let d=YA(n);d!==!1&&d!==0&&i.setTime(i.getTime()+d*6e4),s=i.getUTCFullYear(),o=i.getUTCMonth()+1,a=i.getUTCDate(),u=i.getUTCHours(),c=i.getUTCMinutes(),h=i.getUTCSeconds(),f=i.getUTCMilliseconds()}return nt(s,4)+"-"+nt(o,2)+"-"+nt(a,2)+" "+nt(u,2)+":"+nt(c,2)+":"+nt(h,2)+"."+nt(f,3)}function nt(r,e){for(r=r.toString();r.length<e;)r="0"+r;return r}function YA(r){if(r==="Z")return 0;let e=r.match(/([+\-\s])(\d\d):?(\d\d)?/);return e?(e[1]=="-"?-1:1)*(parseInt(e[2],10)+(e[3]?parseInt(e[3],10):0)/60)*60:!1}wc.exports={arrayToList:$s,bufferToString:yc,dateToString:bc,escapeString:Ps,charsRegex:On,charsMap:mc,escapeObject:gc,makeEscape:KA}});var qc=l((L7,_c)=>{function XA(){this.__data__=[],this.size=0}_c.exports=XA});var Le=l((k7,Ec)=>{function ZA(r,e){return r===e||r!==r&&e!==e}Ec.exports=ZA});var wr=l((M7,Cc)=>{var e0=Le();function t0(r,e){for(var t=r.length;t--;)if(e0(r[t][0],e))return t;return-1}Cc.exports=t0});var xc=l((B7,vc)=>{var r0=wr(),n0=Array.prototype,i0=n0.splice;function s0(r){var e=this.__data__,t=r0(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():i0.call(e,t,1),--this.size,!0}vc.exports=s0});var Ac=l((j7,Tc)=>{var o0=wr();function a0(r){var e=this.__data__,t=o0(e,r);return t<0?void 0:e[t][1]}Tc.exports=a0});var Nc=l((D7,Sc)=>{var u0=wr();function l0(r){return u0(this.__data__,r)>-1}Sc.exports=l0});var Rc=l((F7,Oc)=>{var c0=wr();function h0(r,e){var t=this.__data__,n=c0(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}Oc.exports=h0});var _r=l((Q7,Ic)=>{var f0=qc(),d0=xc(),p0=Ac(),m0=Nc(),g0=Rc();function Ot(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Ot.prototype.clear=f0;Ot.prototype.delete=d0;Ot.prototype.get=p0;Ot.prototype.has=m0;Ot.prototype.set=g0;Ic.exports=Ot});var Pc=l((U7,$c)=>{var y0=_r();function b0(){this.__data__=new y0,this.size=0}$c.exports=b0});var kc=l((H7,Lc)=>{function w0(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}Lc.exports=w0});var Bc=l((W7,Mc)=>{function _0(r){return this.__data__.get(r)}Mc.exports=_0});var Dc=l((V7,jc)=>{function q0(r){return this.__data__.has(r)}jc.exports=q0});var Ls=l((G7,Fc)=>{var E0=typeof global=="object"&&global&&global.Object===Object&&global;Fc.exports=E0});var fe=l((z7,Qc)=>{var C0=Ls(),v0=typeof self=="object"&&self&&self.Object===Object&&self,x0=C0||v0||Function("return this")();Qc.exports=x0});var ke=l((J7,Uc)=>{var T0=fe(),A0=T0.Symbol;Uc.exports=A0});var Gc=l((K7,Vc)=>{var Hc=ke(),Wc=Object.prototype,S0=Wc.hasOwnProperty,N0=Wc.toString,qr=Hc?Hc.toStringTag:void 0;function O0(r){var e=S0.call(r,qr),t=r[qr];try{r[qr]=void 0;var n=!0}catch{}var i=N0.call(r);return n&&(e?r[qr]=t:delete r[qr]),i}Vc.exports=O0});var Jc=l((Y7,zc)=>{var R0=Object.prototype,I0=R0.toString;function $0(r){return I0.call(r)}zc.exports=$0});var Ce=l((X7,Xc)=>{var Kc=ke(),P0=Gc(),L0=Jc(),k0="[object Null]",M0="[object Undefined]",Yc=Kc?Kc.toStringTag:void 0;function B0(r){return r==null?r===void 0?M0:k0:Yc&&Yc in Object(r)?P0(r):L0(r)}Xc.exports=B0});var Z=l((Z7,Zc)=>{function j0(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}Zc.exports=j0});var Er=l((eX,eh)=>{var D0=Ce(),F0=Z(),Q0="[object AsyncFunction]",U0="[object Function]",H0="[object GeneratorFunction]",W0="[object Proxy]";function V0(r){if(!F0(r))return!1;var e=D0(r);return e==U0||e==H0||e==Q0||e==W0}eh.exports=V0});var rh=l((tX,th)=>{var G0=fe(),z0=G0["__core-js_shared__"];th.exports=z0});var sh=l((rX,ih)=>{var ks=rh(),nh=function(){var r=/[^.]+$/.exec(ks&&ks.keys&&ks.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function J0(r){return!!nh&&nh in r}ih.exports=J0});var Ms=l((nX,oh)=>{var K0=Function.prototype,Y0=K0.toString;function X0(r){if(r!=null){try{return Y0.call(r)}catch{}try{return r+""}catch{}}return""}oh.exports=X0});var uh=l((iX,ah)=>{var Z0=Er(),eS=sh(),tS=Z(),rS=Ms(),nS=/[\\^$.*+?()[\]{}|]/g,iS=/^\[object .+?Constructor\]$/,sS=Function.prototype,oS=Object.prototype,aS=sS.toString,uS=oS.hasOwnProperty,lS=RegExp("^"+aS.call(uS).replace(nS,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function cS(r){if(!tS(r)||eS(r))return!1;var e=Z0(r)?lS:iS;return e.test(rS(r))}ah.exports=cS});var ch=l((sX,lh)=>{function hS(r,e){return r?.[e]}lh.exports=hS});var Me=l((oX,hh)=>{var fS=uh(),dS=ch();function pS(r,e){var t=dS(r,e);return fS(t)?t:void 0}hh.exports=pS});var In=l((aX,fh)=>{var mS=Me(),gS=fe(),yS=mS(gS,"Map");fh.exports=yS});var Cr=l((uX,dh)=>{var bS=Me(),wS=bS(Object,"create");dh.exports=wS});var gh=l((lX,mh)=>{var ph=Cr();function _S(){this.__data__=ph?ph(null):{},this.size=0}mh.exports=_S});var bh=l((cX,yh)=>{function qS(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}yh.exports=qS});var _h=l((hX,wh)=>{var ES=Cr(),CS="__lodash_hash_undefined__",vS=Object.prototype,xS=vS.hasOwnProperty;function TS(r){var e=this.__data__;if(ES){var t=e[r];return t===CS?void 0:t}return xS.call(e,r)?e[r]:void 0}wh.exports=TS});var Eh=l((fX,qh)=>{var AS=Cr(),SS=Object.prototype,NS=SS.hasOwnProperty;function OS(r){var e=this.__data__;return AS?e[r]!==void 0:NS.call(e,r)}qh.exports=OS});var vh=l((dX,Ch)=>{var RS=Cr(),IS="__lodash_hash_undefined__";function $S(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=RS&&e===void 0?IS:e,this}Ch.exports=$S});var Th=l((pX,xh)=>{var PS=gh(),LS=bh(),kS=_h(),MS=Eh(),BS=vh();function Rt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Rt.prototype.clear=PS;Rt.prototype.delete=LS;Rt.prototype.get=kS;Rt.prototype.has=MS;Rt.prototype.set=BS;xh.exports=Rt});var Nh=l((mX,Sh)=>{var Ah=Th(),jS=_r(),DS=In();function FS(){this.size=0,this.__data__={hash:new Ah,map:new(DS||jS),string:new Ah}}Sh.exports=FS});var Rh=l((gX,Oh)=>{function QS(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}Oh.exports=QS});var vr=l((yX,Ih)=>{var US=Rh();function HS(r,e){var t=r.__data__;return US(e)?t[typeof e=="string"?"string":"hash"]:t.map}Ih.exports=HS});var Ph=l((bX,$h)=>{var WS=vr();function VS(r){var e=WS(this,r).delete(r);return this.size-=e?1:0,e}$h.exports=VS});var kh=l((wX,Lh)=>{var GS=vr();function zS(r){return GS(this,r).get(r)}Lh.exports=zS});var Bh=l((_X,Mh)=>{var JS=vr();function KS(r){return JS(this,r).has(r)}Mh.exports=KS});var Dh=l((qX,jh)=>{var YS=vr();function XS(r,e){var t=YS(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}jh.exports=XS});var $n=l((EX,Fh)=>{var ZS=Nh(),eN=Ph(),tN=kh(),rN=Bh(),nN=Dh();function It(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}It.prototype.clear=ZS;It.prototype.delete=eN;It.prototype.get=tN;It.prototype.has=rN;It.prototype.set=nN;Fh.exports=It});var Uh=l((CX,Qh)=>{var iN=_r(),sN=In(),oN=$n(),aN=200;function uN(r,e){var t=this.__data__;if(t instanceof iN){var n=t.__data__;if(!sN||n.length<aN-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new oN(n)}return t.set(r,e),this.size=t.size,this}Qh.exports=uN});var xr=l((vX,Hh)=>{var lN=_r(),cN=Pc(),hN=kc(),fN=Bc(),dN=Dc(),pN=Uh();function $t(r){var e=this.__data__=new lN(r);this.size=e.size}$t.prototype.clear=cN;$t.prototype.delete=hN;$t.prototype.get=fN;$t.prototype.has=dN;$t.prototype.set=pN;Hh.exports=$t});var Pn=l((xX,Wh)=>{function mN(r,e){for(var t=-1,n=r==null?0:r.length;++t<n&&e(r[t],t,r)!==!1;);return r}Wh.exports=mN});var Bs=l((TX,Vh)=>{var gN=Me(),yN=function(){try{var r=gN(Object,"defineProperty");return r({},"",{}),r}catch{}}();Vh.exports=yN});var Tr=l((AX,zh)=>{var Gh=Bs();function bN(r,e,t){e=="__proto__"&&Gh?Gh(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}zh.exports=bN});var Ar=l((SX,Jh)=>{var wN=Tr(),_N=Le(),qN=Object.prototype,EN=qN.hasOwnProperty;function CN(r,e,t){var n=r[e];(!(EN.call(r,e)&&_N(n,t))||t===void 0&&!(e in r))&&wN(r,e,t)}Jh.exports=CN});var ve=l((NX,Kh)=>{var vN=Ar(),xN=Tr();function TN(r,e,t,n){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],u=n?n(t[a],r[a],a,t,r):void 0;u===void 0&&(u=r[a]),i?xN(t,a,u):vN(t,a,u)}return t}Kh.exports=TN});var Xh=l((OX,Yh)=>{function AN(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}Yh.exports=AN});var se=l((RX,Zh)=>{function SN(r){return r!=null&&typeof r=="object"}Zh.exports=SN});var tf=l((IX,ef)=>{var NN=Ce(),ON=se(),RN="[object Arguments]";function IN(r){return ON(r)&&NN(r)==RN}ef.exports=IN});var Pt=l(($X,sf)=>{var rf=tf(),$N=se(),nf=Object.prototype,PN=nf.hasOwnProperty,LN=nf.propertyIsEnumerable,kN=rf(function(){return arguments}())?rf:function(r){return $N(r)&&PN.call(r,"callee")&&!LN.call(r,"callee")};sf.exports=kN});var I=l((PX,of)=>{var MN=Array.isArray;of.exports=MN});var uf=l((LX,af)=>{function BN(){return!1}af.exports=BN});var it=l((Sr,Lt)=>{var jN=fe(),DN=uf(),hf=typeof Sr=="object"&&Sr&&!Sr.nodeType&&Sr,lf=hf&&typeof Lt=="object"&&Lt&&!Lt.nodeType&&Lt,FN=lf&&lf.exports===hf,cf=FN?jN.Buffer:void 0,QN=cf?cf.isBuffer:void 0,UN=QN||DN;Lt.exports=UN});var Nr=l((kX,ff)=>{var HN=9007199254740991,WN=/^(?:0|[1-9]\d*)$/;function VN(r,e){var t=typeof r;return e=e??HN,!!e&&(t=="number"||t!="symbol"&&WN.test(r))&&r>-1&&r%1==0&&r<e}ff.exports=VN});var Ln=l((MX,df)=>{var GN=9007199254740991;function zN(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=GN}df.exports=zN});var mf=l((BX,pf)=>{var JN=Ce(),KN=Ln(),YN=se(),XN="[object Arguments]",ZN="[object Array]",eO="[object Boolean]",tO="[object Date]",rO="[object Error]",nO="[object Function]",iO="[object Map]",sO="[object Number]",oO="[object Object]",aO="[object RegExp]",uO="[object Set]",lO="[object String]",cO="[object WeakMap]",hO="[object ArrayBuffer]",fO="[object DataView]",dO="[object Float32Array]",pO="[object Float64Array]",mO="[object Int8Array]",gO="[object Int16Array]",yO="[object Int32Array]",bO="[object Uint8Array]",wO="[object Uint8ClampedArray]",_O="[object Uint16Array]",qO="[object Uint32Array]",N={};N[dO]=N[pO]=N[mO]=N[gO]=N[yO]=N[bO]=N[wO]=N[_O]=N[qO]=!0;N[XN]=N[ZN]=N[hO]=N[eO]=N[fO]=N[tO]=N[rO]=N[nO]=N[iO]=N[sO]=N[oO]=N[aO]=N[uO]=N[lO]=N[cO]=!1;function EO(r){return YN(r)&&KN(r.length)&&!!N[JN(r)]}pf.exports=EO});var kt=l((jX,gf)=>{function CO(r){return function(e){return r(e)}}gf.exports=CO});var kn=l((Or,Mt)=>{var vO=Ls(),yf=typeof Or=="object"&&Or&&!Or.nodeType&&Or,Rr=yf&&typeof Mt=="object"&&Mt&&!Mt.nodeType&&Mt,xO=Rr&&Rr.exports===yf,js=xO&&vO.process,TO=function(){try{var r=Rr&&Rr.require&&Rr.require("util").types;return r||js&&js.binding&&js.binding("util")}catch{}}();Mt.exports=TO});var st=l((DX,_f)=>{var AO=mf(),SO=kt(),bf=kn(),wf=bf&&bf.isTypedArray,NO=wf?SO(wf):AO;_f.exports=NO});var Ds=l((FX,qf)=>{var OO=Xh(),RO=Pt(),IO=I(),$O=it(),PO=Nr(),LO=st(),kO=Object.prototype,MO=kO.hasOwnProperty;function BO(r,e){var t=IO(r),n=!t&&RO(r),i=!t&&!n&&$O(r),s=!t&&!n&&!i&&LO(r),o=t||n||i||s,a=o?OO(r.length,String):[],u=a.length;for(var c in r)(e||MO.call(r,c))&&!(o&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||PO(c,u)))&&a.push(c);return a}qf.exports=BO});var Bt=l((QX,Ef)=>{var jO=Object.prototype;function DO(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||jO;return r===t}Ef.exports=DO});var Fs=l((UX,Cf)=>{function FO(r,e){return function(t){return r(e(t))}}Cf.exports=FO});var xf=l((HX,vf)=>{var QO=Fs(),UO=QO(Object.keys,Object);vf.exports=UO});var Qs=l((WX,Tf)=>{var HO=Bt(),WO=xf(),VO=Object.prototype,GO=VO.hasOwnProperty;function zO(r){if(!HO(r))return WO(r);var e=[];for(var t in Object(r))GO.call(r,t)&&t!="constructor"&&e.push(t);return e}Tf.exports=zO});var de=l((VX,Af)=>{var JO=Er(),KO=Ln();function YO(r){return r!=null&&KO(r.length)&&!JO(r)}Af.exports=YO});var xe=l((GX,Sf)=>{var XO=Ds(),ZO=Qs(),eR=de();function tR(r){return eR(r)?XO(r):ZO(r)}Sf.exports=tR});var Of=l((zX,Nf)=>{var rR=ve(),nR=xe();function iR(r,e){return r&&rR(e,nR(e),r)}Nf.exports=iR});var If=l((JX,Rf)=>{function sR(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}Rf.exports=sR});var Pf=l((KX,$f)=>{var oR=Z(),aR=Bt(),uR=If(),lR=Object.prototype,cR=lR.hasOwnProperty;function hR(r){if(!oR(r))return uR(r);var e=aR(r),t=[];for(var n in r)n=="constructor"&&(e||!cR.call(r,n))||t.push(n);return t}$f.exports=hR});var Te=l((YX,Lf)=>{var fR=Ds(),dR=Pf(),pR=de();function mR(r){return pR(r)?fR(r,!0):dR(r)}Lf.exports=mR});var Mf=l((XX,kf)=>{var gR=ve(),yR=Te();function bR(r,e){return r&&gR(e,yR(e),r)}kf.exports=bR});var Us=l((Ir,jt)=>{var wR=fe(),Ff=typeof Ir=="object"&&Ir&&!Ir.nodeType&&Ir,Bf=Ff&&typeof jt=="object"&&jt&&!jt.nodeType&&jt,_R=Bf&&Bf.exports===Ff,jf=_R?wR.Buffer:void 0,Df=jf?jf.allocUnsafe:void 0;function qR(r,e){if(e)return r.slice();var t=r.length,n=Df?Df(t):new r.constructor(t);return r.copy(n),n}jt.exports=qR});var Mn=l((ZX,Qf)=>{function ER(r,e){var t=-1,n=r.length;for(e||(e=Array(n));++t<n;)e[t]=r[t];return e}Qf.exports=ER});var Bn=l((eZ,Uf)=>{function CR(r,e){for(var t=-1,n=r==null?0:r.length,i=0,s=[];++t<n;){var o=r[t];e(o,t,r)&&(s[i++]=o)}return s}Uf.exports=CR});var Hs=l((tZ,Hf)=>{function vR(){return[]}Hf.exports=vR});var jn=l((rZ,Vf)=>{var xR=Bn(),TR=Hs(),AR=Object.prototype,SR=AR.propertyIsEnumerable,Wf=Object.getOwnPropertySymbols,NR=Wf?function(r){return r==null?[]:(r=Object(r),xR(Wf(r),function(e){return SR.call(r,e)}))}:TR;Vf.exports=NR});var zf=l((nZ,Gf)=>{var OR=ve(),RR=jn();function IR(r,e){return OR(r,RR(r),e)}Gf.exports=IR});var Dn=l((iZ,Jf)=>{function $R(r,e){for(var t=-1,n=e.length,i=r.length;++t<n;)r[i+t]=e[t];return r}Jf.exports=$R});var $r=l((sZ,Kf)=>{var PR=Fs(),LR=PR(Object.getPrototypeOf,Object);Kf.exports=LR});var Ws=l((oZ,Yf)=>{var kR=Dn(),MR=$r(),BR=jn(),jR=Hs(),DR=Object.getOwnPropertySymbols,FR=DR?function(r){for(var e=[];r;)kR(e,BR(r)),r=MR(r);return e}:jR;Yf.exports=FR});var Zf=l((aZ,Xf)=>{var QR=ve(),UR=Ws();function HR(r,e){return QR(r,UR(r),e)}Xf.exports=HR});var Vs=l((uZ,ed)=>{var WR=Dn(),VR=I();function GR(r,e,t){var n=e(r);return VR(r)?n:WR(n,t(r))}ed.exports=GR});var Gs=l((lZ,td)=>{var zR=Vs(),JR=jn(),KR=xe();function YR(r){return zR(r,KR,JR)}td.exports=YR});var zs=l((cZ,rd)=>{var XR=Vs(),ZR=Ws(),eI=Te();function tI(r){return XR(r,eI,ZR)}rd.exports=tI});var id=l((hZ,nd)=>{var rI=Me(),nI=fe(),iI=rI(nI,"DataView");nd.exports=iI});var od=l((fZ,sd)=>{var sI=Me(),oI=fe(),aI=sI(oI,"Promise");sd.exports=aI});var Js=l((dZ,ad)=>{var uI=Me(),lI=fe(),cI=uI(lI,"Set");ad.exports=cI});var ld=l((pZ,ud)=>{var hI=Me(),fI=fe(),dI=hI(fI,"WeakMap");ud.exports=dI});var at=l((mZ,gd)=>{var Ks=id(),Ys=In(),Xs=od(),Zs=Js(),eo=ld(),md=Ce(),Dt=Ms(),cd="[object Map]",pI="[object Object]",hd="[object Promise]",fd="[object Set]",dd="[object WeakMap]",pd="[object DataView]",mI=Dt(Ks),gI=Dt(Ys),yI=Dt(Xs),bI=Dt(Zs),wI=Dt(eo),ot=md;(Ks&&ot(new Ks(new ArrayBuffer(1)))!=pd||Ys&&ot(new Ys)!=cd||Xs&&ot(Xs.resolve())!=hd||Zs&&ot(new Zs)!=fd||eo&&ot(new eo)!=dd)&&(ot=function(r){var e=md(r),t=e==pI?r.constructor:void 0,n=t?Dt(t):"";if(n)switch(n){case mI:return pd;case gI:return cd;case yI:return hd;case bI:return fd;case wI:return dd}return e});gd.exports=ot});var bd=l((gZ,yd)=>{var _I=Object.prototype,qI=_I.hasOwnProperty;function EI(r){var e=r.length,t=new r.constructor(e);return e&&typeof r[0]=="string"&&qI.call(r,"index")&&(t.index=r.index,t.input=r.input),t}yd.exports=EI});var to=l((yZ,wd)=>{var CI=fe(),vI=CI.Uint8Array;wd.exports=vI});var Fn=l((bZ,qd)=>{var _d=to();function xI(r){var e=new r.constructor(r.byteLength);return new _d(e).set(new _d(r)),e}qd.exports=xI});var Cd=l((wZ,Ed)=>{var TI=Fn();function AI(r,e){var t=e?TI(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.byteLength)}Ed.exports=AI});var xd=l((_Z,vd)=>{var SI=/\w*$/;function NI(r){var e=new r.constructor(r.source,SI.exec(r));return e.lastIndex=r.lastIndex,e}vd.exports=NI});var Od=l((qZ,Nd)=>{var Td=ke(),Ad=Td?Td.prototype:void 0,Sd=Ad?Ad.valueOf:void 0;function OI(r){return Sd?Object(Sd.call(r)):{}}Nd.exports=OI});var ro=l((EZ,Rd)=>{var RI=Fn();function II(r,e){var t=e?RI(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}Rd.exports=II});var $d=l((CZ,Id)=>{var $I=Fn(),PI=Cd(),LI=xd(),kI=Od(),MI=ro(),BI="[object Boolean]",jI="[object Date]",DI="[object Map]",FI="[object Number]",QI="[object RegExp]",UI="[object Set]",HI="[object String]",WI="[object Symbol]",VI="[object ArrayBuffer]",GI="[object DataView]",zI="[object Float32Array]",JI="[object Float64Array]",KI="[object Int8Array]",YI="[object Int16Array]",XI="[object Int32Array]",ZI="[object Uint8Array]",e$="[object Uint8ClampedArray]",t$="[object Uint16Array]",r$="[object Uint32Array]";function n$(r,e,t){var n=r.constructor;switch(e){case VI:return $I(r);case BI:case jI:return new n(+r);case GI:return PI(r,t);case zI:case JI:case KI:case YI:case XI:case ZI:case e$:case t$:case r$:return MI(r,t);case DI:return new n;case FI:case HI:return new n(r);case QI:return LI(r);case UI:return new n;case WI:return kI(r)}}Id.exports=n$});var no=l((vZ,Ld)=>{var i$=Z(),Pd=Object.create,s$=function(){function r(){}return function(e){if(!i$(e))return{};if(Pd)return Pd(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}();Ld.exports=s$});var io=l((xZ,kd)=>{var o$=no(),a$=$r(),u$=Bt();function l$(r){return typeof r.constructor=="function"&&!u$(r)?o$(a$(r)):{}}kd.exports=l$});var Bd=l((TZ,Md)=>{var c$=at(),h$=se(),f$="[object Map]";function d$(r){return h$(r)&&c$(r)==f$}Md.exports=d$});var Qd=l((AZ,Fd)=>{var p$=Bd(),m$=kt(),jd=kn(),Dd=jd&&jd.isMap,g$=Dd?m$(Dd):p$;Fd.exports=g$});var Hd=l((SZ,Ud)=>{var y$=at(),b$=se(),w$="[object Set]";function _$(r){return b$(r)&&y$(r)==w$}Ud.exports=_$});var zd=l((NZ,Gd)=>{var q$=Hd(),E$=kt(),Wd=kn(),Vd=Wd&&Wd.isSet,C$=Vd?E$(Vd):q$;Gd.exports=C$});var so=l((OZ,Xd)=>{var v$=xr(),x$=Pn(),T$=Ar(),A$=Of(),S$=Mf(),N$=Us(),O$=Mn(),R$=zf(),I$=Zf(),$$=Gs(),P$=zs(),L$=at(),k$=bd(),M$=$d(),B$=io(),j$=I(),D$=it(),F$=Qd(),Q$=Z(),U$=zd(),H$=xe(),W$=Te(),V$=1,G$=2,z$=4,Jd="[object Arguments]",J$="[object Array]",K$="[object Boolean]",Y$="[object Date]",X$="[object Error]",Kd="[object Function]",Z$="[object GeneratorFunction]",eP="[object Map]",tP="[object Number]",Yd="[object Object]",rP="[object RegExp]",nP="[object Set]",iP="[object String]",sP="[object Symbol]",oP="[object WeakMap]",aP="[object ArrayBuffer]",uP="[object DataView]",lP="[object Float32Array]",cP="[object Float64Array]",hP="[object Int8Array]",fP="[object Int16Array]",dP="[object Int32Array]",pP="[object Uint8Array]",mP="[object Uint8ClampedArray]",gP="[object Uint16Array]",yP="[object Uint32Array]",T={};T[Jd]=T[J$]=T[aP]=T[uP]=T[K$]=T[Y$]=T[lP]=T[cP]=T[hP]=T[fP]=T[dP]=T[eP]=T[tP]=T[Yd]=T[rP]=T[nP]=T[iP]=T[sP]=T[pP]=T[mP]=T[gP]=T[yP]=!0;T[X$]=T[Kd]=T[oP]=!1;function Qn(r,e,t,n,i,s){var o,a=e&V$,u=e&G$,c=e&z$;if(t&&(o=i?t(r,n,i,s):t(r)),o!==void 0)return o;if(!Q$(r))return r;var h=j$(r);if(h){if(o=k$(r),!a)return O$(r,o)}else{var f=L$(r),d=f==Kd||f==Z$;if(D$(r))return N$(r,a);if(f==Yd||f==Jd||d&&!i){if(o=u||d?{}:B$(r),!a)return u?I$(r,S$(o,r)):R$(r,A$(o,r))}else{if(!T[f])return i?r:{};o=M$(r,f,a)}}s||(s=new v$);var g=s.get(r);if(g)return g;s.set(r,o),U$(r)?r.forEach(function(_){o.add(Qn(_,e,t,_,r,s))}):F$(r)&&r.forEach(function(_,v){o.set(v,Qn(_,e,t,v,r,s))});var m=c?u?P$:$$:u?W$:H$,y=h?void 0:m(r);return x$(y||r,function(_,v){y&&(v=_,_=r[v]),T$(o,v,Qn(_,e,t,v,r,s))}),o}Xd.exports=Qn});var ep=l((RZ,Zd)=>{var bP=so(),wP=1,_P=4;function qP(r){return bP(r,wP|_P)}Zd.exports=qP});var z=l((IZ,tp)=>{function EP(r){return r}tp.exports=EP});var oo=l(($Z,rp)=>{function CP(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}rp.exports=CP});var sp=l((PZ,ip)=>{var vP=oo(),np=Math.max;function xP(r,e,t){return e=np(e===void 0?r.length-1:e,0),function(){for(var n=arguments,i=-1,s=np(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=t(o),vP(r,this,a)}}ip.exports=xP});var ao=l((LZ,op)=>{function TP(r){return function(){return r}}op.exports=TP});var lp=l((kZ,up)=>{var AP=ao(),ap=Bs(),SP=z(),NP=ap?function(r,e){return ap(r,"toString",{configurable:!0,enumerable:!1,value:AP(e),writable:!0})}:SP;up.exports=NP});var hp=l((MZ,cp)=>{var OP=800,RP=16,IP=Date.now;function $P(r){var e=0,t=0;return function(){var n=IP(),i=RP-(n-t);if(t=n,i>0){if(++e>=OP)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}cp.exports=$P});var dp=l((BZ,fp)=>{var PP=lp(),LP=hp(),kP=LP(PP);fp.exports=kP});var ut=l((jZ,pp)=>{var MP=z(),BP=sp(),jP=dp();function DP(r,e){return jP(BP(r,e,MP),r+"")}pp.exports=DP});var lt=l((DZ,mp)=>{var FP=Le(),QP=de(),UP=Nr(),HP=Z();function WP(r,e,t){if(!HP(t))return!1;var n=typeof e;return(n=="number"?QP(t)&&UP(e,t.length):n=="string"&&e in t)?FP(t[e],r):!1}mp.exports=WP});var uo=l((FZ,yp)=>{var VP=ut(),GP=Le(),zP=lt(),JP=Te(),gp=Object.prototype,KP=gp.hasOwnProperty,YP=VP(function(r,e){r=Object(r);var t=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&zP(e[0],e[1],i)&&(n=1);++t<n;)for(var s=e[t],o=JP(s),a=-1,u=o.length;++a<u;){var c=o[a],h=r[c];(h===void 0||GP(h,gp[c])&&!KP.call(r,c))&&(r[c]=s[c])}return r});yp.exports=YP});var ct=l((QZ,bp)=>{function XP(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}bp.exports=XP});var ht=l((UZ,wp)=>{var ZP=Ce(),e1=se(),t1="[object Symbol]";function r1(r){return typeof r=="symbol"||e1(r)&&ZP(r)==t1}wp.exports=r1});var xp=l((HZ,vp)=>{var _p=ke(),n1=ct(),i1=I(),s1=ht(),o1=1/0,qp=_p?_p.prototype:void 0,Ep=qp?qp.toString:void 0;function Cp(r){if(typeof r=="string")return r;if(i1(r))return n1(r,Cp)+"";if(s1(r))return Ep?Ep.call(r):"";var e=r+"";return e=="0"&&1/r==-o1?"-0":e}vp.exports=Cp});var Pr=l((WZ,Tp)=>{var a1=xp();function u1(r){return r==null?"":a1(r)}Tp.exports=u1});var lo=l((VZ,Ap)=>{var l1=Pr(),c1=0;function h1(r){var e=++c1;return l1(r)+e}Ap.exports=h1});var ft=l((GZ,co)=>{var Un=class extends Error{constructor(e){super(e),this.name="KnexTimeoutError"}};function f1(r,e){return new Promise(function(t,n){let i=setTimeout(function(){n(new Un("operation timed out"))},e);function s(a){clearTimeout(i),t(a)}function o(a){clearTimeout(i),n(a)}r.then(s,o)})}co.exports.KnexTimeoutError=Un;co.exports.timeout=f1});var Np=l((zZ,Sp)=>{function d1(r){r.client.emit("start",r.builder),r.builder.emit("start",r.builder);let e=r.builder.toSQL();return r.builder._debug&&r.client.logger.debug(e),Array.isArray(e)?r.queryArray(e):r.query(e)}function p1(r,e){try{let t=r.builder.toSQL();if(Array.isArray(t)&&e.hasHandler)throw new Error("The stream may only be used with a single query statement.");return r.client.stream(r.connection,t,e.stream,e.options)}catch(t){throw e.stream.emit("error",t),t}}Sp.exports={ensureConnectionCallback:d1,ensureConnectionStreamCallback:p1}});var Ip=l((JZ,Rp)=>{var{KnexTimeoutError:Op}=ft(),{timeout:m1}=ft(),{ensureConnectionCallback:g1,ensureConnectionStreamCallback:y1}=Np(),ho,Lr=class{constructor(e,t){this.client=e,this.builder=t,this.queries=[],this.connection=void 0}async run(){let e=this;try{let t=await this.ensureConnection(g1);return e.builder.emit("end"),t}catch(t){throw e.builder._events&&e.builder._events.error&&e.builder.emit("error",t),t}}stream(e,t){let n=typeof e=="function"&&arguments.length===1,i=n?{}:e,s=n?e:t,o=typeof s=="function";ho=ho||require("stream").Transform;let a=this.builder.queryContext(),u=new ho({objectMode:!0,transform:(h,f,d)=>{d(null,this.client.postProcessResponse(h,a))}});u.on("close",()=>{this.client.releaseConnection(this.connection)});let c=this.ensureConnection(y1,{options:i,hasHandler:o,stream:u}).catch(h=>{this.connection||u.emit("error",h)});return o?(s(u),c):u}pipe(e,t){return this.stream(t).pipe(e)}async query(e){let{__knexUid:t,__knexTxId:n}=this.connection;this.builder.emit("query",Object.assign({__knexUid:t,__knexTxId:n},e));let i=this,s=this.builder.queryContext();e!==null&&typeof e=="object"&&(e.queryContext=s);let o=this.client.query(this.connection,e);return e.timeout&&(o=m1(o,e.timeout)),o.then(a=>this.client.processResponse(a,i)).then(a=>{let u=this.client.postProcessResponse(a,s);return this.builder.emit("query-response",u,Object.assign({__knexUid:t,__knexTxId:n},e),this.builder),this.client.emit("query-response",u,Object.assign({__knexUid:t,__knexTxId:n},e),this.builder),u}).catch(a=>{if(!(a instanceof Op))return Promise.reject(a);let{timeout:u,sql:c,bindings:h}=e,f;return e.cancelOnTimeout?f=this.client.cancelQuery(this.connection):(this.connection.__knex__disposed=a,f=Promise.resolve()),f.catch(d=>{throw this.connection.__knex__disposed=a,Object.assign(d,{message:`After query timeout of ${u}ms exceeded, cancelling of query failed.`,sql:c,bindings:h,timeout:u})}).then(()=>{throw Object.assign(a,{message:`Defined query timeout of ${u}ms exceeded when running query.`,sql:c,bindings:h,timeout:u})})}).catch(a=>{throw this.builder.emit("query-error",a,Object.assign({__knexUid:t,__knexTxId:n,queryContext:s},e)),a})}async queryArray(e){if(e.length===1){let n=e[0];if(!n.statementsProducer)return this.query(n);let i=await n.statementsProducer(void 0,this.connection),s=i.sql.map(c=>({sql:c,bindings:n.bindings})),o=i.pre.map(c=>({sql:c,bindings:n.bindings})),a=i.post.map(c=>({sql:c,bindings:n.bindings})),u=[];await this.queryArray(o);try{await this.client.transaction(async c=>{let h=new Lr(c.client,this.builder);if(h.connection=this.connection,u=await h.queryArray(s),i.check&&(await c.raw(i.check)).length>0)throw new Error("FOREIGN KEY constraint failed")},{connection:this.connection})}finally{await this.queryArray(a)}return u}let t=[];for(let n of e)t.push(await this.queryArray([n]));return t}async ensureConnection(e,t){if(this.builder._connection&&(this.connection=this.builder._connection),this.connection)return e(this,t);let n;try{n=await this.client.acquireConnection()}catch(i){if(!(i instanceof Op))return Promise.reject(i);throw this.builder&&(i.sql=this.builder.sql,i.bindings=this.builder.bindings),i}try{return this.connection=n,await e(this,t)}finally{await this.client.releaseConnection(n)}}};Rp.exports=Lr});var Pp=l((KZ,$p)=>{var Ft=1e3,Qt=Ft*60,Ut=Qt*60,dt=Ut*24,b1=dt*7,w1=dt*365.25;$p.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return _1(r);if(t==="number"&&isFinite(r))return e.long?E1(r):q1(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function _1(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*w1;case"weeks":case"week":case"w":return t*b1;case"days":case"day":case"d":return t*dt;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ut;case"minutes":case"minute":case"mins":case"min":case"m":return t*Qt;case"seconds":case"second":case"secs":case"sec":case"s":return t*Ft;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function q1(r){var e=Math.abs(r);return e>=dt?Math.round(r/dt)+"d":e>=Ut?Math.round(r/Ut)+"h":e>=Qt?Math.round(r/Qt)+"m":e>=Ft?Math.round(r/Ft)+"s":r+"ms"}function E1(r){var e=Math.abs(r);return e>=dt?Hn(r,e,dt,"day"):e>=Ut?Hn(r,e,Ut,"hour"):e>=Qt?Hn(r,e,Qt,"minute"):e>=Ft?Hn(r,e,Ft,"second"):r+" ms"}function Hn(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var fo=l((YZ,Lp)=>{function C1(r){t.debug=t,t.default=t,t.coerce=u,t.disable=s,t.enable=i,t.enabled=o,t.humanize=Pp(),t.destroy=c,Object.keys(r).forEach(h=>{t[h]=r[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let f=0;for(let d=0;d<h.length;d++)f=(f<<5)-f+h.charCodeAt(d),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(h){let f,d=null,g,m;function y(..._){if(!y.enabled)return;let v=y,x=Number(new Date),he=x-(f||x);v.diff=he,v.prev=f,v.curr=x,f=x,_[0]=t.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let ie=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(Es,NA)=>{if(Es==="%%")return"%";ie++;let ec=t.formatters[NA];if(typeof ec=="function"){let OA=_[ie];Es=ec.call(v,OA),_.splice(ie,1),ie--}return Es}),t.formatArgs.call(v,_),(v.log||t.log).apply(v,_)}return y.namespace=h,y.useColors=t.useColors(),y.color=t.selectColor(h),y.extend=n,y.destroy=t.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(g!==t.namespaces&&(g=t.namespaces,m=t.enabled(h)),m),set:_=>{d=_}}),typeof t.init=="function"&&t.init(y),y}function n(h,f){let d=t(this.namespace+(typeof f>"u"?":":f)+h);return d.log=this.log,d}function i(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let f,d=(typeof h=="string"?h:"").split(/[\s,]+/),g=d.length;for(f=0;f<g;f++)d[f]&&(h=d[f].replace(/\*/g,".*?"),h[0]==="-"?t.skips.push(new RegExp("^"+h.slice(1)+"$")):t.names.push(new RegExp("^"+h+"$")))}function s(){let h=[...t.names.map(a),...t.skips.map(a).map(f=>"-"+f)].join(",");return t.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let f,d;for(f=0,d=t.skips.length;f<d;f++)if(t.skips[f].test(h))return!1;for(f=0,d=t.names.length;f<d;f++)if(t.names[f].test(h))return!0;return!1}function a(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function u(h){return h instanceof Error?h.stack||h.message:h}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Lp.exports=C1});var kp=l((ee,Wn)=>{ee.formatArgs=x1;ee.save=T1;ee.load=A1;ee.useColors=v1;ee.storage=S1();ee.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ee.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function v1(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function x1(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Wn.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}ee.log=console.debug||console.log||(()=>{});function T1(r){try{r?ee.storage.setItem("debug",r):ee.storage.removeItem("debug")}catch{}}function A1(){let r;try{r=ee.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function S1(){try{return localStorage}catch{}}Wn.exports=fo()(ee);var{formatters:N1}=Wn.exports;N1.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Bp=l((XZ,Mp)=>{"use strict";Mp.exports=(r,e=process.argv)=>{let t=r.startsWith("-")?"":r.length===1?"-":"--",n=e.indexOf(t+r),i=e.indexOf("--");return n!==-1&&(i===-1||n<i)}});var Fp=l((ZZ,Dp)=>{"use strict";var O1=require("os"),jp=require("tty"),oe=Bp(),{env:j}=process,Be;oe("no-color")||oe("no-colors")||oe("color=false")||oe("color=never")?Be=0:(oe("color")||oe("colors")||oe("color=true")||oe("color=always"))&&(Be=1);"FORCE_COLOR"in j&&(j.FORCE_COLOR==="true"?Be=1:j.FORCE_COLOR==="false"?Be=0:Be=j.FORCE_COLOR.length===0?1:Math.min(parseInt(j.FORCE_COLOR,10),3));function po(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function mo(r,e){if(Be===0)return 0;if(oe("color=16m")||oe("color=full")||oe("color=truecolor"))return 3;if(oe("color=256"))return 2;if(r&&!e&&Be===void 0)return 0;let t=Be||0;if(j.TERM==="dumb")return t;if(process.platform==="win32"){let n=O1.release().split(".");return Number(n[0])>=10&&Number(n[2])>=10586?Number(n[2])>=14931?3:2:1}if("CI"in j)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(n=>n in j)||j.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in j)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(j.TEAMCITY_VERSION)?1:0;if(j.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in j){let n=parseInt((j.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(j.TERM_PROGRAM){case"iTerm.app":return n>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(j.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(j.TERM)||"COLORTERM"in j?1:t}function R1(r){let e=mo(r,r&&r.isTTY);return po(e)}Dp.exports={supportsColor:R1,stdout:po(mo(!0,jp.isatty(1))),stderr:po(mo(!0,jp.isatty(2)))}});var Up=l((W,Gn)=>{var I1=require("tty"),Vn=require("util");W.init=j1;W.log=k1;W.formatArgs=P1;W.save=M1;W.load=B1;W.useColors=$1;W.destroy=Vn.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");W.colors=[6,2,3,4,5,1];try{let r=Fp();r&&(r.stderr||r).level>=2&&(W.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}W.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,s)=>s.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function $1(){return"colors"in W.inspectOpts?!!W.inspectOpts.colors:I1.isatty(process.stderr.fd)}function P1(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),s=`  ${i};1m${e} \x1B[0m`;r[0]=s+r[0].split(`
`).join(`
`+s),r.push(i+"m+"+Gn.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=L1()+e+" "+r[0]}function L1(){return W.inspectOpts.hideDate?"":new Date().toISOString()+" "}function k1(...r){return process.stderr.write(Vn.format(...r)+`
`)}function M1(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function B1(){return process.env.DEBUG}function j1(r){r.inspectOpts={};let e=Object.keys(W.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=W.inspectOpts[e[t]]}Gn.exports=fo()(W);var{formatters:Qp}=Gn.exports;Qp.o=function(r){return this.inspectOpts.colors=this.useColors,Vn.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};Qp.O=function(r){return this.inspectOpts.colors=this.useColors,Vn.inspect(r,this.inspectOpts)}});var ae=l((eee,go)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?go.exports=kp():go.exports=Up()});var Wp=l((tee,Hp)=>{var D1="__lodash_hash_undefined__";function F1(r){return this.__data__.set(r,D1),this}Hp.exports=F1});var Gp=l((ree,Vp)=>{function Q1(r){return this.__data__.has(r)}Vp.exports=Q1});var Jn=l((nee,zp)=>{var U1=$n(),H1=Wp(),W1=Gp();function zn(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new U1;++e<t;)this.add(r[e])}zn.prototype.add=zn.prototype.push=H1;zn.prototype.has=W1;zp.exports=zn});var Kp=l((iee,Jp)=>{function V1(r,e,t,n){for(var i=r.length,s=t+(n?1:-1);n?s--:++s<i;)if(e(r[s],s,r))return s;return-1}Jp.exports=V1});var Xp=l((see,Yp)=>{function G1(r){return r!==r}Yp.exports=G1});var em=l((oee,Zp)=>{function z1(r,e,t){for(var n=t-1,i=r.length;++n<i;)if(r[n]===e)return n;return-1}Zp.exports=z1});var Kn=l((aee,tm)=>{var J1=Kp(),K1=Xp(),Y1=em();function X1(r,e,t){return e===e?Y1(r,e,t):J1(r,K1,t)}tm.exports=X1});var yo=l((uee,rm)=>{var Z1=Kn();function eL(r,e){var t=r==null?0:r.length;return!!t&&Z1(r,e,0)>-1}rm.exports=eL});var bo=l((lee,nm)=>{function tL(r,e,t){for(var n=-1,i=r==null?0:r.length;++n<i;)if(t(e,r[n]))return!0;return!1}nm.exports=tL});var Yn=l((cee,im)=>{function rL(r,e){return r.has(e)}im.exports=rL});var om=l((hee,sm)=>{var nL=Jn(),iL=yo(),sL=bo(),oL=ct(),aL=kt(),uL=Yn(),lL=200;function cL(r,e,t,n){var i=-1,s=iL,o=!0,a=r.length,u=[],c=e.length;if(!a)return u;t&&(e=oL(e,aL(t))),n?(s=sL,o=!1):e.length>=lL&&(s=uL,o=!1,e=new nL(e));e:for(;++i<a;){var h=r[i],f=t==null?h:t(h);if(h=n||h!==0?h:0,o&&f===f){for(var d=c;d--;)if(e[d]===f)continue e;u.push(h)}else s(e,f,n)||u.push(h)}return u}sm.exports=cL});var cm=l((fee,lm)=>{var am=ke(),hL=Pt(),fL=I(),um=am?am.isConcatSpreadable:void 0;function dL(r){return fL(r)||hL(r)||!!(um&&r&&r[um])}lm.exports=dL});var Xn=l((dee,fm)=>{var pL=Dn(),mL=cm();function hm(r,e,t,n,i){var s=-1,o=r.length;for(t||(t=mL),i||(i=[]);++s<o;){var a=r[s];e>0&&t(a)?e>1?hm(a,e-1,t,n,i):pL(i,a):n||(i[i.length]=a)}return i}fm.exports=hm});var wo=l((pee,dm)=>{var gL=de(),yL=se();function bL(r){return yL(r)&&gL(r)}dm.exports=bL});var _o=l((mee,pm)=>{function wL(r){var e=r==null?0:r.length;return e?r[e-1]:void 0}pm.exports=wL});var gm=l((gee,mm)=>{var _L=om(),qL=Xn(),EL=ut(),qo=wo(),CL=_o(),vL=EL(function(r,e){var t=CL(e);return qo(t)&&(t=void 0),qo(r)?_L(r,qL(e,1,qo,!0),void 0,t):[]});mm.exports=vL});var Zn=l((yee,ym)=>{var xL=I(),TL=ht(),AL=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,SL=/^\w*$/;function NL(r,e){if(xL(r))return!1;var t=typeof r;return t=="number"||t=="symbol"||t=="boolean"||r==null||TL(r)?!0:SL.test(r)||!AL.test(r)||e!=null&&r in Object(e)}ym.exports=NL});var _m=l((bee,wm)=>{var bm=$n(),OL="Expected a function";function Eo(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError(OL);var t=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=t.cache;if(s.has(i))return s.get(i);var o=r.apply(this,n);return t.cache=s.set(i,o)||s,o};return t.cache=new(Eo.Cache||bm),t}Eo.Cache=bm;wm.exports=Eo});var Em=l((wee,qm)=>{var RL=_m(),IL=500;function $L(r){var e=RL(r,function(n){return t.size===IL&&t.clear(),n}),t=e.cache;return e}qm.exports=$L});var vm=l((_ee,Cm)=>{var PL=Em(),LL=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,kL=/\\(\\)?/g,ML=PL(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(LL,function(t,n,i,s){e.push(i?s.replace(kL,"$1"):n||t)}),e});Cm.exports=ML});var kr=l((qee,xm)=>{var BL=I(),jL=Zn(),DL=vm(),FL=Pr();function QL(r,e){return BL(r)?r:jL(r,e)?[r]:DL(FL(r))}xm.exports=QL});var Ht=l((Eee,Tm)=>{var UL=ht(),HL=1/0;function WL(r){if(typeof r=="string"||UL(r))return r;var e=r+"";return e=="0"&&1/r==-HL?"-0":e}Tm.exports=WL});var Mr=l((Cee,Am)=>{var VL=kr(),GL=Ht();function zL(r,e){e=VL(e,r);for(var t=0,n=e.length;r!=null&&t<n;)r=r[GL(e[t++])];return t&&t==n?r:void 0}Am.exports=zL});var Co=l((vee,Sm)=>{var JL=Mr();function KL(r,e,t){var n=r==null?void 0:JL(r,e);return n===void 0?t:n}Sm.exports=KL});var te=l((xee,Nm)=>{var YL=Qs(),XL=at(),ZL=Pt(),ek=I(),tk=de(),rk=it(),nk=Bt(),ik=st(),sk="[object Map]",ok="[object Set]",ak=Object.prototype,uk=ak.hasOwnProperty;function lk(r){if(r==null)return!0;if(tk(r)&&(ek(r)||typeof r=="string"||typeof r.splice=="function"||rk(r)||ik(r)||ZL(r)))return!r.length;var e=XL(r);if(e==sk||e==ok)return!r.size;if(nk(r))return!YL(r).length;for(var t in r)if(uk.call(r,t))return!1;return!0}Nm.exports=lk});var Rm=l((Tee,Om)=>{var ck=ht();function hk(r,e,t){for(var n=-1,i=r.length;++n<i;){var s=r[n],o=e(s);if(o!=null&&(a===void 0?o===o&&!ck(o):t(o,a)))var a=o,u=s}return u}Om.exports=hk});var $m=l((Aee,Im)=>{function fk(r,e){return r>e}Im.exports=fk});var Lm=l((See,Pm)=>{var dk=Rm(),pk=$m(),mk=z();function gk(r){return r&&r.length?dk(r,mk,pk):void 0}Pm.exports=gk});var ei=l((Nee,km)=>{function yk(r,e){return e?`${e}.${r}`:r}function bk(r,e,t){return t?r(e).withSchema(t):r(e)}function vo(r){return r+"_lock"}function wk(r,e){return e?e+"."+vo(r):vo(r)}km.exports={getLockTableName:vo,getLockTableNameWithSchema:wk,getTable:bk,getTableName:yk}});var xo=l((Oee,Mm)=>{var{getTable:_k,getLockTableName:qk,getLockTableNameWithSchema:Ek,getTableName:Ck}=ei();function vk(r,e,t){let n=qk(r);return Br(t,e).hasTable(r).then(i=>!i&&xk(r,e,t)).then(()=>Br(t,e).hasTable(n)).then(i=>!i&&Tk(n,e,t)).then(()=>_k(t,n,e).select("*")).then(i=>!i.length&&Ak(r,e,t))}function xk(r,e,t){return Br(t,e).createTable(Ck(r),function(n){n.increments(),n.string("name"),n.integer("batch"),n.timestamp("migration_time")})}function Tk(r,e,t){return Br(t,e).createTable(r,function(n){n.increments("index").primary(),n.integer("is_locked")})}function Ak(r,e,t){let n=Ek(r,e);return t.select("*").from(n).then(i=>i.length?null:t.from(n).insert({is_locked:0}))}function Br(r,e){return e?r.schema.withSchema(e):r.schema}Mm.exports={ensureTable:vk,getSchemaBuilder:Br}});var Fm=l((Ree,Dm)=>{var{getTableName:Sk}=ei(),{ensureTable:Nk}=xo();function Bm(r,e){return r.getMigrations(e)}async function jm(r,e,t){return await Nk(r,e,t),await t.from(Sk(r,e)).orderBy("id").select("name")}function Ok(r,e){return Promise.all([Bm(r.migrationSource,r.loadExtensions),jm(r.tableName,r.schemaName,e)])}Dm.exports={listAll:Bm,listAllAndCompleted:Ok,listCompleted:jm}});var jr=l((Iee,Qm)=>{var Rk=ut(),Ik=lt();function $k(r){return Rk(function(e,t){var n=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=r.length>3&&typeof s=="function"?(i--,s):void 0,o&&Ik(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=t[n];a&&r(e,a,n,s)}return e})}Qm.exports=$k});var Hm=l(($ee,Um)=>{var Pk=ve(),Lk=jr(),kk=Te(),Mk=Lk(function(r,e,t,n){Pk(e,kk(e),r,n)});Um.exports=Mk});var we=l((Pee,Vm)=>{var Bk=Ce(),jk=$r(),Dk=se(),Fk="[object Object]",Qk=Function.prototype,Uk=Object.prototype,Wm=Qk.toString,Hk=Uk.hasOwnProperty,Wk=Wm.call(Object);function Vk(r){if(!Dk(r)||Bk(r)!=Fk)return!1;var e=jk(r);if(e===null)return!0;var t=Hk.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&Wm.call(t)==Wk}Vm.exports=Vk});var To=l((Lee,Gm)=>{var Gk=Ce(),zk=se(),Jk=we(),Kk="[object DOMException]",Yk="[object Error]";function Xk(r){if(!zk(r))return!1;var e=Gk(r);return e==Yk||e==Kk||typeof r.message=="string"&&typeof r.name=="string"&&!Jk(r)}Gm.exports=Xk});var Jm=l((kee,zm)=>{var Zk=oo(),eM=ut(),tM=To(),rM=eM(function(r,e){try{return Zk(r,void 0,e)}catch(t){return tM(t)?t:new Error(t)}});zm.exports=rM});var Ao=l((Mee,Km)=>{var nM=ct();function iM(r,e){return nM(e,function(t){return r[t]})}Km.exports=iM});var Zm=l((Bee,Xm)=>{var sM=Le(),Ym=Object.prototype,oM=Ym.hasOwnProperty;function aM(r,e,t,n){return r===void 0||sM(r,Ym[t])&&!oM.call(n,t)?e:r}Xm.exports=aM});var tg=l((jee,eg)=>{var uM={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};function lM(r){return"\\"+uM[r]}eg.exports=lM});var So=l((Dee,rg)=>{var cM=/<%=([\s\S]+?)%>/g;rg.exports=cM});var ig=l((Fee,ng)=>{function hM(r){return function(e){return r?.[e]}}ng.exports=hM});var og=l((Qee,sg)=>{var fM=ig(),dM={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},pM=fM(dM);sg.exports=pM});var lg=l((Uee,ug)=>{var mM=og(),gM=Pr(),ag=/[&<>"']/g,yM=RegExp(ag.source);function bM(r){return r=gM(r),r&&yM.test(r)?r.replace(ag,mM):r}ug.exports=bM});var hg=l((Hee,cg)=>{var wM=/<%-([\s\S]+?)%>/g;cg.exports=wM});var dg=l((Wee,fg)=>{var _M=/<%([\s\S]+?)%>/g;fg.exports=_M});var mg=l((Vee,pg)=>{var qM=lg(),EM=hg(),CM=dg(),vM=So(),xM={escape:EM,evaluate:CM,interpolate:vM,variable:"",imports:{_:{escape:qM}}};pg.exports=xM});var qg=l((Gee,_g)=>{var gg=Hm(),TM=Jm(),AM=Ao(),yg=Zm(),SM=tg(),NM=To(),OM=lt(),RM=xe(),IM=So(),bg=mg(),$M=Pr(),PM="Invalid `variable` option passed into `_.template`",LM=/\b__p \+= '';/g,kM=/\b(__p \+=) '' \+/g,MM=/(__e\(.*?\)|\b__t\)) \+\n'';/g,BM=/[()=,{}\[\]\/\s]/,jM=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ti=/($^)/,DM=/['\n\r\u2028\u2029\\]/g,FM=Object.prototype,wg=FM.hasOwnProperty;function QM(r,e,t){var n=bg.imports._.templateSettings||bg;t&&OM(r,e,t)&&(e=void 0),r=$M(r),e=gg({},e,n,yg);var i=gg({},e.imports,n.imports,yg),s=RM(i),o=AM(i,s),a,u,c=0,h=e.interpolate||ti,f="__p += '",d=RegExp((e.escape||ti).source+"|"+h.source+"|"+(h===IM?jM:ti).source+"|"+(e.evaluate||ti).source+"|$","g"),g=wg.call(e,"sourceURL")?"//# sourceURL="+(e.sourceURL+"").replace(/\s/g," ")+`
`:"";r.replace(d,function(_,v,x,he,ie,Pe){return x||(x=he),f+=r.slice(c,Pe).replace(DM,SM),v&&(a=!0,f+=`' +
__e(`+v+`) +
'`),ie&&(u=!0,f+=`';
`+ie+`;
__p += '`),x&&(f+=`' +
((__t = (`+x+`)) == null ? '' : __t) +
'`),c=Pe+_.length,_}),f+=`';
`;var m=wg.call(e,"variable")&&e.variable;if(!m)f=`with (obj) {
`+f+`
}
`;else if(BM.test(m))throw new Error(PM);f=(u?f.replace(LM,""):f).replace(kM,"$1").replace(MM,"$1;"),f="function("+(m||"obj")+`) {
`+(m?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(a?", __e = _.escape":"")+(u?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+f+`return __p
}`;var y=TM(function(){return Function(s,g+"return "+f).apply(void 0,o)});if(y.source=f,NM(y))throw y;return y}_g.exports=QM});var Dr=l((zee,Eg)=>{var UM=Xn();function HM(r){var e=r==null?0:r.length;return e?UM(r,1):[]}Eg.exports=HM});var Vt=l((Jee,Tg)=>{var pt=require("fs"),WM=Dr(),VM=require("os"),Cg=require("path"),{promisify:Wt}=require("util"),No=Wt(pt.stat),GM=Wt(pt.readFile),zM=Wt(pt.writeFile),vg=Wt(pt.readdir),JM=Wt(pt.mkdir);function KM(r){try{return pt.accessSync(r),!0}catch{return!1}}function YM(){return Wt(pt.mkdtemp)(`${VM.tmpdir()}${Cg.sep}`)}function XM(r){return No(r).catch(()=>JM(r,{recursive:!0}))}async function xg(r,e=!1){let t=await vg(r);return WM(await Promise.all(t.sort().map(async n=>{let i=Cg.resolve(r,n),s=await No(i);return s&&s.isDirectory()?e?await xg(i,!0):[]:[i]})))}Tg.exports={existsSync:KM,stat:No,readdir:vg,readFile:GM,writeFile:zM,createTemp:YM,ensureDirectoryExists:XM,getFilepathsInFolder:xg}});var Oo=l((Kee,Ng)=>{var ZM=qg(),{readFile:eB,writeFile:tB}=Vt(),Ag=(r,e)=>ZM(r,{interpolate:/<%=([\s\S]+?)%>/g,...e}),Sg=async(r,e)=>{let t=await eB(r);return Ag(t.toString(),e)},rB=async(r,e,t,n)=>tB(r,(await Sg(e,t))(n));Ng.exports={jsSourceTemplate:Ag,jsFileTemplate:Sg,writeJsFileUsingTemplate:rB}});var Ro=l((Yee,Og)=>{function nB(r,e){for(var t=-1,n=r==null?0:r.length;++t<n;)if(e(r[t],t,r))return!0;return!1}Og.exports=nB});var Io=l((Xee,Rg)=>{var iB=Jn(),sB=Ro(),oB=Yn(),aB=1,uB=2;function lB(r,e,t,n,i,s){var o=t&aB,a=r.length,u=e.length;if(a!=u&&!(o&&u>a))return!1;var c=s.get(r),h=s.get(e);if(c&&h)return c==e&&h==r;var f=-1,d=!0,g=t&uB?new iB:void 0;for(s.set(r,e),s.set(e,r);++f<a;){var m=r[f],y=e[f];if(n)var _=o?n(y,m,f,e,r,s):n(m,y,f,r,e,s);if(_!==void 0){if(_)continue;d=!1;break}if(g){if(!sB(e,function(v,x){if(!oB(g,x)&&(m===v||i(m,v,t,n,s)))return g.push(x)})){d=!1;break}}else if(!(m===y||i(m,y,t,n,s))){d=!1;break}}return s.delete(r),s.delete(e),d}Rg.exports=lB});var $o=l((Zee,Ig)=>{function cB(r){var e=-1,t=Array(r.size);return r.forEach(function(n,i){t[++e]=[i,n]}),t}Ig.exports=cB});var Fr=l((ete,$g)=>{function hB(r){var e=-1,t=Array(r.size);return r.forEach(function(n){t[++e]=n}),t}$g.exports=hB});var Bg=l((tte,Mg)=>{var Pg=ke(),Lg=to(),fB=Le(),dB=Io(),pB=$o(),mB=Fr(),gB=1,yB=2,bB="[object Boolean]",wB="[object Date]",_B="[object Error]",qB="[object Map]",EB="[object Number]",CB="[object RegExp]",vB="[object Set]",xB="[object String]",TB="[object Symbol]",AB="[object ArrayBuffer]",SB="[object DataView]",kg=Pg?Pg.prototype:void 0,Po=kg?kg.valueOf:void 0;function NB(r,e,t,n,i,s,o){switch(t){case SB:if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case AB:return!(r.byteLength!=e.byteLength||!s(new Lg(r),new Lg(e)));case bB:case wB:case EB:return fB(+r,+e);case _B:return r.name==e.name&&r.message==e.message;case CB:case xB:return r==e+"";case qB:var a=pB;case vB:var u=n&gB;if(a||(a=mB),r.size!=e.size&&!u)return!1;var c=o.get(r);if(c)return c==e;n|=yB,o.set(r,e);var h=dB(a(r),a(e),n,i,s,o);return o.delete(r),h;case TB:if(Po)return Po.call(r)==Po.call(e)}return!1}Mg.exports=NB});var Fg=l((rte,Dg)=>{var jg=Gs(),OB=1,RB=Object.prototype,IB=RB.hasOwnProperty;function $B(r,e,t,n,i,s){var o=t&OB,a=jg(r),u=a.length,c=jg(e),h=c.length;if(u!=h&&!o)return!1;for(var f=u;f--;){var d=a[f];if(!(o?d in e:IB.call(e,d)))return!1}var g=s.get(r),m=s.get(e);if(g&&m)return g==e&&m==r;var y=!0;s.set(r,e),s.set(e,r);for(var _=o;++f<u;){d=a[f];var v=r[d],x=e[d];if(n)var he=o?n(x,v,d,e,r,s):n(v,x,d,r,e,s);if(!(he===void 0?v===x||i(v,x,t,n,s):he)){y=!1;break}_||(_=d=="constructor")}if(y&&!_){var ie=r.constructor,Pe=e.constructor;ie!=Pe&&"constructor"in r&&"constructor"in e&&!(typeof ie=="function"&&ie instanceof ie&&typeof Pe=="function"&&Pe instanceof Pe)&&(y=!1)}return s.delete(r),s.delete(e),y}Dg.exports=$B});var Jg=l((nte,zg)=>{var Lo=xr(),PB=Io(),LB=Bg(),kB=Fg(),Qg=at(),Ug=I(),Hg=it(),MB=st(),BB=1,Wg="[object Arguments]",Vg="[object Array]",ri="[object Object]",jB=Object.prototype,Gg=jB.hasOwnProperty;function DB(r,e,t,n,i,s){var o=Ug(r),a=Ug(e),u=o?Vg:Qg(r),c=a?Vg:Qg(e);u=u==Wg?ri:u,c=c==Wg?ri:c;var h=u==ri,f=c==ri,d=u==c;if(d&&Hg(r)){if(!Hg(e))return!1;o=!0,h=!1}if(d&&!h)return s||(s=new Lo),o||MB(r)?PB(r,e,t,n,i,s):LB(r,e,u,t,n,i,s);if(!(t&BB)){var g=h&&Gg.call(r,"__wrapped__"),m=f&&Gg.call(e,"__wrapped__");if(g||m){var y=g?r.value():r,_=m?e.value():e;return s||(s=new Lo),i(y,_,t,n,s)}}return d?(s||(s=new Lo),kB(r,e,t,n,i,s)):!1}zg.exports=DB});var ko=l((ite,Xg)=>{var FB=Jg(),Kg=se();function Yg(r,e,t,n,i){return r===e?!0:r==null||e==null||!Kg(r)&&!Kg(e)?r!==r&&e!==e:FB(r,e,t,n,Yg,i)}Xg.exports=Yg});var ey=l((ste,Zg)=>{var QB=xr(),UB=ko(),HB=1,WB=2;function VB(r,e,t,n){var i=t.length,s=i,o=!n;if(r==null)return!s;for(r=Object(r);i--;){var a=t[i];if(o&&a[2]?a[1]!==r[a[0]]:!(a[0]in r))return!1}for(;++i<s;){a=t[i];var u=a[0],c=r[u],h=a[1];if(o&&a[2]){if(c===void 0&&!(u in r))return!1}else{var f=new QB;if(n)var d=n(c,h,u,r,e,f);if(!(d===void 0?UB(h,c,HB|WB,n,f):d))return!1}}return!0}Zg.exports=VB});var Mo=l((ote,ty)=>{var GB=Z();function zB(r){return r===r&&!GB(r)}ty.exports=zB});var ny=l((ate,ry)=>{var JB=Mo(),KB=xe();function YB(r){for(var e=KB(r),t=e.length;t--;){var n=e[t],i=r[n];e[t]=[n,i,JB(i)]}return e}ry.exports=YB});var Bo=l((ute,iy)=>{function XB(r,e){return function(t){return t==null?!1:t[r]===e&&(e!==void 0||r in Object(t))}}iy.exports=XB});var oy=l((lte,sy)=>{var ZB=ey(),ej=ny(),tj=Bo();function rj(r){var e=ej(r);return e.length==1&&e[0][2]?tj(e[0][0],e[0][1]):function(t){return t===r||ZB(t,r,e)}}sy.exports=rj});var uy=l((cte,ay)=>{function nj(r,e){return r!=null&&e in Object(r)}ay.exports=nj});var jo=l((hte,ly)=>{var ij=kr(),sj=Pt(),oj=I(),aj=Nr(),uj=Ln(),lj=Ht();function cj(r,e,t){e=ij(e,r);for(var n=-1,i=e.length,s=!1;++n<i;){var o=lj(e[n]);if(!(s=r!=null&&t(r,o)))break;r=r[o]}return s||++n!=i?s:(i=r==null?0:r.length,!!i&&uj(i)&&aj(o,i)&&(oj(r)||sj(r)))}ly.exports=cj});var hy=l((fte,cy)=>{var hj=uy(),fj=jo();function dj(r,e){return r!=null&&fj(r,e,hj)}cy.exports=dj});var dy=l((dte,fy)=>{var pj=ko(),mj=Co(),gj=hy(),yj=Zn(),bj=Mo(),wj=Bo(),_j=Ht(),qj=1,Ej=2;function Cj(r,e){return yj(r)&&bj(e)?wj(_j(r),e):function(t){var n=mj(t,r);return n===void 0&&n===e?gj(t,r):pj(e,n,qj|Ej)}}fy.exports=Cj});var my=l((pte,py)=>{function vj(r){return function(e){return e?.[r]}}py.exports=vj});var yy=l((mte,gy)=>{var xj=Mr();function Tj(r){return function(e){return xj(e,r)}}gy.exports=Tj});var wy=l((gte,by)=>{var Aj=my(),Sj=yy(),Nj=Zn(),Oj=Ht();function Rj(r){return Nj(r)?Aj(Oj(r)):Sj(r)}by.exports=Rj});var pe=l((yte,_y)=>{var Ij=oy(),$j=dy(),Pj=z(),Lj=I(),kj=wy();function Mj(r){return typeof r=="function"?r:r==null?Pj:typeof r=="object"?Lj(r)?$j(r[0],r[1]):Ij(r):kj(r)}_y.exports=Mj});var Ey=l((bte,qy)=>{function Bj(r){return function(e,t,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var u=o[r?a:++i];if(t(s[u],u,s)===!1)break}return e}}qy.exports=Bj});var Do=l((wte,Cy)=>{var jj=Ey(),Dj=jj();Cy.exports=Dj});var Fo=l((_te,vy)=>{var Fj=Do(),Qj=xe();function Uj(r,e){return r&&Fj(r,e,Qj)}vy.exports=Uj});var Ty=l((qte,xy)=>{var Hj=de();function Wj(r,e){return function(t,n){if(t==null)return t;if(!Hj(t))return r(t,n);for(var i=t.length,s=e?i:-1,o=Object(t);(e?s--:++s<i)&&n(o[s],s,o)!==!1;);return t}}xy.exports=Wj});var mt=l((Ete,Ay)=>{var Vj=Fo(),Gj=Ty(),zj=Gj(Vj);Ay.exports=zj});var Qo=l((Cte,Sy)=>{var Jj=mt(),Kj=de();function Yj(r,e){var t=-1,n=Kj(r)?Array(r.length):[];return Jj(r,function(i,s,o){n[++t]=e(i,s,o)}),n}Sy.exports=Yj});var Oy=l((vte,Ny)=>{function Xj(r,e){var t=r.length;for(r.sort(e);t--;)r[t]=r[t].value;return r}Ny.exports=Xj});var $y=l((xte,Iy)=>{var Ry=ht();function Zj(r,e){if(r!==e){var t=r!==void 0,n=r===null,i=r===r,s=Ry(r),o=e!==void 0,a=e===null,u=e===e,c=Ry(e);if(!a&&!c&&!s&&r>e||s&&o&&u&&!a&&!c||n&&o&&u||!t&&u||!i)return 1;if(!n&&!s&&!c&&r<e||c&&t&&i&&!n&&!s||a&&t&&i||!o&&i||!u)return-1}return 0}Iy.exports=Zj});var Ly=l((Tte,Py)=>{var eD=$y();function tD(r,e,t){for(var n=-1,i=r.criteria,s=e.criteria,o=i.length,a=t.length;++n<o;){var u=eD(i[n],s[n]);if(u){if(n>=a)return u;var c=t[n];return u*(c=="desc"?-1:1)}}return r.index-e.index}Py.exports=tD});var My=l((Ate,ky)=>{var Uo=ct(),rD=Mr(),nD=pe(),iD=Qo(),sD=Oy(),oD=kt(),aD=Ly(),uD=z(),lD=I();function cD(r,e,t){e.length?e=Uo(e,function(s){return lD(s)?function(o){return rD(o,s.length===1?s[0]:s)}:s}):e=[uD];var n=-1;e=Uo(e,oD(nD));var i=iD(r,function(s,o,a){var u=Uo(e,function(c){return c(s)});return{criteria:u,index:++n,value:s}});return sD(i,function(s,o){return aD(s,o,t)})}ky.exports=cD});var Dy=l((Ste,jy)=>{var hD=Xn(),fD=My(),dD=ut(),By=lt(),pD=dD(function(r,e){if(r==null)return[];var t=e.length;return t>1&&By(r,e[0],e[1])?e=[]:t>2&&By(e[0],e[1],e[2])&&(e=[e[0]]),fD(r,hD(e,1),[])});jy.exports=pD});var Ho=l((Nte,Qy)=>{"use strict";var Fy=require("path");function mD(r){let e=Fy.basename(r);return Fy.sep==="\\"&&(e=e.toLowerCase()),e==="node_modules"}Qy.exports=mD});var Wo=l((Ote,Uy)=>{"use strict";Uy.exports=new Map});var Vy=l((Rte,Wy)=>{"use strict";var ii=require("path"),{promisify:gD}=require("util"),yD=gD(require("fs").readFile),bD=Ho(),Vo=Wo(),ni=new Map;async function wD(r){if(bD(r))return"commonjs";try{return JSON.parse(await yD(ii.resolve(r,"package.json"))).type||"commonjs"}catch{}let e=ii.dirname(r);return e===r?"commonjs":Hy(e)}async function Hy(r){if(Vo.has(r))return Vo.get(r);if(ni.has(r))return ni.get(r);let e=wD(r);ni.set(r,e);let t=await e;return Vo.set(r,t),ni.delete(r),t}function _D(r){return Hy(ii.resolve(ii.dirname(r)))}Wy.exports=_D});var Jy=l((Ite,zy)=>{"use strict";var si=require("path"),{readFileSync:qD}=require("fs"),ED=Ho(),Go=Wo();function CD(r){if(ED(r))return"commonjs";try{return JSON.parse(qD(si.resolve(r,"package.json"))).type||"commonjs"}catch{}let e=si.dirname(r);return e===r?"commonjs":Gy(e)}function Gy(r){if(Go.has(r))return Go.get(r);let e=CD(r);return Go.set(r,e),e}function vD(r){return Gy(si.resolve(si.dirname(r)))}zy.exports=vD});var Ky=l(($te,zo)=>{"use strict";var xD=Vy(),TD=Jy();zo.exports=r=>xD(r);zo.exports.sync=TD});var Xy=l((Pte,Yy)=>{var AD=Ky();Yy.exports=async function(e){return e.endsWith(".mjs")||!e.endsWith(".cjs")&&await AD(e)==="module"}});var Jo=l((Lte,Zy)=>{var SD=Xy();Zy.exports=async function(e){return await SD(e)?import(require("url").pathToFileURL(e)):require(e)}});var Qr=l((kte,rb)=>{var eb=require("path"),tb=Object.freeze([".co",".coffee",".eg",".iced",".js",".cjs",".litcoffee",".ls",".ts"]),Ko=class{constructor(e,t,n){this.sortDirsSeparately=t,Array.isArray(e)||(e=[e]),this.migrationsPaths=e,this.loadExtensions=n||tb}getFile(e){let t=eb.resolve(process.cwd(),e.directory),n=eb.join(t,e.file);return Jo()(n)}};rb.exports={DEFAULT_LOAD_EXTENSIONS:tb,AbstractMigrationsLoader:Ko}});var ob=l((Mte,sb)=>{var ib=require("path"),ND=Dy(),{readdir:OD}=Vt(),{AbstractMigrationsLoader:RD}=Qr(),Yo=class extends RD{getMigrations(e){let t=this.migrationsPaths.map(n=>{let i=ib.resolve(process.cwd(),n);return OD(i).then(s=>({files:s,configDir:n,absoluteDir:i}))});return Promise.all(t).then(n=>{let i=n.reduce((s,o)=>(this.sortDirsSeparately&&(o.files=o.files.sort()),o.files.forEach(a=>s.push({file:a,directory:o.configDir})),s),[]);return this.sortDirsSeparately?nb(this,i,e||this.loadExtensions):nb(this,ND(i,"file"),e||this.loadExtensions)})}getMigrationName(e){return e.file}getMigration(e){return this.getFile(e)}};function nb(r,e,t){return e.filter(n=>{let i=r.getMigrationName(n),s=ib.extname(i);return t.includes(s)})}sb.exports={FsMigrations:Yo}});var db=l(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});var ID=require("tty");function $D(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,Object.freeze(e)}var Xo=$D(ID),{env:je={},argv:ub=[],platform:PD=""}=typeof process>"u"?{}:process,LD="NO_COLOR"in je||ub.includes("--no-color"),kD="FORCE_COLOR"in je||ub.includes("--color"),MD=PD==="win32",lb=je.TERM==="dumb",BD=Xo&&Xo.isatty&&Xo.isatty(1)&&je.TERM&&!lb,jD="CI"in je&&("GITHUB_ACTIONS"in je||"GITLAB_CI"in je||"CIRCLECI"in je),cb=!LD&&(kD||MD&&!lb||BD||jD),hb=(r,e,t,n,i=e.substring(0,r)+n,s=e.substring(r+t.length),o=s.indexOf(t))=>i+(o<0?s:hb(o,s,t,n)),DD=(r,e,t,n,i)=>r<0?t+e+n:t+hb(r,e,n,i)+n,FD=(r,e,t=r,n=r.length+1)=>i=>i||!(i===""||i===void 0)?DD((""+i).indexOf(e,n),i,r,e,t):"",C=(r,e,t)=>FD(`\x1B[${r}m`,`\x1B[${e}m`,t),ab={reset:C(0,0),bold:C(1,22,"\x1B[22m\x1B[1m"),dim:C(2,22,"\x1B[22m\x1B[2m"),italic:C(3,23),underline:C(4,24),inverse:C(7,27),hidden:C(8,28),strikethrough:C(9,29),black:C(30,39),red:C(31,39),green:C(32,39),yellow:C(33,39),blue:C(34,39),magenta:C(35,39),cyan:C(36,39),white:C(37,39),gray:C(90,39),bgBlack:C(40,49),bgRed:C(41,49),bgGreen:C(42,49),bgYellow:C(43,49),bgBlue:C(44,49),bgMagenta:C(45,49),bgCyan:C(46,49),bgWhite:C(47,49),blackBright:C(90,39),redBright:C(91,39),greenBright:C(92,39),yellowBright:C(93,39),blueBright:C(94,39),magentaBright:C(95,39),cyanBright:C(96,39),whiteBright:C(97,39),bgBlackBright:C(100,49),bgRedBright:C(101,49),bgGreenBright:C(102,49),bgYellowBright:C(103,49),bgBlueBright:C(104,49),bgMagentaBright:C(105,49),bgCyanBright:C(106,49),bgWhiteBright:C(107,49)},fb=({useColor:r=cb}={})=>r?ab:Object.keys(ab).reduce((e,t)=>({...e,[t]:String}),{}),{reset:QD,bold:UD,dim:HD,italic:WD,underline:VD,inverse:GD,hidden:zD,strikethrough:JD,black:KD,red:YD,green:XD,yellow:ZD,blue:eF,magenta:tF,cyan:rF,white:nF,gray:iF,bgBlack:sF,bgRed:oF,bgGreen:aF,bgYellow:uF,bgBlue:lF,bgMagenta:cF,bgCyan:hF,bgWhite:fF,blackBright:dF,redBright:pF,greenBright:mF,yellowBright:gF,blueBright:yF,magentaBright:bF,cyanBright:wF,whiteBright:_F,bgBlackBright:qF,bgRedBright:EF,bgGreenBright:CF,bgYellowBright:vF,bgBlueBright:xF,bgMagentaBright:TF,bgCyanBright:AF,bgWhiteBright:SF}=fb();E.bgBlack=sF;E.bgBlackBright=qF;E.bgBlue=lF;E.bgBlueBright=xF;E.bgCyan=hF;E.bgCyanBright=AF;E.bgGreen=aF;E.bgGreenBright=CF;E.bgMagenta=cF;E.bgMagentaBright=TF;E.bgRed=oF;E.bgRedBright=EF;E.bgWhite=fF;E.bgWhiteBright=SF;E.bgYellow=uF;E.bgYellowBright=vF;E.black=KD;E.blackBright=dF;E.blue=eF;E.blueBright=yF;E.bold=UD;E.createColors=fb;E.cyan=rF;E.cyanBright=wF;E.dim=HD;E.gray=iF;E.green=XD;E.greenBright=mF;E.hidden=zD;E.inverse=GD;E.isColorSupported=cb;E.italic=WD;E.magenta=tF;E.magentaBright=bF;E.red=YD;E.redBright=pF;E.reset=QD;E.strikethrough=JD;E.underline=VD;E.white=nF;E.whiteBright=_F;E.yellow=ZD;E.yellowBright=gF});var A=l((jte,pb)=>{function NF(r){return typeof r=="string"}function OF(r){return typeof r=="number"}function RF(r){return typeof r=="boolean"}function IF(r){return typeof r>"u"}function $F(r){return typeof r=="object"&&r!==null}function PF(r){return typeof r=="function"}pb.exports={isString:NF,isNumber:OF,isBoolean:RF,isUndefined:IF,isObject:$F,isFunction:PF}});var oi=l((Dte,gb)=>{var Zo=db(),{inspect:LF}=require("util"),{isString:kF,isFunction:mb}=A(),ea=class{constructor(e={}){let{log:{debug:t,warn:n,error:i,deprecate:s,inspectionDepth:o,enableColors:a}={}}=e;this._inspectionDepth=o||5,this._enableColors=MF(a),this._debug=t,this._warn=n,this._error=i,this._deprecate=s}_log(e,t,n){if(t!=null&&!mb(t))throw new TypeError("Extensions to knex logger must be functions!");if(mb(t)){t(e);return}kF(e)||(e=LF(e,{depth:this._inspectionDepth,colors:this._enableColors})),console.log(n?n(e):e)}debug(e){this._log(e,this._debug)}warn(e){this._log(e,this._warn,Zo.yellow)}error(e){this._log(e,this._error,Zo.red)}deprecate(e,t){let n=`${e} is deprecated, please use ${t}`;this._log(n,this._deprecate,Zo.yellow)}};function MF(r){return r??(process&&process.stdout?process.stdout.isTTY:!1)}gb.exports=ea});var ta=l((Fte,yb)=>{var{FsMigrations:BF}=ob(),jF=oi(),{DEFAULT_LOAD_EXTENSIONS:DF}=Qr(),FF=new jF,QF=Object.freeze({extension:"js",loadExtensions:DF,tableName:"knex_migrations",schemaName:null,directory:"./migrations",disableTransactions:!1,disableMigrationsListValidation:!1,sortDirsSeparately:!1});function UF(r,e,t=FF){let n=Object.assign({},QF,e||{},r);return r&&(r.directory||r.sortDirsSeparately!==void 0||r.loadExtensions)&&(r.migrationSource&&t.warn("FS-related option specified for migration configuration. This resets migrationSource to default FsMigrations"),n.migrationSource=null),n.migrationSource||(n.migrationSource=new BF(n.directory,n.sortDirsSeparately,n.loadExtensions)),n}yb.exports={getMergedConfig:UF}});var ra=l((Qte,bb)=>{function HF(){let r=new Date;return r.getUTCFullYear().toString()+(r.getUTCMonth()+1).toString().padStart(2,"0")+r.getUTCDate().toString().padStart(2,"0")+r.getUTCHours().toString().padStart(2,"0")+r.getUTCMinutes().toString().padStart(2,"0")+r.getUTCSeconds().toString().padStart(2,"0")}bb.exports={yyyymmddhhmmss:HF}});var qb=l((Ute,_b)=>{var na=require("path"),{writeJsFileUsingTemplate:WF}=Oo(),{getMergedConfig:wb}=ta(),{ensureDirectoryExists:VF}=Vt(),{yyyymmddhhmmss:GF}=ra(),ia=class{constructor(e,t){this.config=wb(e,void 0,t)}async make(e,t,n){return this.config=wb(t,this.config,n),e?(await this._ensureFolder(),await this._writeNewMigration(e)):Promise.reject(new Error("A name must be specified for the generated migration"))}_ensureFolder(){let t=this._absoluteConfigDirs().map(VF);return Promise.all(t)}_getStubPath(){return this.config.stub||na.join(__dirname,"stub",this.config.extension+".stub")}_getNewMigrationName(e){return e[0]==="-"&&(e=e.slice(1)),GF()+"_"+e+"."+this.config.extension.split("-")[0]}_getNewMigrationPath(e){let t=this._getNewMigrationName(e),i=this._absoluteConfigDirs().slice(-1)[0];return na.join(i,t)}async _writeNewMigration(e){let t=this._getNewMigrationPath(e);return await WF(t,this._getStubPath(),{variable:"d"},this.config.variables||{}),t}_absoluteConfigDirs(){return(Array.isArray(this.config.directory)?this.config.directory:[this.config.directory]).map(t=>(t||console.warn("Failed to resolve config file, knex cannot determine where to generate migrations"),na.resolve(process.cwd(),t)))}};_b.exports=ia});var xb=l((Hte,vb)=>{var Cb=gm(),zF=Co(),JF=te(),KF=Lm(),{getLockTableName:sa,getTable:Ur,getTableName:ai}=ei(),{getSchemaBuilder:YF}=xo(),De=Fm(),XF=qb(),{getMergedConfig:Ae}=ta(),{isBoolean:ZF,isFunction:eQ}=A(),li=class extends Error{constructor(e){super(e),this.name="MigrationLocked"}},oa=class{constructor(e){eQ(e)?e.isTransaction?this.knex=e:this.knex=e.withUserParams({...e.userParams}):(this.knex=Object.assign({},e),this.knex.userParams=this.knex.userParams||{}),this.config=Ae(this.knex.client.config.migrations,void 0,this.knex.client.logger),this.generator=new XF(this.knex.client.config.migrations,this.knex.client.logger),this._activeMigration={fileName:null}}async latest(e){this._disableProcessing(),this.config=Ae(e,this.config,this.knex.client.logger);let t=await De.listAllAndCompleted(this.config,this.knex);this.config.disableMigrationsListValidation||Hr(this.config.migrationSource,t);let[n,i]=t,s=ui(this.config.migrationSource,n,i);return!this.config.disableTransactions&&!(await Promise.all(s.map(async a=>{let u=await this.config.migrationSource.getMigration(a);return!this._useTransaction(u)}))).some(a=>a)?this.knex.transaction(a=>this._runBatch(s,"up",a)):this._runBatch(s,"up")}async up(e){this._disableProcessing(),this.config=Ae(e,this.config,this.knex.client.logger);let t=await De.listAllAndCompleted(this.config,this.knex);this.config.disableMigrationsListValidation||Hr(this.config.migrationSource,t);let[n,i]=t,s=ui(this.config.migrationSource,n,i),o,a=this.config.name;if(a){if(!i.includes(a)&&(o=s.find(f=>this.config.migrationSource.getMigrationName(f)===a),!o))throw new Error(`Migration "${a}" not found.`)}else o=s[0];let u=!o||this._useTransaction(await this.config.migrationSource.getMigration(o)),c=[];return o&&c.push(o),!this.config.disableTransactions&&(!o||u)?await this.knex.transaction(f=>this._runBatch(c,"up",f)):await this._runBatch(c,"up")}rollback(e,t=!1){return this._disableProcessing(),new Promise((n,i)=>{try{this.config=Ae(e,this.config,this.knex.client.logger)}catch(s){i(s)}De.listAllAndCompleted(this.config,this.knex).then(s=>(this.config.disableMigrationsListValidation||Hr(this.config.migrationSource,s),s)).then(s=>{let[o,a]=s;return t?o.filter(u=>a.map(c=>c.name).includes(this.config.migrationSource.getMigrationName(u))).reverse():this._getLastBatch(s)}).then(s=>this._runBatch(s,"down")).then(n,i)})}down(e){return this._disableProcessing(),this.config=Ae(e,this.config,this.knex.client.logger),De.listAllAndCompleted(this.config,this.knex).then(t=>(this.config.disableMigrationsListValidation||Hr(this.config.migrationSource,t),t)).then(([t,n])=>{let i=t.filter(u=>n.map(c=>c.name).includes(this.config.migrationSource.getMigrationName(u))),s,o=this.config.name;if(o){if(s=i.find(u=>this.config.migrationSource.getMigrationName(u)===o),!s)throw new Error(`Migration "${o}" was not run.`)}else s=i[i.length-1];let a=[];return s&&a.push(s),this._runBatch(a,"down")})}status(e){return this._disableProcessing(),this.config=Ae(e,this.config,this.knex.client.logger),Promise.all([Ur(this.knex,this.config.tableName,this.config.schemaName).select("*"),De.listAll(this.config.migrationSource)]).then(([t,n])=>t.length-n.length)}currentVersion(e){return this._disableProcessing(),this.config=Ae(e,this.config,this.knex.client.logger),De.listCompleted(this.config.tableName,this.config.schemaName,this.knex).then(t=>{let n=KF(t.map(i=>i.name.split("_")[0]));return n===void 0?"none":n})}async list(e){this._disableProcessing(),this.config=Ae(e,this.config,this.knex.client.logger);let[t,n]=await De.listAllAndCompleted(this.config,this.knex);this.config.disableMigrationsListValidation||Hr(this.config.migrationSource,[t,n]);let i=ui(this.config.migrationSource,t,n);return[n,i]}async forceFreeMigrationsLock(e){this.config=Ae(e,this.config,this.knex.client.logger);let{schemaName:t,tableName:n}=this.config,i=sa(n),{knex:s}=this,o=()=>Ur(s,i,t);await YF(s,t).hasTable(i)&&(await o().del(),await o().insert({is_locked:0}))}make(e,t){return this.generator.make(e,t,this.knex.client.logger)}_disableProcessing(){this.knex.disableProcessing&&this.knex.disableProcessing()}_lockMigrations(e){let t=sa(this.config.tableName);return Ur(this.knex,t,this.config.schemaName).transacting(e).where("is_locked","=",0).update({is_locked:1}).then(n=>{if(n!==1)throw new Error("Migration table is already locked")})}_getLock(e){return(e?n=>n(e):n=>this.knex.transaction(n))(n=>this._lockMigrations(n)).catch(n=>{throw new li(n.message)})}_freeLock(e=this.knex){let t=sa(this.config.tableName);return Ur(e,t,this.config.schemaName).update({is_locked:0})}async _runBatch(e,t,n){let i=this.knex.client.driverName!=="cockroachdb";try{await this._getLock(i?n:void 0);let s=n?await De.listCompleted(this.config.tableName,this.config.schemaName,n):[];e=ui(this.config.migrationSource,e,s),await Promise.all(e.map(this._validateMigrationStructure.bind(this)));let o=await this._latestBatchNumber(n);t==="up"&&o++;let a=await this._waterfallBatch(o,e,t,n);return await this._freeLock(i?n:void 0),a}catch(s){let o=Promise.resolve();s instanceof li?(this.knex.client.logger.warn(`Can't take lock to run migrations: ${s.message}`),this.knex.client.logger.warn("If you are sure migrations are not running you can release the lock manually by running 'knex migrate:unlock'")):(this._activeMigration.fileName&&this.knex.client.logger.warn(`migration file "${this._activeMigration.fileName}" failed`),this.knex.client.logger.warn(`migration failed with error: ${s.message}`),o=this._freeLock(i?n:void 0));try{await o}catch{}throw s}}async _validateMigrationStructure(e){let t=this.config.migrationSource.getMigrationName(e),n=await this.config.migrationSource.getMigration(e);if(typeof n.up!="function"||typeof n.down!="function")throw new Error(`Invalid migration: ${t} must have both an up and down function`);return e}async _getLastBatch([e]){let{tableName:t,schemaName:n}=this.config,s=(await Ur(this.knex,t,n).where("batch",function(o){o.max("batch").from(ai(t,n))}).orderBy("id","desc")).map(o=>e.find(a=>this.config.migrationSource.getMigrationName(a)===o.name));return Promise.all(s)}_latestBatchNumber(e=this.knex){return e.from(ai(this.config.tableName,this.config.schemaName)).max("batch as max_batch").then(t=>t[0].max_batch||0)}_useTransaction(e,t){let n=zF(e,"config.transaction");return ZF(n)?n:!t}_waterfallBatch(e,t,n,i){let s=i||this.knex,{tableName:o,schemaName:a,disableTransactions:u}=this.config,c=Promise.resolve(),h=[];return t.forEach(f=>{let d=this.config.migrationSource.getMigrationName(f);this._activeMigration.fileName=d;let g=this.config.migrationSource.getMigration(f);c=c.then(async()=>await g).then(m=>(this._activeMigration.fileName=d,!i&&this._useTransaction(m,u)?(this.knex.enableProcessing(),this._transaction(this.knex,m,n,d)):(s.enableProcessing(),Eb(this.knex.client.logger,m[n](s),d)))).then(()=>{if(s.disableProcessing(),this.knex.disableProcessing(),h.push(d),n==="up")return s.into(ai(o,a)).insert({name:d,batch:e,migration_time:new Date});if(n==="down")return s.from(ai(o,a)).where({name:d}).del()})}),c.then(()=>[e,h])}_transaction(e,t,n,i){return e.transaction(s=>Eb(e.client.logger,t[n](s),i,()=>{s.commit()}))}};function Hr(r,e){let[t,n]=e,i=tQ(r,n,t);if(!JF(i)){let s=i.map(o=>o.name);throw new Error(`The migration directory is corrupt, the following files are missing: ${s.join(", ")}`)}}function tQ(r,e,t){return Cb(e,t,(n,i)=>n.name===r.getMigrationName(i))}function ui(r,e,t){return Cb(e,t,(n,i)=>i.name===r.getMigrationName(n))}function Eb(r,e,t,n){return(!e||typeof e.then!="function")&&(r.warn(`migration ${t} did not return a promise`),n&&n()),e}vb.exports={Migrator:oa}});var aa=l((Wte,Tb)=>{var rQ=Ce(),nQ=I(),iQ=se(),sQ="[object String]";function oQ(r){return typeof r=="string"||!nQ(r)&&iQ(r)&&rQ(r)==sQ}Tb.exports=oQ});var Sb=l((Vte,Ab)=>{var aQ=/\s/;function uQ(r){for(var e=r.length;e--&&aQ.test(r.charAt(e)););return e}Ab.exports=uQ});var Ob=l((Gte,Nb)=>{var lQ=Sb(),cQ=/^\s+/;function hQ(r){return r&&r.slice(0,lQ(r)+1).replace(cQ,"")}Nb.exports=hQ});var Pb=l((zte,$b)=>{var fQ=Ob(),Rb=Z(),dQ=ht(),Ib=0/0,pQ=/^[-+]0x[0-9a-f]+$/i,mQ=/^0b[01]+$/i,gQ=/^0o[0-7]+$/i,yQ=parseInt;function bQ(r){if(typeof r=="number")return r;if(dQ(r))return Ib;if(Rb(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=Rb(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=fQ(r);var t=mQ.test(r);return t||gQ.test(r)?yQ(r.slice(2),t?2:8):pQ.test(r)?Ib:+r}$b.exports=bQ});var Mb=l((Jte,kb)=>{var wQ=Pb(),Lb=1/0,_Q=17976931348623157e292;function qQ(r){if(!r)return r===0?r:0;if(r=wQ(r),r===Lb||r===-Lb){var e=r<0?-1:1;return e*_Q}return r===r?r:0}kb.exports=qQ});var ci=l((Kte,Bb)=>{var EQ=Mb();function CQ(r){var e=EQ(r),t=e%1;return e===e?t?e-t:e:0}Bb.exports=CQ});var hi=l((Yte,jb)=>{var vQ=Ao(),xQ=xe();function TQ(r){return r==null?[]:vQ(r,xQ(r))}jb.exports=TQ});var Fb=l((Xte,Db)=>{var AQ=Kn(),SQ=de(),NQ=aa(),OQ=ci(),RQ=hi(),IQ=Math.max;function $Q(r,e,t,n){r=SQ(r)?r:RQ(r),t=t&&!n?OQ(t):0;var i=r.length;return t<0&&(t=IQ(i+t,0)),NQ(r)?t<=i&&r.indexOf(e,t)>-1:!!i&&AQ(r,e,t)>-1}Db.exports=$Q});var Ub=l((Zte,Qb)=>{var ua=require("path"),PQ=Dr(),LQ=Fb(),{AbstractMigrationsLoader:kQ}=Qr(),{getFilepathsInFolder:MQ}=Vt(),BQ=r=>e=>{let t=ua.extname(e);return LQ(r,t)},la=class extends kQ{_getConfigDirectories(e){return this.migrationsPaths.map(n=>(n||e.warn("Empty value passed as a directory for Seeder, this is not supported."),ua.resolve(process.cwd(),n)))}async getSeeds(e){let{loadExtensions:t,recursive:n,specific:i}=e,o=PQ(await Promise.all(this._getConfigDirectories(e.logger).map(a=>MQ(a,n)))).filter(BQ(t));if(this.sortDirsSeparately||o.sort(),i&&(o=o.filter(a=>ua.basename(a)===i),o.length===0))throw new Error(`Invalid argument provided: the specific seed "${i}" does not exist.`);return o}async getSeed(e){return await Jo()(e)}};Qb.exports={FsSeeds:la}});var Wb=l((ere,Hb)=>{var{FsSeeds:jQ}=Ub(),DQ=oi(),{DEFAULT_LOAD_EXTENSIONS:FQ}=Qr(),QQ=new DQ,UQ=Object.freeze({extension:"js",directory:"./seeds",loadExtensions:FQ,specific:null,timestampFilenamePrefix:!1,recursive:!1,sortDirsSeparately:!1});function HQ(r,e,t=QQ){let n=Object.assign({},UQ,e||{},r,{logger:t});return r&&(r.directory||r.sortDirsSeparately!==void 0||r.loadExtensions)&&(r.seedSource&&t.warn("FS-related option specified for seed configuration. This resets seedSource to default FsMigrations"),n.seedSource=null),n.seedSource||(n.seedSource=new jQ(n.directory,n.sortDirsSeparately,n.loadExtensions)),n}Hb.exports={getMergedConfig:HQ}});var zb=l((tre,Gb)=>{var Vb=require("path"),{ensureDirectoryExists:WQ}=Vt(),{writeJsFileUsingTemplate:VQ}=Oo(),{yyyymmddhhmmss:GQ}=ra(),{getMergedConfig:zQ}=Wb(),ca=class{constructor(e){this.knex=e,this.config=this.resolveConfig(e.client.config.seeds)}async run(e){this.config=this.resolveConfig(e);let t=await this.config.seedSource.getSeeds(this.config);return this._runSeeds(t)}async make(e,t){if(this.config=this.resolveConfig(t),!e)throw new Error("A name must be specified for the generated seed");return await this._ensureFolder(t),await this._writeNewSeed(e)}_ensureFolder(){let t=this.config.seedSource._getConfigDirectories(this.config.logger).map(WQ);return Promise.all(t)}async _runSeeds(e){for(let t of e)await this._validateSeedStructure(t);return this._waterfallBatch(e)}async _validateSeedStructure(e){if(typeof(await this.config.seedSource.getSeed(e)).seed!="function")throw new Error(`Invalid seed file: ${e} must have a seed function`);return e}_getStubPath(){return this.config.stub||Vb.join(__dirname,"stub",this.config.extension+".stub")}_getNewStubFileName(e){return e[0]==="-"&&(e=e.slice(1)),this.config.timestampFilenamePrefix===!0&&(e=`${GQ()}_${e}`),`${e}.${this.config.extension}`}_getNewStubFilePath(e){let t=this._getNewStubFileName(e),i=this.config.seedSource._getConfigDirectories(this.config.logger).slice(-1)[0];return Vb.join(i,t)}async _writeNewSeed(e){let t=this._getNewStubFilePath(e);return await VQ(t,this._getStubPath(),{variable:"d"},this.config.variables||{}),t}async _listAll(e){return this.config=this.resolveConfig(e),this.config.seedSource.getSeeds(this.config)}async _waterfallBatch(e){let{knex:t}=this,n=[];for(let i of e){let s=await this.config.seedSource.getSeed(i);try{await s.seed(t),n.push(i)}catch(o){let a=new Error(`Error while executing "${i}" seed: ${o.message}`);throw a.original=o,a.stack=a.stack.split(`
`).slice(0,2).join(`
`)+`
`+o.stack,a}}return[n]}resolveConfig(e){return zQ(e,this.config,this.knex.client.logger)}};Gb.exports=ca});var Kb=l((rre,Jb)=>{var ha=class{constructor(e){this.client=e}now(e){return typeof e=="number"?this.client.raw(`CURRENT_TIMESTAMP(${e})`):this.client.raw("CURRENT_TIMESTAMP")}uuidToBin(e,t=!0){let n=Buffer.from(e.replace(/-/g,""),"hex");return t?Buffer.concat([n.slice(6,8),n.slice(4,6),n.slice(0,4),n.slice(8,16)]):Buffer.concat([n.slice(0,4),n.slice(4,6),n.slice(6,8),n.slice(8,16)])}binToUuid(e,t=!0){let n=Buffer.from(e,"hex");return t?[n.toString("hex",4,8),n.toString("hex",2,4),n.toString("hex",0,2),n.toString("hex",8,10),n.toString("hex",10,16)].join("-"):[n.toString("hex",0,4),n.toString("hex",4,6),n.toString("hex",6,8),n.toString("hex",8,10),n.toString("hex",10,16)].join("-")}};Jb.exports=ha});var fa=l((nre,Yb)=>{Yb.exports=["with","withRecursive","withMaterialized","withNotMaterialized","select","as","columns","column","from","fromJS","fromRaw","into","withSchema","table","distinct","join","joinRaw","innerJoin","leftJoin","leftOuterJoin","rightJoin","rightOuterJoin","outerJoin","fullOuterJoin","crossJoin","where","andWhere","orWhere","whereNot","orWhereNot","whereLike","andWhereLike","orWhereLike","whereILike","andWhereILike","orWhereILike","whereRaw","whereWrapped","havingWrapped","orWhereRaw","whereExists","orWhereExists","whereNotExists","orWhereNotExists","whereIn","orWhereIn","whereNotIn","orWhereNotIn","whereNull","orWhereNull","whereNotNull","orWhereNotNull","whereBetween","whereNotBetween","andWhereBetween","andWhereNotBetween","orWhereBetween","orWhereNotBetween","groupBy","groupByRaw","orderBy","orderByRaw","union","unionAll","intersect","having","havingRaw","orHaving","orHavingRaw","offset","limit","count","countDistinct","min","max","sum","sumDistinct","avg","avgDistinct","increment","decrement","first","debug","pluck","clearSelect","clearWhere","clearGroup","clearOrder","clearHaving","insert","update","returning","del","delete","truncate","transacting","connection","jsonExtract","jsonSet","jsonInsert","jsonRemove","whereJsonObject","orWhereJsonObject","andWhereJsonObject","whereNotJsonObject","orWhereNotJsonObject","andWhereNotJsonObject","whereJsonPath","orWhereJsonPath","andWhereJsonPath","whereJsonSupersetOf","orWhereJsonSupersetOf","andWhereJsonSupersetOf","whereJsonNotSupersetOf","orWhereJsonNotSupersetOf","andWhereJsonNotSupersetOf","whereJsonSubsetOf","orWhereJsonSubsetOf","andWhereJsonSubsetOf","whereJsonNotSubsetOf","orWhereJsonNotSubsetOf","andWhereJsonNotSubsetOf"]});var da=l((ire,Xb)=>{var JQ=Tr(),KQ=Le();function YQ(r,e,t){(t!==void 0&&!KQ(r[e],t)||t===void 0&&!(e in r))&&JQ(r,e,t)}Xb.exports=YQ});var pa=l((sre,Zb)=>{function XQ(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}Zb.exports=XQ});var tw=l((ore,ew)=>{var ZQ=ve(),eU=Te();function tU(r){return ZQ(r,eU(r))}ew.exports=tU});var aw=l((are,ow)=>{var rw=da(),rU=Us(),nU=ro(),iU=Mn(),sU=io(),nw=Pt(),iw=I(),oU=wo(),aU=it(),uU=Er(),lU=Z(),cU=we(),hU=st(),sw=pa(),fU=tw();function dU(r,e,t,n,i,s,o){var a=sw(r,t),u=sw(e,t),c=o.get(u);if(c){rw(r,t,c);return}var h=s?s(a,u,t+"",r,e,o):void 0,f=h===void 0;if(f){var d=iw(u),g=!d&&aU(u),m=!d&&!g&&hU(u);h=u,d||g||m?iw(a)?h=a:oU(a)?h=iU(a):g?(f=!1,h=rU(u,!0)):m?(f=!1,h=nU(u,!0)):h=[]:cU(u)||nw(u)?(h=a,nw(a)?h=fU(a):(!lU(a)||uU(a))&&(h=sU(u))):f=!1}f&&(o.set(u,h),i(h,u,n,s,o),o.delete(u)),rw(r,t,h)}ow.exports=dU});var cw=l((ure,lw)=>{var pU=xr(),mU=da(),gU=Do(),yU=aw(),bU=Z(),wU=Te(),_U=pa();function uw(r,e,t,n,i){r!==e&&gU(e,function(s,o){if(i||(i=new pU),bU(s))yU(r,e,o,t,uw,n,i);else{var a=n?n(_U(r,o),s,o+"",r,e,i):void 0;a===void 0&&(a=s),mU(r,o,a)}},wU)}lw.exports=uw});var fw=l((lre,hw)=>{var qU=cw(),EU=jr(),CU=EU(function(r,e,t){qU(r,e,t)});hw.exports=CU});var ma=l((cre,dw)=>{function vU(r,e,t){var n=-1,i=r.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=r[n+e];return s}dw.exports=vU});var mw=l((hre,pw)=>{var xU=ma(),TU=lt(),AU=ci(),SU=Math.ceil,NU=Math.max;function OU(r,e,t){(t?TU(r,e,t):e===void 0)?e=1:e=NU(AU(e),0);var n=r==null?0:r.length;if(!n||e<1)return[];for(var i=0,s=0,o=Array(SU(n/e));i<n;)o[s++]=xU(r,i,i+=e);return o}pw.exports=OU});var yw=l((fre,gw)=>{gw.exports=r=>new Promise(e=>setTimeout(e,r))});var ww=l((dre,bw)=>{var RU=mw(),IU=Dr(),$U=yw(),{isNumber:PU}=A();function LU(r,e,t,n=1e3){let i,s=null;if(!PU(n)||n<1)throw new TypeError(`Invalid chunkSize: ${n}`);if(!Array.isArray(t))throw new TypeError(`Invalid batch: Expected array, got ${typeof t}`);let o=RU(t,n),a=u=>s?u(s):r.transaction(u);return Object.assign(Promise.resolve().then(async()=>(await $U(1),a(async u=>{let c=[];for(let h of o)c.push(await u(e).insert(h,i));return IU(c)}))),{returning(u){return i=u,this},transacting(u){return s=u,this}})}bw.exports=LU});var ga=l((pre,vw)=>{var{EventEmitter:kU}=require("events"),{Migrator:MU}=xb(),BU=zb(),jU=Kb(),_w=fa(),DU=fw(),FU=ww(),{isObject:QU}=A(),qw={client:{get(){return this.context.client},set(r){this.context.client=r},configurable:!0},userParams:{get(){return this.context.userParams},set(r){this.context.userParams=r},configurable:!0},schema:{get(){return this.client.schemaBuilder()},configurable:!0},migrate:{get(){return new MU(this)},configurable:!0},seed:{get(){return new BU(this)},configurable:!0},fn:{get(){return new jU(this.client)},configurable:!0}},UU=["raw","batchInsert","transaction","transactionProvider","initialize","destroy","ref","withUserParams","queryBuilder","disableProcessing","enableProcessing"];for(let r of UU)qw[r]={value:function(...e){return this.context[r](...e)},configurable:!0};function HU(r){function e(t,n){return Cw(e.context,t,n)}return Ew(e,r),e}function WU(r){let e=r.context||{};Object.assign(e,{queryBuilder(){return this.client.queryBuilder()},raw(){return this.client.raw.apply(this.client,arguments)},batchInsert(t,n,i=1e3){return FU(this,t,n,i)},transaction(t,n){!n&&QU(t)&&(n=t,t=null);let i=Object.assign({},n);return i.userParams=this.userParams||{},i.doNotRejectOnRollback===void 0&&(i.doNotRejectOnRollback=!0),this._transaction(t,i)},_transaction(t,n,i=null){return t?this.client.transaction(t,n,i):new Promise((s,o)=>{this.client.transaction(s,n,i).catch(o)})},transactionProvider(t){let n;return()=>(n||(n=this.transaction(void 0,t)),n)},initialize(t){return this.client.initializePool(t)},destroy(t){return this.client.destroy(t)},ref(t){return this.client.ref(t)},disableProcessing(){this.userParams.isProcessingDisabled||(this.userParams.wrapIdentifier=this.client.config.wrapIdentifier,this.userParams.postProcessResponse=this.client.config.postProcessResponse,this.client.config.wrapIdentifier=null,this.client.config.postProcessResponse=null,this.userParams.isProcessingDisabled=!0)},enableProcessing(){this.userParams.isProcessingDisabled&&(this.client.config.wrapIdentifier=this.userParams.wrapIdentifier,this.client.config.postProcessResponse=this.userParams.postProcessResponse,this.userParams.isProcessingDisabled=!1)},withUserParams(t){let n=VU(r);return this.client&&(n.client=Object.create(this.client.constructor.prototype),DU(n.client,this.client),n.client.config=Object.assign({},this.client.config)),Ew(n,n.client),fi("query",r,n),fi("query-error",r,n),fi("query-response",r,n),fi("start",r,n),n.userParams=t,n}}),r.context||(r.context=e)}function fi(r,e,t){e.listeners(r).forEach(i=>{t.on(r,i)})}function Ew(r,e){for(let n=0;n<_w.length;n++){let i=_w[n];r[i]=function(){let s=this.queryBuilder();return s[i].apply(s,arguments)}}Object.defineProperties(r,qw),WU(r),r.client=e,r.userParams={};let t=new kU;for(let n in t)r[n]=t[n];r._internalListeners&&r._internalListeners.forEach(({eventName:n,listener:i})=>{r.client.removeListener(n,i)}),r._internalListeners=[],di(r,"start",n=>{r.emit("start",n)}),di(r,"query",n=>{r.emit("query",n)}),di(r,"query-error",(n,i)=>{r.emit("query-error",n,i)}),di(r,"query-response",(n,i,s)=>{r.emit("query-response",n,i,s)})}function di(r,e,t){r.client.on(e,t),r._internalListeners.push({eventName:e,listener:t})}function Cw(r,e,t){let n=r.queryBuilder();return e||r.client.logger.warn("calling knex without a tableName is deprecated. Use knex.queryBuilder() instead."),e?n.table(e,t):n}function VU(r){let e=Object.create(Object.getPrototypeOf(r),Object.getOwnPropertyDescriptors(r)),t={},i=((s,o)=>Cw(t,s,o)).bind(e);return Object.assign(i,r),i.context=t,i}vw.exports=HU});var ya=l((mre,xw)=>{xw.exports=function(){}});var ba=l((gre,Tw)=>{var GU=ya(),zU=r=>Object.assign(r,{finally(e){return this.then().finally(e)}});Tw.exports=Promise.prototype.finally?zU:GU});var Se=l((yre,Rw)=>{var{EventEmitter:JU}=require("events"),KU=ae(),YU=lo(),{callbackify:XU}=require("util"),ZU=ga(),{timeout:Aw,KnexTimeoutError:Sw}=ft(),e2=ba(),Wr=KU("knex:tx");function t2(){return{userParams:{},doNotRejectOnRollback:!0}}var Nw=["read uncommitted","read committed","snapshot","repeatable read","serializable"],pi=class extends JU{constructor(e,t,n=t2(),i=null){super(),this.userParams=n.userParams,this.doNotRejectOnRollback=n.doNotRejectOnRollback;let s=this.txid=YU("trx");this.client=e,this.logger=e.logger,this.outerTx=i,this.trxClient=void 0,this._completed=!1,this._debug=e.config&&e.config.debug,n.isolationLevel&&this.setIsolationLevel(n.isolationLevel),Wr("%s: Starting %s transaction",s,i?"nested":"top level"),this._lastChild=Promise.resolve();let a=(i?i._lastChild:Promise.resolve()).then(()=>this._evaluateContainer(n,t));this._promise=a.then(u=>u),i&&(i._lastChild=a.catch(()=>{}))}isCompleted(){return this._completed||this.outerTx&&this.outerTx.isCompleted()||!1}begin(e){return(this.isolationLevel?this.query(e,`SET TRANSACTION ISOLATION LEVEL ${this.isolationLevel};`):Promise.resolve()).then(()=>this.query(e,"BEGIN;"))}savepoint(e){return this.query(e,`SAVEPOINT ${this.txid};`)}commit(e,t){return this.query(e,"COMMIT;",1,t)}release(e,t){return this.query(e,`RELEASE SAVEPOINT ${this.txid};`,1,t)}setIsolationLevel(e){if(!Nw.includes(e))throw new Error(`Invalid isolationLevel, supported isolation levels are: ${JSON.stringify(Nw)}`);return this.isolationLevel=e,this}rollback(e,t){return Aw(this.query(e,"ROLLBACK",2,t),5e3).catch(n=>{if(!(n instanceof Sw))return Promise.reject(n);this._rejecter(t)})}rollbackTo(e,t){return Aw(this.query(e,`ROLLBACK TO SAVEPOINT ${this.txid}`,2,t),5e3).catch(n=>{if(!(n instanceof Sw))return Promise.reject(n);this._rejecter(t)})}query(e,t,n,i){let s=this.trxClient.query(e,t).catch(o=>{n=2,i=o,this._completed=!0,Wr("%s error running transaction query",this.txid)}).then(o=>{if(n===1&&this._resolver(i),n===2){if(i===void 0){if(this.doNotRejectOnRollback&&/^ROLLBACK\b/i.test(t)){this._resolver();return}i=new Error(`Transaction rejected with non-error: ${i}`)}this._rejecter(i)}return o});return(n===1||n===2)&&(this._completed=!0),s}debug(e){return this._debug=arguments.length?e:!0,this}async _evaluateContainer(e,t){return this.acquireConnection(e,n=>{let i=this.trxClient=n2(this,this.client,n),s=this.client.transacting?this.savepoint(n):this.begin(n),o=new Promise((a,u)=>{this._resolver=a,this._rejecter=u});return s.then(()=>r2(this,n,i)).then(a=>{a.executionPromise=o;let u;try{u=t(a)}catch(c){u=Promise.reject(c)}return u&&u.then&&typeof u.then=="function"&&u.then(c=>a.commit(c)).catch(c=>a.rollback(c)),null}).catch(a=>this._rejecter(a)),o})}async acquireConnection(e,t){let n=e&&e.connection,i=n||await this.client.acquireConnection();try{return i.__knexTxId=this.txid,await t(i)}finally{n?Wr("%s: not releasing external connection",this.txid):(Wr("%s: releasing connection",this.txid),this.client.releaseConnection(i))}}then(e,t){return this._promise.then(e,t)}catch(...e){return this._promise.catch(...e)}asCallback(e){return XU(()=>this._promise)(e),this._promise}};e2(pi.prototype);function r2(r,e,t){let n=ZU(t);return n.context.withUserParams=()=>{throw new Error("Cannot set user params on a transaction - it can only inherit params from main knex instance")},n.isTransaction=!0,n.userParams=r.userParams||{},n.context.transaction=function(i,s){return s?s.doNotRejectOnRollback===void 0&&(s.doNotRejectOnRollback=!0):s={doNotRejectOnRollback:!0},this._transaction(i,s,r)},n.savepoint=function(i,s){return n.transaction(i,s)},r.client.transacting?(n.commit=i=>r.release(e,i),n.rollback=i=>r.rollbackTo(e,i)):(n.commit=i=>r.commit(e,i),n.rollback=i=>r.rollback(e,i)),n.isCompleted=()=>r.isCompleted(),n}function n2(r,e,t){let n=Object.create(e.constructor.prototype);n.version=e.version,n.config=e.config,n.driver=e.driver,n.connectionSettings=e.connectionSettings,n.transacting=!0,n.valueForUndefined=e.valueForUndefined,n.logger=e.logger,n.on("start",function(o){r.emit("start",o),e.emit("start",o)}),n.on("query",function(o){r.emit("query",o),e.emit("query",o)}),n.on("query-error",function(o,a){r.emit("query-error",o,a),e.emit("query-error",o,a)}),n.on("query-response",function(o,a,u){r.emit("query-response",o,a,u),e.emit("query-response",o,a,u)});let i=n.query;n.query=function(o,a){let u=r.isCompleted();return new Promise(function(c,h){try{if(o!==t)throw new Error("Invalid connection for transaction query.");u&&Ow(r,a),c(i.call(n,o,a))}catch(f){h(f)}})};let s=n.stream;return n.stream=function(o,a,u,c){let h=r.isCompleted();return new Promise(function(f,d){try{if(o!==t)throw new Error("Invalid connection for transaction query.");h&&Ow(r,a),f(s.call(n,o,a,u,c))}catch(g){d(g)}})},n.acquireConnection=function(){return Promise.resolve(t)},n.releaseConnection=function(){return Promise.resolve()},n}function Ow(r,e){let t=typeof e=="string"?e:e&&e.sql;throw Wr("%s: Transaction completed: %s",r.txid,t),new Error("Transaction query already complete, run with DEBUG=knex:tx for more info")}Rw.exports=pi});var wa=l((bre,$w)=>{var i2=ae()("knex:query"),s2=ae()("knex:bindings"),o2=(r,e)=>i2(r.replace(/%/g,"%%"),e),{isString:a2}=A();function Iw(r,e,t,n){e=e==null?[]:[].concat(e);let i=0;return r.replace(/\\?\?/g,s=>{if(s==="\\?")return"?";if(i===e.length)return s;let o=e[i++];return n._escapeBinding(o,{timeZone:t})})}function u2(r,e,t){let n=a2(e)?{sql:e}:e;n.bindings=t.prepBindings(n.bindings),n.sql=t.positionBindings(n.sql);let{__knexUid:i,__knexTxId:s}=r;return t.emit("query",Object.assign({__knexUid:i,__knexTxId:s},n)),o2(n.sql,s),s2(n.bindings,s),n}function l2(r,e,t){return t._query(r,e).catch(n=>{throw t.config&&t.config.compileSqlOnError===!1?n.message=e.sql+" - "+n.message:n.message=Iw(e.sql,e.bindings,void 0,t)+" - "+n.message,t.emit("query-error",n,Object.assign({__knexUid:r.__knexUid,__knexTxId:r.__knexUid},e)),n})}$w.exports={enrichQueryObject:u2,executeQuery:l2,formatQuery:Iw}});var Fe=l((wre,Pw)=>{var c2=Ar(),h2=ve(),f2=jr(),d2=de(),p2=Bt(),m2=xe(),g2=Object.prototype,y2=g2.hasOwnProperty,b2=f2(function(r,e){if(p2(e)||d2(e)){h2(e,m2(e),r);return}for(var t in e)y2.call(e,t)&&c2(r,t,e[t])});Pw.exports=b2});var mi=l((_re,Lw)=>{var w2=so(),_2=4;function q2(r){return w2(r,_2)}Lw.exports=q2});var Mw=l((qre,kw)=>{var E2=z();function C2(r){return typeof r=="function"?r:E2}kw.exports=C2});var jw=l((Ere,Bw)=>{var v2=Pn(),x2=mt(),T2=Mw(),A2=I();function S2(r,e){var t=A2(r)?v2:x2;return t(r,T2(e))}Bw.exports=S2});var Gt=l((Cre,Dw)=>{Dw.exports=jw()});var _a=l((vre,Fw)=>{var N2=mt();function O2(r,e){var t=[];return N2(r,function(n,i,s){e(n,i,s)&&t.push(n)}),t}Fw.exports=O2});var qa=l((xre,Qw)=>{var R2="Expected a function";function I2(r){if(typeof r!="function")throw new TypeError(R2);return function(){var e=arguments;switch(e.length){case 0:return!r.call(this);case 1:return!r.call(this,e[0]);case 2:return!r.call(this,e[0],e[1]);case 3:return!r.call(this,e[0],e[1],e[2])}return!r.apply(this,e)}}Qw.exports=I2});var Hw=l((Tre,Uw)=>{var $2=Bn(),P2=_a(),L2=pe(),k2=I(),M2=qa();function B2(r,e){var t=k2(r)?$2:P2;return t(r,M2(L2(e,3)))}Uw.exports=B2});var Vr=l((Are,Ww)=>{var j2=ma();function D2(r){var e=r==null?0:r.length;return e?j2(r,1,e):[]}Ww.exports=D2});var Gw=l((Sre,Vw)=>{function F2(r){for(var e,t=[];!(e=r.next()).done;)t.push(e.value);return t}Vw.exports=F2});var Jw=l((Nre,zw)=>{function Q2(r){return r.split("")}zw.exports=Q2});var Yw=l((Ore,Kw)=>{var U2="\\ud800-\\udfff",H2="\\u0300-\\u036f",W2="\\ufe20-\\ufe2f",V2="\\u20d0-\\u20ff",G2=H2+W2+V2,z2="\\ufe0e\\ufe0f",J2="\\u200d",K2=RegExp("["+J2+U2+G2+z2+"]");function Y2(r){return K2.test(r)}Kw.exports=Y2});var s_=l((Rre,i_)=>{var Xw="\\ud800-\\udfff",X2="\\u0300-\\u036f",Z2="\\ufe20-\\ufe2f",e3="\\u20d0-\\u20ff",t3=X2+Z2+e3,r3="\\ufe0e\\ufe0f",n3="["+Xw+"]",Ea="["+t3+"]",Ca="\\ud83c[\\udffb-\\udfff]",i3="(?:"+Ea+"|"+Ca+")",Zw="[^"+Xw+"]",e_="(?:\\ud83c[\\udde6-\\uddff]){2}",t_="[\\ud800-\\udbff][\\udc00-\\udfff]",s3="\\u200d",r_=i3+"?",n_="["+r3+"]?",o3="(?:"+s3+"(?:"+[Zw,e_,t_].join("|")+")"+n_+r_+")*",a3=n_+r_+o3,u3="(?:"+[Zw+Ea+"?",Ea,e_,t_,n3].join("|")+")",l3=RegExp(Ca+"(?="+Ca+")|"+u3+a3,"g");function c3(r){return r.match(l3)||[]}i_.exports=c3});var a_=l((Ire,o_)=>{var h3=Jw(),f3=Yw(),d3=s_();function p3(r){return f3(r)?d3(r):h3(r)}o_.exports=p3});var zt=l(($re,l_)=>{var u_=ke(),m3=Mn(),g3=at(),y3=de(),b3=aa(),w3=Gw(),_3=$o(),q3=Fr(),E3=a_(),C3=hi(),v3="[object Map]",x3="[object Set]",va=u_?u_.iterator:void 0;function T3(r){if(!r)return[];if(y3(r))return b3(r)?E3(r):m3(r);if(va&&r[va])return w3(r[va]());var e=g3(r),t=e==v3?_3:e==x3?q3:C3;return t(r)}l_.exports=T3});var gi=l((Pre,h_)=>{var c_=Object.freeze({pg:"postgres",postgresql:"postgres",sqlite:"sqlite3"}),A3=Object.freeze(["mssql","mysql","mysql2","oracledb","postgres","pgnative","redshift","sqlite3","cockroachdb","better-sqlite3"].concat(Object.keys(c_))),S3=Object.freeze({MsSQL:"mssql",MySQL:"mysql",MySQL2:"mysql2",Oracle:"oracledb",PostgreSQL:"pg",PgNative:"pgnative",Redshift:"pg-redshift",SQLite:"sqlite3",CockroachDB:"cockroachdb",BetterSQLite3:"better-sqlite3"}),N3=Object.freeze(["maxWaitingClients","testOnBorrow","fifo","priorityRange","autostart","evictionRunIntervalMillis","numTestsPerRun","softIdleTimeoutMillis","Promise"]),O3=/,[\s](?![^(]*\))/g;h_.exports={CLIENT_ALIASES:c_,SUPPORTED_CLIENTS:A3,POOL_CONFIG_OPTIONS:N3,COMMA_NO_PAREN_REGEX:O3,DRIVER_NAMES:S3}});var D=l((Lre,d_)=>{var f_=we(),R3=st(),{CLIENT_ALIASES:I3}=gi(),{isFunction:$3}=A();function P3(...r){return Array.isArray(r[0])?r[0]:r}function Gr(r){let e=!1;if(R3(r))return!1;if(r&&$3(r.toSQL))return e;if(Array.isArray(r))for(let t=0;t<r.length&&!e;t++)e=Gr(r[t]);else f_(r)?Object.keys(r).forEach(t=>{e||(e=Gr(r[t]))}):e=r===void 0;return e}function L3(r){let e=[];return Array.isArray(r)?r.forEach((t,n)=>{Gr(t)&&e.push(n)}):f_(r)?Object.keys(r).forEach(t=>{Gr(r[t])&&e.push(t)}):e.push(0),e}function k3(r){r.prototype.queryContext=function(e){return e===void 0?this._queryContext:(this._queryContext=e,this)}}function M3(r){return I3[r]||r}function B3(r,e){if(r==null)return e;let t=parseInt(r,10);return isNaN(t)?e:t}d_.exports={addQueryContext:k3,containsUndefined:Gr,getUndefinedIndices:L3,normalizeArr:P3,resolveClientNameWithAliases:M3,toNumber:B3}});var xa=l((kre,g_)=>{var p_=require("assert");function m_(r,e,t,n,i){if(typeof t=="function")return{type:"onWrapped",value:t,bool:e};switch(arguments.length){case 3:return{type:"onRaw",value:t,bool:e};case 4:return{type:r,column:t,operator:"=",value:n,bool:e};default:return{type:r,column:t,operator:n,value:i,bool:e}}}var O=class{constructor(e,t,n){this.schema=n,this.table=e,this.joinType=t,this.and=this,this.clauses=[]}get or(){return this._bool("or")}on(e){if(typeof e=="object"&&typeof e.toSQL!="function"){let n=Object.keys(e),i=-1,s=this._bool()==="or"?"orOn":"on";for(;++i<n.length;)this[s](n[i],e[n[i]]);return this}let t=m_("onBasic",this._bool(),...arguments);return t&&this.clauses.push(t),this}orOn(e,t,n){return this._bool("or").on.apply(this,arguments)}onJsonPathEquals(e,t,n,i){return this.clauses.push({type:"onJsonPathEquals",columnFirst:e,jsonPathFirst:t,columnSecond:n,jsonPathSecond:i,bool:this._bool(),not:this._not()}),this}orOnJsonPathEquals(e,t,n,i){return this._bool("or").onJsonPathEquals.apply(this,arguments)}using(e){return this.clauses.push({type:"onUsing",column:e,bool:this._bool()})}onVal(e){if(typeof e=="object"&&typeof e.toSQL!="function"){let n=Object.keys(e),i=-1,s=this._bool()==="or"?"orOnVal":"onVal";for(;++i<n.length;)this[s](n[i],e[n[i]]);return this}let t=m_("onVal",this._bool(),...arguments);return t&&this.clauses.push(t),this}andOnVal(){return this.onVal(...arguments)}orOnVal(){return this._bool("or").onVal(...arguments)}onBetween(e,t){return p_(Array.isArray(t),"The second argument to onBetween must be an array."),p_(t.length===2,"You must specify 2 values for the onBetween clause"),this.clauses.push({type:"onBetween",column:e,value:t,bool:this._bool(),not:this._not()}),this}onNotBetween(e,t){return this._not(!0).onBetween(e,t)}orOnBetween(e,t){return this._bool("or").onBetween(e,t)}orOnNotBetween(e,t){return this._bool("or")._not(!0).onBetween(e,t)}onIn(e,t){return Array.isArray(t)&&t.length===0?this.on(1,"=",0):(this.clauses.push({type:"onIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}onNotIn(e,t){return this._not(!0).onIn(e,t)}orOnIn(e,t){return this._bool("or").onIn(e,t)}orOnNotIn(e,t){return this._bool("or")._not(!0).onIn(e,t)}onNull(e){return this.clauses.push({type:"onNull",column:e,not:this._not(),bool:this._bool()}),this}orOnNull(e){return this._bool("or").onNull(e)}onNotNull(e){return this._not(!0).onNull(e)}orOnNotNull(e){return this._not(!0)._bool("or").onNull(e)}onExists(e){return this.clauses.push({type:"onExists",value:e,not:this._not(),bool:this._bool()}),this}orOnExists(e){return this._bool("or").onExists(e)}onNotExists(e){return this._not(!0).onExists(e)}orOnNotExists(e){return this._not(!0)._bool("or").onExists(e)}type(e){return this.joinType=e,this}_bool(e){if(arguments.length===1)return this._boolFlag=e,this;let t=this._boolFlag||"and";return this._boolFlag="and",t}_not(e){if(arguments.length===1)return this._notFlag=e,this;let t=this._notFlag;return this._notFlag=!1,t}};Object.assign(O.prototype,{grouping:"join"});O.prototype.andOn=O.prototype.on;O.prototype.andOnIn=O.prototype.onIn;O.prototype.andOnNotIn=O.prototype.onNotIn;O.prototype.andOnNull=O.prototype.onNull;O.prototype.andOnNotNull=O.prototype.onNotNull;O.prototype.andOnExists=O.prototype.onExists;O.prototype.andOnNotExists=O.prototype.onNotExists;O.prototype.andOnBetween=O.prototype.onBetween;O.prototype.andOnNotBetween=O.prototype.onNotBetween;O.prototype.andOnJsonPathEquals=O.prototype.onJsonPathEquals;g_.exports=O});var w_=l((Mre,b_)=>{var y_=require("assert"),Ta=class{constructor(e,t,n,i,s){this.schema=t,this.type="analytic",this.method=e,this.order=i||[],this.partitions=s||[],this.alias=n,this.and=this,this.grouping="columns"}partitionBy(e,t){return y_(Array.isArray(e)||typeof e=="string",`The argument to an analytic partitionBy function must be either a string
            or an array of string.`),Array.isArray(e)?this.partitions=this.partitions.concat(e):this.partitions.push({column:e,order:t}),this}orderBy(e,t){return y_(Array.isArray(e)||typeof e=="string",`The argument to an analytic orderBy function must be either a string
            or an array of string.`),Array.isArray(e)?this.order=this.order.concat(e):this.order.push({column:e,order:t}),this}};b_.exports=Ta});var yi=l((Bre,__)=>{__.exports=function(e,t){e.client.config.asyncStackTraces&&(e._asyncStack={error:new Error,lines:t})}});var E_=l((jre,q_)=>{q_.exports={lockMode:{forShare:"forShare",forUpdate:"forUpdate",forNoKeyUpdate:"forNoKeyUpdate",forKeyShare:"forKeyShare"},waitMode:{skipLocked:"skipLocked",noWait:"noWait"}}});var bi=l((Dre,C_)=>{var j3=mi(),D3=te(),{callbackify:F3}=require("util"),Q3=ba(),{formatQuery:U3}=wa();function H3(r){r.prototype.toQuery=function(e){let t=this.toSQL(this._method,e);return Array.isArray(t)||(t=[t]),t.length?t.map(n=>U3(n.sql,n.bindings,e,this.client)).reduce((n,i)=>n.concat(n.endsWith(";")?`
`:`;
`,i)):""},r.prototype.then=function(){let e=this.client.runner(this).run();return this.client.config.asyncStackTraces&&(e=e.catch(t=>{t.originalStack=t.stack;let n=t.stack.split(`
`)[0],{error:i,lines:s}=this._asyncStack,a=i.stack.split(`
`).slice(s);throw a.unshift(n),t.stack=a.join(`
`),t})),e.then.apply(e,arguments)},r.prototype.options=function(e){return this._options=this._options||[],this._options.push(j3(e)||{}),this},r.prototype.connection=function(e){return this._connection=e,this.client.processPassedConnection(e),this},r.prototype.debug=function(e){return this._debug=arguments.length?e:!0,this},r.prototype.transacting=function(e){if(e&&e.client&&(e.client.transacting?this.client=e.client:e.client.logger.warn(`Invalid transaction value: ${e.client}`)),D3(e))throw this.client.logger.error("Invalid value on transacting call, potential bug"),Error("Invalid transacting value (null, undefined or empty object)");return this},r.prototype.stream=function(e){return this.client.runner(this).stream(e)},r.prototype.pipe=function(e,t){return this.client.runner(this).pipe(e,t)},r.prototype.asCallback=function(e){let t=this.then();return F3(()=>t)(e),t},r.prototype.catch=function(e){return this.then().catch(e)},Object.defineProperty(r.prototype,Symbol.toStringTag,{get:()=>"object"}),Q3(r.prototype)}C_.exports={augmentWithBuilderInterface:H3}});var Oe=l((Fre,T_)=>{var Jt=require("assert"),{EventEmitter:W3}=require("events"),V3=Fe(),wi=mi(),G3=Gt(),Kt=te(),v_=we(),z3=_o(),J3=Hw(),K3=Vr(),x_=zt(),{addQueryContext:Y3,normalizeArr:zr}=D(),Aa=xa(),X3=w_(),Z3=yi(),{isBoolean:Jr,isNumber:eH,isObject:Ne,isString:Sa,isFunction:tH}=A(),{lockMode:Qe,waitMode:_i}=E_(),{augmentWithBuilderInterface:rH}=bi(),nH=new Set(["pluck","first","select"]),iH=new Set(["with","select","columns","hintComments","where","union","join","group","order","having","limit","offset","counter","counters"]),sH=new Set([Qe.forShare,Qe.forUpdate,Qe.forNoKeyUpdate,Qe.forKeyShare]),b=class extends W3{constructor(e){super(),this.client=e,this.and=this,this._single={},this._statements=[],this._method="select",e.config&&(Z3(this,5),this._debug=e.config.debug),this._joinFlag="inner",this._boolFlag="and",this._notFlag=!1,this._asColumnFlag=!1}toString(){return this.toQuery()}toSQL(e,t){return this.client.queryCompiler(this).toSQL(e||this._method,t)}clone(){let e=new this.constructor(this.client);return e._method=this._method,e._single=wi(this._single),e._statements=wi(this._statements),e._debug=this._debug,this._options!==void 0&&(e._options=wi(this._options)),this._queryContext!==void 0&&(e._queryContext=wi(this._queryContext)),this._connection!==void 0&&(e._connection=this._connection),e}timeout(e,{cancel:t}={}){return eH(e)&&e>0&&(this._timeout=e,t&&(this.client.assertCanCancelQuery(),this._cancelOnTimeout=!0)),this}isValidStatementArg(e){return typeof e=="function"||e instanceof b||e&&e.isRawInstance}_validateWithArgs(e,t,n,i){let[s,o]=typeof n>"u"?[t,void 0]:[n,t];if(typeof e!="string")throw new Error(`${i}() first argument must be a string`);if(this.isValidStatementArg(s)&&typeof o>"u")return;if(!(Array.isArray(o)&&o.length>0&&o.every(u=>typeof u=="string")))throw new Error(`${i}() second argument must be a statement or non-empty column name list.`);if(!this.isValidStatementArg(s))throw new Error(`${i}() third argument must be a function / QueryBuilder or a raw when its second argument is a column name list`)}with(e,t,n){return this._validateWithArgs(e,t,n,"with"),this.withWrapped(e,t,n)}withMaterialized(e,t,n){throw new Error("With materialized is not supported by this dialect")}withNotMaterialized(e,t,n){throw new Error("With materialized is not supported by this dialect")}withWrapped(e,t,n,i){let[s,o]=typeof n>"u"?[t,void 0]:[n,t],a={grouping:"with",type:"withWrapped",alias:e,columnList:o,value:s};return i!==void 0&&(a.materialized=i),this._statements.push(a),this}withRecursive(e,t,n){return this._validateWithArgs(e,t,n,"withRecursive"),this.withRecursiveWrapped(e,t,n)}withRecursiveWrapped(e,t,n){return this.withWrapped(e,t,n),this._statements[this._statements.length-1].recursive=!0,this}columns(e){return!e&&e!==0?this:(this._statements.push({grouping:"columns",value:zr(...arguments)}),this)}as(e){return this._single.as=e,this}hintComment(e){if(e=Array.isArray(e)?e:[e],e.some(t=>!Sa(t)))throw new Error("Hint comment must be a string");if(e.some(t=>t.includes("/*")||t.includes("*/")))throw new Error('Hint comment cannot include "/*" or "*/"');if(e.some(t=>t.includes("?")))throw new Error('Hint comment cannot include "?"');return this._statements.push({grouping:"hintComments",value:e}),this}withSchema(e){return this._single.schema=e,this}table(e,t={}){return this._single.table=e,this._single.only=t.only===!0,this}distinct(...e){return this._statements.push({grouping:"columns",value:zr(...e),distinct:!0}),this}distinctOn(...e){if(Kt(e))throw new Error("distinctOn requires at least on argument");return this._statements.push({grouping:"columns",value:zr(...e),distinctOn:!0}),this}join(e,t,...n){let i,s=e instanceof b||typeof e=="function"?void 0:this._single.schema,o=this._joinType();return typeof t=="function"?(i=new Aa(e,o,s),t.call(i,i)):o==="raw"?i=new Aa(this.client.raw(e,t),"raw"):(i=new Aa(e,o,s),t&&i.on(t,...n)),this._statements.push(i),this}using(e){throw new Error("'using' function is only available in PostgreSQL dialect with Delete statements.")}innerJoin(...e){return this._joinType("inner").join(...e)}leftJoin(...e){return this._joinType("left").join(...e)}leftOuterJoin(...e){return this._joinType("left outer").join(...e)}rightJoin(...e){return this._joinType("right").join(...e)}rightOuterJoin(...e){return this._joinType("right outer").join(...e)}outerJoin(...e){return this._joinType("outer").join(...e)}fullOuterJoin(...e){return this._joinType("full outer").join(...e)}crossJoin(...e){return this._joinType("cross").join(...e)}joinRaw(...e){return this._joinType("raw").join(...e)}get or(){return this._bool("or")}get not(){return this._not(!0)}where(e,t,n){let i=arguments.length;if(e===!1||e===!0)return this.where(1,"=",e?1:0);if(typeof e=="function")return this.whereWrapped(e);if(Ne(e)&&!e.isRawInstance)return this._objectWhere(e);if(e&&e.isRawInstance&&i===1)return this.whereRaw(e);if(i===2&&(n=t,t="=",n===null))return this.whereNull(e);let s=`${t}`.toLowerCase().trim();if(i===3){if(s==="in"||s==="not in")return this._not(s==="not in").whereIn(e,n);if(s==="between"||s==="not between")return this._not(s==="not between").whereBetween(e,n)}return n===null&&(s==="is"||s==="is not")?this._not(s==="is not").whereNull(e):(this._statements.push({grouping:"where",type:"whereBasic",column:e,operator:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag}),this)}whereColumn(...e){return this._asColumnFlag=!0,this.where(...e),this._asColumnFlag=!1,this}orWhere(e,...t){this._bool("or");let n=e;return Ne(n)&&!n.isRawInstance?this.whereWrapped(function(){for(let i in n)this.andWhere(i,n[i])}):this.where(e,...t)}orWhereColumn(e,...t){this._bool("or");let n=e;return Ne(n)&&!n.isRawInstance?this.whereWrapped(function(){for(let i in n)this.andWhereColumn(i,"=",n[i])}):this.whereColumn(e,...t)}whereNot(e,...t){return t.length>=2&&(t[0]==="in"||t[0]==="between")&&this.client.logger.warn('whereNot is not suitable for "in" and "between" type subqueries. You should use "not in" and "not between" instead.'),this._not(!0).where(e,...t)}whereNotColumn(...e){return this._not(!0).whereColumn(...e)}orWhereNot(...e){return this._bool("or").whereNot(...e)}orWhereNotColumn(...e){return this._bool("or").whereNotColumn(...e)}_objectWhere(e){let t=this._bool(),n=this._not()?"Not":"";for(let i in e)this[t+"Where"+n](i,e[i]);return this}whereRaw(e,t){let n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"where",type:"whereRaw",value:n,not:this._not(),bool:this._bool()}),this}orWhereRaw(e,t){return this._bool("or").whereRaw(e,t)}whereWrapped(e){return this._statements.push({grouping:"where",type:"whereWrapped",value:e,not:this._not(),bool:this._bool()}),this}whereExists(e){return this._statements.push({grouping:"where",type:"whereExists",value:e,not:this._not(),bool:this._bool()}),this}orWhereExists(e){return this._bool("or").whereExists(e)}whereNotExists(e){return this._not(!0).whereExists(e)}orWhereNotExists(e){return this._bool("or").whereNotExists(e)}whereIn(e,t){return Array.isArray(t)&&Kt(t)?this.where(this._not()):(this._statements.push({grouping:"where",type:"whereIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}orWhereIn(e,t){return this._bool("or").whereIn(e,t)}whereNotIn(e,t){return this._not(!0).whereIn(e,t)}orWhereNotIn(e,t){return this._bool("or")._not(!0).whereIn(e,t)}whereNull(e){return this._statements.push({grouping:"where",type:"whereNull",column:e,not:this._not(),bool:this._bool()}),this}orWhereNull(e){return this._bool("or").whereNull(e)}whereNotNull(e){return this._not(!0).whereNull(e)}orWhereNotNull(e){return this._bool("or").whereNotNull(e)}whereBetween(e,t){return Jt(Array.isArray(t),"The second argument to whereBetween must be an array."),Jt(t.length===2,"You must specify 2 values for the whereBetween clause"),this._statements.push({grouping:"where",type:"whereBetween",column:e,value:t,not:this._not(),bool:this._bool()}),this}whereNotBetween(e,t){return this._not(!0).whereBetween(e,t)}orWhereBetween(e,t){return this._bool("or").whereBetween(e,t)}orWhereNotBetween(e,t){return this._bool("or").whereNotBetween(e,t)}_whereLike(e,t,n){return this._statements.push({grouping:"where",type:e,column:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag}),this}whereLike(e,t){return this._whereLike("whereLike",e,t)}orWhereLike(e,t){return this._bool("or")._whereLike("whereLike",e,t)}whereILike(e,t){return this._whereLike("whereILike",e,t)}orWhereILike(e,t){return this._bool("or")._whereLike("whereILike",e,t)}groupBy(e){return e&&e.isRawInstance?this.groupByRaw.apply(this,arguments):(this._statements.push({grouping:"group",type:"groupByBasic",value:zr(...arguments)}),this)}groupByRaw(e,t){let n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"group",type:"groupByRaw",value:n}),this}orderBy(e,t,n=""){return Array.isArray(e)?this._orderByArray(e):(this._statements.push({grouping:"order",type:"orderByBasic",value:e,direction:t,nulls:n}),this)}_orderByArray(e){for(let t=0;t<e.length;t++){let n=e[t];Ne(n)?this._statements.push({grouping:"order",type:"orderByBasic",value:n.column,direction:n.order,nulls:n.nulls}):Sa(n)&&this._statements.push({grouping:"order",type:"orderByBasic",value:n})}return this}orderByRaw(e,t){let n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"order",type:"orderByRaw",value:n}),this}_union(e,t){let n=t[0],i=t[1];if(t.length===1||t.length===2&&Jr(i)){Array.isArray(n)||(n=[n]);for(let s=0,o=n.length;s<o;s++)this._statements.push({grouping:"union",clause:e,value:n[s],wrap:i||!1})}else n=x_(t).slice(0,t.length-1),i=t[t.length-1],Jr(i)||(n.push(i),i=!1),this._union(e,[n,i]);return this}union(...e){return this._union("union",e)}unionAll(...e){return this._union("union all",e)}intersect(e,t){if(arguments.length===1||arguments.length===2&&Jr(t)){Array.isArray(e)||(e=[e]);for(let n=0,i=e.length;n<i;n++)this._statements.push({grouping:"union",clause:"intersect",value:e[n],wrap:t||!1})}else e=x_(arguments).slice(0,arguments.length-1),t=arguments[arguments.length-1],Jr(t)||(e.push(t),t=!1),this.intersect(e,t);return this}having(e,t,n){return e.isRawInstance&&arguments.length===1?this.havingRaw(e):typeof e=="function"?this.havingWrapped(e):(this._statements.push({grouping:"having",type:"havingBasic",column:e,operator:t,value:n,bool:this._bool(),not:this._not()}),this)}orHaving(e,...t){this._bool("or");let n=e;return Ne(n)&&!n.isRawInstance?this.havingWrapped(function(){for(let i in n)this.andHaving(i,n[i])}):this.having(e,...t)}havingWrapped(e){return this._statements.push({grouping:"having",type:"havingWrapped",value:e,bool:this._bool(),not:this._not()}),this}havingNull(e){return this._statements.push({grouping:"having",type:"havingNull",column:e,not:this._not(),bool:this._bool()}),this}orHavingNull(e){return this._bool("or").havingNull(e)}havingNotNull(e){return this._not(!0).havingNull(e)}orHavingNotNull(e){return this._not(!0)._bool("or").havingNull(e)}havingExists(e){return this._statements.push({grouping:"having",type:"havingExists",value:e,not:this._not(),bool:this._bool()}),this}orHavingExists(e){return this._bool("or").havingExists(e)}havingNotExists(e){return this._not(!0).havingExists(e)}orHavingNotExists(e){return this._not(!0)._bool("or").havingExists(e)}havingBetween(e,t){return Jt(Array.isArray(t),"The second argument to havingBetween must be an array."),Jt(t.length===2,"You must specify 2 values for the havingBetween clause"),this._statements.push({grouping:"having",type:"havingBetween",column:e,value:t,not:this._not(),bool:this._bool()}),this}orHavingBetween(e,t){return this._bool("or").havingBetween(e,t)}havingNotBetween(e,t){return this._not(!0).havingBetween(e,t)}orHavingNotBetween(e,t){return this._not(!0)._bool("or").havingBetween(e,t)}havingIn(e,t){return Array.isArray(t)&&Kt(t)?this.where(this._not()):(this._statements.push({grouping:"having",type:"havingIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}orHavingIn(e,t){return this._bool("or").havingIn(e,t)}havingNotIn(e,t){return this._not(!0).havingIn(e,t)}orHavingNotIn(e,t){return this._bool("or")._not(!0).havingIn(e,t)}havingRaw(e,t){let n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"having",type:"havingRaw",value:n,bool:this._bool(),not:this._not()}),this}orHavingRaw(e,t){return this._bool("or").havingRaw(e,t)}_setSkipBinding(e,t){let n=t;Ne(t)&&(n=t.skipBinding),this._single.skipBinding=this._single.skipBinding||{},this._single.skipBinding[e]=n}offset(e,t){if(e==null||e.isRawInstance||e instanceof b)this._single.offset=e;else{let n=parseInt(e,10);if(isNaN(n))this.client.logger.warn("A valid integer must be provided to offset");else{if(n<0)throw new Error("A non-negative integer must be provided to offset.");this._single.offset=n}}return this._setSkipBinding("offset",t),this}limit(e,t){let n=parseInt(e,10);return isNaN(n)?this.client.logger.warn("A valid integer must be provided to limit"):(this._single.limit=n,this._setSkipBinding("limit",t)),this}count(e,t){return this._aggregate("count",e||"*",t)}min(e,t){return this._aggregate("min",e,t)}max(e,t){return this._aggregate("max",e,t)}sum(e,t){return this._aggregate("sum",e,t)}avg(e,t){return this._aggregate("avg",e,t)}countDistinct(...e){let t;return e.length>1&&v_(z3(e))&&([t]=e.splice(e.length-1,1)),e.length?e.length===1&&(e=e[0]):e="*",this._aggregate("count",e,{...t,distinct:!0})}sumDistinct(e,t){return this._aggregate("sum",e,{...t,distinct:!0})}avgDistinct(e,t){return this._aggregate("avg",e,{...t,distinct:!0})}increment(e,t=1){if(Ne(e)){for(let n in e)this._counter(n,e[n]);return this}return this._counter(e,t)}decrement(e,t=1){if(Ne(e)){for(let n in e)this._counter(n,-e[n]);return this}return this._counter(e,-t)}clearCounters(){return this._single.counter={},this}first(...e){if(this._method&&this._method!=="select")throw new Error(`Cannot chain .first() on "${this._method}" query`);return this.select(zr(...e)),this._method="first",this.limit(1),this}connection(e){return this._connection=e,this.client.processPassedConnection(e),this}pluck(e){if(this._method&&this._method!=="select")throw new Error(`Cannot chain .pluck() on "${this._method}" query`);return this._method="pluck",this._single.pluck=e,this._statements.push({grouping:"columns",type:"pluck",value:e}),this}clearSelect(){return this._clearGrouping("columns"),this}clearWhere(){return this._clearGrouping("where"),this}clearGroup(){return this._clearGrouping("group"),this}clearOrder(){return this._clearGrouping("order"),this}clearHaving(){return this._clearGrouping("having"),this}clear(e){if(!iH.has(e))throw new Error(`Knex Error: unknown statement '${e}'`);return e.startsWith("counter")?this.clearCounters():(e==="select"&&(e="columns"),this._clearGrouping(e),this)}insert(e,t,n){return this._method="insert",Kt(t)||this.returning(t,n),this._single.insert=e,this}update(e,t,n){let i,s=this._single.update||{};if(this._method="update",Sa(e))v_(t)?s[e]=JSON.stringify(t):s[e]=t,arguments.length>2&&(i=arguments[2]);else{let o=Object.keys(e);this._single.update&&this.client.logger.warn("Update called multiple times with objects.");let a=-1;for(;++a<o.length;)s[o[a]]=e[o[a]];i=arguments[1]}return Kt(i)||this.returning(i,n),this._single.update=s,this}returning(e,t){return this._single.returning=e,this._single.options=t,this}onConflict(e){return typeof e=="string"&&(e=[e]),new Na(this,e||!0)}delete(e,t){return this._method="del",Kt(e)||this.returning(e,t),this}truncate(e){return this._method="truncate",e&&(this._single.table=e),this}columnInfo(e){return this._method="columnInfo",this._single.columnInfo=e,this}forUpdate(...e){return this._single.lock=Qe.forUpdate,e.length===1&&Array.isArray(e[0])?this._single.lockTables=e[0]:this._single.lockTables=e,this}forShare(...e){return this._single.lock=Qe.forShare,this._single.lockTables=e,this}forNoKeyUpdate(...e){return this._single.lock=Qe.forNoKeyUpdate,this._single.lockTables=e,this}forKeyShare(...e){return this._single.lock=Qe.forKeyShare,this._single.lockTables=e,this}skipLocked(){if(!this._isSelectQuery())throw new Error(`Cannot chain .skipLocked() on "${this._method}" query!`);if(!this._hasLockMode())throw new Error(".skipLocked() can only be used after a call to .forShare() or .forUpdate()!");if(this._single.waitMode===_i.noWait)throw new Error(".skipLocked() cannot be used together with .noWait()!");return this._single.waitMode=_i.skipLocked,this}noWait(){if(!this._isSelectQuery())throw new Error(`Cannot chain .noWait() on "${this._method}" query!`);if(!this._hasLockMode())throw new Error(".noWait() can only be used after a call to .forShare() or .forUpdate()!");if(this._single.waitMode===_i.skipLocked)throw new Error(".noWait() cannot be used together with .skipLocked()!");return this._single.waitMode=_i.noWait,this}fromJS(e){return G3(e,(t,n)=>{typeof this[n]!="function"&&this.client.logger.warn(`Knex Error: unknown key ${n}`),Array.isArray(t)?this[n].apply(this,t):this[n](t)}),this}fromRaw(e,t){let n=e.isRawInstance?e:this.client.raw(e,t);return this.from(n)}modify(e){return e.apply(this,[this].concat(K3(arguments))),this}upsert(e,t,n){throw new Error(`Upsert is not yet supported for dialect ${this.client.dialect}`)}_json(e,t){return this._statements.push({grouping:"columns",type:"json",method:e,params:t}),this}jsonExtract(){let e=arguments[0],t,n,i=!0;return arguments.length>=2&&(t=arguments[1]),arguments.length>=3&&(n=arguments[2]),arguments.length===4&&(i=arguments[3]),arguments.length===2&&Array.isArray(arguments[0])&&Jr(arguments[1])&&(i=arguments[1]),this._json("jsonExtract",{column:e,path:t,alias:n,singleValue:i})}jsonSet(e,t,n,i){return this._json("jsonSet",{column:e,path:t,value:n,alias:i})}jsonInsert(e,t,n,i){return this._json("jsonInsert",{column:e,path:t,value:n,alias:i})}jsonRemove(e,t,n){return this._json("jsonRemove",{column:e,path:t,alias:n})}_isJsonObject(e){return Ne(e)&&!(e instanceof b)}_whereJsonWrappedValue(e,t,n){let i={grouping:"where",type:e,column:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag};arguments[3]&&(i.operator=arguments[3]),arguments[4]&&(i.jsonPath=arguments[4]),this._statements.push(i)}whereJsonObject(e,t){return this._whereJsonWrappedValue("whereJsonObject",e,t),this}orWhereJsonObject(e,t){return this._bool("or").whereJsonObject(e,t)}whereNotJsonObject(e,t){return this._not(!0).whereJsonObject(e,t)}orWhereNotJsonObject(e,t){return this._bool("or").whereNotJsonObject(e,t)}whereJsonPath(e,t,n,i){return this._whereJsonWrappedValue("whereJsonPath",e,i,n,t),this}orWhereJsonPath(e,t,n,i){return this._bool("or").whereJsonPath(e,t,n,i)}whereJsonSupersetOf(e,t){return this._whereJsonWrappedValue("whereJsonSupersetOf",e,t),this}whereJsonNotSupersetOf(e,t){return this._not(!0).whereJsonSupersetOf(e,t)}orWhereJsonSupersetOf(e,t){return this._bool("or").whereJsonSupersetOf(e,t)}orWhereJsonNotSupersetOf(e,t){return this._bool("or").whereJsonNotSupersetOf(e,t)}whereJsonSubsetOf(e,t){return this._whereJsonWrappedValue("whereJsonSubsetOf",e,t),this}whereJsonNotSubsetOf(e,t){return this._not(!0).whereJsonSubsetOf(e,t)}orWhereJsonSubsetOf(e,t){return this._bool("or").whereJsonSubsetOf(e,t)}orWhereJsonNotSubsetOf(e,t){return this._bool("or").whereJsonNotSubsetOf(e,t)}whereJsonHasNone(e,t){return this._not(!0).whereJsonHasAll(e,t),this}_analytic(e,t,n){let i,{schema:s}=this._single,o=this._analyticMethod();if(e=typeof e=="string"?e:null,Jt(typeof t=="function"||t.isRawInstance||Array.isArray(t)||typeof t=="string"||typeof t=="object",`The second argument to an analytic function must be either a function, a raw,
       an array of string or object, an object or a single string.`),n&&Jt(Array.isArray(n)||typeof n=="string"||typeof n=="object","The third argument to an analytic function must be either a string, an array of string or object or an object."),tH(t))i=new X3(o,s,e),t.call(i,i);else if(t.isRawInstance)i={grouping:"columns",type:"analytic",method:o,raw:t,alias:e};else{let a=Array.isArray(t)?t:[t],u=n||[];u=Array.isArray(u)?u:[u],i={grouping:"columns",type:"analytic",method:o,order:a,alias:e,partitions:u}}return this._statements.push(i),this}rank(...e){return this._analyticMethod("rank")._analytic(...e)}denseRank(...e){return this._analyticMethod("dense_rank")._analytic(...e)}rowNumber(...e){return this._analyticMethod("row_number")._analytic(...e)}_counter(e,t){return t=parseFloat(t),this._method="update",this._single.counter=this._single.counter||{},this._single.counter[e]=t,this}_bool(e){if(arguments.length===1)return this._boolFlag=e,this;let t=this._boolFlag;return this._boolFlag="and",t}_not(e){if(arguments.length===1)return this._notFlag=e,this;let t=this._notFlag;return this._notFlag=!1,t}_joinType(e){if(arguments.length===1)return this._joinFlag=e,this;let t=this._joinFlag||"inner";return this._joinFlag="inner",t}_analyticMethod(e){return arguments.length===1?(this._analyticFlag=e,this):this._analyticFlag||"row_number"}_aggregate(e,t,n={}){return this._statements.push({grouping:"columns",type:t.isRawInstance?"aggregateRaw":"aggregate",method:e,value:t,aggregateDistinct:n.distinct||!1,alias:n.as}),this}_clearGrouping(e){e in this._single?this._single[e]=void 0:this._statements=J3(this._statements,{grouping:e})}_isSelectQuery(){return nH.has(this._method)}_hasLockMode(){return sH.has(this._single.lock)}};b.prototype.select=b.prototype.columns;b.prototype.column=b.prototype.columns;b.prototype.andWhereNot=b.prototype.whereNot;b.prototype.andWhereNotColumn=b.prototype.whereNotColumn;b.prototype.andWhere=b.prototype.where;b.prototype.andWhereColumn=b.prototype.whereColumn;b.prototype.andWhereRaw=b.prototype.whereRaw;b.prototype.andWhereBetween=b.prototype.whereBetween;b.prototype.andWhereNotBetween=b.prototype.whereNotBetween;b.prototype.andWhereJsonObject=b.prototype.whereJsonObject;b.prototype.andWhereNotJsonObject=b.prototype.whereJsonObject;b.prototype.andWhereJsonPath=b.prototype.whereJsonPath;b.prototype.andWhereLike=b.prototype.whereLike;b.prototype.andWhereILike=b.prototype.whereILike;b.prototype.andHaving=b.prototype.having;b.prototype.andHavingIn=b.prototype.havingIn;b.prototype.andHavingNotIn=b.prototype.havingNotIn;b.prototype.andHavingNull=b.prototype.havingNull;b.prototype.andHavingNotNull=b.prototype.havingNotNull;b.prototype.andHavingExists=b.prototype.havingExists;b.prototype.andHavingNotExists=b.prototype.havingNotExists;b.prototype.andHavingBetween=b.prototype.havingBetween;b.prototype.andHavingNotBetween=b.prototype.havingNotBetween;b.prototype.from=b.prototype.table;b.prototype.into=b.prototype.table;b.prototype.del=b.prototype.delete;rH(b);Y3(b);b.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(b.prototype,r))throw new Error(`Can't extend QueryBuilder with existing method ('${r}').`);V3(b.prototype,{[r]:e})};var Na=class{constructor(e,t){this.builder=e,this._columns=t}ignore(){return this.builder._single.onConflict=this._columns,this.builder._single.ignore=!0,this.builder}merge(e){return this.builder._single.onConflict=this._columns,this.builder._single.merge={updates:e},this.builder}then(){throw new Error("Incomplete onConflict clause. .onConflict() must be directly followed by either .merge() or .ignore()")}};T_.exports=b});var S_=l((Qre,A_)=>{function oH(r,e,t,n){var i=-1,s=r==null?0:r.length;for(n&&s&&(t=r[++i]);++i<s;)t=e(t,r[i],i,r);return t}A_.exports=oH});var O_=l((Ure,N_)=>{function aH(r,e,t,n,i){return i(r,function(s,o,a){t=n?(n=!1,s):e(t,s,o,a)}),t}N_.exports=aH});var Yt=l((Hre,R_)=>{var uH=S_(),lH=mt(),cH=pe(),hH=O_(),fH=I();function dH(r,e,t){var n=fH(r)?uH:hH,i=arguments.length<3;return n(r,cH(e,4),t,i,lH)}R_.exports=dH});var $_=l((Wre,I_)=>{var pH=Pn(),mH=no(),gH=Fo(),yH=pe(),bH=$r(),wH=I(),_H=it(),qH=Er(),EH=Z(),CH=st();function vH(r,e,t){var n=wH(r),i=n||_H(r)||CH(r);if(e=yH(e,4),t==null){var s=r&&r.constructor;i?t=n?new s:[]:EH(r)?t=qH(s)?mH(bH(r)):{}:t={}}return(i?pH:gH)(r,function(o,a,u){return e(t,o,a,u)}),t}I_.exports=vH});var Ue=l((Vre,P_)=>{var{isObject:xH}=A();function TH(r,e,t,n){let i=t.queryBuilder();return r.call(i,i),t.queryCompiler(i,n.bindings).toSQL(e||i._method||"select")}function AH(r,e,t){let n=e.queryContext();return t.wrapIdentifier((r||"").trim(),n)}function SH(r,e,t){return r===void 0?"":r===null?"null":r&&r.isRawInstance?r.toQuery():e==="bool"?(r==="false"&&(r=0),`'${r?1:0}'`):(e==="json"||e==="jsonb")&&xH(r)?`'${JSON.stringify(r)}'`:t._escapeBinding(r.toString())}P_.exports={compileCallback:TH,wrapAsIdentifier:AH,formatDefault:SH}});var F=l((Gre,k_)=>{var NH=$_(),L_=Oe(),{compileCallback:Oa,wrapAsIdentifier:qi}=Ue(),OH=["asc","desc"],RH=NH(["=","<",">","<=",">=","<>","!=","like","not like","between","not between","ilike","not ilike","exists","not exist","rlike","not rlike","regexp","not regexp","match","&","|","^","<<",">>","~","~=","~*","!~","!~*","#","&&","@>","<@","||","&<","&>","-|-","@@","!!",["?","\\?"],["?|","\\?|"],["?&","\\?&"]],(r,e)=>{Array.isArray(e)?r[e[0]]=e[1]:r[e]=e},{});function IH(r,e,t,n){let i=Array.isArray(r)?r:[r],s="",o=-1;for(;++o<i.length;)o>0&&(s+=", "),s+=Ei(i[o],void 0,e,t,n);return s}function Ei(r,e,t,n,i){let s=Yr(r,e,t,n,i);if(s)return s;switch(typeof r){case"function":return Xr(Oa(r,void 0,n,i),!0,t,n);case"object":return PH(r,t,n,i);case"number":return r;default:return Kr(r+"",t,n)}}function Yr(r,e,t,n,i){let s;if(r instanceof L_)return s=n.queryCompiler(r).toSQL(),s.bindings&&i.bindings.push(...s.bindings),Xr(s,e,t,n);if(r&&r.isRawInstance)return r.client=n,t._queryContext&&(r.queryContext=()=>t._queryContext),s=r.toSQL(),s.bindings&&i.bindings.push(...s.bindings),s.sql;e&&i.bindings.push(r)}function $H(r,e,t,n){let i=Yr(r,void 0,e,t,n);if(i)return i;let s=RH[(r||"").toLowerCase()];if(!s)throw new TypeError(`The operator "${r}" is not permitted`);return s}function Kr(r,e,t){let n=r.toLowerCase().indexOf(" as ");if(n!==-1){let a=r.slice(0,n),u=r.slice(n+4);return t.alias(Kr(a,e,t),qi(u,e,t))}let i=[],s=-1,o=r.split(".");for(;++s<o.length;)r=o[s],s===0&&o.length>1?i.push(Kr((r||"").trim(),e,t)):i.push(qi(r,e,t));return i.join(".")}function PH(r,e,t,n){let i=[];for(let s in r){let o=r[s];if(typeof o=="function"){let a=Oa(o,void 0,t,n);a.as=s,i.push(Xr(a,!0,e,t))}else o instanceof L_?i.push(t.alias(`(${Ei(o,void 0,e,t,n)})`,qi(s,e,t))):i.push(t.alias(Ei(o,void 0,e,t,n),qi(s,e,t)))}return i.join(", ")}function Xr(r,e,t,n){let i=r.sql||"";return i&&(r.method==="select"||r.method==="first")&&(e||r.as)&&(i=`(${i})`,r.as)?n.alias(i,Kr(r.as,t,n)):i}function LH(r,e,t,n,i){return typeof r=="function"?Xr(Oa(r,e,n,i),void 0,t,n):Yr(r,void 0,t,n,i)||""}function kH(r,e,t,n){let i=Yr(r,void 0,e,t,n);return i||(OH.indexOf((r||"").toLowerCase())!==-1?r:"asc")}k_.exports={columnize:IH,direction:kH,operator:$H,outputQuery:Xr,rawOrFn:LH,unwrapRaw:Yr,wrap:Ei,wrapString:Kr}});var j_=l((zre,B_)=>{var{columnize:M_}=F();function MH(r,e){let t={bindings:[]},n=r,i=r.bindings.length,s=r.bindings,o=0,a=r.sql.replace(/\\?\?\??/g,function(u){if(u==="\\?")return u;let c=s[o++];return u==="??"?M_(c,n,e,t):e.parameter(c,n,t)});if(i!==o)throw new Error(`Expected ${i} bindings, saw ${o}`);return{method:"raw",sql:a,bindings:t.bindings}}function BH(r,e){let t={bindings:[]},n=r,i=r.bindings,s=/\\?(:(\w+):(?=::)|:(\w+):(?!:)|:(\w+))/g;return{method:"raw",sql:r.sql.replace(s,function(a,u,c,h,f){if(a!==u)return u;let d=c||h||f,g=a.trim(),m=g[g.length-1]===":",y=i[d];return y===void 0?(Object.prototype.hasOwnProperty.call(i,d)&&t.bindings.push(y),a):m?a.replace(u,M_(y,n,e,t)):a.replace(u,e.parameter(y,n,t))}),bindings:t.bindings}}B_.exports={replaceKeyBindings:BH,replaceRawArrBindings:MH}});var Ci=l((Jre,D_)=>{var jH="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",DH="0123456789";function FH(r=21){let e="",t=r;for(;t--;)e+=jH[Math.random()*64|0];return e}function QH(r=21){let e="",t=r;for(;t--;)e+=DH[Math.random()*10|0];return e}D_.exports={nanoid:FH,nanonum:QH}});var gt=l((Kre,F_)=>{var{EventEmitter:UH}=require("events"),HH=ae(),WH=Fe(),VH=we(),GH=Yt(),{replaceRawArrBindings:zH,replaceKeyBindings:JH}=j_(),Ra=D(),KH=yi(),{nanoid:YH}=Ci(),{isNumber:XH,isObject:ZH}=A(),{augmentWithBuilderInterface:eW}=bi(),tW=HH("knex:bindings"),Xt=class extends UH{constructor(e){super(),this.client=e,this.sql="",this.bindings=[],this._wrappedBefore=void 0,this._wrappedAfter=void 0,e&&e.config&&(this._debug=e.config.debug,KH(this,4))}set(e,t){return this.sql=e,this.bindings=ZH(t)&&!t.toSQL||t===void 0?t:[t],this}timeout(e,{cancel:t}={}){return XH(e)&&e>0&&(this._timeout=e,t&&(this.client.assertCanCancelQuery(),this._cancelOnTimeout=!0)),this}wrap(e,t){return this._wrappedBefore=e,this._wrappedAfter=t,this}toString(){return this.toQuery()}toSQL(e,t){let n;if(Array.isArray(this.bindings)?n=zH(this,this.client):this.bindings&&VH(this.bindings)?n=JH(this,this.client):n={method:"raw",sql:this.sql,bindings:this.bindings===void 0?[]:[this.bindings]},this._wrappedBefore&&(n.sql=this._wrappedBefore+n.sql),this._wrappedAfter&&(n.sql=n.sql+this._wrappedAfter),n.options=GH(this._options,WH,{}),this._timeout&&(n.timeout=this._timeout,this._cancelOnTimeout&&(n.cancelOnTimeout=this._cancelOnTimeout)),n.bindings=n.bindings||[],Ra.containsUndefined(n.bindings)){let i=Ra.getUndefinedIndices(this.bindings);throw tW(n.bindings),new Error(`Undefined binding(s) detected for keys [${i}] when compiling RAW query: ${n.sql}`)}return n.__knexQueryUid=YH(),Object.defineProperties(n,{toNative:{value:()=>({sql:this.client.positionBindings(n.sql),bindings:this.client.prepBindings(n.bindings)}),enumerable:!1}}),n}};Xt.prototype.isRawInstance=!0;eW(Xt);Ra.addQueryContext(Xt);F_.exports=Xt});var vi=l((Yre,Q_)=>{function rW(r){for(var e=-1,t=r==null?0:r.length,n=0,i=[];++e<t;){var s=r[e];s&&(i[n++]=s)}return i}Q_.exports=rW});var H_=l((Xre,U_)=>{function nW(r,e,t,n){for(var i=-1,s=r==null?0:r.length;++i<s;){var o=r[i];e(n,o,t(o),r)}return n}U_.exports=nW});var V_=l((Zre,W_)=>{var iW=mt();function sW(r,e,t,n){return iW(r,function(i,s,o){e(n,i,t(i),o)}),n}W_.exports=sW});var z_=l((ene,G_)=>{var oW=H_(),aW=V_(),uW=pe(),lW=I();function cW(r,e){return function(t,n){var i=lW(t)?oW:aW,s=e?e():{};return i(t,r,uW(n,2),s)}}G_.exports=cW});var Zr=l((tne,J_)=>{var hW=Tr(),fW=z_(),dW=Object.prototype,pW=dW.hasOwnProperty,mW=fW(function(r,e,t){pW.call(r,t)?r[t].push(e):hW(r,t,[e])});J_.exports=mW});var Y_=l((rne,K_)=>{var gW=Object.prototype,yW=gW.hasOwnProperty;function bW(r,e){return r!=null&&yW.call(r,e)}K_.exports=bW});var en=l((nne,X_)=>{var wW=Y_(),_W=jo();function qW(r,e){return r!=null&&_W(r,e,wW)}X_.exports=qW});var He=l((ine,Z_)=>{var EW=ct(),CW=pe(),vW=Qo(),xW=I();function TW(r,e){var t=xW(r)?EW:vW;return t(r,CW(e,3))}Z_.exports=TW});var rq=l((sne,tq)=>{var AW=Ar(),SW=kr(),NW=Nr(),eq=Z(),OW=Ht();function RW(r,e,t,n){if(!eq(r))return r;e=SW(e,r);for(var i=-1,s=e.length,o=s-1,a=r;a!=null&&++i<s;){var u=OW(e[i]),c=t;if(u==="__proto__"||u==="constructor"||u==="prototype")return r;if(i!=o){var h=a[u];c=n?n(h,u,a):void 0,c===void 0&&(c=eq(h)?h:NW(e[i+1])?[]:{})}AW(a,u,c),a=a[u]}return r}tq.exports=RW});var iq=l((one,nq)=>{var IW=Mr(),$W=rq(),PW=kr();function LW(r,e,t){for(var n=-1,i=e.length,s={};++n<i;){var o=e[n],a=IW(r,o);t(a,o)&&$W(s,PW(o,r),a)}return s}nq.exports=LW});var oq=l((ane,sq)=>{var kW=ct(),MW=pe(),BW=iq(),jW=zs();function DW(r,e){if(r==null)return{};var t=kW(jW(r),function(n){return[n]});return e=MW(e),BW(r,t,function(n,i){return e(n,i[0])})}sq.exports=DW});var uq=l((une,aq)=>{var FW=pe(),QW=qa(),UW=oq();function HW(r,e){return UW(r,QW(FW(e)))}aq.exports=HW});var Ve=l((lne,dq)=>{var WW=D(),Zt=gt(),xi=Oe(),VW=xa(),GW=ae(),lq=Fe(),tn=vi(),zW=Zr(),JW=en(),cq=te(),hq=He(),KW=uq(),YW=Yt(),{nanoid:XW}=Ci(),{isString:Ia,isUndefined:ZW}=A(),{columnize:Re,direction:fq,operator:rn,wrap:M,unwrapRaw:er,rawOrFn:We}=F(),e6=GW("knex:bindings"),t6=["columns","join","where","union","group","having","order","limit","offset","lock","waitMode"],$a=class{constructor(e,t,n){this.client=e,this.method=t._method||"select",this.options=t._options,this.single=t._single,this.timeout=t._timeout||!1,this.cancelOnTimeout=t._cancelOnTimeout||!1,this.grouped=zW(t._statements,"grouping"),this.formatter=e.formatter(t),this._emptyInsertValue="default values",this.first=this.select,this.bindings=n||[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.builder=this.formatter.builder}toSQL(e,t){this._undefinedInWhereClause=!1,this.undefinedBindingsInfo=[],e=e||this.method;let n=this[e]()||"",i={method:e,options:YW(this.options,lq,{}),timeout:this.timeout,cancelOnTimeout:this.cancelOnTimeout,bindings:this.bindingsHolder.bindings||[],__knexQueryUid:XW()};if(Object.defineProperties(i,{toNative:{value:()=>({sql:this.client.positionBindings(i.sql),bindings:this.client.prepBindings(i.bindings)}),enumerable:!1}}),Ia(n)?i.sql=n:lq(i,n),(e==="select"||e==="first")&&this.single.as&&(i.as=this.single.as),this._undefinedInWhereClause)throw e6(i.bindings),new Error(`Undefined binding(s) detected when compiling ${e.toUpperCase()}. Undefined column(s): [${this.undefinedBindingsInfo.join(", ")}] query: ${i.sql}`);return i}select(){let e=this.with(),t="",n=[],i=[];t6.forEach(o=>{let a=this[o](this);switch(o){case"union":t=a;break;case"columns":case"join":case"where":n.push(a);break;default:i.push(a);break}});let s=this.grouped.union&&this.grouped.union.map(o=>o.wrap).some(o=>o);if(this.onlyUnions()){let o=tn(n.concat(i)).join(" ");e+=t+(o?" "+o:"")}else{let o=(s?"(":"")+tn(n).join(" ")+(s?")":""),a=tn(i).join(" ");e+=o+(t?" "+t:"")+(a&&" "+a)}return e}pluck(){let e=this.single.pluck;return e.indexOf(".")!==-1&&(e=e.split(".").slice(-1)[0]),{sql:this.select(),pluck:e}}insert(){let e=this.single.insert||[],t=this.with()+`insert into ${this.tableName} `,n=this._insertBody(e);return n===""?"":t+n}_onConflictClause(e){return e instanceof Zt?this.formatter.wrap(e):`(${this.formatter.columnize(e)})`}_buildInsertValues(e){let t="",n=-1;for(;++n<e.values.length;)n!==0&&(t+="), ("),t+=this.client.parameterize(e.values[n],this.client.valueForUndefined,this.builder,this.bindingsHolder);return t}_insertBody(e){let t="";if(Array.isArray(e)){if(e.length===0)return""}else if(typeof e=="object"&&cq(e))return t+this._emptyInsertValue;let n=this._prepInsert(e);return typeof n=="string"?t+=n:n.columns.length?(t+=`(${Re(n.columns,this.builder,this.client,this.bindingsHolder)}`,t+=") values ("+this._buildInsertValues(n)+")"):e.length===1&&e[0]?t+=this._emptyInsertValue:t="",t}update(){let e=this.with(),{tableName:t}=this,n=this._prepUpdate(this.single.update),i=this.where();return e+`update ${this.single.only?"only ":""}${t} set `+n.join(", ")+(i?` ${i}`:"")}_hintComments(){let e=this.grouped.hintComments||[];return e=e.map(t=>tn(t.value).join(" ")),e=tn(e).join(" "),e?`/*+ ${e} */ `:""}columns(){let e="";if(this.onlyUnions())return"";let t=this._hintComments(),n=this.grouped.columns||[],i=-1,s=[];if(n)for(;++i<n.length;){let a=n[i];if(a.distinct&&(e="distinct "),a.distinctOn){e=this.distinctOn(a.value);continue}a.type==="aggregate"?s.push(...this.aggregate(a)):a.type==="aggregateRaw"?s.push(this.aggregateRaw(a)):a.type==="analytic"?s.push(this.analytic(a)):a.type==="json"?s.push(this.json(a)):a.value&&a.value.length>0&&s.push(Re(a.value,this.builder,this.client,this.bindingsHolder))}return s.length===0&&(s=["*"]),`${this.onlyJson()?"":"select "}${t}${e}`+s.join(", ")+(this.tableName?` from ${this.single.only?"only ":""}${this.tableName}`:"")}_aggregate(e,{aliasSeparator:t=" as ",distinctParentheses:n}={}){let i=e.value,s=e.method,o=e.aggregateDistinct?"distinct ":"",a=m=>M(m,void 0,this.builder,this.client,this.bindingsHolder),u=(m,y)=>y?m+t+a(y):m,c=(m,y)=>{let _=m.map(a).join(", ");if(o){let x=n?"(":" ",he=n?")":"";_=o.trim()+x+_+he}let v=`${s}(${_})`;return u(v,y)},h=(m,y)=>{let _=`${s}(${o+a(m)})`;return u(_,y)};if(Array.isArray(i))return[c(i)];if(typeof i=="object"){if(e.alias)throw new Error("When using an object explicit alias can not be used");return Object.entries(i).map(([m,y])=>Array.isArray(y)?c(y,m):h(y,m))}let f=i.toLowerCase().indexOf(" as "),d=i,{alias:g}=e;if(f!==-1){if(d=i.slice(0,f),g)throw new Error(`Found multiple aliases for same column: ${d}`);g=i.slice(f+4)}return[h(d,g)]}aggregate(e){return this._aggregate(e)}aggregateRaw(e){let t=e.aggregateDistinct?"distinct ":"";return`${e.method}(${t+er(e.value,void 0,this.builder,this.client,this.bindingsHolder)})`}_joinTable(e){return e.schema&&!(e.table instanceof Zt)?`${e.schema}.${e.table}`:e.table}join(){let e="",t=-1,n=this.grouped.join;if(!n)return"";for(;++t<n.length;){let i=n[t],s=this._joinTable(i);if(t>0&&(e+=" "),i.joinType==="raw")e+=er(i.table,void 0,this.builder,this.client,this.bindingsHolder);else{e+=i.joinType+" join "+M(s,void 0,this.builder,this.client,this.bindingsHolder);let o=-1;for(;++o<i.clauses.length;){let a=i.clauses[o];o>0?e+=` ${a.bool} `:e+=` ${a.type==="onUsing"?"using":"on"} `;let u=this[a.type](a);u&&(e+=u)}}}return e}onBetween(e){return M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}onNull(e){return M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}onExists(e){return this._not(e,"exists")+" ("+We(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}onIn(e){if(Array.isArray(e.column))return this.multiOnIn(e);let t;return e.value instanceof Zt?t=this.client.parameter(e.value,this.builder,this.formatter):t=this.client.parameterize(e.value,void 0,this.builder,this.bindingsHolder),M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"in ")+this.wrap(t)}multiOnIn(e){let t=-1,n=`(${Re(e.column,this.builder,this.client,this.bindingsHolder)}) `;for(n+=this._not(e,"in ")+"((";++t<e.value.length;)t!==0&&(n+="),("),n+=this.client.parameterize(e.value[t],void 0,this.builder,this.bindingsHolder);return n+"))"}where(){let e=this.grouped.where;if(!e)return;let t=[],n=-1;for(;++n<e.length;){let i=e[n];Object.prototype.hasOwnProperty.call(i,"value")&&WW.containsUndefined(i.value)&&(this.undefinedBindingsInfo.push(i.column),this._undefinedInWhereClause=!0);let s=this[i.type](i);s&&(t.length===0?t[0]="where":t.push(i.bool),t.push(s))}return t.length>1?t.join(" "):""}group(){return this._groupsOrders("group")}order(){return this._groupsOrders("order")}having(){let e=this.grouped.having;if(!e)return"";let t=["having"];for(let n=0,i=e.length;n<i;n++){let s=e[n],o=this[s.type](s);o&&(t.length===0&&(t[0]="where"),(t.length>1||t.length===1&&t[0]!=="having")&&t.push(s.bool),t.push(o))}return t.length>1?t.join(" "):""}havingRaw(e){return this._not(e,"")+er(e.value,void 0,this.builder,this.client,this.bindingsHolder)}havingWrapped(e){let t=We(e.value,"where",this.builder,this.client,this.bindingsHolder);return t&&this._not(e,"")+"("+t.slice(6)+")"||""}havingBasic(e){return this._not(e,"")+M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+rn(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this.client.parameter(e.value,this.builder,this.bindingsHolder)}havingNull(e){return M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}havingExists(e){return this._not(e,"exists")+" ("+We(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}havingBetween(e){return M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}havingIn(e){return Array.isArray(e.column)?this.multiHavingIn(e):M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"in ")+this.wrap(this.client.parameterize(e.value,void 0,this.builder,this.bindingsHolder))}multiHavingIn(e){return this.multiOnIn(e)}union(){let e=this.onlyUnions(),t=this.grouped.union;if(!t)return"";let n="";for(let i=0,s=t.length;i<s;i++){let o=t[i];i>0&&(n+=" "),(i>0||!e)&&(n+=o.clause+" ");let a=We(o.value,void 0,this.builder,this.client,this.bindingsHolder);if(a){let u=o.wrap;u&&(n+="("),n+=a,u&&(n+=")")}}return n}onlyUnions(){return(!this.grouped.columns||!!this.grouped.columns[0].value)&&this.grouped.union&&!this.tableName}_getValueOrParameterFromAttribute(e,t){return this.single.skipBinding[e]===!0?t??this.single[e]:this.client.parameter(this.single[e],this.builder,this.bindingsHolder)}onlyJson(){return!this.tableName&&this.grouped.columns&&this.grouped.columns.length===1&&this.grouped.columns[0].type==="json"}limit(){return!this.single.limit&&this.single.limit!==0?"":`limit ${this._getValueOrParameterFromAttribute("limit")}`}offset(){return this.single.offset?`offset ${this._getValueOrParameterFromAttribute("offset")}`:""}del(){let{tableName:e}=this,t=this.with(),n=this.where(),i=this.join(),s=i?e+" ":"";return t+`delete ${s}from ${this.single.only?"only ":""}${e}`+(i?` ${i}`:"")+(n?` ${n}`:"")}truncate(){return`truncate ${this.tableName}`}lock(){if(this.single.lock)return this[this.single.lock]()}waitMode(){if(this.single.waitMode)return this[this.single.waitMode]()}skipLocked(){throw new Error(".skipLocked() is currently only supported on MySQL 8.0+ and PostgreSQL 9.5+")}noWait(){throw new Error(".noWait() is currently only supported on MySQL 8.0+, MariaDB 10.3.0+ and PostgreSQL 9.5+")}distinctOn(e){throw new Error(".distinctOn() is currently only supported on PostgreSQL")}onWrapped(e){let t=this,n=new VW;e.value.call(n,n);let i="";for(let s=0;s<n.clauses.length;s++){let o=n.clauses[s];s>0&&(i+=` ${o.bool} `);let a=t[o.type](o);a&&(i+=a)}return i.length?`(${i})`:""}onBasic(e){let t=e.value instanceof xi;return M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+rn(e.operator,this.builder,this.client,this.bindingsHolder)+" "+(t?"(":"")+M(e.value,void 0,this.builder,this.client,this.bindingsHolder)+(t?")":"")}onVal(e){return M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+rn(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this.client.parameter(e.value,this.builder,this.bindingsHolder)}onRaw(e){return er(e.value,void 0,this.builder,this.client,this.bindingsHolder)}onUsing(e){return"("+Re(e.column,this.builder,this.client,this.bindingsHolder)+")"}_valueClause(e){return e.asColumn?M(e.value,void 0,this.builder,this.client,this.bindingsHolder):this.client.parameter(e.value,this.builder,this.bindingsHolder)}_columnClause(e){let t;return Array.isArray(e.column)?t=`(${Re(e.column,this.builder,this.client,this.bindingsHolder)})`:t=M(e.column,void 0,this.builder,this.client,this.bindingsHolder),t}whereIn(e){let t=this.client.values(e.value,this.builder,this.bindingsHolder);return`${this._columnClause(e)} ${this._not(e,"in ")}${t}`}whereLike(e){return`${this._columnClause(e)} ${this._not(e,"like ")}${this._valueClause(e)}`}whereILike(e){return`${this._columnClause(e)} ${this._not(e,"ilike ")}${this._valueClause(e)}`}whereNull(e){return M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}whereBasic(e){return this._not(e,"")+M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+rn(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this._valueClause(e)}whereExists(e){return this._not(e,"exists")+" ("+We(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}whereWrapped(e){let t=We(e.value,"where",this.builder,this.client,this.bindingsHolder);return t&&this._not(e,"")+"("+t.slice(6)+")"||""}whereBetween(e){return M(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}whereRaw(e){return this._not(e,"")+er(e.value,void 0,this.builder,this.client,this.bindingsHolder)}_jsonWrapValue(e){if(!this.builder._isJsonObject(e))try{return JSON.stringify(JSON.parse(e.replace(/\n|\t/g,"")))}catch{return e}return JSON.stringify(e)}_jsonValueClause(e){return e.value=this._jsonWrapValue(e.value),this._valueClause(e)}whereJsonObject(e){return`${this._columnClause(e)} ${e.not?"!=":"="} ${this._jsonValueClause(e)}`}wrap(e){return e.charAt(0)!=="("?`(${e})`:e}json(e){return this[e.method](e.params)}analytic(e){let t="",n=this;return t+=e.method+"() over (",e.raw?t+=e.raw:(e.partitions.length&&(t+="partition by ",t+=hq(e.partitions,function(i){return Ia(i)?n.formatter.columnize(i):n.formatter.columnize(i.column)+(i.order?" "+i.order:"")}).join(", ")+" "),t+="order by ",t+=hq(e.order,function(i){return Ia(i)?n.formatter.columnize(i):n.formatter.columnize(i.column)+(i.order?" "+i.order:"")}).join(", ")),t+=")",e.alias&&(t+=" as "+e.alias),t}with(){if(!this.grouped.with||!this.grouped.with.length)return"";let e=this.grouped.with;if(!e)return;let t=[],n=-1,i=!1;for(;++n<e.length;){let s=e[n];s.recursive&&(i=!0);let o=this[s.type](s);t.push(o)}return`with ${i?"recursive ":""}${t.join(", ")} `}withWrapped(e){let t=We(e.value,void 0,this.builder,this.client,this.bindingsHolder),n=e.columnList?"("+Re(e.columnList,this.builder,this.client,this.bindingsHolder)+")":"",i=e.materialized===void 0?"":e.materialized?"materialized ":"not materialized ";return t&&Re(e.alias,this.builder,this.client,this.bindingsHolder)+n+" as "+i+"("+t+")"||""}_not(e,t){return e.not?`not ${t}`:t}_prepInsert(e){let t=We(e,void 0,this.builder,this.client,this.bindingsHolder);if(t)return t;let n=[],i=[];Array.isArray(e)||(e=e?[e]:[]);let s=-1;for(;++s<e.length&&e[s]!=null;){s===0&&(n=Object.keys(e[s]).sort());let o=new Array(n.length),a=Object.keys(e[s]),u=-1;for(;++u<a.length;){let c=a[u],h=n.indexOf(c);if(h===-1){n=n.concat(c).sort(),h=n.indexOf(c);let f=-1;for(;++f<i.length;)i[f].splice(h,0,void 0);o.splice(h,0,void 0)}o[h]=e[s][c]}i.push(o)}return{columns:n,values:i}}_prepUpdate(e={}){let{counter:t={}}=this.single;for(let o of Object.keys(t)){if(JW(e,o)){this.client.logger.warn("increment/decrement called for a column that has already been specified in main .update() call. Ignoring increment/decrement and using value from .update() call.");continue}let a=t[o],u=a<0?"-":"+";u==="-"&&(a=-a),e[o]=this.client.raw(`?? ${u} ?`,[o,a])}e=KW(e,ZW);let n=[],i=Object.keys(e),s=-1;for(;++s<i.length;)n.push(M(i[s],void 0,this.builder,this.client,this.bindingsHolder)+" = "+this.client.parameter(e[i[s]],this.builder,this.bindingsHolder));if(cq(n))throw new Error(["Empty .update() call detected!","Update data does not contain any values to update.","This will result in a faulty query.",this.single.table?`Table: ${this.single.table}.`:"",this.single.update?`Columns: ${Object.keys(this.single.update)}.`:""].join(" "));return n}_formatGroupsItemValue(e,t){let{formatter:n}=this,i="";t==="last"?i=" is null":t==="first"&&(i=" is not null");let s;return e instanceof Zt?s=er(e,void 0,this.builder,this.client,this.bindingsHolder):e instanceof xi||t?s="("+n.columnize(e)+i+")":s=n.columnize(e),s}_basicGroupOrder(e,t){let n=this._formatGroupsItemValue(e.value,e.nulls),i=t==="order"&&e.type!=="orderByRaw"?` ${fq(e.direction,this.builder,this.client,this.bindingsHolder)}`:"";return n+i}_groupOrder(e,t){return this._basicGroupOrder(e,t)}_groupOrderNulls(e,t){let n=this._formatGroupsItemValue(e.value),i=t==="order"&&e.type!=="orderByRaw"?` ${fq(e.direction,this.builder,this.client,this.bindingsHolder)}`:"";return e.nulls&&!(e.value instanceof Zt)?`${n}${i||""} nulls ${e.nulls}`:n+i}_groupsOrders(e){let t=this.grouped[e];if(!t)return"";let n=t.map(i=>this._groupOrder(i,e));return n.length?e+" by "+n.join(", "):""}get tableName(){if(!this._tableName){let e=this.single.table,t=this.single.schema;if(e&&t){let n=e instanceof xi,i=e instanceof Zt;!n&&!i&&!(typeof e=="function")&&(e=`${t}.${e}`)}this._tableName=e?M(e,e instanceof xi,this.builder,this.client,this.bindingsHolder):""}return this._tableName}_jsonPathWrap(e){return this.client.parameter(e.path||e[1],this.builder,this.bindingsHolder)}_jsonExtract(e,t){let n;return Array.isArray(t.column)?n=t.column:n=[t],Array.isArray(e)||(e=[e]),n.map(i=>{let s=`${Re(i.column||i[0],this.builder,this.client,this.bindingsHolder)}, ${this._jsonPathWrap(i)}`;e.forEach(a=>{s=a+"("+s+")"});let o=i.alias||i[2];return o?this.client.alias(s,this.formatter.wrap(o)):s}).join(", ")}_jsonSet(e,t){let n=`${e}(${Re(t.column,this.builder,this.client,this.bindingsHolder)}, ${this.client.parameter(t.path,this.builder,this.bindingsHolder)}, ${this.client.parameter(t.value,this.builder,this.bindingsHolder)})`;return t.alias?this.client.alias(n,this.formatter.wrap(t.alias)):n}_whereJsonPath(e,t){return`${e}(${this._columnClause(t)}, ${this._jsonPathWrap({path:t.jsonPath})}) ${rn(t.operator,this.builder,this.client,this.bindingsHolder)} ${this._jsonValueClause(t)}`}_onJsonPathEquals(e,t){return e+"("+M(t.columnFirst,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.parameter(t.jsonPathFirst,this.builder,this.bindingsHolder)+") = "+e+"("+M(t.columnSecond,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.parameter(t.jsonPathSecond,this.builder,this.bindingsHolder)+")"}};dq.exports=$a});var Pa=l((cne,pq)=>{var{EventEmitter:r6}=require("events"),n6=zt(),i6=Fe(),{addQueryContext:s6}=D(),o6=yi(),{augmentWithBuilderInterface:a6}=bi(),Ie=class extends r6{constructor(e){super(),this.client=e,this._sequence=[],e.config&&(this._debug=e.config.debug,o6(this,4))}withSchema(e){return this._schema=e,this}toString(){return this.toQuery()}toSQL(){return this.client.schemaCompiler(this).toSQL()}async generateDdlCommands(){return await this.client.schemaCompiler(this).generateDdlCommands()}};["createTable","createTableIfNotExists","createTableLike","createView","createViewOrReplace","createMaterializedView","refreshMaterializedView","dropView","dropViewIfExists","dropMaterializedView","dropMaterializedViewIfExists","createSchema","createSchemaIfNotExists","dropSchema","dropSchemaIfExists","createExtension","createExtensionIfNotExists","dropExtension","dropExtensionIfExists","table","alterTable","view","alterView","hasTable","hasColumn","dropTable","renameTable","renameView","dropTableIfExists","raw"].forEach(function(r){Ie.prototype[r]=function(){return r==="createTableIfNotExists"&&this.client.logger.warn(["Use async .hasTable to check if table exists and then use plain .createTable. Since ",'.createTableIfNotExists actually just generates plain "CREATE TABLE IF NOT EXIST..." ',"query it will not work correctly if there are any alter table queries generated for ","columns afterwards. To not break old migrations this function is left untouched for now",", but it should not be used when writing new code and it is removed from documentation."].join("")),r==="table"&&(r="alterTable"),r==="view"&&(r="alterView"),this._sequence.push({method:r,args:n6(arguments)}),this}});Ie.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(Ie.prototype,r))throw new Error(`Can't extend SchemaBuilder with existing method ('${r}').`);i6(Ie.prototype,{[r]:e})};a6(Ie);s6(Ie);pq.exports=Ie});var nn=l((hne,gq)=>{var u6=Vr(),{isString:mq}=A();function l6(r){r&&(mq(r)&&(r={sql:r}),r.bindings||(r.bindings=this.bindingsHolder.bindings),this.sequence.push(r),this.formatter=this.client.formatter(this._commonBuilder),this.bindings=[],this.formatter.bindings=this.bindings)}function c6(r){let e=new this.constructor(this.client,this.tableCompiler,this.columnBuilder);r.call(e,u6(arguments)),this.sequence.additional=(this.sequence.additional||[]).concat(e.sequence)}function h6(r){r&&(mq(r)&&(r={sql:r}),r.bindings||(r.bindings=this.bindingsHolder.bindings),this.sequence.unshift(r),this.formatter=this.client.formatter(this._commonBuilder),this.bindings=[],this.formatter.bindings=this.bindings)}gq.exports={pushAdditional:c6,pushQuery:l6,unshiftQuery:h6}});var yt=l((fne,yq)=>{var{pushQuery:f6,pushAdditional:d6,unshiftQuery:p6}=nn(),Q=class{constructor(e,t){this.builder=t,this._commonBuilder=this.builder,this.client=e,this.schema=t._schema,this.bindings=[],this.bindingsHolder=this,this.formatter=e.formatter(t),this.formatter.bindings=this.bindings,this.sequence=[]}createSchema(){Ti("createSchema")}createSchemaIfNotExists(){Ti("createSchemaIfNotExists")}dropSchema(){Ti("dropSchema")}dropSchemaIfExists(){Ti("dropSchemaIfExists")}dropTable(e){this.pushQuery(this.dropTablePrefix+this.formatter.wrap(La(this.schema,e)))}dropTableIfExists(e){this.pushQuery(this.dropTablePrefix+"if exists "+this.formatter.wrap(La(this.schema,e)))}dropView(e){this._dropView(e,!1,!1)}dropViewIfExists(e){this._dropView(e,!0,!1)}dropMaterializedView(e){throw new Error("materialized views are not supported by this dialect.")}dropMaterializedViewIfExists(e){throw new Error("materialized views are not supported by this dialect.")}renameView(e,t){throw new Error("rename view is not supported by this dialect (instead drop then create another view).")}refreshMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}_dropView(e,t,n){this.pushQuery((n?this.dropMaterializedViewPrefix:this.dropViewPrefix)+(t?"if exists ":"")+this.formatter.wrap(La(this.schema,e)))}raw(e,t){this.sequence.push(this.client.raw(e,t).toSQL())}toSQL(){let e=this.builder._sequence;for(let t=0,n=e.length;t<n;t++){let i=e[t];this[i.method].apply(this,i.args)}return this.sequence}async generateDdlCommands(){let e=this.toSQL();return{pre:[],sql:Array.isArray(e)?e:[e],check:null,post:[]}}};Q.prototype.dropTablePrefix="drop table ";Q.prototype.dropViewPrefix="drop view ";Q.prototype.dropMaterializedViewPrefix="drop materialized view ";Q.prototype.alterViewPrefix="alter view ";Q.prototype.alterTable=Ai("alter");Q.prototype.createTable=Ai("create");Q.prototype.createTableIfNotExists=Ai("createIfNot");Q.prototype.createTableLike=Ai("createLike");Q.prototype.createView=Si("create");Q.prototype.createViewOrReplace=Si("createOrReplace");Q.prototype.createMaterializedView=Si("createMaterializedView");Q.prototype.alterView=Si("alter");Q.prototype.pushQuery=f6;Q.prototype.pushAdditional=d6;Q.prototype.unshiftQuery=p6;function ka(r){let e=this.builder.queryContext();e!==void 0&&r.queryContext()===void 0&&r.queryContext(e),r.setSchema(this.schema);let t=r.toSQL();for(let n=0,i=t.length;n<i;n++)this.sequence.push(t[n])}function Ai(r){return r==="createLike"?function(e,t,n){let i=this.client.tableBuilder(r,e,t,n);ka.call(this,i)}:function(e,t){let n=this.client.tableBuilder(r,e,null,t);ka.call(this,n)}}function Si(r){return function(e,t){let n=this.client.viewBuilder(r,e,t);ka.call(this,n)}}function La(r,e){return r?`${r}.${e}`:e}function Ti(r){throw new Error(`${r} is not supported for this dialect (only PostgreSQL supports it currently).`)}yq.exports=Q});var wq=l((dne,bq)=>{var m6=ve(),g6=jr(),y6=Te(),b6=g6(function(r,e){m6(e,y6(e),r)});bq.exports=b6});var sn=l((pne,_q)=>{_q.exports=wq()});var Ba=l((mne,Eq)=>{var w6=Gt(),qq=sn(),_6=Fe(),Ni=zt(),q6=D(),{isString:E6,isFunction:C6,isObject:v6}=A(),_e=class{constructor(e,t,n,i,s){if(this.client=e,this._fn=s,this._method=t,this._schemaName=void 0,this._tableName=n,this._tableNameLike=i,this._statements=[],this._single={},!i&&!C6(this._fn))throw new TypeError("A callback function must be supplied to calls against `.createTable` and `.table`")}setSchema(e){this._schemaName=e}toSQL(){return this._method==="alter"&&qq(this,Ma),this._fn&&this._fn.call(this,this),this.client.tableCompiler(this).toSQL()}timestamps(e,t,n){v6(e)&&({useTimestamps:e,defaultToNow:t,useCamelCase:n}=e);let i=e===!0?"timestamp":"datetime",s=this[i](n?"createdAt":"created_at"),o=this[i](n?"updatedAt":"updated_at");if(t===!0){let a=this.client.raw("CURRENT_TIMESTAMP");s.notNullable().defaultTo(a),o.notNullable().defaultTo(a)}}comment(e){if(typeof e!="string")throw new TypeError("Table comment must be string");this._single.comment=e}foreign(e,t){let n={column:e,keyName:t};this._statements.push({grouping:"alterTable",method:"foreign",args:[n]});let i={references(s){let o;return E6(s)&&(o=s.split(".")),!o||o.length===1?(n.references=o?o[0]:s,{on(a){if(typeof a!="string")throw new TypeError(`Expected tableName to be a string, got: ${typeof a}`);return n.inTable=a,i},inTable(){return this.on.apply(this,arguments)}}):(n.inTable=o[0],n.references=o[1],i)},withKeyName(s){return n.keyName=s,i},onUpdate(s){return n.onUpdate=s,i},onDelete(s){return n.onDelete=s,i},deferrable:s=>{if(["mysql","mssql","redshift","mysql2","oracledb"].indexOf(this.client.dialect)!==-1)throw new Error(`${this.client.dialect} does not support deferrable`);return n.deferrable=s,i},_columnBuilder(s){return qq(s,i),i=s,s}};return i}check(e,t,n){return this._statements.push({grouping:"checks",args:[e,t,n]}),this}};["index","primary","unique","dropPrimary","dropUnique","dropIndex","dropForeign"].forEach(r=>{_e.prototype[r]=function(){return this._statements.push({grouping:"alterTable",method:r,args:Ni(arguments)}),this}});var x6={mysql:["engine","charset","collate"],postgresql:["inherits"]};w6(x6,function(r,e){r.forEach(function(t){_e.prototype[t]=function(n){if(this.client.dialect!==e)throw new Error(`Knex only supports ${t} statement with ${e}.`);if(this._method==="alter")throw new Error(`Knex does not support altering the ${t} outside of create table, please use knex.raw statement.`);this._single[t]=n}})});q6.addQueryContext(_e);var T6=["tinyint","smallint","mediumint","int","bigint","decimal","float","double","real","bit","boolean","serial","date","datetime","timestamp","time","year","geometry","geography","point","char","varchar","tinytext","tinyText","text","mediumtext","mediumText","longtext","longText","binary","varbinary","tinyblob","tinyBlob","mediumblob","mediumBlob","blob","longblob","longBlob","enum","set","bool","dateTime","increments","bigincrements","bigIncrements","integer","biginteger","bigInteger","string","json","jsonb","uuid","enu","specificType"];T6.forEach(r=>{_e.prototype[r]=function(){let e=Ni(arguments),t=this.client.columnBuilder(this,r,e);return this._statements.push({grouping:"columns",builder:t}),t}});var Ma={renameColumn(r,e){return this._statements.push({grouping:"alterTable",method:"renameColumn",args:[r,e]}),this},dropTimestamps(){return this.dropColumns(arguments[0]===!0?["createdAt","updatedAt"]:["created_at","updated_at"])},setNullable(r){return this._statements.push({grouping:"alterTable",method:"setNullable",args:[r]}),this},check(r,e,t){this._statements.push({grouping:"alterTable",method:"check",args:[r,e,t]})},dropChecks(){this._statements.push({grouping:"alterTable",method:"dropChecks",args:Ni(arguments)})},dropNullable(r){return this._statements.push({grouping:"alterTable",method:"dropNullable",args:[r]}),this}};Ma.dropColumn=Ma.dropColumns=function(){return this._statements.push({grouping:"alterTable",method:"dropColumn",args:Ni(arguments)}),this};_e.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(_e.prototype,r))throw new Error(`Can't extend TableBuilder with existing method ('${r}').`);_6(_e.prototype,{[r]:e})};Eq.exports=_e});var vq=l((gne,Cq)=>{var A6=Kn(),S6=ci(),N6=Math.max;function O6(r,e,t){var n=r==null?0:r.length;if(!n)return-1;var i=t==null?0:S6(t);return i<0&&(i=N6(n+i,0)),A6(r,e,i)}Cq.exports=O6});var bt=l((yne,Tq)=>{var{pushAdditional:R6,pushQuery:I6,unshiftQuery:$6}=nn(),P6=D(),L6=Zr(),k6=vq(),xq=te(),M6=Vr(),{normalizeArr:B6}=D(),ue=class{constructor(e,t){this.client=e,this.tableBuilder=t,this._commonBuilder=this.tableBuilder,this.method=t._method,this.schemaNameRaw=t._schemaName,this.tableNameRaw=t._tableName,this.tableNameLikeRaw=t._tableNameLike,this.single=t._single,this.grouped=L6(t._statements,"grouping"),this.formatter=e.formatter(t),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[],this._formatting=e.config&&e.config.formatting,this.checksCount=0}toSQL(){return this[this.method](),this.sequence}create(e,t){let i=this.getColumns().map(o=>o.toSQL()),s=this.getColumnTypes(i);this.createAlterTableMethods&&this.alterTableForCreate(s),this.createQuery(s,e,t),this.columnQueries(i),delete this.single.comment,this.alterTable()}createIfNot(){this.create(!0)}createLike(){this.create(!1,!0)}createLikeIfNot(){this.create(!0,!0)}alter(){let t=this.getColumns().map(a=>a.toSQL()),n=this.getColumns("alter"),i=n.map(a=>a.toSQL()),s=this.getColumnTypes(t),o=this.getColumnTypes(i);this.addColumns(s),this.alterColumns(o,n),this.columnQueries(t),this.columnQueries(i),this.alterTable()}foreign(e){if(e.inTable&&e.references){let t=e.keyName?this.formatter.wrap(e.keyName):this._indexCommand("foreign",this.tableNameRaw,e.column),n=this.formatter.columnize(e.column),i=this.formatter.columnize(e.references),s=this.formatter.wrap(e.inTable),o=e.onUpdate?(this.lowerCase?" on update ":" ON UPDATE ")+e.onUpdate:"",a=e.onDelete?(this.lowerCase?" on delete ":" ON DELETE ")+e.onDelete:"",u=e.deferrable?this.lowerCase?` deferrable initially ${e.deferrable.toLowerCase()} `:` DEFERRABLE INITIALLY ${e.deferrable.toUpperCase()} `:"";this.lowerCase?this.pushQuery((this.forCreate?"":`alter table ${this.tableName()} add `)+"constraint "+t+" foreign key ("+n+") references "+s+" ("+i+")"+o+a+u):this.pushQuery((this.forCreate?"":`ALTER TABLE ${this.tableName()} ADD `)+"CONSTRAINT "+t+" FOREIGN KEY ("+n+") REFERENCES "+s+" ("+i+")"+o+a+u)}}getColumnTypes(e){return e.reduce(function(t,n){let i=n[0];return t.sql.push(i.sql),t.bindings.concat(i.bindings),t},{sql:[],bindings:[]})}columnQueries(e){let t=e.reduce(function(n,i){let s=M6(i);return xq(s)?n:n.concat(s)},[]);for(let n of t)this.pushQuery(n)}addColumns(e,t){if(t=t||this.addColumnsPrefix,e.sql.length>0){let n=e.sql.map(i=>t+i);this.pushQuery({sql:(this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+n.join(", "),bindings:e.bindings})}}alterColumns(e,t){e.sql.length>0&&this.addColumns(e,this.alterColumnsPrefix,t)}getColumns(e){let t=this.grouped.columns||[];e=e||"add";let n=this.tableBuilder.queryContext();return t.filter(i=>i.builder._method===e).map(i=>(n!==void 0&&i.builder.queryContext()===void 0&&i.builder.queryContext(n),this.client.columnCompiler(this,i.builder)))}tableName(){let e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.tableNameRaw}`:this.tableNameRaw;return this.formatter.wrap(e)}tableNameLike(){let e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.tableNameLikeRaw}`:this.tableNameLikeRaw;return this.formatter.wrap(e)}alterTable(){let e=this.grouped.alterTable||[];for(let t=0,n=e.length;t<n;t++){let i=e[t];this[i.method]?this[i.method].apply(this,i.args):this.client.logger.error(`Debug: ${i.method} does not exist`)}for(let t in this.single)typeof this[t]=="function"&&this[t](this.single[t])}alterTableForCreate(e){this.forCreate=!0;let t=this.sequence,n=this.grouped.alterTable||[];this.grouped.alterTable=[];for(let i=0,s=n.length;i<s;i++){let o=n[i];if(k6(this.createAlterTableMethods,o.method)<0){this.grouped.alterTable.push(o);continue}this[o.method]?(this.sequence=[],this[o.method].apply(this,o.args),e.sql.push(this.sequence[0].sql)):this.client.logger.error(`Debug: ${o.method} does not exist`)}this.sequence=t,this.forCreate=!1}dropIndex(e){this.pushQuery(`drop index${e}`)}dropUnique(){throw new Error("Method implemented in the dialect driver")}dropForeign(){throw new Error("Method implemented in the dialect driver")}dropColumn(){let e=P6.normalizeArr.apply(null,arguments),t=(Array.isArray(e)?e:[e]).map(n=>this.dropColumnPrefix+this.formatter.wrap(n));this.pushQuery((this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+t.join(", "))}_setNullableState(e,t){let n=this.tableName(),i=this.formatter.columnize(e),s=this.alterColumnsPrefix;return this.pushQuery({sql:"SELECT 1",output:()=>this.client.queryBuilder().from(this.tableNameRaw).columnInfo(e).then(o=>{if(xq(o))throw new Error(`.setNullable: Column ${i} does not exist in table ${n}.`);let a=t?"null":"not null",u=o.type+(o.maxLength?`(${o.maxLength})`:""),c=o.defaultValue!==null&&o.defaultValue!==void 0?`default '${o.defaultValue}'`:"",h=`alter table ${n} ${s} ${i} ${u} ${a} ${c}`;return this.client.raw(h)})})}setNullable(e){return this._setNullableState(e,!0)}dropNullable(e){return this._setNullableState(e,!1)}dropChecks(e){if(e===void 0)return"";e=B6(e);let n=`alter table ${this.tableName()} ${e.map(i=>`drop constraint ${i}`).join(", ")}`;this.pushQuery(n)}check(e,t,n){let i=this.tableName(),s=n;s||(this.checksCount++,s=i+"_"+this.checksCount);let o=`alter table ${i} add constraint ${s} check(${e})`;this.pushQuery(o)}_addChecks(){return this.grouped.checks?", "+this.grouped.checks.map(e=>`${e.args[2]?"constraint "+e.args[2]+" ":""}check (${this.client.raw(e.args[0],e.args[1])})`).join(", "):""}_indexCommand(e,t,n){Array.isArray(n)||(n=n?[n]:[]);let s=(t.replace(/\.|-/g,"_")+"_"+n.join("_")+"_"+e).toLowerCase();return this.formatter.wrap(s)}_getPrimaryKeys(){return(this.grouped.alterTable||[]).filter(e=>e.method==="primary").flatMap(e=>e.args).flat()}_canBeAddPrimaryKey(e){return e.primaryKey&&this._getPrimaryKeys().length===0}_getIncrementsColumnNames(){return this.grouped.columns.filter(e=>e.builder._type==="increments").map(e=>e.builder._args[0])}};ue.prototype.pushQuery=I6;ue.prototype.pushAdditional=R6;ue.prototype.unshiftQuery=$6;ue.prototype.lowerCase=!0;ue.prototype.createAlterTableMethods=null;ue.prototype.addColumnsPrefix="add column ";ue.prototype.alterColumnsPrefix="alter column ";ue.prototype.modifyColumnPrefix="modify column ";ue.prototype.dropColumnPrefix="drop column ";Tq.exports=ue});var on=l((bne,Sq)=>{var j6=sn(),D6=Fe(),Aq=zt(),{addQueryContext:F6}=D(),me=class{constructor(e,t,n,i){this.client=e,this._method="add",this._single={},this._modifiers={},this._statements=[],this._type=H6[n]||n,this._args=i,this._tableBuilder=t,t._method==="alter"&&j6(this,Oi)}references(e){return this._tableBuilder.foreign.call(this._tableBuilder,this._args[0],void 0,this)._columnBuilder(this).references(e)}},Q6=["default","defaultsTo","defaultTo","unsigned","nullable","first","after","comment","collate","check","checkPositive","checkNegative","checkIn","checkNotIn","checkBetween","checkLength","checkRegex"],U6={default:"defaultTo",defaultsTo:"defaultTo"};Q6.forEach(function(r){let e=U6[r]||r;me.prototype[r]=function(){return this._modifiers[e]=Aq(arguments),this}});F6(me);me.prototype.notNull=me.prototype.notNullable=function(){return this.nullable(!1)};["index","primary","unique"].forEach(function(r){me.prototype[r]=function(){return this._type.toLowerCase().indexOf("increments")===-1&&this._tableBuilder[r].apply(this._tableBuilder,[this._args[0]].concat(Aq(arguments))),this}});me.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(me.prototype,r))throw new Error(`Can't extend ColumnBuilder with existing method ('${r}').`);D6(me.prototype,{[r]:e})};var Oi={};Oi.drop=function(){return this._single.drop=!0,this};Oi.alterType=function(r){return this._statements.push({grouping:"alterType",value:r}),this};Oi.alter=function({alterNullable:r=!0,alterType:e=!0}={}){return this._method="alter",this.alterNullable=r,this.alterType=e,this};var H6={float:"floating",enum:"enu",boolean:"bool",string:"varchar",bigint:"bigInteger"};Sq.exports=me});var Oq=l((wne,Nq)=>{function W6(r){return r&&r.length?r[0]:void 0}Nq.exports=W6});var Iq=l((_ne,Rq)=>{Rq.exports=Oq()});var Ge=l((qne,$q)=>{var Da=nn(),V6=Zr(),G6=Iq(),z6=en(),J6=Vr(),{toNumber:tr}=D(),{formatDefault:K6}=Ue(),{operator:ja}=F(),S=class{constructor(e,t,n){this.client=e,this.tableCompiler=t,this.columnBuilder=n,this._commonBuilder=this.columnBuilder,this.args=n._args,this.type=n._type.toLowerCase(),this.grouped=V6(n._statements,"grouping"),this.modified=n._modifiers,this.isIncrements=this.type.indexOf("increments")!==-1,this.formatter=e.formatter(n),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[],this.modifiers=[],this.checksCount=0}_addCheckModifiers(){this.modifiers.push("check","checkPositive","checkNegative","checkIn","checkNotIn","checkBetween","checkLength","checkRegex")}defaults(e){if(Object.prototype.hasOwnProperty.call(this._defaultMap,e))return this._defaultMap[e].bind(this)();throw new Error(`There is no default for the specified identifier ${e}`)}toSQL(){return this.pushQuery(this.compileColumn()),this.sequence.additional&&(this.sequence=this.sequence.concat(this.sequence.additional)),this.sequence}compileColumn(){return this.formatter.wrap(this.getColumnName())+" "+this.getColumnType()+this.getModifiers()}getColumnName(){return G6(this.args)||this.defaults("columnName")}getColumnType(){if(!this._columnType){let e=this[this.type];this._columnType=typeof e=="function"?e.apply(this,J6(this.args)):e}return this._columnType}getModifiers(){let e=[];for(let t=0,n=this.modifiers.length;t<n;t++){let i=this.modifiers[t];if((!this.isIncrements||this.isIncrements&&i==="comment")&&z6(this.modified,i)){let s=this[i].apply(this,this.modified[i]);s&&e.push(s)}}return e.length>0?` ${e.join(" ")}`:""}varchar(e){return`varchar(${tr(e,255)})`}floating(e,t){return`float(${tr(e,8)}, ${tr(t,2)})`}decimal(e,t){if(e===null)throw new Error("Specifying no precision on decimal columns is not supported for that SQL dialect.");return`decimal(${tr(e,8)}, ${tr(t,2)})`}specifictype(e){return e}nullable(e){return e===!1?"not null":"null"}notNullable(){return this.nullable(!1)}defaultTo(e){return`default ${K6(e,this.type,this.client)}`}increments(e={primaryKey:!0}){return"integer not null"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")+" autoincrement"}bigincrements(e={primaryKey:!0}){return this.increments(e)}_pushAlterCheckQuery(e,t){let n=t;n||(this.checksCount++,n=this.tableCompiler.tableNameRaw+"_"+this.getColumnName()+"_"+this.checksCount),this.pushAdditional(function(){this.pushQuery(`alter table ${this.tableCompiler.tableName()} add constraint ${n} check(${e})`)})}_checkConstraintName(e){return e?`constraint ${e} `:""}_check(e,t){return this.columnBuilder._method==="alter"?(this._pushAlterCheckQuery(e,t),""):`${this._checkConstraintName(t)}check (${e})`}checkPositive(e){return this._check(`${this.formatter.wrap(this.getColumnName())} ${ja(">",this.columnBuilder,this.bindingsHolder)} 0`,e)}checkNegative(e){return this._check(`${this.formatter.wrap(this.getColumnName())} ${ja("<",this.columnBuilder,this.bindingsHolder)} 0`,e)}_checkIn(e,t,n){return this._check(`${this.formatter.wrap(this.getColumnName())} ${n?"not ":""}in (${e.map(i=>this.client._escapeBinding(i)).join(",")})`,t)}checkIn(e,t){return this._checkIn(e,t)}checkNotIn(e,t){return this._checkIn(e,t,!0)}checkBetween(e,t){e.length===2&&!Array.isArray(e[0])&&!Array.isArray(e[1])&&(e=[e]);let n=e.map(i=>`${this.formatter.wrap(this.getColumnName())} between ${this.client._escapeBinding(i[0])} and ${this.client._escapeBinding(i[1])}`).join(" or ");return this._check(n,t)}checkLength(e,t,n){return this._check(`length(${this.formatter.wrap(this.getColumnName())}) ${ja(e,this.columnBuilder,this.bindingsHolder)} ${tr(t)}`,n)}};S.prototype.binary="blob";S.prototype.bool="boolean";S.prototype.date="date";S.prototype.datetime="datetime";S.prototype.time="time";S.prototype.timestamp="timestamp";S.prototype.geometry="geometry";S.prototype.geography="geography";S.prototype.point="point";S.prototype.enu="varchar";S.prototype.bit=S.prototype.json="text";S.prototype.uuid=({useBinaryUuid:r=!1,primaryKey:e=!1}={})=>r?"binary(16)":"char(36)";S.prototype.integer=S.prototype.smallint=S.prototype.mediumint="integer";S.prototype.biginteger="bigint";S.prototype.text="text";S.prototype.tinyint="tinyint";S.prototype.pushQuery=Da.pushQuery;S.prototype.pushAdditional=Da.pushAdditional;S.prototype.unshiftQuery=Da.unshiftQuery;S.prototype._defaultMap={columnName:function(){if(!this.isIncrements)throw new Error(`You did not specify a column name for the ${this.type} column.`);return"id"}};$q.exports=S});var Lq=l((Ene,Pq)=>{var Y6=gt(),Fa=class extends Y6{constructor(e,t){super(e),this.ref=t,this._schema=null,this._alias=null}withSchema(e){return this._schema=e,this}as(e){return this._alias=e,this}toSQL(){let e=this._schema?`${this._schema}.${this.ref}`:this.ref,t=this.client.formatter(this),n=t.columnize(e),i=this._alias?`${n} as ${t.wrap(this._alias)}`:n;return this.set(i,[]),super.toSQL(...arguments)}};Pq.exports=Fa});var an=l((Cne,kq)=>{var{columnize:X6,wrap:Z6}=F(),Qa=class{constructor(e,t){this.client=e,this.builder=t,this.bindings=[]}columnize(e){return X6(e,this.builder,this.client,this)}wrap(e,t){return Z6(e,t,this.builder,this.client,this)}};kq.exports=Qa});var rr=l((vne,Mq)=>{var eV=D(),tV=sn(),rV=Fe(),wt=class{constructor(e,t,n,i){this.client=e,this._method=t,this._schemaName=void 0,this._columns=void 0,this._fn=i,this._viewName=n,this._statements=[],this._single={}}setSchema(e){this._schemaName=e}columns(e){this._columns=e}as(e){this._selectQuery=e}checkOption(){throw new Error("check option definition is not supported by this dialect.")}localCheckOption(){throw new Error("check option definition is not supported by this dialect.")}cascadedCheckOption(){throw new Error("check option definition is not supported by this dialect.")}toSQL(){return this._method==="alter"&&tV(this,nV),this._fn.call(this,this),this.client.viewCompiler(this).toSQL()}},nV={column(r){let e=this;return{rename:function(t){return e._statements.push({grouping:"alterView",method:"renameColumn",args:[r,t]}),this},defaultTo:function(t){return e._statements.push({grouping:"alterView",method:"defaultTo",args:[r,t]}),this}}}};eV.addQueryContext(wt);wt.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(wt.prototype,r))throw new Error(`Can't extend ViewBuilder with existing method ('${r}').`);rV(wt.prototype,{[r]:e})};Mq.exports=wt});var _t=l((xne,Bq)=>{var{pushQuery:iV}=nn(),sV=Zr(),{columnize:oV}=F(),Ri=class{constructor(e,t){this.client=e,this.viewBuilder=t,this._commonBuilder=this.viewBuilder,this.method=t._method,this.schemaNameRaw=t._schemaName,this.viewNameRaw=t._viewName,this.single=t._single,this.selectQuery=t._selectQuery,this.columns=t._columns,this.grouped=sV(t._statements,"grouping"),this.formatter=e.formatter(t),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[]}toSQL(){return this[this.method](),this.sequence}create(){this.createQuery(this.columns,this.selectQuery)}createOrReplace(){throw new Error("replace views is not supported by this dialect.")}createMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}createQuery(e,t,n,i){let s="create "+(n?"materialized ":"")+(i?"or replace ":"")+"view ",o=e?" ("+oV(e,this.viewBuilder,this.client,this.bindingsHolder)+")":"",a=s+this.viewName()+o;switch(a+=" as ",a+=t.toString(),this.single.checkOption){case"default_option":a+=" with check option";break;case"local":a+=" with local check option";break;case"cascaded":a+=" with cascaded check option";break;default:break}this.pushQuery({sql:a})}renameView(e,t){throw new Error("rename view is not supported by this dialect (instead drop, then create another view).")}refreshMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}alter(){this.alterView()}alterView(){let e=this.grouped.alterView||[];for(let t=0,n=e.length;t<n;t++){let i=e[t];this[i.method]?this[i.method].apply(this,i.args):this.client.logger.error(`Debug: ${i.method} does not exist`)}for(let t in this.single)typeof this[t]=="function"&&this[t](this.single[t])}renameColumn(e,t){throw new Error("rename column of views is not supported by this dialect.")}defaultTo(e,t){throw new Error("change default values of views is not supported by this dialect.")}viewName(){let e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.viewNameRaw}`:this.viewNameRaw;return this.formatter.wrap(e)}};Ri.prototype.pushQuery=iV;Bq.exports=Ri});var ze=l((Tne,Dq)=>{var{Pool:aV,TimeoutError:uV}=pc(),{EventEmitter:lV}=require("events"),{promisify:cV}=require("util"),{makeEscape:hV}=Rn(),fV=ep(),dV=uo(),pV=lo(),mV=Ip(),gV=Se(),{executeQuery:yV,enrichQueryObject:jq}=wa(),bV=Oe(),wV=Ve(),_V=Pa(),qV=yt(),EV=Ba(),CV=bt(),vV=on(),xV=Ge(),{KnexTimeoutError:TV}=ft(),{outputQuery:AV,unwrapRaw:SV}=F(),{compileCallback:NV}=Ue(),OV=gt(),RV=Lq(),IV=an(),$V=oi(),{POOL_CONFIG_OPTIONS:PV}=gi(),LV=rr(),kV=_t(),MV=we(),Ua=ae()("knex:client"),Ii=class extends lV{constructor(e={}){if(super(),this.config=e,this.logger=new $V(e),this.dialect&&!this.config.client&&this.logger.warn("Using 'this.dialect' to identify the client is deprecated and support for it will be removed in the future. Please use configuration option 'client' instead."),!(this.config.client||this.dialect))throw new Error("knex: Required configuration option 'client' is missing.");e.version&&(this.version=e.version),e.connection&&e.connection instanceof Function?(this.connectionConfigProvider=e.connection,this.connectionConfigExpirationChecker=()=>!0):(this.connectionSettings=fV(e.connection||{}),this.connectionConfigExpirationChecker=null),this.driverName&&e.connection&&(this.initializeDriver(),(!e.pool||e.pool&&e.pool.max!==0)&&this.initializePool(e)),this.valueForUndefined=this.raw("DEFAULT"),e.useNullAsDefault&&(this.valueForUndefined=null)}formatter(e){return new IV(this,e)}queryBuilder(){return new bV(this)}queryCompiler(e,t){return new wV(this,e,t)}schemaBuilder(){return new _V(this)}schemaCompiler(e){return new qV(this,e)}tableBuilder(e,t,n,i){return new EV(this,e,t,n,i)}viewBuilder(e,t,n){return new LV(this,e,t,n)}tableCompiler(e){return new CV(this,e)}viewCompiler(e){return new kV(this,e)}columnBuilder(e,t,n){return new vV(this,e,t,n)}columnCompiler(e,t){return new xV(this,e,t)}runner(e){return new mV(this,e)}transaction(e,t,n){return new gV(this,e,t,n)}raw(){return new OV(this).set(...arguments)}ref(){return new RV(this,...arguments)}query(e,t){let n=jq(e,t,this);return yV(e,n,this)}stream(e,t,n,i){let s=jq(e,t,this);return this._stream(e,s,n,i)}prepBindings(e){return e}positionBindings(e){return e}postProcessResponse(e,t){return this.config.postProcessResponse?this.config.postProcessResponse(e,t):e}wrapIdentifier(e,t){return this.customWrapIdentifier(e,this.wrapIdentifierImpl,t)}customWrapIdentifier(e,t,n){return this.config.wrapIdentifier?this.config.wrapIdentifier(e,t,n):t(e)}wrapIdentifierImpl(e){return e!=="*"?`"${e.replace(/"/g,'""')}"`:"*"}initializeDriver(){try{this.driver=this._driver()}catch(e){let t=`Knex: run
$ npm install ${this.driverName} --save`;throw this.logger.error(`${t}
${e.message}
${e.stack}`),new Error(`${t}
${e.message}`)}}poolDefaults(){return{min:2,max:10,propagateCreateError:!0}}getPoolSettings(e){e=dV({},e,this.poolDefaults()),PV.forEach(s=>{s in e&&this.logger.warn([`Pool config option "${s}" is no longer supported.`,"See https://github.com/Vincit/tarn.js for possible pool config options."].join(" "))});let t=6e4,n=[this.config.acquireConnectionTimeout,e.acquireTimeoutMillis].filter(s=>s!==void 0);n.length||n.push(t),e.acquireTimeoutMillis=Math.min(...n);let i=async()=>{if(!this.connectionConfigProvider||!this.connectionConfigExpirationChecker||!this.connectionConfigExpirationChecker())return;let s=await this.connectionConfigProvider();s.expirationChecker?(this.connectionConfigExpirationChecker=s.expirationChecker,delete s.expirationChecker):this.connectionConfigExpirationChecker=null,this.connectionSettings=s};return Object.assign(e,{create:async()=>{await i();let s=await this.acquireRawConnection();return s.__knexUid=pV("__knexUid"),e.afterCreate&&await cV(e.afterCreate)(s),s},destroy:s=>{if(s!==void 0)return this.destroyRawConnection(s)},validate:s=>s.__knex__disposed?(this.logger.warn(`Connection Error: ${s.__knex__disposed}`),!1):this.validateConnection(s)})}initializePool(e=this.config){if(this.pool){this.logger.warn("The pool has already been initialized");return}let t={...this.getPoolSettings(e.pool)};t.afterCreate&&delete t.afterCreate,this.pool=new aV(t)}validateConnection(e){return!0}async acquireConnection(){if(!this.pool)throw new Error("Unable to acquire a connection");try{let e=await this.pool.acquire().promise;return Ua("acquired connection from pool: %s",e.__knexUid),e}catch(e){let t=e;throw e instanceof uV&&(t=new TV("Knex: Timeout acquiring a connection. The pool is probably full. Are you missing a .transacting(trx) call?")),t}}releaseConnection(e){return Ua("releasing connection to pool: %s",e.__knexUid),this.pool.release(e)||Ua("pool refused connection: %s",e.__knexUid),Promise.resolve()}async destroy(e){try{this.pool&&this.pool.destroy&&await this.pool.destroy(),this.pool=void 0,typeof e=="function"&&e()}catch(t){if(typeof e=="function")return e(t);throw t}}database(){return this.connectionSettings.database}toString(){return"[object KnexClient]"}assertCanCancelQuery(){if(!this.canCancelQuery)throw new Error("Query cancelling not supported for this dialect")}cancelQuery(){throw new Error("Query cancelling not supported for this dialect")}alias(e,t){return e+" as "+t}parameter(e,t,n){return typeof e=="function"?AV(NV(e,void 0,this,n),!0,t,this):SV(e,!0,t,this,n)||"?"}parameterize(e,t,n,i){if(typeof e=="function")return this.parameter(e,n,i);e=Array.isArray(e)?e:[e];let s="",o=-1;for(;++o<e.length;){o>0&&(s+=", ");let a=e[o];MV(a)&&(a=JSON.stringify(a)),s+=this.parameter(a===void 0?t:a,n,i)}return s}values(e,t,n){return Array.isArray(e)?Array.isArray(e[0])?`(${e.map(i=>`(${this.parameterize(i,void 0,t,n)})`).join(", ")})`:`(${this.parameterize(e,void 0,t,n)})`:e&&e.isRawInstance?`(${this.parameter(e,t,n)})`:this.parameter(e,t,n)}processPassedConnection(e){}toPathForJson(e){return e}};Object.assign(Ii.prototype,{_escapeBinding:hV({escapeString(r){return`'${r.replace(/'/g,"''")}'`}}),canCancelQuery:!1});Dq.exports=Ii});var Va=l((Ane,Fq)=>{"use strict";var BV=require("url"),Ha=require("fs");function Wa(r){if(r.charAt(0)==="/"){var t=r.split(" ");return{host:t[0],database:t[1]}}var e=BV.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)?encodeURI(r).replace(/\%25(\d\d)/g,"%$1"):r,!0),t=e.query;for(var n in t)Array.isArray(t[n])&&(t[n]=t[n][t[n].length-1]);var i=(e.auth||":").split(":");if(t.user=i[0],t.password=i.splice(1).join(":"),t.port=e.port,e.protocol=="socket:")return t.host=decodeURI(e.pathname),t.database=e.query.db,t.client_encoding=e.query.encoding,t;t.host||(t.host=e.hostname);var s=e.pathname;if(!t.host&&s&&/^%2f/i.test(s)){var o=s.split("/");t.host=decodeURIComponent(o[0]),s=o.splice(1).join("/")}switch(s&&s.charAt(0)==="/"&&(s=s.slice(1)||null),t.database=s&&decodeURI(s),(t.ssl==="true"||t.ssl==="1")&&(t.ssl=!0),t.ssl==="0"&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={}),t.sslcert&&(t.ssl.cert=Ha.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=Ha.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=Ha.readFileSync(t.sslrootcert).toString()),t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{t.ssl.rejectUnauthorized=!1;break}}return t}Fq.exports=Wa;Wa.parse=Wa});var Uq=l((Sne,Qq)=>{var{parse:jV}=Va(),DV=jV,FV=process&&process.platform&&process.platform==="win32";function QV(r){try{return new URL(r)}catch{return null}}Qq.exports=function(e){let t=QV(e),n=FV&&t&&t.protocol.length===2;if(!t||n)return{client:"sqlite3",connection:{filename:e}};let{protocol:i}=t;i.slice(-1)===":"&&(i=i.slice(0,-1));let s=["postgresql","postgres"].includes(i);return{client:i,connection:s?DV(e):UV(t)}};function UV(r){let e={},t=r.pathname;if(t[0]==="/"&&(t=t.slice(1)),e.database=t,r.hostname&&(r.protocol.indexOf("mssql")===0?e.server=r.hostname:e.host=r.hostname),r.port&&(e.port=r.port),(r.username||r.password)&&(e.user=decodeURIComponent(r.username)),r.password&&(e.password=decodeURIComponent(r.password)),r.searchParams)for(let[n,i]of r.searchParams.entries())if(["mysql:","mariadb:","mssql:"].includes(r.protocol))try{e[n]=JSON.parse(i)}catch{e[n]=i}else e[n]=i;return e}});var Wq=l((Nne,Hq)=>{var HV=Se(),Ga=class extends HV{begin(e){return this.isolationLevel&&this.client.logger.warn("sqlite3 only supports serializable transactions, ignoring the isolation level param"),this.query(e,"BEGIN;")}};Hq.exports=Ga});var Jq=l((One,zq)=>{var WV=ao(),VV=Gt(),GV=z(),Vq=te(),zV=Yt(),JV=Ve(),KV=ya(),{isString:YV}=A(),{wrapString:Gq,columnize:XV}=F(),$i=WV(""),za=class extends JV{constructor(e,t,n){super(e,t,n),this.forShare=$i,this.forKeyShare=$i,this.forUpdate=$i,this.forNoKeyUpdate=$i}insert(){let e=this.single.insert||[],t=this.with()+`insert into ${this.tableName} `;if(Array.isArray(e)){if(e.length===0)return"";if(e.length===1&&e[0]&&Vq(e[0]))return{sql:t+this._emptyInsertValue}}else if(typeof e=="object"&&Vq(e))return{sql:t+this._emptyInsertValue};let n=this._prepInsert(e);if(YV(n))return{sql:t+n};if(n.columns.length===0)return{sql:""};if(t+=`(${this.formatter.columnize(n.columns)})`,this.client.valueForUndefined!==null&&n.values.forEach(h=>{VV(h,f=>{if(f===void 0)throw new TypeError("`sqlite` does not support inserting default values. Specify values explicitly or use the `useNullAsDefault` config flag. (see docs https://knexjs.org/guide/query-builder.html#insert).")})}),n.values.length===1){let h=this.client.parameterize(n.values[0],this.client.valueForUndefined,this.builder,this.bindingsHolder);t+=` values (${h})`;let{onConflict:f,ignore:d,merge:g}=this.single;if(f&&d)t+=this._ignore(f);else if(f&&g){t+=this._merge(g.updates,f,e);let y=this.where();y&&(t+=` ${y}`)}let{returning:m}=this.single;return m&&(t+=this._returning(m)),{sql:t,returning:m}}let i=[],s=-1;for(;++s<n.values.length;){let h=-1,f=i[s]=[],d=n.values[s];for(d=d===void 0?this.client.valueForUndefined:d;++h<n.columns.length;)f.push(this.client.alias(this.client.parameter(d[h],this.builder,this.bindingsHolder),this.formatter.wrap(n.columns[h])));i[s]=f.join(", ")}t+=" select "+i.join(" union all select ");let{onConflict:o,ignore:a,merge:u}=this.single;o&&a?t+=" where true"+this._ignore(o):o&&u&&(t+=" where true"+this._merge(u.updates,o,e));let{returning:c}=this.single;return c&&(t+=this._returning(c)),{sql:t,returning:c}}update(){let e=this.with(),t=this._prepUpdate(this.single.update),n=this.where(),{returning:i}=this.single;return{sql:e+`update ${this.single.only?"only ":""}${this.tableName} set ${t.join(", ")}`+(n?` ${n}`:"")+this._returning(i),returning:i}}_ignore(e){return e===!0?" on conflict do nothing":` on conflict ${this._onConflictClause(e)} do nothing`}_merge(e,t,n){let i=` on conflict ${this._onConflictClause(t)} do update set `;if(e&&Array.isArray(e))return i+=e.map(s=>Gq(s.split(".").pop(),this.formatter.builder,this.client,this.formatter)).map(s=>`${s} = excluded.${s}`).join(", "),i;if(e&&typeof e=="object"){let s=this._prepUpdate(e);return typeof s=="string"?i+=s:i+=s.join(","),i}else{let s=this._prepInsert(n);if(typeof s=="string")throw new Error("If using merge with a raw insert query, then updates must be provided");return i+=s.columns.map(o=>Gq(o.split(".").pop(),this.builder,this.client)).map(o=>`${o} = excluded.${o}`).join(", "),i}}_returning(e){return e?` returning ${this.formatter.columnize(e)}`:""}truncate(){let{table:e}=this.single;return{sql:`delete from ${this.tableName}`,output(){return this.query({sql:`delete from sqlite_sequence where name = '${e}'`}).catch(KV)}}}columnInfo(){let e=this.single.columnInfo;return{sql:`PRAGMA table_info(\`${this.client.customWrapIdentifier(this.single.table,GV)}\`)`,output(n){let i=/.*\((\d+)\)/,s=zV(n,function(o,a){let{type:u}=a,c=u.match(i);return c&&(c=c[1]),u=c?u.split("(")[0]:u,o[a.name]={type:u.toLowerCase(),maxLength:c,nullable:!a.notnull,defaultValue:a.dflt_value},o},{});return e&&s[e]||s}}}limit(){let e=!this.single.limit&&this.single.limit!==0;return e&&!this.single.offset?"":(this.single.limit=e?-1:this.single.limit,`limit ${this._getValueOrParameterFromAttribute("limit")}`)}jsonExtract(e){return this._jsonExtract("json_extract",e)}jsonSet(e){return this._jsonSet("json_set",e)}jsonInsert(e){return this._jsonSet("json_insert",e)}jsonRemove(e){let t=`json_remove(${XV(e.column,this.builder,this.client,this.bindingsHolder)},${this.client.parameter(e.path,this.builder,this.bindingsHolder)})`;return e.alias?this.client.alias(t,this.formatter.wrap(e.alias)):t}whereJsonPath(e){return this._whereJsonPath("json_extract",e)}whereJsonSupersetOf(e){throw new Error("Json superset where clause not actually supported by SQLite")}whereJsonSubsetOf(e){throw new Error("Json subset where clause not actually supported by SQLite")}onJsonPathEquals(e){return this._onJsonPathEquals("json_extract",e)}};zq.exports=za});var Yq=l((Rne,Kq)=>{var ZV=mt();function eG(r,e){var t;return ZV(r,function(n,i,s){return t=e(n,i,s),!t}),!!t}Kq.exports=eG});var Zq=l((Ine,Xq)=>{var tG=Ro(),rG=pe(),nG=Yq(),iG=I(),sG=lt();function oG(r,e,t){var n=iG(r)?tG:nG;return t&&sG(r,e,t)&&(e=void 0),n(r,rG(e,3))}Xq.exports=oG});var tE=l(($ne,eE)=>{var aG=yt(),uG=Zq(),Ja=class extends aG{constructor(e,t){super(e,t)}hasTable(e){let t=`select * from sqlite_master where type = 'table' and name = ${this.client.parameter(this.formatter.wrap(e).replace(/`/g,""),this.builder,this.bindingsHolder)}`;this.pushQuery({sql:t,output:n=>n.length>0})}hasColumn(e,t){this.pushQuery({sql:`PRAGMA table_info(${this.formatter.wrap(e)})`,output(n){return uG(n,i=>this.client.wrapIdentifier(i.name.toLowerCase())===this.client.wrapIdentifier(t.toLowerCase()))}})}renameTable(e,t){this.pushQuery(`alter table ${this.formatter.wrap(e)} rename to ${this.formatter.wrap(t)}`)}async generateDdlCommands(){let e=this.builder._sequence;for(let n=0,i=e.length;n<i;n++){let s=e[n];this[s.method].apply(this,s.args)}let t=this.sequence;if(t.length===1&&t[0].statementsProducer)return t[0].statementsProducer();{let n=[];for(let i of t){let s=i.sql;Array.isArray(s)?n.push(...s):n.push(s)}return{pre:[],sql:n,check:null,post:[]}}}};eE.exports=Ja});var nE=l((Pne,rE)=>{var lG=Ge(),ge=class extends lG{constructor(){super(...arguments),this.modifiers=["nullable","defaultTo"],this._addCheckModifiers()}enu(e){return`text check (${this.formatter.wrap(this.args[0])} in ('${e.join("', '")}'))`}_pushAlterCheckQuery(e,t){throw new Error("Alter table with to add constraints is not permitted in SQLite")}checkRegex(e,t){return this._check(`${this.formatter.wrap(this.getColumnName())} REGEXP ${this.client._escapeBinding(e)}`,t)}};ge.prototype.json="json";ge.prototype.jsonb="json";ge.prototype.double=ge.prototype.decimal=ge.prototype.floating="float";ge.prototype.timestamp="datetime";ge.prototype.increments=ge.prototype.bigincrements="integer not null primary key autoincrement";rE.exports=ge});var sE=l((Lne,iE)=>{var cG=Bn(),hG=_a(),fG=pe(),dG=I();function pG(r,e){var t=dG(r)?cG:hG;return t(r,fG(e,3))}iE.exports=pG});var uE=l((kne,aE)=>{var oE=sE(),mG=hi(),qe=z(),{isObject:Ka}=A(),gG=bt(),{formatDefault:yG}=Ue(),Ya=class extends gG{constructor(){super(...arguments)}createQuery(e,t,n){let s=(t?"create table if not exists ":"create table ")+this.tableName();n&&this.tableNameLike()?s+=" as select * from "+this.tableNameLike()+" where 0=1":(s+=" ("+e.sql.join(", "),s+=this.foreignKeys()||"",s+=this.primaryKeys()||"",s+=this._addChecks(),s+=")"),this.pushQuery(s),n&&this.addColumns(e,this.addColumnsPrefix)}addColumns(e,t,n){if(t===this.alterColumnsPrefix){let i=this,s=n.map(o=>{let a=this.client.customWrapIdentifier(o.getColumnName(),qe,o.columnBuilder.queryContext()),u=o.getColumnType(),c=o.modified.defaultTo?yG(o.modified.defaultTo[0],o.type,this.client):null,h=o.modified.nullable&&o.modified.nullable[0]===!1;return{name:a,type:u,defaultTo:c,notNull:h}});this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,statementsProducer(o,a){return i.client.ddl(i,o,a).alterColumn(s)}})}else for(let i=0,s=e.sql.length;i<s;i++)this.pushQuery({sql:`alter table ${this.tableName()} add column ${e.sql[i]}`,bindings:e.bindings[i]})}dropUnique(e,t){t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),this.pushQuery(`drop index ${t}`)}dropForeign(e,t){let n=this;e=Array.isArray(e)?e:[e],e=e.map(i=>this.client.customWrapIdentifier(i,qe)),t=this.client.customWrapIdentifier(t,qe),this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(i){return n.client.ddl(n,i,this.connection).dropForeign(e,t)}})}dropPrimary(e){let t=this;e=this.client.customWrapIdentifier(e,qe),this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(n){return t.client.ddl(t,n,this.connection).dropPrimary(e)}})}dropIndex(e,t){t=t?this.formatter.wrap(t):this._indexCommand("index",this.tableNameRaw,e),this.pushQuery(`drop index ${t}`)}unique(e,t){let n,i;Ka(t)&&({indexName:t,deferrable:n,predicate:i}=t),n&&n!=="not deferrable"&&this.client.logger.warn(`sqlite3: unique index \`${t}\` will not be deferrable ${n} because sqlite3 does not support deferred constraints.`),t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),e=this.formatter.columnize(e);let s=i?" "+this.client.queryCompiler(i).where():"";this.pushQuery(`create unique index ${t} on ${this.tableName()} (${e})${s}`)}index(e,t,n){t=t?this.formatter.wrap(t):this._indexCommand("index",this.tableNameRaw,e),e=this.formatter.columnize(e);let i;Ka(n)&&({predicate:i}=n);let s=i?" "+this.client.queryCompiler(i).where():"";this.pushQuery(`create index ${t} on ${this.tableName()} (${e})${s}`)}primary(e,t){let n=this;e=Array.isArray(e)?e:[e],e=e.map(s=>this.client.customWrapIdentifier(s,qe));let i;Ka(t)&&({constraintName:t,deferrable:i}=t),i&&i!=="not deferrable"&&this.client.logger.warn(`sqlite3: primary key constraint \`${t}\` will not be deferrable ${i} because sqlite3 does not support deferred constraints.`),t=this.client.customWrapIdentifier(t,qe),this.method!=="create"&&this.method!=="createIfNot"&&this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(s){return n.client.ddl(n,s,this.connection).primary(e,t)}})}foreign(e){let t=this;this.method!=="create"&&this.method!=="createIfNot"&&(e.column=Array.isArray(e.column)?e.column:[e.column],e.column=e.column.map(n=>this.client.customWrapIdentifier(n,qe)),e.inTable=this.client.customWrapIdentifier(e.inTable,qe),e.references=Array.isArray(e.references)?e.references:[e.references],e.references=e.references.map(n=>this.client.customWrapIdentifier(n,qe)),this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,statementsProducer(n,i){return t.client.ddl(t,n,i).foreign(e)}}))}primaryKeys(){let e=oE(this.grouped.alterTable||[],{method:"primary"});if(e.length>0&&e[0].args.length>0){let t=e[0].args[0],n=e[0].args[1]||"";n&&(n=" constraint "+this.formatter.wrap(n));let i=this.grouped.columns.filter(s=>s.builder._type==="increments").length>0;return`,${n} ${i?"unique":"primary key"} (${this.formatter.columnize(t)})`}}foreignKeys(){let e="",t=oE(this.grouped.alterTable||[],{method:"foreign"});for(let n=0,i=t.length;n<i;n++){let s=t[n].args[0],o=this.formatter.columnize(s.column),a=this.formatter.columnize(s.references),u=this.formatter.wrap(s.inTable),c=s.keyName||"";c&&(c=" constraint "+this.formatter.wrap(c)),e+=`,${c} foreign key(${o}) references ${u}(${a})`,s.onDelete&&(e+=` on delete ${s.onDelete}`),s.onUpdate&&(e+=` on update ${s.onUpdate}`)}return e}createTableBlock(){return this.getColumns().concat().join(",")}renameColumn(e,t){this.pushQuery({sql:`alter table ${this.tableName()} rename ${this.formatter.wrap(e)} to ${this.formatter.wrap(t)}`})}_setNullableState(e,t){let n=this;this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,statementsProducer(i,s){return n.client.ddl(n,i,s).setNullable(e,t)}})}dropColumn(){let e=this,n=mG(arguments).map(i=>this.client.customWrapIdentifier(i,qe));this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(i){return e.client.ddl(e,i,this.connection).dropColumn(n)}})}};aE.exports=Ya});var cE=l((Mne,lE)=>{var bG=_t(),{columnize:wG}=F(),Xa=class extends bG{constructor(e,t){super(e,t)}createOrReplace(){let e=this.columns,t=this.selectQuery.toString(),n=this.viewName(),i=e?" ("+wG(e,this.viewBuilder,this.client,this.bindingsHolder)+")":"",s=`drop view if exists ${n}`,o=`create view ${n}${i} as ${t}`;this.pushQuery({sql:s}),this.pushQuery({sql:o})}};lE.exports=Xa});var fE=l((Bne,hE)=>{function _G(r,e,t){return`INSERT INTO "${e}" SELECT ${t===void 0?"*":t.map(n=>`"${n}"`).join(", ")} FROM "${r}";`}function qG(r){return`DROP TABLE "${r}"`}function EG(r,e){return`ALTER TABLE "${r}" RENAME TO "${e}"`}function CG(r){return`SELECT type, sql FROM sqlite_master WHERE (type='table' OR (type='index' AND sql IS NOT NULL)) AND tbl_name='${r}'`}function vG(){return"PRAGMA foreign_keys"}function xG(r){return`PRAGMA foreign_keys = ${r?"ON":"OFF"}`}function TG(){return"PRAGMA foreign_key_check"}hE.exports={copyData:_G,dropOriginal:qG,renameTable:EG,getTableSql:CG,isForeignCheckEnabled:vG,setForeignCheck:xG,executeForeignCheck:TG}});var pE=l((jne,dE)=>{function AG(r,e){let t=new RegExp(Object.entries(e).map(([s,o])=>`(?<${s}>${o.source})`).join("|"),"yi"),n=0,i=[];for(;n<r.length;){t.lastIndex=n;let s=r.match(t);if(s!==null){let[o,a]=Object.entries(s.groups).find(([u,c])=>c!==void 0);n+=a.length,o.startsWith("_")||i.push({type:o,text:a})}else throw new Error(`No matching tokenizer rule found at: [${r.substring(n)}]`)}return i}dE.exports={tokenize:AG}});var gE=l((Dne,mE)=>{function SG(r,e=t=>t){return function({index:t=0,input:n}){let i=t,s=[];for(let o of r){let a=o({index:i,input:n});if(a.success)i=a.index,s.push(a.ast);else return a}return{success:!0,ast:e(s),index:i,input:n}}}function NG(r,e=t=>t){return function({index:t=0,input:n}){for(let i of r){let s=i({index:t,input:n});if(s.success)return{success:!0,ast:e(s.ast),index:s.index,input:n}}return{success:!1,ast:null,index:t,input:n}}}function OG(r,e=t=>t){return function({index:t=0,input:n}){let i={},s=t,o=[];do i=r({index:s,input:n}),i.success&&(s=i.index,o.push(i.ast));while(i.success);return o.length>0?{success:!0,ast:e(o),index:s,input:n}:{success:!1,ast:null,index:s,input:n}}}function RG(r,e=t=>t){return function({index:t=0,input:n}){let i=r({index:t,input:n});return i.success?{success:!0,ast:e(i.ast),index:i.index,input:n}:{success:!0,ast:e(null),index:t,input:n}}}function IG(r,e=t=>t){return function({index:t=0,input:n}){let i=r.do({index:t,input:n});return i.success&&r.next({index:i.index,input:n}).success?{success:!0,ast:e(i.ast),index:i.index,input:n}:{success:!1,ast:null,index:t,input:n}}}function $G(r,e=t=>t){return function({index:t=0,input:n}){let i=r.do({index:t,input:n});return i.success&&!r.not({index:t,input:n}).success?{success:!0,ast:e(i.ast),index:i.index,input:n}:{success:!1,ast:null,index:t,input:n}}}function PG(r,e=t=>t.text){return function({index:t=0,input:n}){let i=n[t];return i!==void 0&&(r.type===void 0||r.type===i.type)&&(r.text===void 0||r.text.toUpperCase()===i.text.toUpperCase())?{success:!0,ast:e(i),index:t+1,input:n}:{success:!1,ast:null,index:t,input:n}}}var LG=function({index:r=0,input:e}){return{success:!0,ast:null,index:r,input:e}},kG=function({index:r=0,input:e}){return{success:r===e.length,ast:null,index:r,input:e}};mE.exports={s:SG,a:NG,m:OG,o:RG,l:IG,n:$G,t:PG,e:LG,f:kG}});var IE=l((Fne,RE)=>{var{tokenize:qE}=pE(),{s:w,a:L,m:qt,o:B,l:yE,n:Za,t:p,e:ln,f:EE}=gE(),CE={keyword:/(?:ABORT|ACTION|ADD|AFTER|ALL|ALTER|ALWAYS|ANALYZE|AND|AS|ASC|ATTACH|AUTOINCREMENT|BEFORE|BEGIN|BETWEEN|BY|CASCADE|CASE|CAST|CHECK|COLLATE|COLUMN|COMMIT|CONFLICT|CONSTRAINT|CREATE|CROSS|CURRENT|CURRENT_DATE|CURRENT_TIME|CURRENT_TIMESTAMP|DATABASE|DEFAULT|DEFERRED|DEFERRABLE|DELETE|DESC|DETACH|DISTINCT|DO|DROP|END|EACH|ELSE|ESCAPE|EXCEPT|EXCLUSIVE|EXCLUDE|EXISTS|EXPLAIN|FAIL|FILTER|FIRST|FOLLOWING|FOR|FOREIGN|FROM|FULL|GENERATED|GLOB|GROUP|GROUPS|HAVING|IF|IGNORE|IMMEDIATE|IN|INDEX|INDEXED|INITIALLY|INNER|INSERT|INSTEAD|INTERSECT|INTO|IS|ISNULL|JOIN|KEY|LAST|LEFT|LIKE|LIMIT|MATCH|MATERIALIZED|NATURAL|NO|NOT|NOTHING|NOTNULL|NULL|NULLS|OF|OFFSET|ON|OR|ORDER|OTHERS|OUTER|OVER|PARTITION|PLAN|PRAGMA|PRECEDING|PRIMARY|QUERY|RAISE|RANGE|RECURSIVE|REFERENCES|REGEXP|REINDEX|RELEASE|RENAME|REPLACE|RESTRICT|RETURNING|RIGHT|ROLLBACK|ROW|ROWS|SAVEPOINT|SELECT|SET|TABLE|TEMP|TEMPORARY|THEN|TIES|TO|TRANSACTION|TRIGGER|UNBOUNDED|UNION|UNIQUE|UPDATE|USING|VACUUM|VALUES|VIEW|VIRTUAL|WHEN|WHERE|WINDOW|WITH|WITHOUT)(?=\s+|-|\(|\)|;|\+|\*|\/|%|==|=|<=|<>|<<|<|>=|>>|>|!=|,|&|~|\|\||\||\.)/,id:/"[^"]*(?:""[^"]*)*"|`[^`]*(?:``[^`]*)*`|\[[^[\]]*\]|[a-z_][a-z0-9_$]*/,string:/'[^']*(?:''[^']*)*'/,blob:/x'(?:[0-9a-f][0-9a-f])+'/,numeric:/(?:\d+(?:\.\d*)?|\.\d+)(?:e(?:\+|-)?\d+)?|0x[0-9a-f]+/,variable:/\?\d*|[@$:][a-z0-9_$]+/,operator:/-|\(|\)|;|\+|\*|\/|%|==|=|<=|<>|<<|<|>=|>>|>|!=|,|&|~|\|\||\||\./,_ws:/\s+/};function MG(r){let e=jG({input:qE(r,CE)});if(!e.success)throw new Error(`Parsing CREATE TABLE failed at [${e.input.slice(e.index).map(t=>t.text).join(" ")}] of "${r}"`);return e.ast}function BG(r){let e=fz({input:qE(r,CE)});if(!e.success)throw new Error(`Parsing CREATE INDEX failed at [${e.input.slice(e.index).map(t=>t.text).join(" ")}] of "${r}"`);return e.ast}function jG(r){return w([p({text:"CREATE"},e=>null),DG,p({text:"TABLE"},e=>null),AE,SE,eu,p({text:"("},e=>null),vE,tz,p({text:")"},e=>null),FG,EE],e=>Object.assign({},...e.filter(t=>t!==null)))(r)}function DG(r){return L([p({text:"TEMP"}),p({text:"TEMPORARY"}),ln],e=>({temporary:e!==null}))(r)}function FG(r){return B(w([p({text:"WITHOUT"}),p({text:"ROWID"})]),e=>({rowid:e!==null}))(r)}function vE(r){return L([w([bE,p({text:","}),vE],e=>({columns:[e[0]].concat(e[2].columns)})),w([bE],e=>({columns:[e[0]]}))])(r)}function bE(r){return w([w([Je],e=>({name:e[0]})),QG,UG],e=>Object.assign({},...e))(r)}function QG(r){return B(w([qt(p({type:"id"})),L([w([p({text:"("}),Pi,p({text:","}),Pi,p({text:")"})],e=>`(${e[1]}, ${e[3]})`),w([p({text:"("}),Pi,p({text:")"})],e=>`(${e[1]})`),ln])],e=>`${e[0].join(" ")}${e[1]||""}`),e=>({type:e}))(r)}function UG(r){return B(qt(HG),e=>({constraints:Object.assign({primary:null,notnull:null,null:null,unique:null,check:null,default:null,collate:null,references:null,as:null},...e||[])}))(r)}function HG(r){return L([WG,GG,zG,JG,KG,YG,XG,ZG,ez])(r)}function WG(r){return w([re,p({text:"PRIMARY"},e=>null),p({text:"KEY"},e=>null),tu,nr,VG],e=>({primary:Object.assign({},...e.filter(t=>t!==null))}))(r)}function VG(r){return B(p({text:"AUTOINCREMENT"}),e=>({autoincrement:e!==null}))(r)}function GG(r){return w([re,p({text:"NOT"},e=>null),p({text:"NULL"},e=>null),nr],e=>({notnull:Object.assign({},...e.filter(t=>t!==null))}))(r)}function zG(r){return w([re,p({text:"NULL"},e=>null),nr],e=>({null:Object.assign({},...e.filter(t=>t!==null))}))(r)}function JG(r){return w([re,p({text:"UNIQUE"},e=>null),nr],e=>({unique:Object.assign({},...e.filter(t=>t!==null))}))(r)}function KG(r){return w([re,p({text:"CHECK"},e=>null),p({text:"("},e=>null),w([Et],e=>({expression:e[0]})),p({text:")"},e=>null)],e=>({check:Object.assign({},...e.filter(t=>t!==null))}))(r)}function YG(r){return w([re,p({text:"DEFAULT"},e=>null),L([w([p({text:"("}),Et,p({text:")"})],e=>({value:e[1],expression:!0})),w([yz],e=>({value:e[0],expression:!1})),w([Pi],e=>({value:e[0],expression:!1}))])],e=>({default:Object.assign({},...e.filter(t=>t!==null))}))(r)}function XG(r){return w([re,p({text:"COLLATE"},e=>null),p({type:"id"},e=>({collation:e.text}))],e=>({collate:Object.assign({},...e.filter(t=>t!==null))}))(r)}function ZG(r){return w([re,w([xE],e=>e[0].references)],e=>({references:Object.assign({},...e.filter(t=>t!==null))}))(r)}function ez(r){return w([re,B(w([p({text:"GENERATED"}),p({text:"ALWAYS"})]),e=>({generated:e!==null})),p({text:"AS"},e=>null),p({text:"("},e=>null),w([Et],e=>({expression:e[0]})),p({text:")"},e=>null),L([p({text:"STORED"}),p({text:"VIRTUAL"}),ln],e=>({mode:e?e.toUpperCase():null}))],e=>({as:Object.assign({},...e.filter(t=>t!==null))}))(r)}function tz(r){return B(qt(w([p({text:","}),rz],e=>e[1])),e=>({constraints:e||[]}))(r)}function rz(r){return L([nz,iz,sz,oz])(r)}function nz(r){return w([re,p({text:"PRIMARY"},e=>null),p({text:"KEY"},e=>null),p({text:"("},e=>null),un,p({text:")"},e=>null),nr],e=>Object.assign({type:"PRIMARY KEY"},...e.filter(t=>t!==null)))(r)}function iz(r){return w([re,p({text:"UNIQUE"},e=>null),p({text:"("},e=>null),un,p({text:")"},e=>null),nr],e=>Object.assign({type:"UNIQUE"},...e.filter(t=>t!==null)))(r)}function nr(r){return B(w([p({text:"ON"}),p({text:"CONFLICT"}),L([p({text:"ROLLBACK"}),p({text:"ABORT"}),p({text:"FAIL"}),p({text:"IGNORE"}),p({text:"REPLACE"})])],e=>e[2]),e=>({conflict:e?e.toUpperCase():null}))(r)}function sz(r){return w([re,p({text:"CHECK"},e=>null),p({text:"("},e=>null),w([Et],e=>({expression:e[0]})),p({text:")"},e=>null)],e=>Object.assign({type:"CHECK"},...e.filter(t=>t!==null)))(r)}function oz(r){return w([re,p({text:"FOREIGN"},e=>null),p({text:"KEY"},e=>null),p({text:"("},e=>null),TE,p({text:")"},e=>null),xE],e=>Object.assign({type:"FOREIGN KEY"},...e.filter(t=>t!==null)))(r)}function xE(r){return w([p({text:"REFERENCES"},e=>null),eu,az,B(qt(L([uz,lz,cz])),e=>Object.assign({delete:null,update:null,match:null},...e||[])),hz],e=>({references:Object.assign({},...e.filter(t=>t!==null))}))(r)}function az(r){return B(w([p({text:"("}),TE,p({text:")"})],e=>e[1]),e=>({columns:e?e.columns:[]}))(r)}function TE(r){return w([B(qt(w([Je,p({text:","})],e=>e[0])),e=>e!==null?e:[]),Je],e=>({columns:e[0].concat([e[1]])}))(r)}function uz(r){return w([p({text:"ON"}),p({text:"DELETE"}),OE],e=>({delete:e[2]}))(r)}function lz(r){return w([p({text:"ON"}),p({text:"UPDATE"}),OE],e=>({update:e[2]}))(r)}function cz(r){return w([p({text:"MATCH"}),L([p({type:"keyword"}),p({type:"id"})])],e=>({match:e[1]}))(r)}function hz(r){return B(w([B(p({text:"NOT"})),p({text:"DEFERRABLE"}),B(w([p({text:"INITIALLY"}),L([p({text:"DEFERRED"}),p({text:"IMMEDIATE"})])],e=>e[1].toUpperCase()))]),e=>({deferrable:e?{not:e[0]!==null,initially:e[2]}:null}))(r)}function re(r){return B(w([p({text:"CONSTRAINT"}),Je],e=>e[1]),e=>({name:e}))(r)}function fz(r){return w([p({text:"CREATE"},e=>null),dz,p({text:"INDEX"},e=>null),AE,SE,pz,p({text:"ON"},e=>null),eu,p({text:"("},e=>null),un,p({text:")"},e=>null),mz,EE],e=>Object.assign({},...e.filter(t=>t!==null)))(r)}function dz(r){return B(p({text:"UNIQUE"}),e=>({unique:e!==null}))(r)}function AE(r){return B(w([p({text:"IF"}),p({text:"NOT"}),p({text:"EXISTS"})]),e=>({exists:e!==null}))(r)}function SE(r){return B(w([Je,p({text:"."})],e=>e[0]),e=>({schema:e}))(r)}function pz(r){return w([Je],e=>({index:e[0]}))(r)}function eu(r){return w([Je],e=>({table:e[0]}))(r)}function mz(r){return B(w([p({text:"WHERE"}),Et],e=>e[1]),e=>({where:e}))(r)}function un(r){return L([w([wE,p({text:","}),un],e=>({columns:[e[0]].concat(e[2].columns)})),w([_E,p({text:","}),un],e=>({columns:[e[0]].concat(e[2].columns)})),yE({do:wE,next:p({text:")"})},e=>({columns:[e]})),yE({do:_E,next:p({text:")"})},e=>({columns:[e]}))])(r)}function wE(r){return w([w([Je],e=>({name:e[0],expression:!1})),NE,tu],e=>Object.assign({},...e.filter(t=>t!==null)))(r)}function _E(r){return w([w([gz],e=>({name:e[0],expression:!0})),NE,tu],e=>Object.assign({},...e.filter(t=>t!==null)))(r)}function NE(r){return B(w([p({text:"COLLATE"}),p({type:"id"})],e=>e[1]),e=>({collation:e}))(r)}function tu(r){return L([p({text:"ASC"}),p({text:"DESC"}),ln],e=>({order:e?e.toUpperCase():null}))(r)}function gz(r){return qt(L([Za({do:p({type:"keyword"}),not:L([p({text:"COLLATE"}),p({text:"ASC"}),p({text:"DESC"})])}),p({type:"id"}),p({type:"string"}),p({type:"blob"}),p({type:"numeric"}),p({type:"variable"}),Za({do:p({type:"operator"}),not:L([p({text:"("}),p({text:")"}),p({text:","})])}),w([p({text:"("}),B(Et),p({text:")"})],e=>e[1]||[])]))(r)}function Et(r){return qt(L([p({type:"keyword"}),p({type:"id"}),p({type:"string"}),p({type:"blob"}),p({type:"numeric"}),p({type:"variable"}),Za({do:p({type:"operator"}),not:L([p({text:"("}),p({text:")"})])}),w([p({text:"("}),B(Et),p({text:")"})],e=>e[1]||[])]))(r)}function Je(r){return L([p({type:"id"}),p({type:"string"})],e=>/^["`['][^]*["`\]']$/.test(e)?e.substring(1,e.length-1):e)(r)}function OE(r){return L([w([p({text:"SET"}),p({text:"NULL"})],e=>`${e[0]} ${e[1]}`),w([p({text:"SET"}),p({text:"DEFAULT"})],e=>`${e[0]} ${e[1]}`),p({text:"CASCADE"}),p({text:"RESTRICT"}),w([p({text:"NO"}),p({text:"ACTION"})],e=>`${e[0]} ${e[1]}`)],e=>e.toUpperCase())(r)}function yz(r){return L([p({type:"numeric"}),p({type:"string"}),p({type:"id"}),p({type:"blob"}),p({text:"NULL"}),p({text:"TRUE"}),p({text:"FALSE"}),p({text:"CURRENT_TIME"}),p({text:"CURRENT_DATE"}),p({text:"CURRENT_TIMESTAMP"})])(r)}function Pi(r){return w([L([p({text:"+"}),p({text:"-"}),ln]),p({type:"numeric"})],e=>`${e[0]||""}${e[1]}`)(r)}RE.exports={parseCreateTable:MG,parseCreateIndex:BG}});var jE=l((Qne,BE)=>{function bz(r,e=t=>t){return _z(r,e)}function wz(r,e=t=>t){return Jz(r,e)}function _z(r,e){return`CREATE${qz(r,e)} TABLE${LE(r,e)} ${kE(r,e)}${ru(r,e)} (${Cz(r,e)}${Mz(r,e)})${Ez(r,e)}`}function qz(r,e){return r.temporary?" TEMP":""}function Ez(r,e){return r.rowid?" WITHOUT ROWID":""}function Cz(r,e){return r.columns.map(t=>vz(t,e)).join(", ")}function vz(r,e){return`${vt(r.name,e)}${xz(r,e)}${Tz(r.constraints,e)}`}function xz(r,e){return r.type!==null?` ${r.type}`:""}function Tz(r,e){return`${Az(r,e)}${Nz(r,e)}${Oz(r,e)}${Rz(r,e)}${Iz(r,e)}${$z(r,e)}${Pz(r,e)}${Lz(r,e)}${kz(r,e)}`}function Az(r,e){return r.primary!==null?` ${ne(r.primary,e)}PRIMARY KEY${iu(r.primary,e)}${ir(r.primary,e)}${Sz(r.primary,e)}`:""}function Sz(r,e){return r.autoincrement?" AUTOINCREMENT":""}function Nz(r,e){return r.notnull!==null?` ${ne(r.notnull,e)}NOT NULL${ir(r.notnull,e)}`:""}function Oz(r,e){return r.null!==null?` ${ne(r.null,e)}NULL${ir(r.null,e)}`:""}function Rz(r,e){return r.unique!==null?` ${ne(r.unique,e)}UNIQUE${ir(r.unique,e)}`:""}function Iz(r,e){return r.check!==null?` ${ne(r.check,e)}CHECK (${Ct(r.check.expression,e)})`:""}function $z(r,e){return r.default!==null?` ${ne(r.default,e)}DEFAULT ${r.default.expression?`(${Ct(r.default.value,e)})`:r.default.value}`:""}function Pz(r,e){return r.collate!==null?` ${ne(r.collate,e)}COLLATE ${r.collate.collation}`:""}function Lz(r,e){return r.references!==null?` ${ne(r.references,e)}${$E(r.references,e)}`:""}function kz(r,e){return r.as!==null?` ${ne(r.as,e)}${r.as.generated?"GENERATED ALWAYS ":""}AS (${Ct(r.as.expression,e)})${r.as.mode!==null?` ${r.as.mode}`:""}`:""}function Mz(r,e){return r.constraints.reduce((t,n)=>`${t}, ${Bz(n,e)}`,"")}function Bz(r,e){switch(r.type){case"PRIMARY KEY":return jz(r,e);case"UNIQUE":return Dz(r,e);case"CHECK":return Fz(r,e);case"FOREIGN KEY":return Qz(r,e)}}function jz(r,e){return`${ne(r,e)}PRIMARY KEY (${nu(r,e)})${ir(r,e)}`}function Dz(r,e){return`${ne(r,e)}UNIQUE (${nu(r,e)})${ir(r,e)}`}function ir(r,e){return r.conflict!==null?` ON CONFLICT ${r.conflict}`:""}function Fz(r,e){return`${ne(r,e)}CHECK (${Ct(r.expression,e)})`}function Qz(r,e){return`${ne(r,e)}FOREIGN KEY (${PE(r,e)}) ${$E(r.references,e)}`}function $E(r,e){return`REFERENCES ${ru(r,e)}${Uz(r,e)}${Hz(r,e)}${zz(r.deferrable,e)}`}function Uz(r,e){return r.columns.length>0?` (${PE(r,e)})`:""}function PE(r,e){return r.columns.map(t=>vt(t,e)).join(", ")}function Hz(r,e){return`${Wz(r,e)}${Vz(r,e)}${Gz(r,e)}`}function Wz(r,e){return r.delete!==null?` ON DELETE ${r.delete}`:""}function Vz(r,e){return r.update!==null?` ON UPDATE ${r.update}`:""}function Gz(r,e){return r.match!==null?` MATCH ${r.match}`:""}function zz(r,e){return r!==null?` ${r.not?"NOT ":""}DEFERRABLE${r.initially!==null?` INITIALLY ${r.initially}`:""}`:""}function ne(r,e){return r.name!==null?`CONSTRAINT ${vt(r.name,e)} `:""}function Jz(r,e){return`CREATE${Kz(r,e)} INDEX${LE(r,e)} ${kE(r,e)}${Yz(r,e)} on ${ru(r,e)} (${nu(r,e)})${Xz(r,e)}`}function Kz(r,e){return r.unique?" UNIQUE":""}function LE(r,e){return r.exists?" IF NOT EXISTS":""}function kE(r,e){return r.schema!==null?`${vt(r.schema,e)}.`:""}function Yz(r,e){return vt(r.index,e)}function ru(r,e){return vt(r.table,e)}function Xz(r,e){return r.where!==null?` where ${Ct(r.where)}`:""}function nu(r,e){return r.columns.map(t=>t.expression?eJ(t,e):Zz(t,e)).join(", ")}function Zz(r,e){return`${vt(r.name,e)}${ME(r,e)}${iu(r,e)}`}function eJ(r,e){return`${tJ(r.name,e)}${ME(r,e)}${iu(r,e)}`}function ME(r,e){return r.collation!==null?` COLLATE ${r.collation}`:""}function iu(r,e){return r.order!==null?` ${r.order}`:""}function tJ(r,e){return Ct(r,e)}function Ct(r,e){return r.reduce((t,n)=>Array.isArray(n)?`${t}(${Ct(n)})`:t?`${t} ${n}`:n,"")}function vt(r,e){return e(r)}BE.exports={compileCreateTable:bz,compileCreateIndex:wz}});var QE=l((Une,FE)=>{function DE(r,e){return r.toLowerCase()===e.toLowerCase()}function rJ(r,e){return r.some(t=>DE(t,e))}FE.exports={isEqualId:DE,includesId:rJ}});var zE=l((Hne,GE)=>{var nJ=z(),{nanonum:iJ}=Ci(),{copyData:UE,dropOriginal:HE,renameTable:WE,getTableSql:sJ,isForeignCheckEnabled:oJ,setForeignCheck:su,executeForeignCheck:VE}=fE(),{parseCreateTable:xt,parseCreateIndex:aJ}=IE(),{compileCreateTable:Tt,compileCreateIndex:uJ}=jE(),{isEqualId:Li,includesId:At}=QE(),ou=class{constructor(e,t,n,i){this.client=e,this.tableCompiler=t,this.pragma=n,this.tableNameRaw=this.tableCompiler.tableNameRaw,this.alteredName=`_knex_temp_alter${iJ(3)}`,this.connection=i,this.formatter=s=>this.client.customWrapIdentifier(s,nJ),this.wrap=s=>this.client.wrapIdentifierImpl(s)}tableName(){return this.formatter(this.tableNameRaw)}getTableSql(){let e=this.tableName();return this.client.transaction(async t=>{t.disableProcessing();let n=await t.raw(sJ(e));return t.enableProcessing(),{createTable:n.filter(i=>i.type==="table")[0].sql,createIndices:n.filter(i=>i.type==="index").map(i=>i.sql)}},{connection:this.connection})}async isForeignCheckEnabled(){return(await this.client.raw(oJ()).connection(this.connection))[0].foreign_keys===1}async setForeignCheck(e){await this.client.raw(su(e)).connection(this.connection)}renameTable(e){return e.raw(WE(this.alteredName,this.tableName()))}dropOriginal(e){return e.raw(HE(this.tableName()))}copyData(e,t){return e.raw(UE(this.tableName(),this.alteredName,t))}async alterColumn(e){let{createTable:t,createIndices:n}=await this.getTableSql(),i=xt(t);i.table=this.alteredName,i.columns=i.columns.map(o=>{let a=e.find(u=>Li(u.name,o.name));return a&&(o.type=a.type,o.constraints.default=a.defaultTo!==null?{name:null,value:a.defaultTo,expression:!1}:null,o.constraints.notnull=a.notNull?{name:null,conflict:null}:null,o.constraints.null=a.notNull?null:o.constraints.null),o});let s=Tt(i,this.wrap);return this.generateAlterCommands(s,n)}async dropColumn(e){let{createTable:t,createIndices:n}=await this.getTableSql(),i=xt(t);if(i.table=this.alteredName,i.columns=i.columns.filter(u=>u.expression||!At(e,u.name)),i.columns.length===0)throw new Error("Unable to drop last column from table");i.constraints=i.constraints.filter(u=>u.type==="PRIMARY KEY"||u.type==="UNIQUE"?u.columns.every(c=>c.expression||!At(e,c.name)):u.type==="FOREIGN KEY"?u.columns.every(c=>!At(e,c))&&(u.references.table!==i.table||u.references.columns.every(c=>!At(e,c))):!0);let s=i.columns.map(u=>u.name),o=Tt(i,this.wrap),a=[];for(let u of n){let c=aJ(u);c.columns=c.columns.filter(h=>h.expression||!At(e,h.name)),c.columns.length>0&&a.push(uJ(c,this.wrap))}return this.alter(o,a,s)}async dropForeign(e,t){let{createTable:n,createIndices:i}=await this.getTableSql(),s=xt(n);s.table=this.alteredName,t||(s.columns=s.columns.map(a=>({...a,references:At(e,a.name)?null:a.references}))),s.constraints=s.constraints.filter(a=>a.type==="FOREIGN KEY"?t?!a.name||!Li(a.name,t):a.columns.every(u=>!At(e,u)):!0);let o=Tt(s,this.wrap);return this.alter(o,i)}async dropPrimary(e){let{createTable:t,createIndices:n}=await this.getTableSql(),i=xt(t);i.table=this.alteredName,i.columns=i.columns.map(o=>({...o,primary:null})),i.constraints=i.constraints.filter(o=>o.type==="PRIMARY KEY"?e?!o.name||!Li(o.name,e):!1:!0);let s=Tt(i,this.wrap);return this.alter(s,n)}async primary(e,t){let{createTable:n,createIndices:i}=await this.getTableSql(),s=xt(n);s.table=this.alteredName,s.columns=s.columns.map(a=>({...a,primary:null})),s.constraints=s.constraints.filter(a=>a.type!=="PRIMARY KEY"),s.constraints.push({type:"PRIMARY KEY",name:t||null,columns:e.map(a=>({name:a,expression:!1,collation:null,order:null})),conflict:null});let o=Tt(s,this.wrap);return this.alter(o,i)}async foreign(e){let{createTable:t,createIndices:n}=await this.getTableSql(),i=xt(t);i.table=this.alteredName,i.constraints.push({type:"FOREIGN KEY",name:e.keyName||null,columns:e.column,references:{table:e.inTable,columns:e.references,delete:e.onDelete||null,update:e.onUpdate||null,match:null,deferrable:null}});let s=Tt(i,this.wrap);return this.generateAlterCommands(s,n)}async setNullable(e,t){let{createTable:n,createIndices:i}=await this.getTableSql(),s=xt(n);s.table=this.alteredName;let o=s.columns.find(u=>Li(e,u.name));if(!o)throw new Error(`.setNullable: Column ${e} does not exist in table ${this.tableName()}.`);o.constraints.notnull=t?null:{name:null,conflict:null},o.constraints.null=t?o.constraints.null:null;let a=Tt(s,this.wrap);return this.generateAlterCommands(a,i)}async alter(e,t,n){let i=await this.isForeignCheckEnabled();i&&await this.setForeignCheck(!1);try{await this.client.transaction(async s=>{await s.raw(e),await this.copyData(s,n),await this.dropOriginal(s),await this.renameTable(s);for(let o of t)await s.raw(o);if(i&&(await s.raw(VE())).length>0)throw new Error("FOREIGN KEY constraint failed")},{connection:this.connection})}finally{i&&await this.setForeignCheck(!0)}}async generateAlterCommands(e,t,n){let i=[],s=[],o=[],a=null;i.push(e),i.push(UE(this.tableName(),this.alteredName,n)),i.push(HE(this.tableName())),i.push(WE(this.alteredName,this.tableName()));for(let c of t)i.push(c);return await this.isForeignCheckEnabled()&&(s.push(su(!1)),o.push(su(!0)),a=VE()),{pre:s,sql:i,check:a,post:o}}};GE.exports=ou});var KE=l((Vne,JE)=>{var lJ=Oe();JE.exports=class extends lJ{withMaterialized(e,t,n){return this._validateWithArgs(e,t,n,"with"),this.withWrapped(e,t,n,!0)}withNotMaterialized(e,t,n){return this._validateWithArgs(e,t,n,"with"),this.withWrapped(e,t,n,!1)}}});var au=l((Gne,YE)=>{var cJ=uo(),hJ=He(),{promisify:fJ}=require("util"),dJ=ze(),pJ=gt(),mJ=Wq(),gJ=Jq(),yJ=tE(),bJ=nE(),wJ=uE(),_J=cE(),qJ=zE(),EJ=an(),CJ=KE(),ki=class extends dJ{constructor(e){super(e),e.connection&&e.connection.filename===void 0&&this.logger.warn("Could not find `connection.filename` in config. Please specify the database path and name to avoid errors. (see docs https://knexjs.org/guide/#configuration-options)"),e.useNullAsDefault===void 0&&this.logger.warn("sqlite does not support inserting default values. Set the `useNullAsDefault` flag to hide this warning. (see docs https://knexjs.org/guide/query-builder.html#insert).")}_driver(){return require("sqlite3")}schemaCompiler(){return new yJ(this,...arguments)}transaction(){return new mJ(this,...arguments)}queryCompiler(e,t){return new gJ(this,e,t)}queryBuilder(){return new CJ(this)}viewCompiler(e,t){return new _J(this,e,t)}columnCompiler(){return new bJ(this,...arguments)}tableCompiler(){return new wJ(this,...arguments)}ddl(e,t,n){return new qJ(this,e,t,n)}wrapIdentifierImpl(e){return e!=="*"?`\`${e.replace(/`/g,"``")}\``:"*"}acquireRawConnection(){return new Promise((e,t)=>{let n=this.driver.OPEN_READWRITE|this.driver.OPEN_CREATE;if(this.connectionSettings.flags){if(!Array.isArray(this.connectionSettings.flags))throw new Error("flags must be an array of strings");this.connectionSettings.flags.forEach(s=>{if(!s.startsWith("OPEN_")||!this.driver[s])throw new Error(`flag ${s} not supported by node-sqlite3`);n=n|this.driver[s]})}let i=new this.driver.Database(this.connectionSettings.filename,n,s=>{if(s)return t(s);e(i)})})}async destroyRawConnection(e){return fJ(n=>e.close(n))()}_query(e,t){if(!t.sql)throw new Error("The query is empty");let{method:n}=t,i;switch(n){case"insert":case"update":i=t.returning?"all":"run";break;case"counter":case"del":i="run";break;default:i="all"}return new Promise(function(s,o){if(!e||!e[i])return o(new Error(`Error calling ${i} on connection.`));e[i](t.sql,t.bindings,function(a,u){return a?o(a):(t.response=u,t.context=this,s(t))})})}_stream(e,t,n){if(!t.sql)throw new Error("The query is empty");let i=this;return new Promise(function(s,o){return n.on("error",o),n.on("end",s),i._query(e,t).then(a=>a.response).then(a=>a.forEach(u=>n.write(u))).catch(function(a){n.emit("error",a)}).then(function(){n.end()})})}processResponse(e,t){let n=e.context,{response:i,returning:s}=e;if(e.output)return e.output.call(t,i);switch(e.method){case"select":return i;case"first":return i[0];case"pluck":return hJ(i,e.pluck);case"insert":return s&&i?i:[n.lastID];case"update":return s&&i?i:n.changes;case"del":case"counter":return n.changes;default:return i}}poolDefaults(){return cJ({min:1,max:1},super.poolDefaults())}formatter(e){return new EJ(this,e)}values(e,t,n){return Array.isArray(e)?Array.isArray(e[0])?`( values ${e.map(i=>`(${this.parameterize(i,void 0,t,n)})`).join(", ")})`:`(${this.parameterize(e,void 0,t,n)})`:e instanceof pJ?`(${this.parameter(e,t,n)})`:this.parameter(e,t,n)}};Object.assign(ki.prototype,{dialect:"sqlite3",driverName:"sqlite3"});YE.exports=ki});var ZE=l((zne,XE)=>{var vJ=au(),Mi=class extends vJ{_driver(){return require("better-sqlite3")}async acquireRawConnection(){return new this.driver(this.connectionSettings.filename)}async destroyRawConnection(e){return e.close()}async _query(e,t){if(!t.sql)throw new Error("The query is empty");if(!e)throw new Error("No connection provided");let n=e.prepare(t.sql),i=this._formatBindings(t.bindings);if(n.reader){let o=await n.all(i);return t.response=o,t}let s=await n.run(i);return t.response=s,t.context={lastID:s.lastInsertRowid,changes:s.changes},t}_formatBindings(e){return e?e.map(t=>t instanceof Date?t.valueOf():typeof t=="boolean"?Number(t):t):[]}};Object.assign(Mi.prototype,{driverName:"better-sqlite3"});XE.exports=Mi});var lu=l((Jne,eC)=>{var xJ=Se(),uu=class extends xJ{begin(e){return this.isolationLevel?this.query(e,`BEGIN ISOLATION LEVEL ${this.isolationLevel};`):this.query(e,"BEGIN;")}};eC.exports=uu});var Bi=l((Kne,sC)=>{var tC=z(),TJ=Yt(),AJ=Ve(),{wrapString:rC,columnize:nC,operator:SJ,wrap:iC}=F(),cu=class extends AJ{constructor(e,t,n){super(e,t,n),this._defaultInsertValue="default"}truncate(){return`truncate ${this.tableName} restart identity`}insert(){let e=super.insert();if(e==="")return e;let{returning:t,onConflict:n,ignore:i,merge:s,insert:o}=this.single;if(n&&i&&(e+=this._ignore(n)),n&&s){e+=this._merge(s.updates,n,o);let a=this.where();a&&(e+=` ${a}`)}return t&&(e+=this._returning(t)),{sql:e,returning:t}}update(){let e=this.with(),t=this._prepUpdate(this.single.update),n=this.where(),{returning:i}=this.single;return{sql:e+`update ${this.single.only?"only ":""}${this.tableName} set ${t.join(", ")}`+(n?` ${n}`:"")+this._returning(i),returning:i}}using(){let e=this.single.using;if(!e)return;let t="using ";return Array.isArray(e)?t+=e.map(n=>this.formatter.wrap(n)).join(","):t+=this.formatter.wrap(e),t}del(){let{tableName:e}=this,t=this.with(),n=this.where()||"",i=this.using()||"",s=this.grouped.join,o=[];if(Array.isArray(s)){for(let c of s){o.push(iC(this._joinTable(c),void 0,this.builder,this.client,this.bindingsHolder));let h=[];for(let f of c.clauses)h.push(this.whereBasic({column:f.column,operator:"=",value:f.value,asColumn:!0}));h.length>0&&(n+=(n?" and ":"where ")+h.join(" and "))}o.length>0&&(i+=(i?",":"using ")+o.join(","))}let a=t+`delete from ${this.single.only?"only ":""}${e}`+(i?` ${i}`:"")+(n?` ${n}`:""),{returning:u}=this.single;return{sql:a+this._returning(u),returning:u}}aggregate(e){return this._aggregate(e,{distinctParentheses:!0})}_returning(e){return e?` returning ${this.formatter.columnize(e)}`:""}_ignore(e){return e===!0?" on conflict do nothing":` on conflict ${this._onConflictClause(e)} do nothing`}_merge(e,t,n){let i=` on conflict ${this._onConflictClause(t)} do update set `;if(e&&Array.isArray(e))return i+=e.map(s=>rC(s.split(".").pop(),this.formatter.builder,this.client,this.formatter)).map(s=>`${s} = excluded.${s}`).join(", "),i;if(e&&typeof e=="object"){let s=this._prepUpdate(e);return typeof s=="string"?i+=s:i+=s.join(","),i}else{let s=this._prepInsert(n);if(typeof s=="string")throw new Error("If using merge with a raw insert query, then updates must be provided");return i+=s.columns.map(o=>rC(o.split(".").pop(),this.builder,this.client)).map(o=>`${o} = excluded.${o}`).join(", "),i}}_tableNames(e){let t=this.single.schema,n=[];for(let i=0;i<e.length;i++){let s=e[i];s&&(t&&(s=`${t}.${s}`),n.push(this.formatter.wrap(s)))}return n.join(", ")}_lockingClause(e){let t=this.single.lockTables||[];return e+(t.length?" of "+this._tableNames(t):"")}_groupOrder(e,t){return super._groupOrderNulls(e,t)}forUpdate(){return this._lockingClause("for update")}forShare(){return this._lockingClause("for share")}forNoKeyUpdate(){return this._lockingClause("for no key update")}forKeyShare(){return this._lockingClause("for key share")}skipLocked(){return"skip locked"}noWait(){return"nowait"}columnInfo(){let e=this.single.columnInfo,t=this.single.schema,n=this.client.customWrapIdentifier(this.single.table,tC);t&&(t=this.client.customWrapIdentifier(t,tC));let i="select * from information_schema.columns where table_name = ? and table_catalog = current_database()",s=[n];return this._buildColumnInfoQuery(t,i,s,e)}_buildColumnInfoQuery(e,t,n,i){return e?(t+=" and table_schema = ?",n.push(e)):t+=" and table_schema = current_schema()",{sql:t,bindings:n,output(s){let o=TJ(s.rows,function(a,u){return a[u.column_name]={type:u.data_type,maxLength:u.character_maximum_length,nullable:u.is_nullable==="YES",defaultValue:u.column_default},a},{});return i&&o[i]||o}}}distinctOn(e){return"distinct on ("+this.formatter.columnize(e)+") "}jsonExtract(e){return this._jsonExtract("jsonb_path_query",e)}jsonSet(e){return this._jsonSet("jsonb_set",Object.assign({},e,{path:this.client.toPathForJson(e.path)}))}jsonInsert(e){return this._jsonSet("jsonb_insert",Object.assign({},e,{path:this.client.toPathForJson(e.path)}))}jsonRemove(e){let t=`${nC(e.column,this.builder,this.client,this.bindingsHolder)} #- ${this.client.parameter(this.client.toPathForJson(e.path),this.builder,this.bindingsHolder)}`;return e.alias?this.client.alias(t,this.formatter.wrap(e.alias)):t}whereJsonPath(e){let t="";return!isNaN(e.value)&&parseInt(e.value)?t="::int":!isNaN(e.value)&&parseFloat(e.value)?t="::float":t=" #>> '{}'",`jsonb_path_query_first(${this._columnClause(e)}, ${this.client.parameter(e.jsonPath,this.builder,this.bindingsHolder)})${t} ${SJ(e.operator,this.builder,this.client,this.bindingsHolder)} ${this._jsonValueClause(e)}`}whereJsonSupersetOf(e){return this._not(e,`${iC(e.column,void 0,this.builder,this.client,this.bindingsHolder)} @> ${this._jsonValueClause(e)}`)}whereJsonSubsetOf(e){return this._not(e,`${nC(e.column,this.builder,this.client,this.bindingsHolder)} <@ ${this._jsonValueClause(e)}`)}onJsonPathEquals(e){return this._onJsonPathEquals("jsonb_path_query_first",e)}};sC.exports=cu});var aC=l((Xne,oC)=>{var NJ=Oe();oC.exports=class extends NJ{using(e){return this._single.using=e,this}withMaterialized(e,t,n){return this._validateWithArgs(e,t,n,"with"),this.withWrapped(e,t,n,!0)}withNotMaterialized(e,t,n){return this._validateWithArgs(e,t,n,"with"),this.withWrapped(e,t,n,!1)}}});var ji=l((Zne,cC)=>{var OJ=Ge(),{isObject:RJ}=A(),{toNumber:uC}=D(),IJ=/(?<!')'(?!')/g,Ee=class extends OJ{constructor(e,t,n){super(e,t,n),this.modifiers=["nullable","defaultTo","comment"],this._addCheckModifiers()}bit(e){return e.length!==!1?`bit(${e.length})`:"bit"}enu(e,t){t=t||{};let n=t.useNative&&t.existingType?void 0:e.join("', '");if(t.useNative){let i="",s=t.schemaName||this.tableCompiler.schemaNameRaw;return s&&(i+=`"${s}".`),i+=`"${t.enumName}"`,t.existingType||this.tableCompiler.unshiftQuery(`create type ${i} as enum ('${n}')`),i}return`text check (${this.formatter.wrap(this.args[0])} in ('${n}'))`}decimal(e,t){return e===null?"decimal":`decimal(${uC(e,8)}, ${uC(t,2)})`}json(e){return e&&this.client.logger.deprecate("json(true)","jsonb()"),lC(this.client,e)}jsonb(){return lC(this.client,!0)}checkRegex(e,t){return this._check(`${this.formatter.wrap(this.getColumnName())} ~ ${this.client._escapeBinding(e)}`,t)}datetime(e=!1,t){let n;return RJ(e)?{useTz:n,precision:t}=e:n=!e,n=typeof n=="boolean"?n:!0,t=t!=null?"("+t+")":"",`${n?"timestamptz":"timestamp"}${t}`}timestamp(e=!1,t){return this.datetime(e,t)}comment(e){let t=this.args[0]||this.defaults("columnName"),n=e?`'${e.replace(IJ,"''")}'`:"NULL";this.pushAdditional(function(){this.pushQuery(`comment on column ${this.tableCompiler.tableName()}.`+this.formatter.wrap(t)+` is ${n}`)},e)}increments(e={primaryKey:!0}){return"serial"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")}bigincrements(e={primaryKey:!0}){return"bigserial"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")}uuid(e={primaryKey:!1}){return"uuid"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")}};Ee.prototype.bigint="bigint";Ee.prototype.binary="bytea";Ee.prototype.bool="boolean";Ee.prototype.double="double precision";Ee.prototype.floating="real";Ee.prototype.smallint="smallint";Ee.prototype.tinyint="smallint";function lC(r,e){return!r.version||r.config.client==="cockroachdb"||r.config.jsonbSupport===!0||parseFloat(r.version)>=9.2?e?"jsonb":"json":"text"}cC.exports=Ee});var Fi=l((eie,hC)=>{var $J=en(),PJ=bt(),{isObject:Di,isString:LJ}=A(),hu=class extends PJ{constructor(e,t){super(e,t)}renameColumn(e,t){return this.pushQuery({sql:`alter table ${this.tableName()} rename ${this.formatter.wrap(e)} to ${this.formatter.wrap(t)}`})}_setNullableState(e,t){let n=t?"drop not null":"set not null",i=`alter table ${this.tableName()} alter column ${this.formatter.wrap(e)} ${n}`;return this.pushQuery({sql:i})}compileAdd(e){let t=this.formatter.wrap(e),n=this.prefixArray("add column",this.getColumns(e));return this.pushQuery({sql:`alter table ${t} ${n.join(", ")}`})}createQuery(e,t,n){let i=t?"create table if not exists ":"create table ",s=` (${e.sql.join(", ")}${this.primaryKeys()||""}${this._addChecks()})`,o=i+this.tableName()+(n&&this.tableNameLike()?" (like "+this.tableNameLike()+" including all"+(e.sql.length?", "+e.sql.join(", "):"")+")":s);this.single.inherits&&(o+=` inherits (${this.formatter.wrap(this.single.inherits)})`),this.pushQuery({sql:o,bindings:e.bindings}),$J(this.single,"comment")&&this.comment(this.single.comment)}primaryKeys(){let e=(this.grouped.alterTable||[]).filter(t=>t.method==="primary");if(e.length>0&&e[0].args.length>0){let t=e[0].args[0],n=e[0].args[1]||"",i;return Di(n)&&({constraintName:n,deferrable:i}=n),i=i?` deferrable initially ${i}`:"",n=n?this.formatter.wrap(n):this.formatter.wrap(`${this.tableNameRaw}_pkey`),`, constraint ${n} primary key (${this.formatter.columnize(t)})${i}`}}addColumns(e,t,n){if(t===this.alterColumnsPrefix)for(let i of n)this._addColumn(i);else super.addColumns(e,t)}_addColumn(e){let t=this.tableName(),n=e.getColumnType(),i=this.client.wrapIdentifier(e.getColumnName(),e.columnBuilder.queryContext()),s=e.type==="enu";this.pushQuery({sql:`alter table ${t} alter column ${i} drop default`,bindings:[]});let o=e.columnBuilder.alterNullable;o&&this.pushQuery({sql:`alter table ${t} alter column ${i} drop not null`,bindings:[]}),e.columnBuilder.alterType&&this.pushQuery({sql:`alter table ${t} alter column ${i} type ${n} using (${i}${s?"::text::":"::"}${n})`,bindings:[]});let u=e.modified.defaultTo;if(u){let c=e.defaultTo.apply(e,u);this.pushQuery({sql:`alter table ${t} alter column ${i} set ${c}`,bindings:[]})}if(o){let c=e.modified.nullable;c&&c[0]===!1&&this.pushQuery({sql:`alter table ${t} alter column ${i} set not null`,bindings:[]})}}comment(e){this.pushQuery(`comment on table ${this.tableName()} is '${this.single.comment}'`)}primary(e,t){let n;Di(t)&&({constraintName:t,deferrable:n}=t),n=n?` deferrable initially ${n}`:"",t=t?this.formatter.wrap(t):this.formatter.wrap(`${this.tableNameRaw}_pkey`),this.method!=="create"&&this.method!=="createIfNot"&&this.pushQuery(`alter table ${this.tableName()} add constraint ${t} primary key (${this.formatter.columnize(e)})${n}`)}unique(e,t){let n,i=!0,s;if(Di(t)&&({indexName:t,deferrable:n,useConstraint:i,predicate:s}=t,i===void 0&&(i=!!n||!s)),!i&&n&&n!=="not deferrable")throw new Error("postgres cannot create deferrable index");if(i&&s)throw new Error("postgres cannot create constraint with predicate");if(n=n?` deferrable initially ${n}`:"",t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),i)this.pushQuery(`alter table ${this.tableName()} add constraint ${t} unique (`+this.formatter.columnize(e)+")"+n);else{let o=s?" "+this.client.queryCompiler(s).where():"";this.pushQuery(`create unique index ${t} on ${this.tableName()} (${this.formatter.columnize(e)})${o}`)}}index(e,t,n){t=t?this.formatter.wrap(t):this._indexCommand("index",this.tableNameRaw,e);let i,s;LJ(n)?s=n:Di(n)&&({indexType:s,predicate:i}=n);let o=i?" "+this.client.queryCompiler(i).where():"";this.pushQuery(`create index ${t} on ${this.tableName()}${s&&` using ${s}`||""} (`+this.formatter.columnize(e)+`)${o}`)}dropPrimary(e){e=e?this.formatter.wrap(e):this.formatter.wrap(this.tableNameRaw+"_pkey"),this.pushQuery(`alter table ${this.tableName()} drop constraint ${e}`)}dropIndex(e,t){t=t?this.formatter.wrap(t):this._indexCommand("index",this.tableNameRaw,e),t=this.schemaNameRaw?`${this.formatter.wrap(this.schemaNameRaw)}.${t}`:t,this.pushQuery(`drop index ${t}`)}dropUnique(e,t){t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),this.pushQuery(`alter table ${this.tableName()} drop constraint ${t}`)}dropForeign(e,t){t=t?this.formatter.wrap(t):this._indexCommand("foreign",this.tableNameRaw,e),this.pushQuery(`alter table ${this.tableName()} drop constraint ${t}`)}};hC.exports=hu});var Qi=l((tie,fC)=>{var kJ=_t(),fu=class extends kJ{constructor(e,t){super(e,t)}renameColumn(e,t){return this.pushQuery({sql:`alter view ${this.viewName()} rename ${this.formatter.wrap(e)} to ${this.formatter.wrap(t)}`})}defaultTo(e,t){return this.pushQuery({sql:`alter view ${this.viewName()} alter ${this.formatter.wrap(e)} set default ${t}`})}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}createMaterializedView(){this.createQuery(this.columns,this.selectQuery,!0)}};fC.exports=fu});var pC=l((rie,dC)=>{var MJ=rr(),du=class extends MJ{constructor(){super(...arguments)}checkOption(){this._single.checkOption="default_option"}localCheckOption(){this._single.checkOption="local"}cascadedCheckOption(){this._single.checkOption="cascaded"}};dC.exports=du});var mu=l((nie,mC)=>{var BJ=yt(),pu=class extends BJ{constructor(e,t){super(e,t)}hasTable(e){let t="select * from information_schema.tables where table_name = ?",n=[e];this.schema?(t+=" and table_schema = ?",n.push(this.schema)):t+=" and table_schema = current_schema()",this.pushQuery({sql:t,bindings:n,output(i){return i.rows.length>0}})}hasColumn(e,t){let n="select * from information_schema.columns where table_name = ? and column_name = ?",i=[e,t];this.schema?(n+=" and table_schema = ?",i.push(this.schema)):n+=" and table_schema = current_schema()",this.pushQuery({sql:n,bindings:i,output(s){return s.rows.length>0}})}qualifiedTableName(e){let t=this.schema?`${this.schema}.${e}`:e;return this.formatter.wrap(t)}renameTable(e,t){this.pushQuery(`alter table ${this.qualifiedTableName(e)} rename to ${this.formatter.wrap(t)}`)}createSchema(e){this.pushQuery(`create schema ${this.formatter.wrap(e)}`)}createSchemaIfNotExists(e){this.pushQuery(`create schema if not exists ${this.formatter.wrap(e)}`)}dropSchema(e,t=!1){this.pushQuery(`drop schema ${this.formatter.wrap(e)}${t?" cascade":""}`)}dropSchemaIfExists(e,t=!1){this.pushQuery(`drop schema if exists ${this.formatter.wrap(e)}${t?" cascade":""}`)}dropExtension(e){this.pushQuery(`drop extension ${this.formatter.wrap(e)}`)}dropExtensionIfExists(e){this.pushQuery(`drop extension if exists ${this.formatter.wrap(e)}`)}createExtension(e){this.pushQuery(`create extension ${this.formatter.wrap(e)}`)}createExtensionIfNotExists(e){this.pushQuery(`create extension if not exists ${this.formatter.wrap(e)}`)}renameView(e,t){this.pushQuery(this.alterViewPrefix+`${this.formatter.wrap(e)} rename to ${this.formatter.wrap(t)}`)}refreshMaterializedView(e,t=!1){this.pushQuery({sql:`refresh materialized view${t?" concurrently":""} ${this.formatter.wrap(e)}`})}dropMaterializedView(e){this._dropView(e,!1,!0)}dropMaterializedViewIfExists(e){this._dropView(e,!0,!0)}};mC.exports=pu});var gu=l(gC=>{"use strict";gC.parse=function(r,e){return new cn(r,e).parse()};var cn=class{constructor(e,t){this.source=e,this.transform=t||jJ,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(this.recorded.length>0||e)&&(t=this.recorded.join(""),t==="NULL"&&!e&&(t=null),t!==null&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var t,n,i;for(this.consumeDimensions();!this.isEof();)if(t=this.nextCharacter(),t.value==="{"&&!i)this.dimension++,this.dimension>1&&(n=new cn(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(t.value==="}"&&!i){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else t.value==='"'&&!t.escaped?(i&&this.newEntry(!0),i=!i):t.value===","&&!i?this.newEntry():this.record(t.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function jJ(r){return r}});var yu=l((sie,yC)=>{var DJ=gu();yC.exports={create:function(r,e){return{parse:function(){return DJ.parse(r,e)}}}}});var _C=l((oie,wC)=>{"use strict";var FJ=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,QJ=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,UJ=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,HJ=/^-?infinity$/;wC.exports=function(e){if(HJ.test(e))return Number(e.replace("i","I"));var t=FJ.exec(e);if(!t)return WJ(e)||null;var n=!!t[8],i=parseInt(t[1],10);n&&(i=bC(i));var s=parseInt(t[2],10)-1,o=t[3],a=parseInt(t[4],10),u=parseInt(t[5],10),c=parseInt(t[6],10),h=t[7];h=h?1e3*parseFloat(h):0;var f,d=VJ(e);return d!=null?(f=new Date(Date.UTC(i,s,o,a,u,c,h)),bu(i)&&f.setUTCFullYear(i),d!==0&&f.setTime(f.getTime()-d)):(f=new Date(i,s,o,a,u,c,h),bu(i)&&f.setFullYear(i)),f};function WJ(r){var e=QJ.exec(r);if(e){var t=parseInt(e[1],10),n=!!e[4];n&&(t=bC(t));var i=parseInt(e[2],10)-1,s=e[3],o=new Date(t,i,s);return bu(t)&&o.setFullYear(t),o}}function VJ(r){if(r.endsWith("+00"))return 0;var e=UJ.exec(r.split(" ")[1]);if(e){var t=e[1];if(t==="Z")return 0;var n=t==="-"?-1:1,i=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return i*n*1e3}}function bC(r){return-(r-1)}function bu(r){return r>=0&&r<100}});var EC=l((aie,qC)=>{qC.exports=zJ;var GJ=Object.prototype.hasOwnProperty;function zJ(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)GJ.call(t,n)&&(r[n]=t[n])}return r}});var xC=l((uie,vC)=>{"use strict";var JJ=EC();vC.exports=sr;function sr(r){if(!(this instanceof sr))return new sr(r);JJ(this,aK(r))}var KJ=["seconds","minutes","hours","days","months","years"];sr.prototype.toPostgres=function(){var r=KJ.filter(this.hasOwnProperty,this);return this.milliseconds&&r.indexOf("seconds")<0&&r.push("seconds"),r.length===0?"0":r.map(function(e){var t=this[e]||0;return e==="seconds"&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),t+" "+e},this).join(" ")};var YJ={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},XJ=["years","months","days"],ZJ=["hours","minutes","seconds"];sr.prototype.toISOString=sr.prototype.toISO=function(){var r=XJ.map(t,this).join(""),e=ZJ.map(t,this).join("");return"P"+r+"T"+e;function t(n){var i=this[n]||0;return n==="seconds"&&this.milliseconds&&(i=(i+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),i+YJ[n]}};var wu="([+-]?\\d+)",eK=wu+"\\s+years?",tK=wu+"\\s+mons?",rK=wu+"\\s+days?",nK="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",iK=new RegExp([eK,tK,rK,nK].map(function(r){return"("+r+")?"}).join("\\s*")),CC={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},sK=["hours","minutes","seconds","milliseconds"];function oK(r){var e=r+"000000".slice(r.length);return parseInt(e,10)/1e3}function aK(r){if(!r)return{};var e=iK.exec(r),t=e[8]==="-";return Object.keys(CC).reduce(function(n,i){var s=CC[i],o=e[s];return!o||(o=i==="milliseconds"?oK(o):parseInt(o,10),!o)||(t&&~sK.indexOf(i)&&(o*=-1),n[i]=o),n},{})}});var AC=l((lie,TC)=>{"use strict";TC.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var t="",n=0;n<e.length;)if(e[n]!=="\\")t+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))t+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var i=1;n+i<e.length&&e[n+i]==="\\";)i++;for(var s=0;s<Math.floor(i/2);++s)t+="\\";n+=Math.floor(i/2)*2}return new Buffer(t,"binary")}});var PC=l((cie,$C)=>{var hn=gu(),fn=yu(),Ui=_C(),NC=xC(),OC=AC();function Hi(r){return function(t){return t===null?t:r(t)}}function RC(r){return r===null?r:r==="TRUE"||r==="t"||r==="true"||r==="y"||r==="yes"||r==="on"||r==="1"}function uK(r){return r?hn.parse(r,RC):null}function lK(r){return parseInt(r,10)}function _u(r){return r?hn.parse(r,Hi(lK)):null}function cK(r){return r?hn.parse(r,Hi(function(e){return IC(e).trim()})):null}var hK=function(r){if(!r)return null;var e=fn.create(r,function(t){return t!==null&&(t=vu(t)),t});return e.parse()},qu=function(r){if(!r)return null;var e=fn.create(r,function(t){return t!==null&&(t=parseFloat(t)),t});return e.parse()},le=function(r){if(!r)return null;var e=fn.create(r);return e.parse()},Eu=function(r){if(!r)return null;var e=fn.create(r,function(t){return t!==null&&(t=Ui(t)),t});return e.parse()},fK=function(r){if(!r)return null;var e=fn.create(r,function(t){return t!==null&&(t=NC(t)),t});return e.parse()},dK=function(r){return r?hn.parse(r,Hi(OC)):null},Cu=function(r){return parseInt(r,10)},IC=function(r){var e=String(r);return/^\d+$/.test(e)?e:r},SC=function(r){return r?hn.parse(r,Hi(JSON.parse)):null},vu=function(r){return r[0]!=="("?null:(r=r.substring(1,r.length-1).split(","),{x:parseFloat(r[0]),y:parseFloat(r[1])})},pK=function(r){if(r[0]!=="<"&&r[1]!=="(")return null;for(var e="(",t="",n=!1,i=2;i<r.length-1;i++){if(n||(e+=r[i]),r[i]===")"){n=!0;continue}else if(!n)continue;r[i]!==","&&(t+=r[i])}var s=vu(e);return s.radius=parseFloat(t),s},mK=function(r){r(20,IC),r(21,Cu),r(23,Cu),r(26,Cu),r(700,parseFloat),r(701,parseFloat),r(16,RC),r(1082,Ui),r(1114,Ui),r(1184,Ui),r(600,vu),r(651,le),r(718,pK),r(1e3,uK),r(1001,dK),r(1005,_u),r(1007,_u),r(1028,_u),r(1016,cK),r(1017,hK),r(1021,qu),r(1022,qu),r(1231,qu),r(1014,le),r(1015,le),r(1008,le),r(1009,le),r(1040,le),r(1041,le),r(1115,Eu),r(1182,Eu),r(1185,Eu),r(1186,NC),r(1187,fK),r(17,OC),r(114,JSON.parse.bind(JSON)),r(3802,JSON.parse.bind(JSON)),r(199,SC),r(3807,SC),r(3907,le),r(2951,le),r(791,le),r(1183,le),r(1270,le)};$C.exports={init:mK}});var kC=l((hie,LC)=>{"use strict";var Y=1e6;function gK(r){var e=r.readInt32BE(0),t=r.readUInt32BE(4),n="";e<0&&(e=~e+(t===0),t=~t+1>>>0,n="-");var i="",s,o,a,u,c,h;{if(s=e%Y,e=e/Y>>>0,o=4294967296*s+t,t=o/Y>>>0,a=""+(o-Y*t),t===0&&e===0)return n+a+i;for(u="",c=6-a.length,h=0;h<c;h++)u+="0";i=u+a+i}{if(s=e%Y,e=e/Y>>>0,o=4294967296*s+t,t=o/Y>>>0,a=""+(o-Y*t),t===0&&e===0)return n+a+i;for(u="",c=6-a.length,h=0;h<c;h++)u+="0";i=u+a+i}{if(s=e%Y,e=e/Y>>>0,o=4294967296*s+t,t=o/Y>>>0,a=""+(o-Y*t),t===0&&e===0)return n+a+i;for(u="",c=6-a.length,h=0;h<c;h++)u+="0";i=u+a+i}return s=e%Y,o=4294967296*s+t,a=""+o%Y,n+a+i}LC.exports=gK});var FC=l((fie,DC)=>{var yK=kC(),$=function(r,e,t,n,i){t=t||0,n=n||!1,i=i||function(g,m,y){return g*Math.pow(2,y)+m};var s=t>>3,o=function(g){return n?~g&255:g},a=255,u=8-t%8;e<u&&(a=255<<8-e&255,u=e),t&&(a=a>>t%8);var c=0;t%8+e>=8&&(c=i(0,o(r[s])&a,u));for(var h=e+t>>3,f=s+1;f<h;f++)c=i(c,o(r[f]),8);var d=(e+t)%8;return d>0&&(c=i(c,o(r[h])>>8-d,d)),c},jC=function(r,e,t){var n=Math.pow(2,t-1)-1,i=$(r,1),s=$(r,t,1);if(s===0)return 0;var o=1,a=function(c,h,f){c===0&&(c=1);for(var d=1;d<=f;d++)o/=2,(h&1<<f-d)>0&&(c+=o);return c},u=$(r,e,t+1,!1,a);return s==Math.pow(2,t+1)-1?u===0?i===0?1/0:-1/0:NaN:(i===0?1:-1)*Math.pow(2,s-n)*u},bK=function(r){return $(r,1)==1?-1*($(r,15,1,!0)+1):$(r,15,1)},MC=function(r){return $(r,1)==1?-1*($(r,31,1,!0)+1):$(r,31,1)},wK=function(r){return jC(r,23,8)},_K=function(r){return jC(r,52,11)},qK=function(r){var e=$(r,16,32);if(e==49152)return NaN;for(var t=Math.pow(1e4,$(r,16,16)),n=0,i=[],s=$(r,16),o=0;o<s;o++)n+=$(r,16,64+16*o)*t,t/=1e4;var a=Math.pow(10,$(r,16,48));return(e===0?1:-1)*Math.round(n*a)/a},BC=function(r,e){var t=$(e,1),n=$(e,63,1),i=new Date((t===0?1:-1)*n/1e3+9466848e5);return r||i.setTime(i.getTime()+i.getTimezoneOffset()*6e4),i.usec=n%1e3,i.getMicroSeconds=function(){return this.usec},i.setMicroSeconds=function(s){this.usec=s},i.getUTCMicroSeconds=function(){return this.usec},i},dn=function(r){for(var e=$(r,32),t=$(r,32,32),n=$(r,32,64),i=96,s=[],o=0;o<e;o++)s[o]=$(r,32,i),i+=32,i+=32;var a=function(c){var h=$(r,32,i);if(i+=32,h==4294967295)return null;var f;if(c==23||c==20)return f=$(r,h*8,i),i+=h*8,f;if(c==25)return f=r.toString(this.encoding,i>>3,(i+=h<<3)>>3),f;console.log("ERROR: ElementType not implemented: "+c)},u=function(c,h){var f=[],d;if(c.length>1){var g=c.shift();for(d=0;d<g;d++)f[d]=u(c,h);c.unshift(g)}else for(d=0;d<c[0];d++)f[d]=a(h);return f};return u(s,n)},EK=function(r){return r.toString("utf8")},CK=function(r){return r===null?null:$(r,8)>0},vK=function(r){r(20,yK),r(21,bK),r(23,MC),r(26,MC),r(1700,qK),r(700,wK),r(701,_K),r(16,CK),r(1114,BC.bind(null,!1)),r(1184,BC.bind(null,!0)),r(1e3,dn),r(1007,dn),r(1016,dn),r(1008,dn),r(1009,dn),r(25,EK)};DC.exports={init:vK}});var UC=l((die,QC)=>{QC.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var gn=l(mn=>{var xK=PC(),TK=FC(),AK=yu(),SK=UC();mn.getTypeParser=NK;mn.setTypeParser=OK;mn.arrayParser=AK;mn.builtins=SK;var pn={text:{},binary:{}};function HC(r){return String(r)}function NK(r,e){return e=e||"text",pn[e]&&pn[e][r]||HC}function OK(r,e,t){typeof e=="function"&&(t=e,e="text"),pn[e][r]=t}xK.init(function(r,e){pn.text[r]=e});TK.init(function(r,e){pn.binary[r]=e})});var yn=l((mie,xu)=>{"use strict";xu.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var or=gn(),RK=or.getTypeParser(20,"text"),IK=or.getTypeParser(1016,"text");xu.exports.__defineSetter__("parseInt8",function(r){or.setTypeParser(20,"text",r?or.getTypeParser(23,"text"):RK),or.setTypeParser(1016,"text",r?or.getTypeParser(1007,"text"):IK)})});var Vi=l((gie,VC)=>{"use strict";var $K=require("crypto"),PK=yn();function LK(r){var e=r.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}function WC(r){for(var e="{",t=0;t<r.length;t++)t>0&&(e=e+","),r[t]===null||typeof r[t]>"u"?e=e+"NULL":Array.isArray(r[t])?e=e+WC(r[t]):r[t]instanceof Buffer?e+="\\\\x"+r[t].toString("hex"):e+=LK(Wi(r[t]));return e=e+"}",e}var Wi=function(r,e){if(r==null)return null;if(r instanceof Buffer)return r;if(ArrayBuffer.isView(r)){var t=Buffer.from(r.buffer,r.byteOffset,r.byteLength);return t.length===r.byteLength?t:t.slice(r.byteOffset,r.byteOffset+r.byteLength)}return r instanceof Date?PK.parseInputDatesAsUTC?BK(r):MK(r):Array.isArray(r)?WC(r):typeof r=="object"?kK(r,e):r.toString()};function kK(r,e){if(r&&typeof r.toPostgres=="function"){if(e=e||[],e.indexOf(r)!==-1)throw new Error('circular reference detected while preparing "'+r+'" for query');return e.push(r),Wi(r.toPostgres(Wi),e)}return JSON.stringify(r)}function V(r,e){for(r=""+r;r.length<e;)r="0"+r;return r}function MK(r){var e=-r.getTimezoneOffset(),t=r.getFullYear(),n=t<1;n&&(t=Math.abs(t)+1);var i=V(t,4)+"-"+V(r.getMonth()+1,2)+"-"+V(r.getDate(),2)+"T"+V(r.getHours(),2)+":"+V(r.getMinutes(),2)+":"+V(r.getSeconds(),2)+"."+V(r.getMilliseconds(),3);return e<0?(i+="-",e*=-1):i+="+",i+=V(Math.floor(e/60),2)+":"+V(e%60,2),n&&(i+=" BC"),i}function BK(r){var e=r.getUTCFullYear(),t=e<1;t&&(e=Math.abs(e)+1);var n=V(e,4)+"-"+V(r.getUTCMonth()+1,2)+"-"+V(r.getUTCDate(),2)+"T"+V(r.getUTCHours(),2)+":"+V(r.getUTCMinutes(),2)+":"+V(r.getUTCSeconds(),2)+"."+V(r.getUTCMilliseconds(),3);return n+="+00:00",t&&(n+=" BC"),n}function jK(r,e,t){return r=typeof r=="string"?{text:r}:r,e&&(typeof e=="function"?r.callback=e:r.values=e),t&&(r.callback=t),r}var Tu=function(r){return $K.createHash("md5").update(r,"utf-8").digest("hex")},DK=function(r,e,t){var n=Tu(e+r),i=Tu(Buffer.concat([Buffer.from(n),t]));return"md5"+i};VC.exports={prepareValue:function(e){return Wi(e)},normalizeQueryConfig:jK,postgresMd5PasswordHash:DK,md5:Tu}});var KC=l((yie,JC)=>{"use strict";var zi=require("crypto");function FK(r){if(r.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=zi.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}function QK(r,e,t){if(r.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=WK(t);if(n.nonce.startsWith(r.clientNonce)){if(n.nonce.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var i=Buffer.from(n.salt,"base64"),s=zi.pbkdf2Sync(e,i,n.iteration,32,"sha256"),o=Gi(s,"Client Key"),a=zK(o),u="n=*,r="+r.clientNonce,c="r="+n.nonce+",s="+n.salt+",i="+n.iteration,h="c=biws,r="+n.nonce,f=u+","+c+","+h,d=Gi(a,f),g=GK(o,d),m=g.toString("base64"),y=Gi(s,"Server Key"),_=Gi(y,f);r.message="SASLResponse",r.serverSignature=_.toString("base64"),r.response=h+",p="+m}function UK(r,e){if(r.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:t}=VK(e);if(t!==r.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function HK(r){if(typeof r!="string")throw new TypeError("SASL: text must be a string");return r.split("").map((e,t)=>r.charCodeAt(t)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function GC(r){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(r)}function zC(r){if(typeof r!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(r.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let t=e[0],n=e.substring(2);return[t,n]}))}function WK(r){let e=zC(r),t=e.get("r");if(t){if(!HK(t))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!GC(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let i=e.get("i");if(i){if(!/^[1-9][0-9]*$/.test(i))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let s=parseInt(i,10);return{nonce:t,salt:n,iteration:s}}function VK(r){let t=zC(r).get("v");if(t){if(!GC(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function GK(r,e){if(!Buffer.isBuffer(r))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(r.length!==e.length)throw new Error("Buffer lengths must match");if(r.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(r.map((t,n)=>r[n]^e[n]))}function zK(r){return zi.createHash("sha256").update(r).digest()}function Gi(r,e){return zi.createHmac("sha256",r).update(e).digest()}JC.exports={startSession:FK,continueSession:QK,finalizeSession:UK}});var ev=l((bie,ZC)=>{"use strict";var{Transform:JK}=require("stream"),{StringDecoder:KK}=require("string_decoder"),Ke=Symbol("last"),Ji=Symbol("decoder");function YK(r,e,t){let n;if(this.overflow){if(n=this[Ji].write(r).split(this.matcher),n.length===1)return t();n.shift(),this.overflow=!1}else this[Ke]+=this[Ji].write(r),n=this[Ke].split(this.matcher);this[Ke]=n.pop();for(let i=0;i<n.length;i++)try{XC(this,this.mapper(n[i]))}catch(s){return t(s)}if(this.overflow=this[Ke].length>this.maxLength,this.overflow&&!this.skipOverflow){t(new Error("maximum buffer reached"));return}t()}function XK(r){if(this[Ke]+=this[Ji].end(),this[Ke])try{XC(this,this.mapper(this[Ke]))}catch(e){return r(e)}r()}function XC(r,e){e!==void 0&&r.push(e)}function YC(r){return r}function ZK(r,e,t){switch(r=r||/\r?\n/,e=e||YC,t=t||{},arguments.length){case 1:typeof r=="function"?(e=r,r=/\r?\n/):typeof r=="object"&&!(r instanceof RegExp)&&(t=r,r=/\r?\n/);break;case 2:typeof r=="function"?(t=e,e=r,r=/\r?\n/):typeof e=="object"&&(t=e,e=YC)}t=Object.assign({},t),t.autoDestroy=!0,t.transform=YK,t.flush=XK,t.readableObjectMode=!0;let n=new JK(t);return n[Ke]="",n[Ji]=new KK("utf8"),n.matcher=r,n.mapper=e,n.maxLength=t.maxLength,n.skipOverflow=t.skipOverflow||!1,n.overflow=!1,n._destroy=function(i,s){this._writableState.errorEmitted=!1,s(i)},n}ZC.exports=ZK});var nv=l((wie,$e)=>{"use strict";var tv=require("path"),e9=require("stream").Stream,t9=ev(),rv=require("util"),r9=5432,Ki=process.platform==="win32",bn=process.stderr,n9=56,i9=7,s9=61440,o9=32768;function a9(r){return(r&s9)==o9}var ar=["host","port","database","user","password"],Au=ar.length,u9=ar[Au-1];function Su(){var r=bn instanceof e9&&bn.writable===!0;if(r){var e=Array.prototype.slice.call(arguments).concat(`
`);bn.write(rv.format.apply(rv,e))}}Object.defineProperty($e.exports,"isWin",{get:function(){return Ki},set:function(r){Ki=r}});$e.exports.warnTo=function(r){var e=bn;return bn=r,e};$e.exports.getFileName=function(r){var e=r||process.env,t=e.PGPASSFILE||(Ki?tv.join(e.APPDATA||"./","postgresql","pgpass.conf"):tv.join(e.HOME||"./",".pgpass"));return t};$e.exports.usePgPass=function(r,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Ki?!0:(e=e||"<unkn>",a9(r.mode)?r.mode&(n9|i9)?(Su('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Su('WARNING: password file "%s" is not a plain file',e),!1))};var l9=$e.exports.match=function(r,e){return ar.slice(0,-1).reduce(function(t,n,i){return i==1&&Number(r[n]||r9)===Number(e[n])?t&&!0:t&&(e[n]==="*"||e[n]===r[n])},!0)};$e.exports.getPassword=function(r,e,t){var n,i=e.pipe(t9());function s(u){var c=c9(u);c&&h9(c)&&l9(r,c)&&(n=c[u9],i.end())}var o=function(){e.destroy(),t(n)},a=function(u){e.destroy(),Su("WARNING: error on reading file: %s",u),t(void 0)};e.on("error",a),i.on("data",s).on("end",o).on("error",a)};var c9=$e.exports.parseLine=function(r){if(r.length<11||r.match(/^\s+#/))return null;for(var e="",t="",n=0,i=0,s=0,o={},a=!1,u=function(h,f,d){var g=r.substring(f,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(g=g.replace(/\\([:\\])/g,"$1")),o[ar[h]]=g},c=0;c<r.length-1;c+=1){if(e=r.charAt(c+1),t=r.charAt(c),a=n==Au-1,a){u(n,i);break}c>=0&&e==":"&&t!=="\\"&&(u(n,i,c+1),i=c+2,n+=1)}return o=Object.keys(o).length===Au?o:null,o},h9=$e.exports.isValidEntry=function(r){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},t=0;t<ar.length;t+=1){var n=e[t],i=r[ar[t]]||"",s=n(i);if(!s)return!1}return!0}});var sv=l((qie,Nu)=>{"use strict";var _ie=require("path"),iv=require("fs"),Yi=nv();Nu.exports=function(r,e){var t=Yi.getFileName();iv.stat(t,function(n,i){if(n||!Yi.usePgPass(i,t))return e(void 0);var s=iv.createReadStream(t);Yi.getPassword(r,s,e)})};Nu.exports.warnTo=Yi.warnTo});var Ou=l((Eie,ov)=>{"use strict";var f9=gn();function Xi(r){this._types=r||f9,this.text={},this.binary={}}Xi.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}};Xi.prototype.setTypeParser=function(r,e,t){typeof e=="function"&&(t=e,e="text"),this.getOverrides(e)[r]=t};Xi.prototype.getTypeParser=function(r,e){return e=e||"text",this.getOverrides(e)[r]||this._types.getTypeParser(r,e)};ov.exports=Xi});var Iu=l((Cie,lv)=>{"use strict";var d9=require("dns"),uv=yn(),av=Va().parse,J=function(r,e,t){return t===void 0?t=process.env["PG"+r.toUpperCase()]:t===!1||(t=process.env[t]),e[r]||t||uv[r]},p9=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return uv.ssl},ur=function(r){return"'"+(""+r).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},ce=function(r,e,t){var n=e[t];n!=null&&r.push(t+"="+ur(n))},Ru=class{constructor(e){e=typeof e=="string"?av(e):e||{},e.connectionString&&(e=Object.assign({},e,av(e.connectionString))),this.user=J("user",e),this.database=J("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(J("port",e),10),this.host=J("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:J("password",e)}),this.binary=J("binary",e),this.options=J("options",e),this.ssl=typeof e.ssl>"u"?p9():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=J("client_encoding",e),this.replication=J("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=J("application_name",e,"PGAPPNAME"),this.fallback_application_name=J("fallback_application_name",e,!1),this.statement_timeout=J("statement_timeout",e,!1),this.lock_timeout=J("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=J("idle_in_transaction_session_timeout",e,!1),this.query_timeout=J("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var t=[];ce(t,this,"user"),ce(t,this,"password"),ce(t,this,"port"),ce(t,this,"application_name"),ce(t,this,"fallback_application_name"),ce(t,this,"connect_timeout"),ce(t,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(ce(t,n,"sslmode"),ce(t,n,"sslca"),ce(t,n,"sslkey"),ce(t,n,"sslcert"),ce(t,n,"sslrootcert"),this.database&&t.push("dbname="+ur(this.database)),this.replication&&t.push("replication="+ur(this.replication)),this.host&&t.push("host="+ur(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+ur(this.client_encoding)),d9.lookup(this.host,function(i,s){return i?e(i,null):(t.push("hostaddr="+ur(s)),e(null,t.join(" ")))})}};lv.exports=Ru});var fv=l((vie,hv)=>{"use strict";var m9=gn(),cv=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,$u=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(e){var t;e.text?t=cv.exec(e.text):t=cv.exec(e.command),t&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){for(var t=new Array(e.length),n=0,i=e.length;n<i;n++){var s=e[n];s!==null?t[n]=this._parsers[n](s):t[n]=null}return t}parseRow(e){for(var t={},n=0,i=e.length;n<i;n++){var s=e[n],o=this.fields[n].name;s!==null?t[o]=this._parsers[n](s):t[o]=null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var t=0;t<e.length;t++){var n=e[t];this._types?this._parsers[t]=this._types.getTypeParser(n.dataTypeID,n.format||"text"):this._parsers[t]=m9.getTypeParser(n.dataTypeID,n.format||"text")}}};hv.exports=$u});var gv=l((xie,mv)=>{"use strict";var{EventEmitter:g9}=require("events"),dv=fv(),pv=Vi(),Pu=class extends g9{constructor(e,t,n){super(),e=pv.normalizeQueryConfig(e,t,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new dv(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new dv(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(t){process.nextTick(()=>{throw t})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let t=e.parsedStatements[this.name];return this.text&&t&&this.text!==t?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.isPreparedStatement=!0,this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:pv.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};mv.exports=Pu});var Ju=l(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.NoticeMessage=q.DataRowMessage=q.CommandCompleteMessage=q.ReadyForQueryMessage=q.NotificationResponseMessage=q.BackendKeyDataMessage=q.AuthenticationMD5Password=q.ParameterStatusMessage=q.ParameterDescriptionMessage=q.RowDescriptionMessage=q.Field=q.CopyResponse=q.CopyDataMessage=q.DatabaseError=q.copyDone=q.emptyQuery=q.replicationStart=q.portalSuspended=q.noData=q.closeComplete=q.bindComplete=q.parseComplete=void 0;q.parseComplete={name:"parseComplete",length:5};q.bindComplete={name:"bindComplete",length:5};q.closeComplete={name:"closeComplete",length:5};q.noData={name:"noData",length:5};q.portalSuspended={name:"portalSuspended",length:5};q.replicationStart={name:"replicationStart",length:4};q.emptyQuery={name:"emptyQuery",length:4};q.copyDone={name:"copyDone",length:4};var Lu=class extends Error{constructor(e,t,n){super(e),this.length=t,this.name=n}};q.DatabaseError=Lu;var ku=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};q.CopyDataMessage=ku;var Mu=class{constructor(e,t,n,i){this.length=e,this.name=t,this.binary=n,this.columnTypes=new Array(i)}};q.CopyResponse=Mu;var Bu=class{constructor(e,t,n,i,s,o,a){this.name=e,this.tableID=t,this.columnID=n,this.dataTypeID=i,this.dataTypeSize=s,this.dataTypeModifier=o,this.format=a}};q.Field=Bu;var ju=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};q.RowDescriptionMessage=ju;var Du=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};q.ParameterDescriptionMessage=Du;var Fu=class{constructor(e,t,n){this.length=e,this.parameterName=t,this.parameterValue=n,this.name="parameterStatus"}};q.ParameterStatusMessage=Fu;var Qu=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};q.AuthenticationMD5Password=Qu;var Uu=class{constructor(e,t,n){this.length=e,this.processID=t,this.secretKey=n,this.name="backendKeyData"}};q.BackendKeyDataMessage=Uu;var Hu=class{constructor(e,t,n,i){this.length=e,this.processId=t,this.channel=n,this.payload=i,this.name="notification"}};q.NotificationResponseMessage=Hu;var Wu=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};q.ReadyForQueryMessage=Wu;var Vu=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};q.CommandCompleteMessage=Vu;var Gu=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};q.DataRowMessage=Gu;var zu=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};q.NoticeMessage=zu});var yv=l(Zi=>{"use strict";Object.defineProperty(Zi,"__esModule",{value:!0});Zi.Writer=void 0;var Ku=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var t=this.buffer.length-this.offset;if(t<e){var n=this.buffer,i=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(i),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var t=Buffer.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){var t=Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),t}};Zi.Writer=Ku});var wv=l(ts=>{"use strict";Object.defineProperty(ts,"__esModule",{value:!0});ts.serialize=void 0;var Yu=yv(),P=new Yu.Writer,y9=r=>{P.addInt16(3).addInt16(0);for(let n of Object.keys(r))P.addCString(n).addCString(r[n]);P.addCString("client_encoding").addCString("UTF8");var e=P.addCString("").flush(),t=e.length+4;return new Yu.Writer().addInt32(t).add(e).flush()},b9=()=>{let r=Buffer.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},w9=r=>P.addCString(r).flush(112),_9=function(r,e){return P.addCString(r).addInt32(Buffer.byteLength(e)).addString(e),P.flush(112)},q9=function(r){return P.addString(r).flush(112)},E9=r=>P.addCString(r).flush(81),bv=[],C9=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||bv;for(var n=t.length,i=P.addCString(e).addCString(r.text).addInt16(n),s=0;s<n;s++)i.addInt32(t[s]);return P.flush(80)},lr=new Yu.Writer,v9=function(r,e){for(let t=0;t<r.length;t++){let n=e?e(r[t],t):r[t];n==null?(P.addInt16(0),lr.addInt32(-1)):n instanceof Buffer?(P.addInt16(1),lr.addInt32(n.length),lr.add(n)):(P.addInt16(0),lr.addInt32(Buffer.byteLength(n)),lr.addString(n))}},x9=(r={})=>{let e=r.portal||"",t=r.statement||"",n=r.binary||!1,i=r.values||bv,s=i.length;return P.addCString(e).addCString(t),P.addInt16(s),v9(i,r.valueMapper),P.addInt16(s),P.add(lr.flush()),P.addInt16(n?1:0),P.flush(66)},T9=Buffer.from([69,0,0,0,9,0,0,0,0,0]),A9=r=>{if(!r||!r.portal&&!r.rows)return T9;let e=r.portal||"",t=r.rows||0,n=Buffer.byteLength(e),i=4+n+1+4,s=Buffer.allocUnsafe(1+i);return s[0]=69,s.writeInt32BE(i,1),s.write(e,5,"utf-8"),s[n+5]=0,s.writeUInt32BE(t,s.length-4),s},S9=(r,e)=>{let t=Buffer.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},Xu=(r,e)=>{let n=4+Buffer.byteLength(e)+1,i=Buffer.allocUnsafe(1+n);return i[0]=r,i.writeInt32BE(n,1),i.write(e,5,"utf-8"),i[n]=0,i},N9=P.addCString("P").flush(68),O9=P.addCString("S").flush(68),R9=r=>r.name?Xu(68,`${r.type}${r.name||""}`):r.type==="P"?N9:O9,I9=r=>{let e=`${r.type}${r.name||""}`;return Xu(67,e)},$9=r=>P.add(r).flush(100),P9=r=>Xu(102,r),es=r=>Buffer.from([r,0,0,0,4]),L9=es(72),k9=es(83),M9=es(88),B9=es(99),j9={startup:y9,password:w9,requestSsl:b9,sendSASLInitialResponseMessage:_9,sendSCRAMClientFinalMessage:q9,query:E9,parse:C9,bind:x9,execute:A9,describe:R9,close:I9,flush:()=>L9,sync:()=>k9,end:()=>M9,copyData:$9,copyDone:()=>B9,copyFail:P9,cancel:S9};ts.serialize=j9});var _v=l(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});rs.BufferReader=void 0;var D9=Buffer.allocUnsafe(0),Zu=class{constructor(e=0){this.offset=e,this.buffer=D9,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};rs.BufferReader=Zu});var Cv=l(cr=>{"use strict";var F9=cr&&cr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(cr,"__esModule",{value:!0});cr.Parser=void 0;var k=Ju(),Q9=_v(),U9=F9(require("assert")),el=1,H9=4,qv=el+H9,Ev=Buffer.allocUnsafe(0),tl=class{constructor(e){if(this.buffer=Ev,this.bufferLength=0,this.bufferOffset=0,this.reader=new Q9.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,i=this.bufferOffset;for(;i+qv<=n;){let s=this.buffer[i],o=this.buffer.readUInt32BE(i+el),a=el+o;if(a+i<=n){let u=this.handlePacket(i+qv,s,o,this.buffer);t(u),i+=a}else break}i===n?(this.buffer=Ev,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-i,this.bufferOffset=i)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let i;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)i=this.buffer;else{let s=this.buffer.byteLength*2;for(;t>=s;)s*=2;i=Buffer.allocUnsafe(s)}this.buffer.copy(i,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=i,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,n,i){switch(t){case 50:return k.bindComplete;case 49:return k.parseComplete;case 51:return k.closeComplete;case 110:return k.noData;case 115:return k.portalSuspended;case 99:return k.copyDone;case 87:return k.replicationStart;case 73:return k.emptyQuery;case 68:return this.parseDataRowMessage(e,n,i);case 67:return this.parseCommandCompleteMessage(e,n,i);case 90:return this.parseReadyForQueryMessage(e,n,i);case 65:return this.parseNotificationMessage(e,n,i);case 82:return this.parseAuthenticationResponse(e,n,i);case 83:return this.parseParameterStatusMessage(e,n,i);case 75:return this.parseBackendKeyData(e,n,i);case 69:return this.parseErrorMessage(e,n,i,"error");case 78:return this.parseErrorMessage(e,n,i,"notice");case 84:return this.parseRowDescriptionMessage(e,n,i);case 116:return this.parseParameterDescriptionMessage(e,n,i);case 71:return this.parseCopyInMessage(e,n,i);case 72:return this.parseCopyOutMessage(e,n,i);case 100:return this.parseCopyData(e,n,i);default:U9.default.fail(`unknown message code: ${t.toString(16)}`)}}parseReadyForQueryMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.string(1);return new k.ReadyForQueryMessage(t,i)}parseCommandCompleteMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.cstring();return new k.CommandCompleteMessage(t,i)}parseCopyData(e,t,n){let i=n.slice(e,e+(t-4));return new k.CopyDataMessage(t,i)}parseCopyInMessage(e,t,n){return this.parseCopyMessage(e,t,n,"copyInResponse")}parseCopyOutMessage(e,t,n){return this.parseCopyMessage(e,t,n,"copyOutResponse")}parseCopyMessage(e,t,n,i){this.reader.setBuffer(e,n);let s=this.reader.byte()!==0,o=this.reader.int16(),a=new k.CopyResponse(t,i,s,o);for(let u=0;u<o;u++)a.columnTypes[u]=this.reader.int16();return a}parseNotificationMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s=this.reader.cstring(),o=this.reader.cstring();return new k.NotificationResponseMessage(t,i,s,o)}parseRowDescriptionMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new k.RowDescriptionMessage(t,i);for(let o=0;o<i;o++)s.fields[o]=this.parseField();return s}parseField(){let e=this.reader.cstring(),t=this.reader.int32(),n=this.reader.int16(),i=this.reader.int32(),s=this.reader.int16(),o=this.reader.int32(),a=this.reader.int16()===0?"text":"binary";return new k.Field(e,t,n,i,s,o,a)}parseParameterDescriptionMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new k.ParameterDescriptionMessage(t,i);for(let o=0;o<i;o++)s.dataTypeIDs[o]=this.reader.int32();return s}parseDataRowMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new Array(i);for(let o=0;o<i;o++){let a=this.reader.int32();s[o]=a===-1?null:this.reader.string(a)}return new k.DataRowMessage(t,s)}parseParameterStatusMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.cstring(),s=this.reader.cstring();return new k.ParameterStatusMessage(t,i,s)}parseBackendKeyData(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s=this.reader.int32();return new k.BackendKeyDataMessage(t,i,s)}parseAuthenticationResponse(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s={name:"authenticationOk",length:t};switch(i){case 0:break;case 3:s.length===8&&(s.name="authenticationCleartextPassword");break;case 5:if(s.length===12){s.name="authenticationMD5Password";let a=this.reader.bytes(4);return new k.AuthenticationMD5Password(t,a)}break;case 10:s.name="authenticationSASL",s.mechanisms=[];let o;do o=this.reader.cstring(),o&&s.mechanisms.push(o);while(o);break;case 11:s.name="authenticationSASLContinue",s.data=this.reader.string(t-8);break;case 12:s.name="authenticationSASLFinal",s.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+i)}return s}parseErrorMessage(e,t,n,i){this.reader.setBuffer(e,n);let s={},o=this.reader.string(1);for(;o!=="\0";)s[o]=this.reader.cstring(),o=this.reader.string(1);let a=s.M,u=i==="notice"?new k.NoticeMessage(t,a):new k.DatabaseError(a,t,i);return u.severity=s.S,u.code=s.C,u.detail=s.D,u.hint=s.H,u.position=s.P,u.internalPosition=s.p,u.internalQuery=s.q,u.where=s.W,u.schema=s.s,u.table=s.t,u.column=s.c,u.dataType=s.d,u.constraint=s.n,u.file=s.F,u.line=s.L,u.routine=s.R,u}};cr.Parser=tl});var rl=l(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Ye.DatabaseError=Ye.serialize=Ye.parse=void 0;var W9=Ju();Object.defineProperty(Ye,"DatabaseError",{enumerable:!0,get:function(){return W9.DatabaseError}});var V9=wv();Object.defineProperty(Ye,"serialize",{enumerable:!0,get:function(){return V9.serialize}});var G9=Cv();function z9(r,e){let t=new G9.Parser;return r.on("data",n=>t.parse(n,e)),new Promise(n=>r.on("end",()=>n()))}Ye.parse=z9});var il=l((Iie,xv)=>{"use strict";var vv=require("net"),J9=require("events").EventEmitter,{parse:K9,serialize:U}=rl(),Y9=U.flush(),X9=U.sync(),Z9=U.end(),nl=class extends J9{constructor(e){super(),e=e||{},this.stream=e.stream||new vv.Socket,typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var t=this;this.on("newListener",function(n){n==="message"&&(t._emitMessage=!0)})}connect(e,t){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let i=function(s){n._ending&&(s.code==="ECONNRESET"||s.code==="EPIPE")||n.emit("error",s)};if(this.stream.on("error",i),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(s){var o=s.toString("utf8");switch(o){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}var a=require("tls");let u={socket:n.stream};n.ssl!==!0&&(Object.assign(u,n.ssl),"key"in n.ssl&&(u.key=n.ssl.key)),vv.isIP(t)===0&&(u.servername=t);try{n.stream=a.connect(u)}catch(c){return n.emit("error",c)}n.attachListeners(n.stream),n.stream.on("error",i),n.emit("sslconnect")})}attachListeners(e){e.on("end",()=>{this.emit("end")}),K9(e,t=>{var n=t.name==="error"?"errorMessage":t.name;this._emitMessage&&this.emit("message",t),this.emit(n,t)})}requestSsl(){this.stream.write(U.requestSsl())}startup(e){this.stream.write(U.startup(e))}cancel(e,t){this._send(U.cancel(e,t))}password(e){this._send(U.password(e))}sendSASLInitialResponseMessage(e,t){this._send(U.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(U.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(U.query(e))}parse(e){this._send(U.parse(e))}bind(e){this._send(U.bind(e))}execute(e){this._send(U.execute(e))}flush(){this.stream.writable&&this.stream.write(Y9)}sync(){this._ending=!0,this._send(X9)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(Z9,()=>{this.stream.end()})}close(e){this._send(U.close(e))}describe(e){this._send(U.describe(e))}sendCopyFromChunk(e){this._send(U.copyData(e))}endCopyFrom(){this._send(U.copyDone())}sendCopyFail(e){this._send(U.copyFail(e))}};xv.exports=nl});var Sv=l(($ie,Av)=>{"use strict";var e4=require("events").EventEmitter,t4=Vi(),sl=KC(),r4=sv(),n4=Ou(),i4=Iu(),Tv=gv(),s4=yn(),o4=il(),ns=class extends e4{constructor(e){super(),this.connectionParameters=new i4(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var t=e||{};this._Promise=t.Promise||global.Promise,this._types=new n4(t.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=t.connection||new o4({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||s4.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){let t=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){var t=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){t.ssl?n.requestSsl():n.startup(t.getStartupConf())}),n.on("sslconnect",function(){n.startup(t.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((t,n)=>{this._connect(i=>{i?n(i):t()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let t=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){t.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{t.emit("error",n)}):this.password!==null?e():r4(this.connectionParameters,n=>{n!==void 0&&(this.connectionParameters.password=this.password=n),e()})}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(()=>{let t=t4.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=sl.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(t){this.connection.emit("error",t)}})}_handleAuthSASLContinue(e){try{sl.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(t){this.connection.emit("error",t)}}_handleAuthSASLFinal(e){try{sl.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(t){this.connection.emit("error",t)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let t=this.activeQuery;if(!t){this._handleErrorEvent(e);return}this.activeQuery=null,t.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,t={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(t.application_name=n),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(t)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,n){return this._types.setTypeParser(e,t,n)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return'"'+e.replace(/"/g,'""')+'"'}escapeLiteral(e){for(var t=!1,n="'",i=0;i<e.length;i++){var s=e[i];s==="'"?n+=s+s:s==="\\"?(n+=s+s,t=!0):n+=s}return n+="'",t===!0&&(n=" E"+n),n}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,n){var i,s,o,a,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof t=="function"&&(i.callback=i.callback||t)):(o=this.connectionParameters.query_timeout,i=new Tv(e,t,n),i.callback||(s=new this._Promise((c,h)=>{i.callback=(f,d)=>f?h(f):c(d)}))),o&&(u=i.callback,a=setTimeout(()=>{var c=new Error("Query read timeout");process.nextTick(()=>{i.handleError(c,this.connection)}),u(c),i.callback=()=>{};var h=this.queryQueue.indexOf(i);h>-1&&this.queryQueue.splice(h,1),this._pulseQueryQueue()},o),i.callback=(c,h)=>{clearTimeout(a),u(c,h)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(t=>{this.connection.once("end",t)})}};ns.Query=Tv;Av.exports=ns});var Iv=l((Pie,Rv)=>{"use strict";var a4=require("events").EventEmitter,Nv=function(){},Ov=(r,e)=>{let t=r.findIndex(e);return t===-1?void 0:r.splice(t,1)[0]},ol=class{constructor(e,t,n){this.client=e,this.idleListener=t,this.timeoutId=n}},hr=class{constructor(e){this.callback=e}};function u4(){throw new Error("Release called on client which has already been released to the pool.")}function is(r,e){if(e)return{callback:e,result:void 0};let t,n,i=function(o,a){o?t(o):n(a)},s=new r(function(o,a){n=o,t=a});return{callback:i,result:s}}function l4(r,e){return function t(n){n.client=e,e.removeListener("error",t),e.on("error",()=>{r.log("additional client error after disconnection due to error",n)}),r._remove(e),r.emit("error",n,e)}}var al=class extends a4{constructor(e,t){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||wn().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(t=>{this._remove(t.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let t=this._idle.pop();clearTimeout(t.timeoutId);let n=t.client;n.ref&&n.ref();let i=t.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let t=Ov(this._idle,n=>n.client===e);t!==void 0&&clearTimeout(t.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let t=is(this.Promise,e),n=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new hr(t.callback)),n;let i=(a,u,c)=>{clearTimeout(o),t.callback(a,u,c)},s=new hr(i),o=setTimeout(()=>{Ov(this._pendingQueue,a=>a.callback===i),s.timedOut=!0,t.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(s),n}return this.newClient(new hr(t.callback)),n}newClient(e){let t=new this.Client(this.options);this._clients.push(t);let n=l4(this,t);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),t.connect(o=>{if(i&&clearTimeout(i),t.on("error",n),o)this.log("client failed to connect",o),this._clients=this._clients.filter(a=>a!==t),s&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,Nv);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let a=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(t),this._idle.findIndex(c=>c.client===t)!==-1&&this._acquireClient(t,new hr((c,h,f)=>f()),n,!1)},this.options.maxLifetimeSeconds*1e3);a.unref(),t.once("end",()=>clearTimeout(a))}return this._acquireClient(t,e,n,!0)}})}_acquireClient(e,t,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),t.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),t.callback(s,void 0,Nv);t.callback(void 0,e,e.release)}):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let n=!1;return i=>{n&&u4(),n=!0,this._release(e,t,i)}}_release(e,t,n){if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let s;this.options.idleTimeoutMillis&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new ol(e,t,s)),this._pulseQueue()}query(e,t,n){if(typeof e=="function"){let s=is(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof t=="function"&&(n=t,t=void 0);let i=is(this.Promise,n);return n=i.callback,this.connect((s,o)=>{if(s)return n(s);let a=!1,u=c=>{a||(a=!0,o.release(c),n(c))};o.once("error",u),this.log("dispatching query");try{o.query(e,t,(c,h)=>{if(this.log("query dispatched"),o.removeListener("error",u),!a)return a=!0,o.release(c),c?n(c):n(void 0,h)})}catch(c){return o.release(c),n(c)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let t=is(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,t)=>e+(this._expired.has(t)?1:0),0)}get totalCount(){return this._clients.length}};Rv.exports=al});var Lv=l((Lie,Pv)=>{"use strict";var $v=require("events").EventEmitter,c4=require("util"),ul=Vi(),fr=Pv.exports=function(r,e,t){$v.call(this),r=ul.normalizeQueryConfig(r,e,t),this.text=r.text,this.values=r.values,this.name=r.name,this.callback=r.callback,this.state="new",this._arrayMode=r.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};c4.inherits(fr,$v);var h4={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};fr.prototype.handleError=function(r){var e=this.native.pq.resultErrorFields();if(e)for(var t in e){var n=h4[t]||t;r[n]=e[t]}this.callback?this.callback(r):this.emit("error",r),this.state="error"};fr.prototype.then=function(r,e){return this._getPromise().then(r,e)};fr.prototype.catch=function(r){return this._getPromise().catch(r)};fr.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(r,e){this._once("end",r),this._once("error",e)}.bind(this)),this._promise)};fr.prototype.submit=function(r){this.state="running";var e=this;this.native=r.native,r.native.arrayMode=this._arrayMode;var t=function(s,o,a){if(r.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),s)return e.handleError(s);e._emitRowEvents&&(a.length>1?o.forEach((u,c)=>{u.forEach(h=>{e.emit("row",h,a[c])})}):o.forEach(function(u){e.emit("row",u,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(process.domain&&(t=process.domain.bind(t)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(ul.prepareValue);if(r.namedQueries[this.name]){if(this.text&&r.namedQueries[this.name]!==this.text){let s=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return t(s)}return r.native.execute(this.name,n,t)}return r.native.prepare(this.name,this.text,n.length,function(s){return s?t(s):(r.namedQueries[e.name]=e.text,e.native.execute(e.name,n,t))})}else if(this.values){if(!Array.isArray(this.values)){let s=new Error("Query values must be an array");return t(s)}var i=this.values.map(ul.prepareValue);r.native.query(this.text,i,t)}else r.native.query(this.text,t)}});var jv=l((kie,Bv)=>{"use strict";var f4=require("pg-native"),d4=Ou(),kv=require("events").EventEmitter,p4=require("util"),m4=Iu(),Mv=Lv(),X=Bv.exports=function(r){kv.call(this),r=r||{},this._Promise=r.Promise||global.Promise,this._types=new d4(r.types),this.native=new f4({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new m4(r);this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};X.Query=Mv;p4.inherits(X,kv);X.prototype._errorAllQueries=function(r){let e=t=>{process.nextTick(()=>{t.native=this.native,t.handleError(r)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};X.prototype._connect=function(r){var e=this;if(this._connecting){process.nextTick(()=>r(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(t,n){if(t)return r(t);e.native.connect(n,function(i){if(i)return e.native.end(),r(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),r()})})};X.prototype.connect=function(r){if(r){this._connect(r);return}return new this._Promise((e,t)=>{this._connect(n=>{n?t(n):e()})})};X.prototype.query=function(r,e,t){var n,i,s,o,a;if(r==null)throw new TypeError("Client was passed a null or undefined query");if(typeof r.submit=="function")s=r.query_timeout||this.connectionParameters.query_timeout,i=n=r,typeof e=="function"&&(r.callback=e);else if(s=this.connectionParameters.query_timeout,n=new Mv(r,e,t),!n.callback){let u,c;i=new this._Promise((h,f)=>{u=h,c=f}),n.callback=(h,f)=>h?c(h):u(f)}return s&&(a=n.callback,o=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),a(u),n.callback=()=>{};var c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},s),n.callback=(u,c)=>{clearTimeout(o),a(u,c)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};X.prototype.end=function(r){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,r));var t;return r||(t=new this._Promise(function(n,i){r=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),r&&r()})}),t};X.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};X.prototype._pulseQueryQueue=function(r){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){r||this.emit("drain");return}this._activeQuery=e,e.submit(this);var t=this;e.once("_done",function(){t._pulseQueryQueue()})}};X.prototype.cancel=function(r){this._activeQuery===r?this.native.cancel(function(){}):this._queryQueue.indexOf(r)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(r),1)};X.prototype.ref=function(){};X.prototype.unref=function(){};X.prototype.setTypeParser=function(r,e,t){return this._types.setTypeParser(r,e,t)};X.prototype.getTypeParser=function(r,e){return this._types.getTypeParser(r,e)}});var ll=l((Mie,Dv)=>{"use strict";Dv.exports=jv()});var wn=l((jie,_n)=>{"use strict";var g4=Sv(),y4=yn(),b4=il(),w4=Iv(),{DatabaseError:_4}=rl(),q4=r=>class extends w4{constructor(t){super(t,r)}},cl=function(r){this.defaults=y4,this.Client=r,this.Query=this.Client.Query,this.Pool=q4(this.Client),this._pools=[],this.Connection=b4,this.types=gn(),this.DatabaseError=_4};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?_n.exports=new cl(ll()):(_n.exports=new cl(g4),Object.defineProperty(_n.exports,"native",{configurable:!0,enumerable:!1,get(){var r=null;try{r=new cl(ll())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(_n.exports,"native",{value:r}),r}}))});var qn=l((Die,Uv)=>{var E4=sn(),C4=He(),{promisify:v4}=require("util"),x4=ze(),T4=lu(),A4=Bi(),S4=aC(),N4=ji(),O4=Fi(),R4=Qi(),I4=pC(),$4=mu(),{makeEscape:P4}=Rn(),{isString:Fv}=A(),ss=class extends x4{constructor(e){super(e),e.returning&&(this.defaultReturning=e.returning),e.searchPath&&(this.searchPath=e.searchPath)}transaction(){return new T4(this,...arguments)}queryBuilder(){return new S4(this)}queryCompiler(e,t){return new A4(this,e,t)}columnCompiler(){return new N4(this,...arguments)}schemaCompiler(){return new $4(this,...arguments)}tableCompiler(){return new O4(this,...arguments)}viewCompiler(){return new R4(this,...arguments)}viewBuilder(){return new I4(this,...arguments)}_driver(){return wn()}wrapIdentifierImpl(e){if(e==="*")return e;let t="",n=e.match(/(.*?)(\[[0-9]+\])/);return n&&(e=n[1],t=n[2]),`"${e.replace(/"/g,'""')}"${t}`}_acquireOnlyConnection(){let e=new this.driver.Client(this.connectionSettings);return e.connect().then(()=>e)}acquireRawConnection(){let e=this;return this._acquireOnlyConnection().then(function(t){return t.on("error",n=>{t.__knex__disposed=n}),t.on("end",n=>{t.__knex__disposed=n||"Connection ended unexpectedly"}),e.version?t:e.checkVersion(t).then(function(n){return e.version=n,t})}).then(async function(n){return await e.setSchemaSearchPath(n),n})}async destroyRawConnection(e){return v4(n=>e.end(n))()}checkVersion(e){return new Promise((t,n)=>{e.query("select version();",(i,s)=>{if(i)return n(i);t(this._parseVersion(s.rows[0].version))})})}_parseVersion(e){return/^PostgreSQL (.*?)( |$)/.exec(e)[1]}positionBindings(e){let t=0;return e.replace(/(\\*)(\?)/g,function(n,i){return i.length%2?"?":(t++,`$${t}`)})}setSchemaSearchPath(e,t){let n=t||this.searchPath;if(!n)return Promise.resolve(!0);if(!Array.isArray(n)&&!Fv(n))throw new TypeError(`knex: Expected searchPath to be Array/String, got: ${typeof n}`);if(Fv(n)){if(n.includes(",")){let s=`[${n.split(",").map(o=>`'${o}'`).join(", ")}]`;this.logger.warn(`Detected comma in searchPath "${n}".If you are trying to specify multiple schemas, use Array syntax: ${s}`)}n=[n]}return n=n.map(i=>`"${i}"`).join(","),new Promise(function(i,s){e.query(`set search_path to ${n}`,function(o){if(o)return s(o);i(!0)})})}_stream(e,t,n,i){if(!t.sql)throw new Error("The query is empty");let s=process.browser?void 0:require("pg-query-stream"),o=t.sql;return new Promise(function(a,u){let c=e.query(new s(o,t.bindings,i));c.on("error",function(h){u(h),n.emit("error",h)}),n.on("end",a),c.pipe(n)})}_query(e,t){if(!t.sql)throw new Error("The query is empty");let n={text:t.sql,values:t.bindings||[]};return t.options&&(n=E4(n,t.options)),new Promise(function(i,s){e.query(n,function(o,a){if(o)return s(o);t.response=a,i(t)})})}processResponse(e,t){let n=e.response;if(e.output)return e.output.call(t,n);if(e.method==="raw")return n;let{returning:i}=e;if(n.command==="SELECT")return e.method==="first"?n.rows[0]:e.method==="pluck"?C4(n.rows,e.pluck):n.rows;if(i){let s=[];for(let o=0,a=n.rows.length;o<a;o++){let u=n.rows[o];s[o]=u}return s}return n.command==="UPDATE"||n.command==="DELETE"?n.rowCount:n}async cancelQuery(e){let t=await this.acquireRawConnection();try{return await this._wrappedCancelQueryCall(t,e)}finally{await this.destroyRawConnection(t).catch(n=>{this.logger.warn(`Connection Error: ${n}`)})}}_wrappedCancelQueryCall(e,t){return this._query(e,{sql:"SELECT pg_cancel_backend($1);",bindings:[t.processID],options:{}})}toPathForJson(e){let t=/^{.*}$/;return e.match(t)?e:"{"+e.replace(/^(\$\.)/,"").replace(".",",").replace(/\[([0-9]+)]/,",$1")+"}"}};Object.assign(ss.prototype,{dialect:"postgresql",driverName:"pg",canCancelQuery:!0,_escapeBinding:P4({escapeArray(r,e){return e(Qv(r,e))},escapeString(r){let e=!1,t="'";for(let n=0;n<r.length;n++){let i=r[n];i==="'"?t+=i+i:i==="\\"?(t+=i+i,e=!0):t+=i}return t+="'",e===!0&&(t="E"+t),t},escapeObject(r,e,t,n=[]){if(r&&typeof r.toPostgres=="function"){if(n=n||[],n.indexOf(r)!==-1)throw new Error(`circular reference detected while preparing "${r}" for query`);return n.push(r),e(r.toPostgres(e),n)}return JSON.stringify(r)}})});function Qv(r,e){let t="{";for(let n=0;n<r.length;n++){n>0&&(t+=",");let i=r[n];i===null||typeof i>"u"?t+="NULL":Array.isArray(i)?t+=Qv(i,e):typeof i=="number"?t+=i:t+=JSON.stringify(typeof i=="string"?i:e(i))}return t+"}"}Uv.exports=ss});var Vv=l((Fie,Wv)=>{var L4=Bi(),{columnize:k4,wrap:Hv,operator:M4}=F(),hl=class extends L4{truncate(){return`truncate ${this.tableName}`}upsert(){let e=this._upsert();if(e==="")return e;let{returning:t}=this.single;return t&&(e+=this._returning(t)),{sql:e,returning:t}}_upsert(){let e=this.single.upsert||[],t=this.with()+`upsert into ${this.tableName} `,n=this._insertBody(e);return n===""?"":t+n}_groupOrder(e,t){return this._basicGroupOrder(e,t)}whereJsonPath(e){let t="";return!isNaN(e.value)&&parseInt(e.value)?t="::int":!isNaN(e.value)&&parseFloat(e.value)?t="::float":t=" #>> '{}'",`json_extract_path(${this._columnClause(e)}, ${this.client.toArrayPathFromJsonPath(e.jsonPath,this.builder,this.bindingsHolder)})${t} ${M4(e.operator,this.builder,this.client,this.bindingsHolder)} ${this._jsonValueClause(e)}`}_jsonExtract(e,t){let n;return Array.isArray(t.column)?n=t.column:n=[t],n.map(i=>{let s=`json_extract_path(${k4(i.column||i[0],this.builder,this.client,this.bindingsHolder)}, ${this.client.toArrayPathFromJsonPath(i.path||i[1],this.builder,this.bindingsHolder)})`,o=i.alias||i[2];return o?this.client.alias(s,this.formatter.wrap(o)):s}).join(", ")}_onJsonPathEquals(e,t){return"json_extract_path("+Hv(t.columnFirst,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.toArrayPathFromJsonPath(t.jsonPathFirst,this.builder,this.bindingsHolder)+") = json_extract_path("+Hv(t.columnSecond,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.toArrayPathFromJsonPath(t.jsonPathSecond,this.builder,this.bindingsHolder)+")"}};Wv.exports=hl});var zv=l((Qie,Gv)=>{var B4=ji(),fl=class extends B4{uuid(e={primaryKey:!1}){return"uuid"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key default gen_random_uuid()":"")}};Gv.exports=fl});var Kv=l((Uie,Jv)=>{var j4=Fi(),dl=class extends j4{constructor(e,t){super(e,t)}addColumns(e,t,n){if(t===this.alterColumnsPrefix)for(let i of n)this.client.logger.warn("Experimental alter column in use, see issue: https://github.com/cockroachdb/cockroach/issues/49329"),this.pushQuery({sql:"SET enable_experimental_alter_column_type_general = true",bindings:[]}),super._addColumn(i);else super.addColumns(e,t)}dropUnique(e,t){t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),this.pushQuery(`drop index ${this.tableName()}@${t} cascade `)}};Jv.exports=dl});var Xv=l((Hie,Yv)=>{var D4=Qi(),pl=class extends D4{renameColumn(e,t){throw new Error("rename column of views is not supported by this dialect.")}defaultTo(e,t){throw new Error("change default values of views is not supported by this dialect.")}};Yv.exports=pl});var ex=l((Vie,Zv)=>{var F4=Oe(),Q4=te();Zv.exports=class extends F4{upsert(e,t,n){return this._method="upsert",Q4(t)||this.returning(t,n),this._single.upsert=e,this}}});var rx=l((Gie,tx)=>{var U4=qn(),H4=lu(),W4=Vv(),V4=zv(),G4=Kv(),z4=Xv(),J4=ex(),os=class extends U4{transaction(){return new H4(this,...arguments)}queryCompiler(e,t){return new W4(this,e,t)}columnCompiler(){return new V4(this,...arguments)}tableCompiler(){return new G4(this,...arguments)}viewCompiler(){return new z4(this,...arguments)}queryBuilder(){return new J4(this)}_parseVersion(e){return e.split(" ")[2]}async cancelQuery(e){try{return await this._wrappedCancelQueryCall(null,e)}catch(t){throw this.logger.warn(`Connection Error: ${t}`),t}}_wrappedCancelQueryCall(e,t){if(!(t.activeQuery.processID===0&&t.activeQuery.secretKey===0))return t.cancel(t,t.activeQuery)}toArrayPathFromJsonPath(e,t,n){return e.replace(/^(\$\.)/,"").replace(/\[([0-9]+)]/,".$1").split(".").map(function(i){return this.parameter(i,t,n)}.bind(this)).join(", ")}};Object.assign(os.prototype,{driverName:"cockroachdb"});tx.exports=os});var ix=l((zie,nx)=>{function K4(r){return r==null}nx.exports=K4});var ox=l((Jie,sx)=>{var Y4=an(),ml=class extends Y4{columnizeWithPrefix(e,t){let n=typeof t=="string"?[t]:t,i="",s=-1;for(;++s<n.length;)s>0&&(i+=", "),i+=e+this.wrap(n[s]);return i}escapingStringDelimiters(e){return(e||"").replace(/'/g,"''")}};sx.exports=ml});var lx=l((Kie,ux)=>{var X4=Se(),Xe=ae()("knex:tx"),gl=class extends X4{begin(e){return Xe("transaction::begin id=%s",this.txid),new Promise((t,n)=>{e.beginTransaction(i=>{if(i)return Xe("transaction::begin error id=%s message=%s",this.txid,i.message),n(i);t()},this.outerTx?this.txid:void 0,Z4(this.isolationLevel))}).then(this._resolver,this._rejecter)}savepoint(e){return Xe("transaction::savepoint id=%s",this.txid),new Promise((t,n)=>{e.saveTransaction(i=>{if(i)return Xe("transaction::savepoint id=%s message=%s",this.txid,i.message),n(i);this.trxClient.emit("query",{__knexUid:this.trxClient.__knexUid,__knexTxId:this.trxClient.__knexTxId,autogenerated:!0,sql:this.outerTx?`SAVE TRANSACTION [${this.txid}]`:"SAVE TRANSACTION"}),t()},this.outerTx?this.txid:void 0)})}commit(e,t){return Xe("transaction::commit id=%s",this.txid),new Promise((n,i)=>{e.commitTransaction(s=>{if(s)return Xe("transaction::commit error id=%s message=%s",this.txid,s.message),i(s);this._completed=!0,n(t)},this.outerTx?this.txid:void 0)}).then(()=>this._resolver(t),this._rejecter)}release(e,t){return this._resolver(t)}rollback(e,t){return this._completed=!0,Xe("transaction::rollback id=%s",this.txid),new Promise((n,i)=>{if(!e.inTransaction)return i(t||new Error("Transaction rejected with non-error: undefined"));if(e.state.name!=="LoggedIn")return i(new Error("Can't rollback transaction. There is a request in progress"));e.rollbackTransaction(s=>{s&&Xe("transaction::rollback error id=%s message=%s",this.txid,s.message),i(s||t||new Error("Transaction rejected with non-error: undefined"))},this.outerTx?this.txid:void 0)}).catch(n=>{if(!t&&this.doNotRejectOnRollback){this._resolver();return}if(t)try{n.originalError=t}catch{}this._rejecter(n)})}rollbackTo(e,t){return this.rollback(e,t).then(()=>void this.trxClient.emit("query",{__knexUid:this.trxClient.__knexUid,__knexTxId:this.trxClient.__knexTxId,autogenerated:!0,sql:"ROLLBACK TRANSACTION"}))}};ux.exports=gl;function Z4(r){if(!r)return;r=r.toUpperCase().replace(" ","_");let e=ax[r];if(!e)throw new Error(`Unknown Isolation level, was expecting one of: ${JSON.stringify(e8)}`);return e}var ax={READ_UNCOMMITTED:1,READ_COMMITTED:2,REPEATABLE_READ:3,SERIALIZABLE:4,SNAPSHOT:5},e8=Object.keys(ax).map(r=>r.toLowerCase().replace("_"," "))});var px=l((Yie,dx)=>{var t8=Ve(),r8=vi(),cx=z(),hx=te(),n8=gt(),{columnize:fx}=F(),i8=["columns","join","lock","where","union","group","having","order","limit","offset"],yl=class extends t8{constructor(e,t,n){super(e,t,n);let{onConflict:i}=this.single;if(i)throw new Error(".onConflict() is not supported for mssql.");this._emptyInsertValue="default values"}with(){let e=[];if(this.grouped.with)for(let n of this.grouped.with)n.recursive&&(e.push(n),n.recursive=!1);let t=super.with();for(let n of e)n.recursive=!0;return t}select(){let e=this.with(),t=i8.map(n=>this[n](this));return e+r8(t).join(" ")}insert(){return this.single.options&&this.single.options.includeTriggerModifications?this.insertWithTriggers():this.standardInsert()}insertWithTriggers(){let e=this.single.insert||[],{returning:t}=this.single,n=this.with()+`${this._buildTempTable(t)}insert into ${this.tableName} `,i=t?this._returning("insert",t,!0)+" ":"";if(Array.isArray(e)){if(e.length===0)return""}else if(typeof e=="object"&&hx(e))return{sql:n+i+this._emptyInsertValue+this._buildReturningSelect(t),returning:t};return n+=this._buildInsertData(e,i),t&&(n+=this._buildReturningSelect(t)),{sql:n,returning:t}}_buildInsertData(e,t){let n="",i=this._prepInsert(e);if(typeof i=="string")n+=i;else if(i.columns.length)n+=`(${this.formatter.columnize(i.columns)}`,n+=`) ${t}values (`+this._buildInsertValues(i)+")";else if(e.length===1&&e[0])n+=t+this._emptyInsertValue;else return"";return n}standardInsert(){let e=this.single.insert||[],t=this.with()+`insert into ${this.tableName} `,{returning:n}=this.single,i=n?this._returning("insert",n)+" ":"";if(Array.isArray(e)){if(e.length===0)return""}else if(typeof e=="object"&&hx(e))return{sql:t+i+this._emptyInsertValue,returning:n};return t+=this._buildInsertData(e,i),{sql:t,returning:n}}update(){return this.single.options&&this.single.options.includeTriggerModifications?this.updateWithTriggers():this.standardUpdate()}updateWithTriggers(){let e=this.top(),t=this.with(),n=this._prepUpdate(this.single.update),i=this.join(),s=this.where(),o=this.order(),{returning:a}=this.single,u=this._buildTempTable(a);return{sql:t+u+`update ${e?e+" ":""}${this.tableName} set `+n.join(", ")+(a?` ${this._returning("update",a,!0)}`:"")+(i?` from ${this.tableName} ${i}`:"")+(s?` ${s}`:"")+(o?` ${o}`:"")+(a?this._buildReturningSelect(a):this._returning("rowcount","@@rowcount")),returning:a||"@@rowcount"}}_formatGroupsItemValue(e,t){let n=super._formatGroupsItemValue(e);if(t&&!(e instanceof n8)){let i=`IIF(${n} is null,`;if(t==="first")return`${i}0,1)`;if(t==="last")return`${i}1,0)`}return n}standardUpdate(){let e=this.top(),t=this.with(),n=this._prepUpdate(this.single.update),i=this.join(),s=this.where(),o=this.order(),{returning:a}=this.single;return{sql:t+`update ${e?e+" ":""}${this.tableName} set `+n.join(", ")+(a?` ${this._returning("update",a)}`:"")+(i?` from ${this.tableName} ${i}`:"")+(s?` ${s}`:"")+(o?` ${o}`:"")+(a?"":this._returning("rowcount","@@rowcount")),returning:a||"@@rowcount"}}del(){return this.single.options&&this.single.options.includeTriggerModifications?this.deleteWithTriggers():this.standardDelete()}deleteWithTriggers(){let e=this.with(),{tableName:t}=this,n=this.where(),i=this.join(),{returning:s}=this.single,o=s?` ${this._returning("del",s,!0)}`:"",a=i?`${t}${o} `:"";return{sql:e+`${this._buildTempTable(s)}delete ${a}from ${t}`+(i?"":o)+(i?` ${i}`:"")+(n?` ${n}`:"")+(s?this._buildReturningSelect(s):this._returning("rowcount","@@rowcount")),returning:s||"@@rowcount"}}standardDelete(){let e=this.with(),{tableName:t}=this,n=this.where(),i=this.join(),{returning:s}=this.single,o=s?` ${this._returning("del",s)}`:"",a=i?`${t}${o} `:"";return{sql:e+`delete ${a}from ${t}`+(i?"":o)+(i?` ${i}`:"")+(n?` ${n}`:"")+(s?"":this._returning("rowcount","@@rowcount")),returning:s||"@@rowcount"}}columns(){let e="";if(this.onlyUnions())return"";let t=this.top(),n=this._hintComments(),i=this.grouped.columns||[],s=-1,o=[];if(i)for(;++s<i.length;){let u=i[s];if(u.distinct&&(e="distinct "),u.distinctOn){e=this.distinctOn(u.value);continue}u.type==="aggregate"?o.push(...this.aggregate(u)):u.type==="aggregateRaw"?o.push(this.aggregateRaw(u)):u.type==="analytic"?o.push(this.analytic(u)):u.type==="json"?o.push(this.json(u)):u.value&&u.value.length>0&&o.push(this.formatter.columnize(u.value))}return o.length===0&&(o=["*"]),`${this.onlyJson()?"":"select "}${n}${e}`+(t?t+" ":"")+o.join(", ")+(this.tableName?` from ${this.tableName}`:"")}_returning(e,t,n){switch(e){case"update":case"insert":return t?`output ${this.formatter.columnizeWithPrefix("inserted.",t)}${n?" into #out":""}`:"";case"del":return t?`output ${this.formatter.columnizeWithPrefix("deleted.",t)}${n?" into #out":""}`:"";case"rowcount":return t?";select @@rowcount":""}}_buildTempTable(e){if(e&&e.length>0){let t="";Array.isArray(e)?t=e.map(i=>`[t].${this.formatter.columnize(i)}`).join(","):t=`[t].${this.formatter.columnize(e)}`;let n=`select top(0) ${t} into #out `;return n+=`from ${this.tableName} as t `,n+=`left join ${this.tableName} on 0=1;`,n}return""}_buildReturningSelect(e){if(e&&e.length>0){let t="";Array.isArray(e)?t=e.map(i=>`${this.formatter.columnize(i)}`).join(","):t=this.formatter.columnize(e);let n=`; select ${t} from #out; `;return n+="drop table #out;",n}return""}truncate(){return`truncate table ${this.tableName}`}forUpdate(){return"with (UPDLOCK)"}forShare(){return"with (HOLDLOCK)"}columnInfo(){let e=this.single.columnInfo,t=this.single.schema,n=this.client.customWrapIdentifier(this.single.table,cx);t&&(t=this.client.customWrapIdentifier(t,cx));let i="select [COLUMN_NAME], [COLUMN_DEFAULT], [DATA_TYPE], [CHARACTER_MAXIMUM_LENGTH], [IS_NULLABLE] from INFORMATION_SCHEMA.COLUMNS where table_name = ? and table_catalog = ?",s=[n,this.client.database()];return t?(i+=" and table_schema = ?",s.push(t)):i+=" and table_schema = 'dbo'",{sql:i,bindings:s,output(o){let a=o.reduce((u,c)=>(u[c[0].value]={defaultValue:c[1].value,type:c[2].value,maxLength:c[3].value,nullable:c[4].value==="YES"},u),{});return e&&a[e]||a}}}top(){let e=!this.single.limit&&this.single.limit!==0,t=!this.single.offset;return e||!t?"":`top (${this._getValueOrParameterFromAttribute("limit")})`}limit(){return""}offset(){let e=!this.single.limit&&this.single.limit!==0,t=!this.single.offset;if(t)return"";let n=`offset ${t?"0":this._getValueOrParameterFromAttribute("offset")} rows`;return e||(n+=` fetch next ${this._getValueOrParameterFromAttribute("limit")} rows only`),n}whereLike(e){return`${this._columnClause(e)} collate SQL_Latin1_General_CP1_CS_AS ${this._not(e,"like ")}${this._valueClause(e)}`}whereILike(e){return`${this._columnClause(e)} collate SQL_Latin1_General_CP1_CI_AS ${this._not(e,"like ")}${this._valueClause(e)}`}jsonExtract(e){return this._jsonExtract(e.singleValue?"JSON_VALUE":"JSON_QUERY",e)}jsonSet(e){return this._jsonSet("JSON_MODIFY",e)}jsonInsert(e){return this._jsonSet("JSON_MODIFY",e)}jsonRemove(e){let t=`JSON_MODIFY(${fx(e.column,this.builder,this.client,this.bindingsHolder)},${this.client.parameter(e.path,this.builder,this.bindingsHolder)}, NULL)`;return e.alias?this.client.alias(t,this.formatter.wrap(e.alias)):t}whereJsonPath(e){return this._whereJsonPath("JSON_VALUE",e)}whereJsonSupersetOf(e){throw new Error("Json superset where clause not actually supported by MSSQL")}whereJsonSubsetOf(e){throw new Error("Json subset where clause not actually supported by MSSQL")}_getExtracts(e,t){let n=fx(e.column,this.builder,this.client,this.bindingsHolder);return(Array.isArray(e.values)?e.values:[e.values]).map(function(i){return"JSON_VALUE("+n+","+this.client.parameter(i,this.builder,this.bindingsHolder)+")"},this).join(t)}onJsonPathEquals(e){return this._onJsonPathEquals("JSON_VALUE",e)}};dx.exports=yl});var gx=l((Xie,mx)=>{var s8=yt(),as=class extends s8{constructor(e,t){super(e,t)}dropTableIfExists(e){let t=this.formatter.wrap(dr(this.schema,e));this.pushQuery(`if object_id('${t}', 'U') is not null DROP TABLE ${t}`)}dropViewIfExists(e){let t=this.formatter.wrap(dr(this.schema,e));this.pushQuery(`if object_id('${t}', 'V') is not null DROP VIEW ${t}`)}renameTable(e,t){this.pushQuery(`exec sp_rename ${this.client.parameter(dr(this.schema,e),this.builder,this.bindingsHolder)}, ${this.client.parameter(t,this.builder,this.bindingsHolder)}`)}renameView(e,t){this.pushQuery(`exec sp_rename ${this.client.parameter(dr(this.schema,e),this.builder,this.bindingsHolder)}, ${this.client.parameter(t,this.builder,this.bindingsHolder)}`)}hasTable(e){let t=this.client.parameter(dr(this.schema,e),this.builder,this.bindingsHolder),n=[e],i=`SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ${t}`;this.schema&&(i+=" AND TABLE_SCHEMA = ?",n.push(this.schema)),this.pushQuery({sql:i,bindings:n,output:s=>s.length>0})}hasColumn(e,t){let n=this.client.parameter(t,this.builder,this.bindingsHolder),i=this.client.parameter(this.formatter.wrap(dr(this.schema,e)),this.builder,this.bindingsHolder),s=`select object_id from sys.columns where name = ${n} and object_id = object_id(${i})`;this.pushQuery({sql:s,output:o=>o.length>0})}};as.prototype.dropTablePrefix="DROP TABLE ";function dr(r,e){return r?`${r}.${e}`:e}mx.exports=as});var bx=l((Zie,yx)=>{var o8=bt(),a8=D(),{isObject:bl}=A(),Ze=class extends o8{constructor(e,t){super(e,t)}createQuery(e,t,n){let i=t?`if object_id('${this.tableName()}', 'U') is null `:"";n?i+=`SELECT * INTO ${this.tableName()} FROM ${this.tableNameLike()} WHERE 0=1`:i+="CREATE TABLE "+this.tableName()+(this._formatting?` (
    `:" (")+e.sql.join(this._formatting?`,
    `:", ")+this._addChecks()+")",this.pushQuery(i),this.single.comment&&this.comment(this.single.comment),n&&this.addColumns(e,this.addColumnsPrefix)}comment(e){if(!e)return;e.length>7500/2&&this.client.logger.warn("Your comment might be longer than the max comment length for MSSQL of 7,500 bytes.");let t=this.formatter.escapingStringDelimiters(e),n=this.formatter.escapingStringDelimiters(this.schemaNameRaw||"dbo"),i=this.formatter.escapingStringDelimiters(this.tableNameRaw),s=`N'MS_Description', N'${t}', N'Schema', N'${n}', N'Table', N'${i}'`,o=`EXISTS(SELECT * FROM sys.fn_listextendedproperty(N'MS_Description', N'Schema', N'${n}', N'Table', N'${i}', NULL, NULL))`;this.pushQuery(`IF ${o}
  EXEC sys.sp_updateextendedproperty ${s}
ELSE
  EXEC sys.sp_addextendedproperty ${s}`)}addColumns(e,t){t=t||this.addColumnsPrefix,e.sql.length>0&&this.pushQuery({sql:(this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+t+e.sql.join(", "),bindings:e.bindings})}alterColumns(e,t){for(let n=0,i=t.length;n<i;n++){let s=t[n];if(s.modified.defaultTo){let a=`
              DECLARE @constraint varchar(100) = (SELECT default_constraints.name
                                                  FROM sys.all_columns
                                                  INNER JOIN sys.tables
                                                    ON all_columns.object_id = tables.object_id
                                                  INNER JOIN sys.schemas
                                                    ON tables.schema_id = schemas.schema_id
                                                  INNER JOIN sys.default_constraints
                                                    ON all_columns.default_object_id = default_constraints.object_id
                                                  WHERE schemas.name = '${this.schemaNameRaw||"dbo"}'
                                                  AND tables.name = '${this.tableNameRaw}'
                                                  AND all_columns.name = '${s.getColumnName()}')

              IF @constraint IS NOT NULL EXEC('ALTER TABLE ${this.tableNameRaw} DROP CONSTRAINT ' + @constraint)`;this.pushQuery(a)}}e.sql.forEach(n=>{this.pushQuery({sql:(this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+(this.lowerCase?this.alterColumnPrefix.toLowerCase():this.alterColumnPrefix)+n,bindings:e.bindings})})}dropColumn(){let e=this,t=a8.normalizeArr.apply(null,arguments),i=(Array.isArray(t)?t:[t]).map(o=>e.formatter.wrap(o)),s=this.schemaNameRaw||"dbo";for(let o of t){let a=`
              DECLARE @constraint varchar(100) = (SELECT default_constraints.name
                                                  FROM sys.all_columns
                                                  INNER JOIN sys.tables
                                                    ON all_columns.object_id = tables.object_id
                                                  INNER JOIN sys.schemas
                                                    ON tables.schema_id = schemas.schema_id
                                                  INNER JOIN sys.default_constraints
                                                    ON all_columns.default_object_id = default_constraints.object_id
                                                  WHERE schemas.name = '${s}'
                                                  AND tables.name = '${this.tableNameRaw}'
                                                  AND all_columns.name = '${o}')

              IF @constraint IS NOT NULL EXEC('ALTER TABLE ${this.tableNameRaw} DROP CONSTRAINT ' + @constraint)`;this.pushQuery(a)}this.pushQuery((this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+this.dropColumnPrefix+i.join(", "))}changeType(){}renameColumn(e,t){this.pushQuery(`exec sp_rename ${this.client.parameter(this.tableName()+"."+e,this.tableBuilder,this.bindingsHolder)}, ${this.client.parameter(t,this.tableBuilder,this.bindingsHolder)}, 'COLUMN'`)}dropFKRefs(e,t){let n=this.client.formatter(this.tableBuilder);return Promise.all(t.map(function(i){let s=n.wrap(i.CONSTRAINT_NAME),o=n.wrap(i.TABLE_NAME);return e.query({sql:`ALTER TABLE ${o} DROP CONSTRAINT ${s}`})}))}createFKRefs(e,t){let n=this.client.formatter(this.tableBuilder);return Promise.all(t.map(function(i){let s=n.wrap(i.TABLE_NAME),o=n.wrap(i.CONSTRAINT_NAME),a=n.columnize(i.COLUMN_NAME),u=n.columnize(i.REFERENCED_COLUMN_NAME),c=n.wrap(i.REFERENCED_TABLE_NAME),h=` ON UPDATE ${i.UPDATE_RULE}`,f=` ON DELETE ${i.DELETE_RULE}`;return e.query({sql:`ALTER TABLE ${s} ADD CONSTRAINT ${o} FOREIGN KEY (`+a+") REFERENCES "+c+" ("+u+")"+h+f})}))}index(e,t,n){t=t?this.formatter.wrap(t):this._indexCommand("index",this.tableNameRaw,e);let i;bl(n)&&({predicate:i}=n);let s=i?" "+this.client.queryCompiler(i).where():"";this.pushQuery(`CREATE INDEX ${t} ON ${this.tableName()} (${this.formatter.columnize(e)})${s}`)}primary(e,t){let n;bl(t)&&({constraintName:t,deferrable:n}=t),n&&n!=="not deferrable"&&this.client.logger.warn(`mssql: primary key constraint [${t}] will not be deferrable ${n} because mssql does not support deferred constraints.`),t=t?this.formatter.wrap(t):this.formatter.wrap(`${this.tableNameRaw}_pkey`),this.forCreate?this.pushQuery(`CONSTRAINT ${t} PRIMARY KEY (${this.formatter.columnize(e)})`):this.pushQuery(`ALTER TABLE ${this.tableName()} ADD CONSTRAINT ${t} PRIMARY KEY (${this.formatter.columnize(e)})`)}unique(e,t){let n,i=!1,s;if(bl(t)&&({indexName:t,deferrable:n,useConstraint:i,predicate:s}=t),n&&n!=="not deferrable"&&this.client.logger.warn(`mssql: unique index [${t}] will not be deferrable ${n} because mssql does not support deferred constraints.`),i&&s)throw new Error("mssql cannot create constraint with predicate");if(t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),Array.isArray(e)||(e=[e]),i)this.pushQuery(`ALTER TABLE ${this.tableName()} ADD CONSTRAINT ${t} UNIQUE (${this.formatter.columnize(e)})`);else{let o=s?" "+this.client.queryCompiler(s).where():" WHERE "+e.map(a=>this.formatter.columnize(a)+" IS NOT NULL").join(" AND ");this.pushQuery(`CREATE UNIQUE INDEX ${t} ON ${this.tableName()} (${this.formatter.columnize(e)})${o}`)}}dropIndex(e,t){t=t?this.formatter.wrap(t):this._indexCommand("index",this.tableNameRaw,e),this.pushQuery(`DROP INDEX ${t} ON ${this.tableName()}`)}dropForeign(e,t){t=t?this.formatter.wrap(t):this._indexCommand("foreign",this.tableNameRaw,e),this.pushQuery(`ALTER TABLE ${this.tableName()} DROP CONSTRAINT ${t}`)}dropPrimary(e){e=e?this.formatter.wrap(e):this.formatter.wrap(`${this.tableNameRaw}_pkey`),this.pushQuery(`ALTER TABLE ${this.tableName()} DROP CONSTRAINT ${e}`)}dropUnique(e,t){t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),this.pushQuery(`DROP INDEX ${t} ON ${this.tableName()}`)}};Ze.prototype.createAlterTableMethods=["foreign","primary"];Ze.prototype.lowerCase=!1;Ze.prototype.addColumnsPrefix="ADD ";Ze.prototype.dropColumnPrefix="DROP COLUMN ";Ze.prototype.alterColumnPrefix="ALTER COLUMN ";yx.exports=Ze});var _x=l((ese,wx)=>{var u8=_t(),{columnize:l8}=F(),wl=class extends u8{constructor(e,t){super(e,t)}createQuery(e,t,n,i){let o="CREATE "+(i?"OR ALTER ":"")+"VIEW "+this.viewName(),a=e?" ("+l8(e,this.viewBuilder,this.client,this.bindingsHolder)+")":"";o+=a,o+=" AS ",o+=t.toString(),this.pushQuery({sql:o})}renameColumn(e,t){this.pushQuery(`exec sp_rename ${this.client.parameter(this.viewName()+"."+e,this.viewBuilder,this.bindingsHolder)}, ${this.client.parameter(t,this.viewBuilder,this.bindingsHolder)}, 'COLUMN'`)}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}};wx.exports=wl});var Ex=l((tse,qx)=>{var c8=Ge(),{toNumber:_l}=D(),{formatDefault:h8}=Ue(),{operator:f8}=F(),K=class extends c8{constructor(e,t,n){super(e,t,n),this.modifiers=["nullable","defaultTo","first","after","comment"],this._addCheckModifiers()}double(e,t){return"float"}floating(e,t){return"float"}integer(){return"int"}tinyint(){return"tinyint"}varchar(e){return`nvarchar(${_l(e,255)})`}timestamp({useTz:e=!1}={}){return e?"datetimeoffset":"datetime2"}bit(e){return e>1&&this.client.logger.warn("Bit field is exactly 1 bit length for MSSQL"),"bit"}binary(e){return e?`varbinary(${_l(e)})`:"varbinary(max)"}first(){return this.client.logger.warn("Column first modifier not available for MSSQL"),""}after(e){return this.client.logger.warn("Column after modifier not available for MSSQL"),""}defaultTo(e,{constraintName:t}={}){let n=h8(e,this.type,this.client);return t=typeof t<"u"?t:`${this.tableCompiler.tableNameRaw}_${this.getColumnName()}_default`.toLowerCase(),this.columnBuilder._method==="alter"?(this.pushAdditional(function(){this.pushQuery(`ALTER TABLE ${this.tableCompiler.tableName()} ADD CONSTRAINT ${this.formatter.wrap(t)} DEFAULT ${n} FOR ${this.formatter.wrap(this.getColumnName())}`)}),""):t?`CONSTRAINT ${this.formatter.wrap(t)} DEFAULT ${n}`:`DEFAULT ${n}`}comment(e){if(!e)return;e&&e.length>7500/2&&this.client.logger.warn("Your comment might be longer than the max comment length for MSSQL of 7,500 bytes.");let t=this.formatter.escapingStringDelimiters(e),n=this.tableCompiler.schemaNameRaw||"dbo",i=this.formatter.escapingStringDelimiters(this.tableCompiler.tableNameRaw),s=this.formatter.escapingStringDelimiters(this.args[0]||this.defaults("columnName")),o=`N'MS_Description', N'${t}', N'Schema', N'${n}', N'Table', N'${i}', N'Column', N'${s}'`;return this.pushAdditional(function(){let a=`EXISTS(SELECT * FROM sys.fn_listextendedproperty(N'MS_Description', N'Schema', N'${n}', N'Table', N'${i}', N'Column', N'${s}'))`;this.pushQuery(`IF ${a}
  EXEC sys.sp_updateextendedproperty ${o}
ELSE
  EXEC sys.sp_addextendedproperty ${o}`)}),""}checkLength(e,t,n){return this._check(`LEN(${this.formatter.wrap(this.getColumnName())}) ${f8(e,this.columnBuilder,this.bindingsHolder)} ${_l(t)}`,n)}checkRegex(e,t){return this._check(`${this.formatter.wrap(this.getColumnName())} LIKE ${this.client._escapeBinding("%"+e+"%")}`,t)}increments(e={primaryKey:!0}){return"int identity(1,1) not null"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")}bigincrements(e={primaryKey:!0}){return"bigint identity(1,1) not null"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")}};K.prototype.bigint="bigint";K.prototype.mediumint="int";K.prototype.smallint="smallint";K.prototype.text="nvarchar(max)";K.prototype.mediumtext="nvarchar(max)";K.prototype.longtext="nvarchar(max)";K.prototype.json=K.prototype.jsonb="nvarchar(max)";K.prototype.enu="nvarchar(100)";K.prototype.uuid=({useBinaryUuid:r=!1}={})=>r?"binary(16)":"uniqueidentifier";K.prototype.datetime="datetime2";K.prototype.bool="bit";qx.exports=K});var Tx=l((rse,xx)=>{var d8=He(),p8=ix(),m8=ze(),g8=ox(),y8=lx(),b8=px(),w8=gx(),_8=bx(),q8=_x(),E8=Ex(),C8=Oe(),H=ae()("knex:mssql"),Cx={MIN:-2147483648,MAX:2147483647},vx={MIN:-9007199254740991,MAX:9007199254740991},us=class extends m8{constructor(e={}){super(e)}_generateConnection(){let e=this.connectionSettings;e.options=e.options||{};let t={authentication:{type:e.type||"default",options:{userName:e.userName||e.user,password:e.password,domain:e.domain,token:e.token,clientId:e.clientId,clientSecret:e.clientSecret,tenantId:e.tenantId,msiEndpoint:e.msiEndpoint}},server:e.server||e.host,options:{database:e.database,encrypt:e.encrypt||!1,port:e.port||1433,connectTimeout:e.connectionTimeout||e.timeout||15e3,requestTimeout:p8(e.requestTimeout)?15e3:e.requestTimeout,rowCollectionOnDone:!1,rowCollectionOnRequestCompletion:!1,useColumnNames:!1,tdsVersion:e.options.tdsVersion||"7_4",appName:e.options.appName||"knex",trustServerCertificate:!1,...e.options}};return t.options.instanceName&&delete t.options.port,isNaN(t.options.requestTimeout)&&(t.options.requestTimeout=15e3),t.options.requestTimeout===1/0&&(t.options.requestTimeout=0),t.options.requestTimeout<0&&(t.options.requestTimeout=0),e.debug&&(t.options.debug={packet:!0,token:!0,data:!0,payload:!0}),t}_driver(){return require("tedious")}formatter(){return new g8(this,...arguments)}transaction(){return new y8(this,...arguments)}queryCompiler(){return new b8(this,...arguments)}schemaCompiler(){return new w8(this,...arguments)}tableCompiler(){return new _8(this,...arguments)}viewCompiler(){return new q8(this,...arguments)}queryBuilder(){return new C8(this)}columnCompiler(){return new E8(this,...arguments)}wrapIdentifierImpl(e){return e==="*"?"*":`[${e.replace(/[[\]]+/g,"")}]`}acquireRawConnection(){return new Promise((e,t)=>{H("connection::connection new connection requested");let n=this._driver(),i=Object.assign({},this._generateConnection()),s=new n.Connection(i);s.connect(o=>o?(H("connection::connect error: %s",o.message),t(o)):(H("connection::connect connected to server"),s.connected=!0,s.on("error",a=>{H("connection::error message=%s",a.message),s.__knex__disposed=a,s.connected=!1}),s.once("end",()=>{s.connected=!1,s.__knex__disposed="Connection to server was terminated.",H("connection::end connection ended.")}),e(s)))})}validateConnection(e){return e&&e.connected}destroyRawConnection(e){return H("connection::destroy"),new Promise(t=>{e.once("end",()=>{t()}),e.close()})}positionBindings(e){let t=-1;return e.replace(/\\?\?/g,n=>n==="\\?"?"?":(t+=1,`@p${t}`))}_chomp(e){if(e.state.name==="LoggedIn"){let t=this.requestQueue.pop();t&&(H("connection::query executing query, %d more in queue",this.requestQueue.length),e.execSql(t))}}_enqueueRequest(e,t){this.requestQueue.push(e),this._chomp(t)}_makeRequest(e,t){let n=this._driver(),i=typeof e=="string"?e:e.sql,s=0;if(!i)throw new Error("The query is empty");H("request::request sql=%s",i);let o=new n.Request(i,(a,u)=>{if(a)return H("request::error message=%s",a.message),t(a);s=u,H("request::callback rowCount=%d",s)});return o.on("prepared",()=>{H("request %s::request prepared",this.id)}),o.on("done",(a,u)=>{H("request::done rowCount=%d more=%s",a,u)}),o.on("doneProc",(a,u)=>{H("request::doneProc id=%s rowCount=%d more=%s",o.id,a,u)}),o.on("doneInProc",(a,u)=>{H("request::doneInProc id=%s rowCount=%d more=%s",o.id,a,u)}),o.once("requestCompleted",()=>(H("request::completed id=%s",o.id),t(null,s))),o.on("error",a=>(H("request::error id=%s message=%s",o.id,a.message),t(a))),o}_stream(e,t,n){return new Promise((i,s)=>{let o=this._makeRequest(t,a=>{if(a)return n.emit("error",a),s(a);i()});o.on("row",a=>{n.write(a.reduce((u,c)=>({...u,[c.metadata.colName]:c.value}),{}))}),o.on("error",a=>{n.emit("error",a),s(a)}),o.once("requestCompleted",()=>{n.end(),i()}),this._assignBindings(o,t.bindings),this._enqueueRequest(o,e)})}_assignBindings(e,t){if(Array.isArray(t))for(let n=0;n<t.length;n++){let i=t[n];this._setReqInput(e,n,i)}}_scaleForBinding(e){if(e%1===0)throw new Error(`The binding value ${e} must be a decimal number.`);return{scale:10}}_typeForBinding(e){let t=this._driver();if(this.connectionSettings.options&&this.connectionSettings.options.mapBinding){let n=this.connectionSettings.options.mapBinding(e);if(n)return[n.value,n.type]}switch(typeof e){case"string":return[e,t.TYPES.NVarChar];case"boolean":return[e,t.TYPES.Bit];case"number":{if(e%1!==0)return[e,t.TYPES.Float];if(e<Cx.MIN||e>Cx.MAX){if(e<vx.MIN||e>vx.MAX)throw new Error(`Bigint must be safe integer or must be passed as string, saw ${e}`);return[e,t.TYPES.BigInt]}return[e,t.TYPES.Int]}default:return e instanceof Date?[e,t.TYPES.DateTime]:e instanceof Buffer?[e,t.TYPES.VarBinary]:[e,t.TYPES.NVarChar]}}_query(e,t){return new Promise((n,i)=>{let s=[],o=this._makeRequest(t,(a,u)=>{if(a)return i(a);t.response=s,process.nextTick(()=>this._chomp(e)),n(t)});o.on("row",a=>{H("request::row"),s.push(a)}),this._assignBindings(o,t.bindings),this._enqueueRequest(o,e)})}_setReqInput(e,t,n){let[i,s]=this._typeForBinding(n),o="p".concat(t),a;typeof i=="number"&&i%1!==0&&(a=this._scaleForBinding(i)),H("request::binding pos=%d type=%s value=%s",t,s.name,i),Buffer.isBuffer(i)&&(a={length:"max"}),e.addParameter(o,s,i,a)}processResponse(e,t){if(e==null)return;let{response:n}=e,{method:i}=e;if(e.output||(n=n.map(s=>s.reduce((o,a)=>{let u=a.metadata.colName;return o[u]?(Array.isArray(o[u])||(o[u]=[o[u]]),o[u].push(a.value)):o[u]=a.value,o},{})),e.output))return e.output.call(t,n);switch(i){case"select":return n;case"first":return n[0];case"pluck":return d8(n,e.pluck);case"insert":case"del":case"update":case"counter":return e.returning&&e.returning==="@@rowcount"?n[0][""]:n;default:return n}}};Object.assign(us.prototype,{requestQueue:[],dialect:"mssql",driverName:"mssql"});xx.exports=us});var Sx=l((nse,Ax)=>{var v8="Expected a function";function x8(r,e,t){if(typeof r!="function")throw new TypeError(v8);return setTimeout(function(){r.apply(void 0,t)},e)}Ax.exports=x8});var Ox=l((ise,Nx)=>{var T8=Sx(),A8=ut(),S8=A8(function(r,e){return T8(r,1,e)});Nx.exports=S8});var Ix=l((sse,Rx)=>{var N8=Se(),O8=ae(),R8=O8("knex:tx"),ql=class extends N8{query(e,t,n,i){let s=this,o=this.trxClient.query(e,t).catch(a=>{if(a.errno===1305){this.trxClient.logger.warn("Transaction was implicitly committed, do not mix transactions and DDL with MySQL (#805)");return}n=2,i=a,s._completed=!0,R8("%s error running transaction query",s.txid)}).then(function(a){if(n===1&&s._resolver(i),n===2){if(i===void 0){if(s.doNotRejectOnRollback&&/^ROLLBACK\b/i.test(t)){s._resolver();return}i=new Error(`Transaction rejected with non-error: ${i}`)}s._rejecter(i)}return a});return(n===1||n===2)&&(s._completed=!0),o}};Rx.exports=ql});var Bx=l((ose,Mx)=>{var $x=require("assert"),I8=z(),$8=we(),P8=te(),L8=Ve(),{wrapAsIdentifier:Px}=Ue(),{columnize:k8,wrap:Lx}=F(),kx=r=>$8(r)||Array.isArray(r),El=class extends L8{constructor(e,t,n){super(e,t,n);let{returning:i}=this.single;i&&this.client.logger.warn(".returning() is not supported by mysql and will not have any effect."),this._emptyInsertValue="() values ()"}insert(){let e=super.insert();if(e==="")return e;let{ignore:t,merge:n,insert:i}=this.single;if(t&&(e=e.replace("insert into","insert ignore into")),n&&(e+=this._merge(n.updates,i),this.where()))throw new Error(".onConflict().merge().where() is not supported for mysql");return e}_merge(e,t){let n=" on duplicate key update ";if(e&&Array.isArray(e))return n+e.map(i=>Px(i,this.formatter.builder,this.client)).map(i=>`${i} = values(${i})`).join(", ");if(e&&typeof e=="object"){let i=this._prepUpdate(e);return n+i.join(",")}else{let i=this._prepInsert(t);if(typeof i=="string")throw new Error("If using merge with a raw insert query, then updates must be provided");return n+i.columns.map(s=>Px(s,this.builder,this.client)).map(s=>`${s} = values(${s})`).join(", ")}}update(){let e=this.with(),t=this.join(),n=this._prepUpdate(this.single.update),i=this.where(),s=this.order(),o=this.limit();return e+`update ${this.tableName}`+(t?` ${t}`:"")+" set "+n.join(", ")+(i?` ${i}`:"")+(s?` ${s}`:"")+(o?` ${o}`:"")}forUpdate(){return"for update"}forShare(){return"lock in share mode"}skipLocked(){return"skip locked"}noWait(){return"nowait"}columnInfo(){let e=this.single.columnInfo;return{sql:"select * from information_schema.columns where table_name = ? and table_schema = ?",bindings:[this.client.customWrapIdentifier(this.single.table,I8),this.client.database()],output(n){let i=n.reduce(function(s,o){return s[o.COLUMN_NAME]={defaultValue:o.COLUMN_DEFAULT==="NULL"?null:o.COLUMN_DEFAULT,type:o.DATA_TYPE,maxLength:o.CHARACTER_MAXIMUM_LENGTH,nullable:o.IS_NULLABLE==="YES"},s},{});return e&&i[e]||i}}}limit(){let e=!this.single.limit&&this.single.limit!==0;return e&&!this.single.offset?"":`limit ${this.single.offset&&e?"18446744073709551615":this._getValueOrParameterFromAttribute("limit")}`}whereBasic(e){return $x(!kx(e.value),"The values in where clause must not be object or array."),super.whereBasic(e)}whereRaw(e){return $x(P8(e.value.bindings)||!Object.values(e.value.bindings).some(kx),"The values in where clause must not be object or array."),super.whereRaw(e)}whereLike(e){return`${this._columnClause(e)} ${this._not(e,"like ")}${this._valueClause(e)} COLLATE utf8_bin`}whereILike(e){return`${this._columnClause(e)} ${this._not(e,"like ")}${this._valueClause(e)}`}jsonExtract(e){return this._jsonExtract(["json_extract","json_unquote"],e)}jsonSet(e){return this._jsonSet("json_set",e)}jsonInsert(e){return this._jsonSet("json_insert",e)}jsonRemove(e){let t=`json_remove(${k8(e.column,this.builder,this.client,this.bindingsHolder)},${this.client.parameter(e.path,this.builder,this.bindingsHolder)})`;return e.alias?this.client.alias(t,this.formatter.wrap(e.alias)):t}whereJsonObject(e){return this._not(e,`json_contains(${this._columnClause(e)}, ${this._jsonValueClause(e)})`)}whereJsonPath(e){return this._whereJsonPath("json_extract",e)}whereJsonSupersetOf(e){return this._not(e,`json_contains(${Lx(e.column,void 0,this.builder,this.client,this.bindingsHolder)},${this._jsonValueClause(e)})`)}whereJsonSubsetOf(e){return this._not(e,`json_contains(${this._jsonValueClause(e)},${Lx(e.column,void 0,this.builder,this.client,this.bindingsHolder)})`)}onJsonPathEquals(e){return this._onJsonPathEquals("json_extract",e)}};Mx.exports=El});var Dx=l((ase,jx)=>{var M8=yt(),Cl=class extends M8{constructor(e,t){super(e,t)}renameTable(e,t){this.pushQuery(`rename table ${this.formatter.wrap(e)} to ${this.formatter.wrap(t)}`)}renameView(e,t){this.renameTable(e,t)}hasTable(e){let t="select * from information_schema.tables where table_name = ?",n=[e];this.schema?(t+=" and table_schema = ?",n.push(this.schema)):t+=" and table_schema = database()",this.pushQuery({sql:t,bindings:n,output:function(s){return s.length>0}})}hasColumn(e,t){this.pushQuery({sql:`show columns from ${this.formatter.wrap(e)}`,output(n){return n.some(i=>this.client.wrapIdentifier(i.Field.toLowerCase())===this.client.wrapIdentifier(t.toLowerCase()))}})}};jx.exports=Cl});var Qx=l((use,Fx)=>{var B8=bt(),{isObject:vl,isString:j8}=A(),pr=class extends B8{constructor(e,t){super(e,t)}createQuery(e,t,n){let i=t?"create table if not exists ":"create table ",{client:s}=this,o={},a=" ("+e.sql.join(", ");a+=this.primaryKeys()||"",a+=this._addChecks(),a+=")";let u=i+this.tableName()+(n&&this.tableNameLike()?" like "+this.tableNameLike():a);s.connectionSettings&&(o=s.connectionSettings);let c=this.single.charset||o.charset||"",h=this.single.collate||o.collate||"",f=this.single.engine||"";if(c&&!n&&(u+=` default character set ${c}`),h&&(u+=` collate ${h}`),f&&(u+=` engine = ${f}`),this.single.comment){let d=this.single.comment||"",g=1024;d.length>g&&this.client.logger.warn(`The max length for a table comment is ${g} characters`),u+=` comment = '${d}'`}this.pushQuery(u),n&&this.addColumns(e,this.addColumnsPrefix)}comment(e){this.pushQuery(`alter table ${this.tableName()} comment = '${e}'`)}changeType(){}renameColumn(e,t){let n=this,i=this.tableName(),s=this.formatter.wrap(e)+" "+this.formatter.wrap(t);this.pushQuery({sql:`show full fields from ${i} where field = `+this.client.parameter(e,this.tableBuilder,this.bindingsHolder),output(o){let a=o[0],u=this;return n.getFKRefs(u).then(([c])=>new Promise((h,f)=>{try{c.length||h(),h(n.dropFKRefs(u,c))}catch(d){f(d)}}).then(function(){let h=`alter table ${i} change ${s} ${a.Type}`;return String(a.Null).toUpperCase()!=="YES"?h+=" NOT NULL":h+=" NULL",a.Default!==void 0&&a.Default!==null&&(h+=` DEFAULT '${a.Default}'`),a.Collation!==void 0&&a.Collation!==null&&(h+=` COLLATE '${a.Collation}'`),a.Extra=="auto_increment"&&(h+=" AUTO_INCREMENT"),u.query({sql:h})}).then(function(){if(c.length)return n.createFKRefs(u,c.map(function(h){return h.REFERENCED_COLUMN_NAME===e&&(h.REFERENCED_COLUMN_NAME=t),h.COLUMN_NAME===e&&(h.COLUMN_NAME=t),h}))}))}})}primaryKeys(){let e=(this.grouped.alterTable||[]).filter(t=>t.method==="primary");if(e.length>0&&e[0].args.length>0){let t=e[0].args[0],n=e[0].args[1]||"";if(n&&(n=" constraint "+this.formatter.wrap(n)),this.grouped.columns){let i=this._getIncrementsColumnNames();i.length&&i.forEach(s=>{t.includes(s)||t.unshift(s)})}return`,${n} primary key (${this.formatter.columnize(t)})`}}getFKRefs(e){let t={bindings:[]},n="SELECT KCU.CONSTRAINT_NAME, KCU.TABLE_NAME, KCU.COLUMN_NAME,        KCU.REFERENCED_TABLE_NAME, KCU.REFERENCED_COLUMN_NAME,        RC.UPDATE_RULE, RC.DELETE_RULE FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS KCU JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS AS RC        USING(CONSTRAINT_NAME)WHERE KCU.REFERENCED_TABLE_NAME = "+this.client.parameter(this.tableNameRaw,this.tableBuilder,t)+"   AND KCU.CONSTRAINT_SCHEMA = "+this.client.parameter(this.client.database(),this.tableBuilder,t)+"   AND RC.CONSTRAINT_SCHEMA = "+this.client.parameter(this.client.database(),this.tableBuilder,t);return e.query({sql:n,bindings:t.bindings})}dropFKRefs(e,t){let n=this.client.formatter(this.tableBuilder);return Promise.all(t.map(function(i){let s=n.wrap(i.CONSTRAINT_NAME),o=n.wrap(i.TABLE_NAME);return e.query({sql:`alter table ${o} drop foreign key ${s}`})}))}createFKRefs(e,t){let n=this.client.formatter(this.tableBuilder);return Promise.all(t.map(function(i){let s=n.wrap(i.TABLE_NAME),o=n.wrap(i.CONSTRAINT_NAME),a=n.columnize(i.COLUMN_NAME),u=n.columnize(i.REFERENCED_COLUMN_NAME),c=n.wrap(i.REFERENCED_TABLE_NAME),h=` ON UPDATE ${i.UPDATE_RULE}`,f=` ON DELETE ${i.DELETE_RULE}`;return e.query({sql:`alter table ${s} add constraint ${o} foreign key (`+a+") references "+c+" ("+u+")"+h+f})}))}index(e,t,n){let i,s;j8(n)?s=n:vl(n)&&({indexType:s,storageEngineIndexType:i}=n),t=t?this.formatter.wrap(t):this._indexCommand("index",this.tableNameRaw,e),i=i?` using ${i}`:"",this.pushQuery(`alter table ${this.tableName()} add${s?` ${s}`:""} index ${t}(${this.formatter.columnize(e)})${i}`)}primary(e,t){let n;vl(t)&&({constraintName:t,deferrable:n}=t),n&&n!=="not deferrable"&&this.client.logger.warn(`mysql: primary key constraint \`${t}\` will not be deferrable ${n} because mysql does not support deferred constraints.`),t=t?this.formatter.wrap(t):this.formatter.wrap(`${this.tableNameRaw}_pkey`);let i=e,s=[];this.grouped.columns&&(s=this._getIncrementsColumnNames(),s&&s.forEach(o=>{i.includes(o)||i.unshift(o)})),this.method!=="create"&&this.method!=="createIfNot"&&this.pushQuery(`alter table ${this.tableName()} add primary key ${t}(${this.formatter.columnize(i)})`),s.length&&this.pushQuery(`alter table ${this.tableName()} modify column ${this.formatter.columnize(s)} int unsigned not null auto_increment`)}unique(e,t){let n,i;vl(t)&&({indexName:t,deferrable:i,storageEngineIndexType:n}=t),i&&i!=="not deferrable"&&this.client.logger.warn(`mysql: unique index \`${t}\` will not be deferrable ${i} because mysql does not support deferred constraints.`),t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),n=n?` using ${n}`:"",this.pushQuery(`alter table ${this.tableName()} add unique ${t}(${this.formatter.columnize(e)})${n}`)}dropIndex(e,t){t=t?this.formatter.wrap(t):this._indexCommand("index",this.tableNameRaw,e),this.pushQuery(`alter table ${this.tableName()} drop index ${t}`)}dropForeign(e,t){t=t?this.formatter.wrap(t):this._indexCommand("foreign",this.tableNameRaw,e),this.pushQuery(`alter table ${this.tableName()} drop foreign key ${t}`)}dropPrimary(){this.pushQuery(`alter table ${this.tableName()} drop primary key`)}dropUnique(e,t){t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),this.pushQuery(`alter table ${this.tableName()} drop index ${t}`)}};pr.prototype.addColumnsPrefix="add ";pr.prototype.alterColumnsPrefix="modify ";pr.prototype.dropColumnPrefix="drop ";Fx.exports=pr});var Hx=l((lse,Ux)=>{var D8=Ge(),{isObject:ls}=A(),{toNumber:mr}=D(),F8=/(?<!\\)'/g,gr=class extends D8{constructor(e,t,n){super(e,t,n),this.modifiers=["unsigned","nullable","defaultTo","comment","collate","first","after"],this._addCheckModifiers()}double(e,t){return e?`double(${mr(e,8)}, ${mr(t,2)})`:"double"}integer(e){return e=e?`(${mr(e,11)})`:"",`int${e}`}tinyint(e){return e=e?`(${mr(e,1)})`:"",`tinyint${e}`}text(e){switch(e){case"medium":case"mediumtext":return"mediumtext";case"long":case"longtext":return"longtext";default:return"text"}}mediumtext(){return this.text("medium")}longtext(){return this.text("long")}enu(e){return`enum('${e.join("', '")}')`}datetime(e){return ls(e)&&({precision:e}=e),typeof e=="number"?`datetime(${e})`:"datetime"}timestamp(e){return ls(e)&&({precision:e}=e),typeof e=="number"?`timestamp(${e})`:"timestamp"}time(e){return ls(e)&&({precision:e}=e),typeof e=="number"?`time(${e})`:"time"}bit(e){return e?`bit(${mr(e)})`:"bit"}binary(e){return e?`varbinary(${mr(e)})`:"blob"}json(){return"json"}jsonb(){return"json"}defaultTo(e){if(e==null)return;if((this.type==="json"||this.type==="jsonb")&&ls(e))return`default ('${JSON.stringify(e)}')`;let t=super.defaultTo.apply(this,arguments);return this.type!=="blob"&&this.type.indexOf("text")===-1?t:""}unsigned(){return"unsigned"}comment(e){return e&&e.length>255&&this.client.logger.warn("Your comment is longer than the max comment length for MySQL"),e&&`comment '${e.replace(F8,"\\'")}'`}first(){return"first"}after(e){return`after ${this.formatter.wrap(e)}`}collate(e){return e&&`collate '${e}'`}checkRegex(e,t){return this._check(`${this.formatter.wrap(this.getColumnName())} REGEXP ${this.client._escapeBinding(e)}`,t)}increments(e={primaryKey:!0}){return"int unsigned not null"+(this.tableCompiler._canBeAddPrimaryKey(e)?" auto_increment primary key":"")}bigincrements(e={primaryKey:!0}){return"bigint unsigned not null"+(this.tableCompiler._canBeAddPrimaryKey(e)?" auto_increment primary key":"")}};gr.prototype.bigint="bigint";gr.prototype.mediumint="mediumint";gr.prototype.smallint="smallint";Ux.exports=gr});var Vx=l((cse,Wx)=>{var Q8=_t(),xl=class extends Q8{constructor(e,t){super(e,t)}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}};Wx.exports=xl});var zx=l((hse,Gx)=>{var U8=rr(),Tl=class extends U8{constructor(){super(...arguments)}checkOption(){this._single.checkOption="default_option"}localCheckOption(){this._single.checkOption="local"}cascadedCheckOption(){this._single.checkOption="cascaded"}};Gx.exports=Tl});var Al=l((fse,Jx)=>{var H8=Ox(),W8=He(),{promisify:V8}=require("util"),G8=ze(),z8=Ix(),J8=Bx(),K8=Dx(),Y8=Qx(),X8=Hx(),{makeEscape:Z8}=Rn(),e5=Vx(),t5=zx(),cs=class extends G8{_driver(){return require("mysql")}queryCompiler(e,t){return new J8(this,e,t)}schemaCompiler(){return new K8(this,...arguments)}tableCompiler(){return new Y8(this,...arguments)}viewCompiler(){return new e5(this,...arguments)}viewBuilder(){return new t5(this,...arguments)}columnCompiler(){return new X8(this,...arguments)}transaction(){return new z8(this,...arguments)}wrapIdentifierImpl(e){return e!=="*"?`\`${e.replace(/`/g,"``")}\``:"*"}acquireRawConnection(){return new Promise((e,t)=>{let n=this.driver.createConnection(this.connectionSettings);n.on("error",i=>{n.__knex__disposed=i}),n.connect(i=>{if(i)return n.removeAllListeners(),t(i);e(n)})})}async destroyRawConnection(e){try{return await V8(n=>e.end(n))()}catch(t){e.__knex__disposed=t}finally{H8(()=>e.removeAllListeners())}}validateConnection(e){return e.state==="connected"||e.state==="authenticated"}_stream(e,t,n,i){if(!t.sql)throw new Error("The query is empty");i=i||{};let s=Object.assign({sql:t.sql},t.options);return new Promise((o,a)=>{n.on("error",a),n.on("end",o);let u=e.query(s,t.bindings).stream(i);u.on("error",c=>{a(c),n.emit("error",c)}),u.pipe(n)})}_query(e,t){if((!t||typeof t=="string")&&(t={sql:t}),!t.sql)throw new Error("The query is empty");return new Promise(function(n,i){if(!t.sql){n();return}let s=Object.assign({sql:t.sql},t.options);e.query(s,t.bindings,function(o,a,u){if(o)return i(o);t.response=[a,u],n(t)})})}processResponse(e,t){if(e==null)return;let{response:n}=e,{method:i}=e,s=n[0],o=n[1];if(e.output)return e.output.call(t,s,o);switch(i){case"select":return s;case"first":return s[0];case"pluck":return W8(s,e.pluck);case"insert":return[s.insertId];case"del":case"update":case"counter":return s.affectedRows;default:return n}}async cancelQuery(e){let t=await this.acquireRawConnection();try{return await this._wrappedCancelQueryCall(t,e)}finally{await this.destroyRawConnection(t),t.__knex__disposed&&this.logger.warn(`Connection Error: ${t.__knex__disposed}`)}}_wrappedCancelQueryCall(e,t){return this._query(e,{sql:"KILL QUERY ?",bindings:[t.threadId],options:{}})}};Object.assign(cs.prototype,{dialect:"mysql",driverName:"mysql",_escapeBinding:Z8(),canCancelQuery:!0});Jx.exports=cs});var Yx=l((dse,Kx)=>{var r5=Se(),n5=ae()("knex:tx"),Sl=class extends r5{query(e,t,n,i){let s=this,o=this.trxClient.query(e,t).catch(a=>{if(a.code==="ER_SP_DOES_NOT_EXIST"){this.trxClient.logger.warn("Transaction was implicitly committed, do not mix transactions and DDL with MySQL (#805)");return}n=2,i=a,s._completed=!0,n5("%s error running transaction query",s.txid)}).then(function(a){if(n===1&&s._resolver(i),n===2){if(i===void 0){if(s.doNotRejectOnRollback&&/^ROLLBACK\b/i.test(t)){s._resolver();return}i=new Error(`Transaction rejected with non-error: ${i}`)}return s._rejecter(i),a}});return(n===1||n===2)&&(s._completed=!0),o}};Kx.exports=Sl});var Zx=l((pse,Xx)=>{var i5=Al(),s5=Yx(),hs=class extends i5{transaction(){return new s5(this,...arguments)}_driver(){return require("mysql2")}validateConnection(e){return e&&!e._fatalError&&!e._protocolError&&!e._closing&&!e.stream.destroyed}};Object.assign(hs.prototype,{driverName:"mysql2"});Xx.exports=hs});var et=l((mse,tT)=>{function o5(r,e,t,n){let i=require("crypto"),s=30;Array.isArray(n)||(n=n?[n]:[]);let o=t.replace(/\.|-/g,"_"),a=n.join("_"),u=`${o}_${a.length?a+"_":""}${e}`.toLowerCase();return u.length>s&&(r.warn(`Automatically generated name "${u}" exceeds ${s} character limit for Oracle. Using base64 encoded sha1 of that name instead.`),u=i.createHash("sha1").update(u).digest("base64").replace("=","")),u}function a5(r,e){return`begin execute immediate '${r.replace(/'/g,"''")}'; exception when others then if sqlcode != ${e} then raise; end if; end;`}function eT(r){this.columnName=r}eT.prototype.toString=function(){return`[object ReturningHelper:${this.columnName}]`};function u5(r){return["DPI-1010","DPI-1080","ORA-03114","ORA-03113","ORA-03135","ORA-12514","ORA-00022","ORA-00028","ORA-00031","ORA-00045","ORA-00378","ORA-00602","ORA-00603","ORA-00609","ORA-01012","ORA-01041","ORA-01043","ORA-01089","ORA-01092","ORA-02396","ORA-03122","ORA-12153","ORA-12537","ORA-12547","ORA-12570","ORA-12583","ORA-27146","ORA-28511","ORA-56600","NJS-024","NJS-003"].some(function(e){return r.message.indexOf(e)===0})}tT.exports={generateCombinedName:o5,isConnectionError:u5,wrapSqlWithCatch:a5,ReturningHelper:eT}});var fs=l((gse,rT)=>{var tt=et(),l5={renameColumnTrigger:function(r,e,t,n){let i=tt.generateCombinedName(r,"autoinc_trg",e),s=tt.generateCombinedName(r,"seq",e);return`DECLARE PK_NAME VARCHAR(200); IS_AUTOINC NUMBER := 0; BEGIN  EXECUTE IMMEDIATE ('ALTER TABLE "${e}" RENAME COLUMN "${t}" TO "${n}"');  SELECT COUNT(*) INTO IS_AUTOINC from "USER_TRIGGERS" where trigger_name = '${i}';  IF (IS_AUTOINC > 0) THEN    SELECT cols.column_name INTO PK_NAME    FROM all_constraints cons, all_cons_columns cols    WHERE cons.constraint_type = 'P'    AND cons.constraint_name = cols.constraint_name    AND cons.owner = cols.owner    AND cols.table_name = '${e}';    IF ('${n}' = PK_NAME) THEN      EXECUTE IMMEDIATE ('DROP TRIGGER "${i}"');      EXECUTE IMMEDIATE ('create or replace trigger "${i}"      BEFORE INSERT on "${e}" for each row        declare        checking number := 1;        begin          if (:new."${n}" is null) then            while checking >= 1 loop              select "${s}".nextval into :new."${n}" from dual;              select count("${n}") into checking from "${e}"              where "${n}" = :new."${n}";            end loop;          end if;        end;');    end if;  end if;END;`},createAutoIncrementTrigger:function(r,e,t){let n=`"${e}"`,i=e,s=t?`"${t}".`:"",o=t?`'${t}'`:"cols.owner",a=tt.generateCombinedName(r,"autoinc_trg",e),c=`"${tt.generateCombinedName(r,"seq",e)}"`;return`DECLARE PK_NAME VARCHAR(200); BEGIN  EXECUTE IMMEDIATE ('CREATE SEQUENCE ${s}${c}');  SELECT cols.column_name INTO PK_NAME  FROM all_constraints cons, all_cons_columns cols  WHERE cons.constraint_type = 'P'  AND cons.constraint_name = cols.constraint_name  AND cons.owner = ${o}  AND cols.table_name = '${i}';  execute immediate ('create or replace trigger ${s}"${a}"  BEFORE INSERT on ${s}${n}  for each row  declare  checking number := 1;  begin    if (:new."' || PK_NAME || '" is null) then      while checking >= 1 loop        select ${s}${c}.nextval into :new."' || PK_NAME || '" from dual;        select count("' || PK_NAME || '") into checking from ${s}${n}        where "' || PK_NAME || '" = :new."' || PK_NAME || '";      end loop;    end if;  end;'); END;`},renameTableAndAutoIncrementTrigger:function(r,e,t){let n=tt.generateCombinedName(r,"autoinc_trg",e),i=tt.generateCombinedName(r,"seq",e),s=tt.generateCombinedName(r,"autoinc_trg",t),o=tt.generateCombinedName(r,"seq",t);return`DECLARE PK_NAME VARCHAR(200); IS_AUTOINC NUMBER := 0; BEGIN  EXECUTE IMMEDIATE ('RENAME "${e}" TO "${t}"');  SELECT COUNT(*) INTO IS_AUTOINC from "USER_TRIGGERS" where trigger_name = '${n}';  IF (IS_AUTOINC > 0) THEN    EXECUTE IMMEDIATE ('DROP TRIGGER "${n}"');    EXECUTE IMMEDIATE ('RENAME "${i}" TO "${o}"');    SELECT cols.column_name INTO PK_NAME    FROM all_constraints cons, all_cons_columns cols    WHERE cons.constraint_type = 'P'    AND cons.constraint_name = cols.constraint_name    AND cons.owner = cols.owner    AND cols.table_name = '${t}';    EXECUTE IMMEDIATE ('create or replace trigger "${s}"    BEFORE INSERT on "${t}" for each row      declare      checking number := 1;      begin        if (:new."' || PK_NAME || '" is null) then          while checking >= 1 loop            select "${o}".nextval into :new."' || PK_NAME || '" from dual;            select count("' || PK_NAME || '") into checking from "${t}"            where "' || PK_NAME || '" = :new."' || PK_NAME || '";          end loop;        end if;      end;');  end if;END;`}};rT.exports=l5});var iT=l((yse,nT)=>{var c5=yt(),Nl=et(),h5=fs(),Ol=class extends c5{constructor(){super(...arguments)}renameTable(e,t){let n=h5.renameTableAndAutoIncrementTrigger(this.client.logger,e,t);this.pushQuery(n)}hasTable(e){this.pushQuery({sql:"select TABLE_NAME from USER_TABLES where TABLE_NAME = "+this.client.parameter(e,this.builder,this.bindingsHolder),output(t){return t.length>0}})}hasColumn(e,t){let n=`select COLUMN_NAME from ALL_TAB_COLUMNS where TABLE_NAME = ${this.client.parameter(e,this.builder,this.bindingsHolder)} and COLUMN_NAME = ${this.client.parameter(t,this.builder,this.bindingsHolder)}`;this.pushQuery({sql:n,output:i=>i.length>0})}dropSequenceIfExists(e){let t=this.schema?`"${this.schema}".`:"";this.pushQuery(Nl.wrapSqlWithCatch(`drop sequence ${t}${this.formatter.wrap(e)}`,-2289))}_dropRelatedSequenceIfExists(e){let t=Nl.generateCombinedName(this.client.logger,"seq",e);this.dropSequenceIfExists(t)}dropTable(e){let t=this.schema?`"${this.schema}".`:"";this.pushQuery(`drop table ${t}${this.formatter.wrap(e)}`),this._dropRelatedSequenceIfExists(e)}dropTableIfExists(e){this.dropObject(e,"table")}dropViewIfExists(e){this.dropObject(e,"view")}dropObject(e,t){let n=this.schema?`"${this.schema}".`:"",i=-942;t==="materialized view"&&(i=-12003),this.pushQuery(Nl.wrapSqlWithCatch(`drop ${t} ${n}${this.formatter.wrap(e)}`,i)),this._dropRelatedSequenceIfExists(e)}refreshMaterializedView(e){return this.pushQuery({sql:`BEGIN DBMS_MVIEW.REFRESH('${this.schemaNameRaw?this.schemaNameRaw+".":""}${e}'); END;`})}dropMaterializedView(e){this._dropView(e,!1,!0)}dropMaterializedViewIfExists(e){this.dropObject(e,"materialized view")}};nT.exports=Ol});var oT=l((bse,sT)=>{var f5=on(),d5=zt(),Rl=class extends f5{constructor(){super(...arguments)}checkIn(){return this._modifiers.checkIn=d5(arguments),this}};sT.exports=Rl});var uT=l((wse,aT)=>{function p5(){}aT.exports=p5});var cT=l((_se,lT)=>{var Il=Js(),m5=uT(),g5=Fr(),y5=1/0,b5=Il&&1/g5(new Il([,-0]))[1]==y5?function(r){return new Il(r)}:m5;lT.exports=b5});var fT=l((qse,hT)=>{var w5=Jn(),_5=yo(),q5=bo(),E5=Yn(),C5=cT(),v5=Fr(),x5=200;function T5(r,e,t){var n=-1,i=_5,s=r.length,o=!0,a=[],u=a;if(t)o=!1,i=q5;else if(s>=x5){var c=e?null:C5(r);if(c)return v5(c);o=!1,i=E5,u=new w5}else u=e?[]:a;e:for(;++n<s;){var h=r[n],f=e?e(h):h;if(h=t||h!==0?h:0,o&&f===f){for(var d=u.length;d--;)if(u[d]===f)continue e;e&&u.push(f),a.push(h)}else i(u,f,t)||(u!==a&&u.push(f),a.push(h))}return a}hT.exports=T5});var pT=l((Ese,dT)=>{var A5=fT();function S5(r){return r&&r.length?A5(r):[]}dT.exports=S5});var gT=l((Cse,mT)=>{var N5=fs();function O5(r){r.pushAdditional(function(){let e=this.tableCompiler.tableNameRaw,t=this.tableCompiler.schemaNameRaw,n=N5.createAutoIncrementTrigger(this.client.logger,e,t);this.pushQuery(n)})}mT.exports={createAutoIncrementTriggerAndSequence:O5}});var $l=l((vse,bT)=>{var R5=pT(),I5=gt(),$5=Ge(),{createAutoIncrementTriggerAndSequence:yT}=gT(),{toNumber:St}=D(),ye=class extends $5{constructor(){super(...arguments),this.modifiers=["defaultTo","checkIn","nullable","comment"]}increments(e={primaryKey:!0}){return yT(this),"integer not null"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")}bigincrements(e={primaryKey:!0}){return yT(this),"number(20, 0) not null"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")}floating(e){let t=St(e,0);return`float${t?`(${t})`:""}`}double(e,t){return`number(${St(e,8)}, ${St(t,2)})`}decimal(e,t){return e===null?"decimal":`decimal(${St(e,8)}, ${St(t,2)})`}integer(e){return e?`number(${St(e,11)})`:"integer"}enu(e){e=R5(e);let t=(e||[]).reduce((n,i)=>Math.max(n,String(i).length),1);return this.columnBuilder._modifiers.checkIn=[e],`varchar2(${t})`}datetime(e){return e?"timestamp":"timestamp with time zone"}timestamp(e){return e?"timestamp":"timestamp with time zone"}bool(){return this.columnBuilder._modifiers.checkIn=[[0,1]],"number(1, 0)"}varchar(e){return`varchar2(${St(e,255)})`}comment(e){let t=this.args[0]||this.defaults("columnName");this.pushAdditional(function(){this.pushQuery(`comment on column ${this.tableCompiler.tableName()}.`+this.formatter.wrap(t)+" is '"+(e||"")+"'")},e)}checkIn(e){return e===void 0?"":(e instanceof I5?e=e.toQuery():Array.isArray(e)?e=e.map(t=>`'${t}'`).join(", "):e=`'${e}'`,`check (${this.formatter.wrap(this.args[0])} in (${e}))`)}};ye.prototype.tinyint="smallint";ye.prototype.smallint="smallint";ye.prototype.mediumint="integer";ye.prototype.biginteger="number(20, 0)";ye.prototype.text="clob";ye.prototype.time="timestamp with time zone";ye.prototype.bit="clob";ye.prototype.json="clob";bT.exports=ye});var Pl=l((xse,qT)=>{var wT=et(),P5=bt(),L5=D(),k5=fs(),{isObject:_T}=A(),En=class extends P5{constructor(){super(...arguments)}addColumns(e,t){if(e.sql.length>0){t=t||this.addColumnsPrefix;let n=e.sql,s=`${this.lowerCase?"alter table ":"ALTER TABLE "}${this.tableName()} ${t}`;e.sql.length>1?s+=`(${n.join(", ")})`:s+=n.join(", "),this.pushQuery({sql:s,bindings:e.bindings})}}renameColumn(e,t){let n=this.tableName().slice(1,-1);return this.pushQuery(k5.renameColumnTrigger(this.client.logger,n,e,t))}compileAdd(e){let t=this.formatter.wrap(e),n=this.prefixArray("add column",this.getColumns(e));return this.pushQuery({sql:`alter table ${t} ${n.join(", ")}`})}createQuery(e,t,n){let i=n&&this.tableNameLike()?" as (select * from "+this.tableNameLike()+" where 0=1)":" ("+e.sql.join(", ")+this._addChecks()+")",s=`create table ${this.tableName()}${i}`;this.pushQuery({sql:t?wT.wrapSqlWithCatch(s,-955):s,bindings:e.bindings}),this.single.comment&&this.comment(this.single.comment),n&&this.addColumns(e,this.addColumnsPrefix)}comment(e){this.pushQuery(`comment on table ${this.tableName()} is '${e}'`)}dropColumn(){let e=L5.normalizeArr.apply(null,arguments);this.pushQuery(`alter table ${this.tableName()} drop (${this.formatter.columnize(e)})`)}_indexCommand(e,t,n){return this.formatter.wrap(wT.generateCombinedName(this.client.logger,e,t,n))}primary(e,t){let n;_T(t)&&({constraintName:t,deferrable:n}=t),n=n?` deferrable initially ${n}`:"",t=t?this.formatter.wrap(t):this.formatter.wrap(`${this.tableNameRaw}_pkey`);let i=e,s=[];this.grouped.columns&&(s=this._getIncrementsColumnNames(),s&&s.forEach(o=>{i.includes(o)||i.unshift(o)})),this.pushQuery(`alter table ${this.tableName()} add constraint ${t} primary key (${this.formatter.columnize(i)})${n}`)}dropPrimary(e){e=e?this.formatter.wrap(e):this.formatter.wrap(this.tableNameRaw+"_pkey"),this.pushQuery(`alter table ${this.tableName()} drop constraint ${e}`)}index(e,t){t=t?this.formatter.wrap(t):this._indexCommand("index",this.tableNameRaw,e),this.pushQuery(`create index ${t} on ${this.tableName()} (`+this.formatter.columnize(e)+")")}dropIndex(e,t){t=t?this.formatter.wrap(t):this._indexCommand("index",this.tableNameRaw,e),this.pushQuery(`drop index ${t}`)}unique(e,t){let n;_T(t)&&({indexName:t,deferrable:n}=t),n=n?` deferrable initially ${n}`:"",t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),this.pushQuery(`alter table ${this.tableName()} add constraint ${t} unique (`+this.formatter.columnize(e)+")"+n)}dropUnique(e,t){t=t?this.formatter.wrap(t):this._indexCommand("unique",this.tableNameRaw,e),this.pushQuery(`alter table ${this.tableName()} drop constraint ${t}`)}dropForeign(e,t){t=t?this.formatter.wrap(t):this._indexCommand("foreign",this.tableNameRaw,e),this.pushQuery(`alter table ${this.tableName()} drop constraint ${t}`)}};En.prototype.addColumnsPrefix="add ";En.prototype.alterColumnsPrefix="modify ";qT.exports=En});var Ll=l((Tse,ET)=>{var{ReturningHelper:M5}=et(),{isConnectionError:B5}=et(),j5=ze(),D5=iT(),F5=oT(),Q5=$l(),U5=Pl(),ds=class extends j5{schemaCompiler(){return new D5(this,...arguments)}columnBuilder(){return new F5(this,...arguments)}columnCompiler(){return new Q5(this,...arguments)}tableCompiler(){return new U5(this,...arguments)}database(){return this.connectionSettings.database}positionBindings(e){let t=0;return e.replace(/\?/g,function(){return t+=1,`:${t}`})}_stream(e,t,n,i){if(!t.sql)throw new Error("The query is empty");return new Promise(function(s,o){n.on("error",u=>{B5(u)&&(e.__knex__disposed=u),o(u)}),n.on("end",s);let a=e.queryStream(t.sql,t.bindings,i);a.pipe(n),a.on("error",function(u){o(u),n.emit("error",u)})})}alias(e,t){return e+" "+t}parameter(e,t,n){return e instanceof M5&&this.driver?e=new this.driver.OutParam(this.driver.OCCISTRING):typeof e=="boolean"&&(e=e?1:0),super.parameter(e,t,n)}};Object.assign(ds.prototype,{dialect:"oracle",driverName:"oracle"});ET.exports=ds});var TT=l((Ase,xT)=>{var H5=vi(),W5=z(),CT=te(),V5=we(),G5=Yt(),z5=Ve(),{ReturningHelper:vT}=et(),{isString:J5}=A(),K5=["columns","join","where","union","group","having","order","lock"],kl=class extends z5{constructor(e,t,n){super(e,t,n);let{onConflict:i}=this.single;if(i)throw new Error(".onConflict() is not supported for oracledb.");this.first=this.select}insert(){let e=this.single.insert||[],{returning:t}=this.single;if(!Array.isArray(e)&&V5(this.single.insert)&&(e=[this.single.insert]),t&&!Array.isArray(t)&&(t=[t]),Array.isArray(e)&&e.length===1&&CT(e[0]))return this._addReturningToSqlAndConvert(`insert into ${this.tableName} (${this.formatter.wrap(this.single.returning)}) values (default)`,t,this.tableName);if(CT(this.single.insert)&&typeof this.single.insert!="function")return"";let n=this._prepInsert(e),i={};if(J5(n))return this._addReturningToSqlAndConvert(`insert into ${this.tableName} ${n}`,t);if(n.values.length===1)return this._addReturningToSqlAndConvert(`insert into ${this.tableName} (${this.formatter.columnize(n.columns)}) values (${this.client.parameterize(n.values[0],void 0,this.builder,this.bindingsHolder)})`,t,this.tableName);let s=n.columns.length===0;return i.sql="begin "+n.values.map(o=>{let a,u=s?"":this.client.parameterize(o,this.client.valueForUndefined,this.builder,this.bindingsHolder),c=Array.isArray(t)?t:[t],h=`insert into ${this.tableName} `;t&&(a=new vT(c.join(":")),i.outParams=(i.outParams||[]).concat(a)),s?h+=`(${this.formatter.wrap(this.single.returning)}) values (default)`:h+=`(${this.formatter.columnize(n.columns)}) values (${u})`,h+=t?` returning ROWID into ${this.client.parameter(a,this.builder,this.bindingsHolder)}`:"",h=this.formatter.client.positionBindings(h);let f=u.replace("DEFAULT, ","").replace(", DEFAULT","");return`execute immediate '${h.replace(/'/g,"''")}`+(f||t?"' using ":"")+f+(f&&t?", ":"")+(t?"out ?":"")+";"}).join(" ")+"end;",t&&(i.returning=t,i.returningSql=`select ${this.formatter.columnize(t)} from `+this.tableName+" where ROWID in ("+i.outParams.map((o,a)=>`:${a+1}`).join(", ")+") order by case ROWID "+i.outParams.map((o,a)=>`when CHARTOROWID(:${a+1}) then ${a}`).join(" ")+" end"),i}update(){let e=this._prepUpdate(this.single.update),t=this.where(),{returning:n}=this.single,i=`update ${this.tableName} set `+e.join(", ")+(t?` ${t}`:"");return n?(Array.isArray(n)||(n=[n]),this._addReturningToSqlAndConvert(i,n,this.tableName)):i}truncate(){return`truncate table ${this.tableName}`}forUpdate(){return"for update"}forShare(){return this.client.logger.warn("lock for share is not supported by oracle dialect"),""}columnInfo(){let e=this.single.columnInfo;return{sql:`select * from xmltable( '/ROWSET/ROW'
      passing dbms_xmlgen.getXMLType('
      select char_col_decl_length, column_name, data_type, data_default, nullable
      from all_tab_columns where table_name = ''${this.client.customWrapIdentifier(this.single.table,W5)}'' ')
      columns
      CHAR_COL_DECL_LENGTH number, COLUMN_NAME varchar2(200), DATA_TYPE varchar2(106),
      DATA_DEFAULT clob, NULLABLE varchar2(1))`,output(i){let s=G5(i,function(o,a){return o[a.COLUMN_NAME]={type:a.DATA_TYPE,defaultValue:a.DATA_DEFAULT,maxLength:a.CHAR_COL_DECL_LENGTH,nullable:a.NULLABLE==="Y"},o},{});return e&&s[e]||s}}}select(){let e=this.with(),t=K5.map(n=>this[n]());return e+=H5(t).join(" "),this._surroundQueryWithLimitAndOffset(e)}aggregate(e){return this._aggregate(e,{aliasSeparator:" "})}_addReturningToSqlAndConvert(e,t,n){let i={sql:e};if(!t)return i;let s=Array.isArray(t)?t:[t],o=new vT(s.join(":"));return i.sql=e+" returning ROWID into "+this.client.parameter(o,this.builder,this.bindingsHolder),i.returningSql=`select ${this.formatter.columnize(t)} from ${n} where ROWID = :1`,i.outParams=[o],i.returning=t,i}_surroundQueryWithLimitAndOffset(e){let{limit:t}=this.single,{offset:n}=this.single,i=t||t===0||t==="0";if(t=+t,!i&&!n)return e;if(e=e||"",i&&!n)return`select * from (${e}) where rownum <= ${this._getValueOrParameterFromAttribute("limit",t)}`;let s=+n+(i?t:1e13);return"select * from (select row_.*, ROWNUM rownum_ from ("+e+") row_ where rownum <= "+(this.single.skipBinding.offset?s:this.client.parameter(s,this.builder,this.bindingsHolder))+") where rownum_ > "+this._getValueOrParameterFromAttribute("offset",n)}};xT.exports=kl});var ps=l((Sse,NT)=>{var yr=et(),{promisify:AT}=require("util"),Y5=require("stream");function ST(r,e){this.columnName=r,this.value=e,this.returning=!1}ST.prototype.toString=function(){return"[object BlobHelper:"+this.columnName+"]"};function X5(r,e){return new Promise((t,n)=>{let i=e==="string"?"":Buffer.alloc(0);r.on("error",function(s){n(s)}),r.on("data",function(s){e==="string"?i+=s:i=Buffer.concat([i,s])}),r.on("end",function(){t(i)})})}var Z5=function(r){let e=require("oracledb"),t;if(r.type)r.type===e.BLOB?t="buffer":r.type===e.CLOB&&(t="string");else if(r.iLob)r.iLob.type===e.CLOB?t="string":r.iLob.type===e.BLOB&&(t="buffer");else throw new Error("Unrecognized oracledb lob stream type");return t==="string"&&r.setEncoding("utf-8"),X5(r,t)};function eY(r,e){if(r.executeAsync)return;r.commitAsync=function(){return new Promise((n,i)=>{this.commit(function(s){if(s)return i(s);n()})})},r.rollbackAsync=function(){return new Promise((n,i)=>{this.rollback(function(s){if(s)return i(s);n()})})};let t=AT(function(n,i,s,o){if(s=s||{},s.outFormat=e.driver.OUT_FORMAT_OBJECT||e.driver.OBJECT,!s.outFormat)throw new Error("not found oracledb.outFormat constants");s.resultSet?r.execute(n,i||[],s,function(a,u){if(a)return yr.isConnectionError(a)&&(r.close().catch(function(d){}),r.__knex__disposed=a),o(a);let c={rows:[],resultSet:u.resultSet},h=100,f=function(d,g,m){g.getRows(m,function(y,_){if(y)yr.isConnectionError(y)&&(d.close().catch(function(v){}),d.__knex__disposed=y),g.close(function(){return o(y)});else{if(_.length===0)return o(null,c);if(_.length>0)if(_.length===m)c.rows=c.rows.concat(_),f(d,g,m);else return c.rows=c.rows.concat(_),o(null,c)}})};f(r,u.resultSet,h)}):r.execute(n,i||[],s,function(a,u){return a?(yr.isConnectionError(a)&&(r.close().catch(function(c){}),r.__knex__disposed=a),o(a)):o(null,u)})});r.executeAsync=function(n,i,s){return t(n,i,s).then(async o=>{let a=()=>o.resultSet?AT(o.resultSet.close).call(o.resultSet):Promise.resolve(),u=[];if(o.rows&&Array.isArray(o.rows))for(let c=0;c<o.rows.length;c++){let h=o.rows[c];for(let f in h)h[f]instanceof Y5.Readable&&u.push({index:c,key:f,stream:h[f]})}try{for(let c of u)o.rows[c.index][c.key]=await Z5(c.stream)}catch(c){throw await a().catch(()=>{}),c}return await a(),o})}}yr.BlobHelper=ST;yr.monkeyPatchConnection=eY;NT.exports=yr});var RT=l((Nse,OT)=>{var tY=mi(),Ml=Gt(),ms=te(),rY=we(),nY=TT(),Bl=ps().ReturningHelper,Cn=ps().BlobHelper,{isString:iY}=A(),{columnize:jl}=F(),Dl=class extends nY{insert(){let e=this,t=this._prepOutbindings(this.single.insert,this.single.returning),n=t.outBinding,i=t.returning,s=t.values;if(Array.isArray(s)&&s.length===1&&ms(s[0])){let c=this.single.returning?" ("+this.formatter.wrap(this.single.returning)+")":"";return this._addReturningToSqlAndConvert("insert into "+this.tableName+c+" values (default)",n[0],this.tableName,i)}if(ms(this.single.insert)&&typeof this.single.insert!="function")return"";let o=this._prepInsert(s),a={};if(iY(o))return this._addReturningToSqlAndConvert("insert into "+this.tableName+" "+o,n[0],this.tableName,i);if(o.values.length===1)return this._addReturningToSqlAndConvert("insert into "+this.tableName+" ("+this.formatter.columnize(o.columns)+") values ("+this.client.parameterize(o.values[0],void 0,this.builder,this.bindingsHolder)+")",n[0],this.tableName,i);let u=o.columns.length===0;return a.returning=i,a.sql="begin "+o.values.map(function(c,h){let f=u?"":e.client.parameterize(c,e.client.valueForUndefined,e.builder,e.bindingsHolder),d="insert into "+e.tableName;u?d+=" ("+e.formatter.wrap(e.single.returning)+") values (default)":d+=" ("+e.formatter.columnize(o.columns)+") values ("+f+")";let g="",m="",y="",_="";Ml(c,function(x){x instanceof Cn||(y+=" ?,")}),y=y.slice(0,-1),n[h].forEach(function(x){let he=x.columnName||x;if(g+=e.formatter.wrap(he)+",",m+=" ?,",_+=" out ?,",x instanceof Cn)return e.formatter.bindings.push(x);e.formatter.bindings.push(new Bl(he))}),g=g.slice(0,-1),m=m.slice(0,-1),_=_.slice(0,-1),g&&m&&(d+=" returning "+g+" into"+m),d=e.formatter.client.positionBindings(d);let v=f.replace(/DEFAULT, /g,"").replace(/, DEFAULT/g,"").replace("EMPTY_BLOB(), ","").replace(", EMPTY_BLOB()","");return"execute immediate '"+d.replace(/'/g,"''")+(v||c?"' using ":"")+v+(v&&_?",":"")+_+";"}).join(" ")+"end;",a.outBinding=n,i[0]==="*"&&(a.returningSql=function(){return"select * from "+e.tableName+" where ROWID in ("+this.outBinding.map(function(c,h){return":"+(h+1)}).join(", ")+") order by case ROWID "+this.outBinding.map(function(c,h){return"when CHARTOROWID(:"+(h+1)+") then "+h}).join(" ")+" end"}),a}with(){let e=[];if(this.grouped.with)for(let n of this.grouped.with)n.recursive&&(e.push(n),n.recursive=!1);let t=super.with();for(let n of e)n.recursive=!0;return t}_addReturningToSqlAndConvert(e,t,n,i){let s=this,o={sql:e};if(!t)return o;let a=Array.isArray(t)?t:[t],u="",c="";return a.forEach(function(h){let f=h.columnName||h;if(u+=s.formatter.wrap(f)+",",c+="?,",h instanceof Cn)return s.formatter.bindings.push(h);s.formatter.bindings.push(new Bl(f))}),o.sql=e,u=u.slice(0,-1),c=c.slice(0,-1),u&&c&&(o.sql+=" returning "+u+" into "+c),o.outBinding=[t],i[0]==="*"&&(o.returningSql=function(){return"select * from "+s.tableName+" where ROWID = :1"}),o.returning=i,o}_prepOutbindings(e,t){let n={},i=e||[],s=t||[];!Array.isArray(i)&&rY(e)&&(i=[i]),s&&!Array.isArray(s)&&(s=[s]);let o=[];return Ml(i,function(a,u){s[0]==="*"?o[u]=["ROWID"]:o[u]=tY(s),Ml(a,function(c,h){if(c instanceof Buffer){a[h]=new Cn(h,c);let f=o[u].indexOf(h);f>=0&&(o[u].splice(f,1),a[h].returning=!0),o[u].push(a[h])}c===void 0&&delete i[u][h]})}),n.returning=s,n.outBinding=o,n.values=i,n}_groupOrder(e,t){return super._groupOrderNulls(e,t)}update(){let e=this,t={},n=this._prepOutbindings(this.single.update||this.single.counter,this.single.returning),i=n.outBinding,s=n.returning,o=this._prepUpdate(this.single.update),a=this.where(),u="",c="";return ms(o)&&typeof this.single.update!="function"?"":(i.forEach(function(h){h.forEach(function(f){let d=f.columnName||f;if(u+=e.formatter.wrap(d)+",",c+=" ?,",f instanceof Cn)return e.formatter.bindings.push(f);e.formatter.bindings.push(new Bl(d))})}),u=u.slice(0,-1),c=c.slice(0,-1),t.outBinding=i,t.returning=s,t.sql="update "+this.tableName+" set "+o.join(", ")+(a?" "+a:""),i.length&&!ms(i[0])&&(t.sql+=" returning "+u+" into"+c),s[0]==="*"&&(t.returningSql=function(){let h="select * from "+e.tableName,f=this.rowsAffected.length||this.rowsAffected,d=" where ROWID in (",g=") order by case ROWID ";for(let m=0;m<f;m++)this.returning[0]==="*"&&(d+=":"+(m+1)+", ",g+="when CHARTOROWID(:"+(m+1)+") then "+m+" ");return this.returning[0]==="*"&&(this.returning=this.returning.slice(0,-1),d=d.slice(0,-2),g=g.slice(0,-1)),h+=d+g+" end"}),t)}_jsonPathWrap(e){return`'${e.path||e[1]}'`}jsonExtract(e){return this._jsonExtract(e.singleValue?"json_value":"json_query",e)}jsonSet(e){return`json_transform(${jl(e.column,this.builder,this.client,this.bindingsHolder)}, set ${this.client.parameter(e.path,this.builder,this.bindingsHolder)} = ${this.client.parameter(e.value,this.builder,this.bindingsHolder)})`}jsonInsert(e){return`json_transform(${jl(e.column,this.builder,this.client,this.bindingsHolder)}, insert ${this.client.parameter(e.path,this.builder,this.bindingsHolder)} = ${this.client.parameter(e.value,this.builder,this.bindingsHolder)})`}jsonRemove(e){let t=`json_transform(${jl(e.column,this.builder,this.client,this.bindingsHolder)}, remove ${this.client.parameter(e.path,this.builder,this.bindingsHolder)})`;return e.alias?this.client.alias(t,this.formatter.wrap(e.alias)):t}whereJsonPath(e){return this._whereJsonPath("json_value",e)}whereJsonSupersetOf(e){throw new Error("Json superset where clause not actually supported by Oracle")}whereJsonSubsetOf(e){throw new Error("Json subset where clause not actually supported by Oracle")}onJsonPathEquals(e){return this._onJsonPathEquals("json_value",e)}};OT.exports=Dl});var $T=l((Ose,IT)=>{var sY=Pl(),Fl=class extends sY{constructor(e,t){super(e,t)}_setNullableState(e,t){let n=t?"NULL":"NOT NULL",i=`alter table ${this.tableName()} modify (${this.formatter.wrap(e)} ${n})`;return this.pushQuery({sql:i})}};IT.exports=Fl});var kT=l((Rse,LT)=>{var oY=$l(),{isObject:PT}=A(),vn=class extends oY{constructor(){super(...arguments),this.modifiers=["defaultTo","nullable","comment"],this._addCheckModifiers()}datetime(e){let t;return PT(e)?{useTz:t}=e:t=!e,t?"timestamp with local time zone":"timestamp"}timestamp(e){let t;return PT(e)?{useTz:t}=e:t=!e,t?"timestamp with local time zone":"timestamp"}checkRegex(e,t){return this._check(`REGEXP_LIKE(${this.formatter.wrap(this.getColumnName())},${this.client._escapeBinding(e)})`,t)}json(){return`varchar2(4000) check (${this.formatter.columnize(this.getColumnName())} is json)`}jsonb(){return this.json()}};vn.prototype.time="timestamp with local time zone";vn.prototype.uuid=({useBinaryUuid:r=!1}={})=>r?"raw(16)":"char(36)";LT.exports=vn});var BT=l((Ise,MT)=>{var aY=_t(),Ql=class extends aY{constructor(e,t){super(e,t)}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}createMaterializedView(){this.createQuery(this.columns,this.selectQuery,!0)}};MT.exports=Ql});var DT=l(($se,jT)=>{var uY=rr(),Ul=class extends uY{constructor(){super(...arguments)}checkOption(){this._single.checkOption="default_option"}};jT.exports=Ul});var QT=l((Lse,FT)=>{var lY=Se(),{timeout:cY,KnexTimeoutError:hY}=ft(),Hl=ae()("knex:tx"),fY=["read committed","serializable"],dY=!1;FT.exports=class extends lY{begin(e){if(this.isolationLevel)if(dY)if(!fY.includes(this.isolationLevel))this.client.logger.warn("Oracle only supports read committed and serializable transactions, ignoring the isolation level param");else return this.query(e,`SET TRANSACTION ${this.isolationLevel}`);else this.client.logger.warn("Transaction isolation is not currently supported for Oracle");return Promise.resolve()}async commit(e,t){this._completed=!0;try{await e.commitAsync(),this._resolver(t)}catch(n){this._rejecter(n)}}release(e,t){return this._resolver(t)}rollback(e,t){return this._completed=!0,Hl("%s: rolling back",this.txid),cY(e.rollbackAsync(),5e3).catch(n=>{if(!(n instanceof hY))return Promise.reject(n);this._rejecter(n)}).then(()=>{if(t===void 0){if(this.doNotRejectOnRollback){this._resolver();return}t=new Error(`Transaction rejected with non-error: ${t}`)}this._rejecter(t)})}savepoint(e){return this.query(e,`SAVEPOINT ${this.txid}`)}async acquireConnection(e,t){let n=e&&e.connection,i=n||await this.client.acquireConnection();try{return i.__knexTxId=this.txid,i.isTransaction=!0,await t(i)}finally{Hl("%s: releasing connection",this.txid),i.isTransaction=!1;try{await i.commitAsync()}catch(s){this._rejecter(s)}finally{n?Hl("%s: not releasing external connection",this.txid):await this.client.releaseConnection(i)}}}}});var VT=l((kse,WT)=>{var pY=Gt(),mY=Dr(),gY=te(),UT=He(),yY=an(),bY=RT(),wY=$T(),_Y=kT(),{BlobHelper:Wl,ReturningHelper:qY,monkeyPatchConnection:HT}=ps(),EY=BT(),CY=DT(),vY=QT(),xY=Ll(),{isString:TY}=A(),{outputQuery:AY,unwrapRaw:SY}=F(),{compileCallback:NY}=Ue(),gs=class extends xY{constructor(e){super(e),this.driver&&(process.env.UV_THREADPOOL_SIZE=process.env.UV_THREADPOOL_SIZE||1,process.env.UV_THREADPOOL_SIZE=parseInt(process.env.UV_THREADPOOL_SIZE)+this.driver.poolMax)}_driver(){let e=this,t=require("oracledb");return e.fetchAsString=[],this.config.fetchAsString&&Array.isArray(this.config.fetchAsString)&&this.config.fetchAsString.forEach(function(n){TY(n)&&(n=n.toUpperCase(),t[n]&&(n!=="NUMBER"&&n!=="DATE"&&n!=="CLOB"&&n!=="BUFFER"&&this.logger.warn('Only "date", "number", "clob" and "buffer" are supported for fetchAsString'),e.fetchAsString.push(t[n])))}),t}queryCompiler(e,t){return new bY(this,e,t)}tableCompiler(){return new wY(this,...arguments)}columnCompiler(){return new _Y(this,...arguments)}viewBuilder(){return new CY(this,...arguments)}viewCompiler(){return new EY(this,...arguments)}formatter(e){return new yY(this,e)}transaction(){return new vY(this,...arguments)}prepBindings(e){return UT(e,t=>t instanceof Wl&&this.driver?{type:this.driver.BLOB,dir:this.driver.BIND_OUT}:t instanceof qY&&this.driver?{type:this.driver.STRING,dir:this.driver.BIND_OUT}:typeof t=="boolean"?t?1:0:t)}parameter(e,t,n){return typeof e=="function"?AY(NY(e,void 0,this,n),!0,t,this):e instanceof Wl?(n.bindings.push(e.value),"?"):SY(e,!0,t,this,n)||"?"}acquireRawConnection(){let e=this;return new Promise(function(n,i){let s=e.connectionSettings.externalAuth?{externalAuth:e.connectionSettings.externalAuth}:{user:e.connectionSettings.user,password:e.connectionSettings.password};s.connectString=OY(e.connectionSettings),e.connectionSettings.prefetchRowCount&&(s.prefetchRows=e.connectionSettings.prefetchRowCount),e.connectionSettings.stmtCacheSize!==void 0&&(s.stmtCacheSize=e.connectionSettings.stmtCacheSize),e.driver.fetchAsString=e.fetchAsString,e.driver.getConnection(s,function(o,a){if(o)return i(o);HT(a,e),n(a)})})}destroyRawConnection(e){return e.release()}_query(e,t){if(!t.sql)throw new Error("The query is empty");let n={autoCommit:!1};return t.method==="select"&&(n.resultSet=!0),e.executeAsync(t.sql,t.bindings,n).then(async function(i){let s=mY(i.outBinds);if(t.response=i.rows||[],t.rowsAffected=i.rows?i.rows.rowsAffected:i.rowsAffected,t.method==="raw"&&s.length>0)return{response:s};if(t.method==="update"){let u=t.rowsAffected.length||t.rowsAffected,c=[],h=[],f=d=>function(g,m){let y=m*u;h.push(s[d+y])};for(let d=0;d<u;d++)c.push(t.outBinding[0]),pY(t.outBinding[0],f(d));s=h,t.outBinding=c}if(!t.returning&&s.length===0)return e.isTransaction||await e.commitAsync(),t;let o=[],a=0;for(let u=0;u<t.outBinding.length;u++){let c=t.outBinding[u];a=a+(t.outBinding[u-1]?t.outBinding[u-1].length:0);for(let h=0;h<c.length;h++){let f=c[h];await new Promise(function(d,g){if(f instanceof Wl){let m=s[h+a];f.returning&&(t.response[u]=t.response[u]||{},t.response[u][f.columnName]=f.value),m.on("error",function(y){g(y)}),m.on("finish",function(){d()}),m.write(f.value),m.end()}else t.outBinding[u][h]==="ROWID"?(o.push(s[h+a]),d()):(t.response[u]=t.response[u]||{},t.response[u][f]=s[h+a],d())})}}if(e.isTransaction)return t;if(await e.commitAsync(),t.returningSql){let u=await e.executeAsync(t.returningSql(),o,{resultSet:!0});t.response=u.rows}return t})}processResponse(e,t){let{response:n}=e;if(e.output)return e.output.call(t,n);switch(e.method){case"select":return n;case"first":return n[0];case"pluck":return UT(n,e.pluck);case"insert":case"del":case"update":case"counter":return e.returning&&!gY(e.returning)?n:e.rowsAffected!==void 0?e.rowsAffected:1;default:return n}}processPassedConnection(e){HT(e,this)}};gs.prototype.driverName="oracledb";function OY(r){return r.connectString?r.connectString:r.port?r.host+":"+r.port+"/"+r.database:r.host+"/"+r.database}WT.exports=gs});var zT=l((Mse,GT)=>{var RY=qn(),Vl=class extends RY{constructor(...e){super(...e),this.driverName="pgnative",this.canCancelQuery=!0}_driver(){return wn().native}_stream(e,t,n,i){if(!t.sql)throw new Error("The query is empty");let s=this;return new Promise((o,a)=>(n.on("error",a),n.on("end",o),s._query(e,t).then(u=>u.response).then(({rows:u})=>u.forEach(c=>n.write(c))).catch(function(u){n.emit("error",u)}).then(function(){n.end()})))}async cancelQuery(e){try{return await this._wrappedCancelQueryCall(null,e)}catch(t){throw this.logger.warn(`Connection Error: ${t}`),t}}_wrappedCancelQueryCall(e,t){return new Promise(function(n,i){t.native.cancel(function(s){if(s){i(s);return}n(!0)})})}};GT.exports=Vl});var KT=l((jse,JT)=>{var IY=Se();JT.exports=class extends IY{begin(e){return this.isolationLevel?this.query(e,`BEGIN ISOLATION LEVEL ${this.isolationLevel};`):this.query(e,"BEGIN;")}savepoint(e){return this.trxClient.logger("Redshift does not support savepoints."),Promise.resolve()}release(e,t){return this.trxClient.logger("Redshift does not support savepoints."),Promise.resolve()}rollbackTo(e,t){return this.trxClient.logger("Redshift does not support savepoints."),Promise.resolve()}}});var ZT=l((Dse,XT)=>{var Gl=Ve(),$Y=Bi(),YT=z(),{columnize:PY}=F(),zl=class extends $Y{truncate(){return`truncate ${this.tableName.toLowerCase()}`}insert(){let e=Gl.prototype.insert.apply(this,arguments);return e===""?e:(this._slightReturn(),{sql:e})}update(){let e=Gl.prototype.update.apply(this,arguments);return this._slightReturn(),{sql:e}}del(){let e=Gl.prototype.del.apply(this,arguments);return this._slightReturn(),{sql:e}}_slightReturn(){this.single.isReturning&&this.client.logger.warn("insert/update/delete returning is not supported by redshift dialect")}forUpdate(){return this.client.logger.warn("table lock is not supported by redshift dialect"),""}forShare(){return this.client.logger.warn("lock for share is not supported by redshift dialect"),""}forNoKeyUpdate(){return this.client.logger.warn("table lock is not supported by redshift dialect"),""}forKeyShare(){return this.client.logger.warn("lock for share is not supported by redshift dialect"),""}columnInfo(){let e=this.single.columnInfo,t=this.single.schema,n=this.client.customWrapIdentifier(this.single.table,YT);t&&(t=this.client.customWrapIdentifier(t,YT));let i="select * from information_schema.columns where table_name = ? and table_catalog = ?",s=[n.toLowerCase(),this.client.database().toLowerCase()];return this._buildColumnInfoQuery(t,i,s,e)}jsonExtract(e){let t;return Array.isArray(e.column)?t=e.column:t=[e],t.map(n=>{let i=`json_extract_path_text(${PY(n.column||n[0],this.builder,this.client,this.bindingsHolder)}, ${this.client.toPathForJson(e.path||n[1],this.builder,this.bindingsHolder)})`,s=n.alias||n[2];return s?this.client.alias(i,this.formatter.wrap(s)):i}).join(", ")}jsonSet(e){throw new Error("Json set is not supported by Redshift")}jsonInsert(e){throw new Error("Json insert is not supported by Redshift")}jsonRemove(e){throw new Error("Json remove is not supported by Redshift")}whereJsonPath(e){return this._whereJsonPath("json_extract_path_text",Object.assign({},e,{path:this.client.toPathForJson(e.path)}))}whereJsonSupersetOf(e){throw new Error("Json superset is not supported by Redshift")}whereJsonSubsetOf(e){throw new Error("Json subset is not supported by Redshift")}onJsonPathEquals(e){return this._onJsonPathEquals("json_extract_path_text",e)}};XT.exports=zl});var tA=l((Fse,eA)=>{var LY=on(),Jl=class extends LY{constructor(){super(...arguments)}primary(){return this.notNullable(),super.primary(...arguments)}index(){return this.client.logger.warn("Redshift does not support the creation of indexes."),this}};eA.exports=Jl});var nA=l((Qse,rA)=>{var kY=ji(),MY=Ge(),R=class extends kY{constructor(){super(...arguments)}bit(e){return e.length!==!1?`char(${e.length})`:"char(1)"}datetime(e){return e?"timestamp":"timestamptz"}timestamp(e){return e?"timestamp":"timestamptz"}comment(e){this.pushAdditional(function(){this.pushQuery(`comment on column ${this.tableCompiler.tableName()}.`+this.formatter.wrap(this.args[0])+" is "+(e?`'${e}'`:"NULL"))},e)}};R.prototype.increments=({primaryKey:r=!0}={})=>"integer identity(1,1)"+(r?" primary key":"")+" not null";R.prototype.bigincrements=({primaryKey:r=!0}={})=>"bigint identity(1,1)"+(r?" primary key":"")+" not null";R.prototype.binary="varchar(max)";R.prototype.blob="varchar(max)";R.prototype.enu="varchar(255)";R.prototype.enum="varchar(255)";R.prototype.json="varchar(max)";R.prototype.jsonb="varchar(max)";R.prototype.longblob="varchar(max)";R.prototype.mediumblob="varchar(16777218)";R.prototype.set="text";R.prototype.text="varchar(max)";R.prototype.tinyblob="varchar(256)";R.prototype.uuid=MY.prototype.uuid;R.prototype.varbinary="varchar(max)";R.prototype.bigint="bigint";R.prototype.bool="boolean";R.prototype.double="double precision";R.prototype.floating="real";R.prototype.smallint="smallint";R.prototype.tinyint="smallint";rA.exports=R});var sA=l((Use,iA)=>{var BY=en(),jY=Fi(),Kl=class extends jY{constructor(){super(...arguments)}index(e,t,n){this.client.logger.warn("Redshift does not support the creation of indexes.")}dropIndex(e,t){this.client.logger.warn("Redshift does not support the deletion of indexes.")}createQuery(e,t,n){let i=t?"create table if not exists ":"create table ",s=" ("+e.sql.join(", ")+this._addChecks()+")",o=i+this.tableName()+(n&&this.tableNameLike()?" (like "+this.tableNameLike()+")":s);this.single.inherits&&(o+=` like (${this.formatter.wrap(this.single.inherits)})`),this.pushQuery({sql:o,bindings:e.bindings}),BY(this.single,"comment")&&this.comment(this.single.comment),n&&this.addColumns(e,this.addColumnsPrefix)}primary(e,t){let n=this;t=t?n.formatter.wrap(t):n.formatter.wrap(`${this.tableNameRaw}_pkey`),e.constructor!==Array&&(e=[e]);let i=n.grouped.columns;if(i)for(let s=0;s<e.length;s++){let o=i.find(u=>u.grouping==="columns"&&u.builder&&u.builder._method==="add"&&u.builder._args&&u.builder._args.indexOf(e[s])>-1);if(o&&(o=o.builder),!(o&&o._modifiers&&o._modifiers.nullable&&o._modifiers.nullable[0]===!1))return o?this.client.logger.warn("Redshift does not allow primary keys to contain nullable columns."):this.client.logger.warn("Redshift does not allow primary keys to contain nonexistent columns.")}return n.pushQuery(`alter table ${n.tableName()} add constraint ${t} primary key (${n.formatter.columnize(e)})`)}addColumns(e,t,n){if(t===this.alterColumnsPrefix)super.addColumns(e,t,n);else{t=t||this.addColumnsPrefix,n=n||this.getColumns();for(let i of n){let s=this.tableName(),o=i.compileColumn();this.pushQuery({sql:`alter table ${s} ${t}${o}`,bindings:[]})}}}};iA.exports=Kl});var aA=l((Hse,oA)=>{var DY=mu(),Yl=class extends DY{constructor(){super(...arguments)}};oA.exports=Yl});var lA=l((Wse,uA)=>{var FY=Qi(),Xl=class extends FY{constructor(e,t){super(e,t)}};uA.exports=Xl});var hA=l((Vse,cA)=>{var QY=qn(),UY=He(),HY=KT(),WY=ZT(),VY=tA(),GY=nA(),zY=sA(),JY=aA(),KY=lA(),ys=class extends QY{transaction(){return new HY(this,...arguments)}queryCompiler(e,t){return new WY(this,e,t)}columnBuilder(){return new VY(this,...arguments)}columnCompiler(){return new GY(this,...arguments)}tableCompiler(){return new zY(this,...arguments)}schemaCompiler(){return new JY(this,...arguments)}viewCompiler(){return new KY(this,...arguments)}_driver(){return wn()}processResponse(e,t){let n=e.response;return e.output?e.output.call(t,n):e.method==="raw"?n:n.command==="SELECT"?e.method==="first"?n.rows[0]:e.method==="pluck"?UY(n.rows,e.pluck):n.rows:n.command==="INSERT"||n.command==="UPDATE"||n.command==="DELETE"?n.rowCount:n}toPathForJson(e,t,n){return e.replace(/^(\$\.)/,"").split(".").map(function(i){return this.parameter(i,t,n)}.bind(this)).join(", ")}};Object.assign(ys.prototype,{dialect:"redshift",driverName:"pg-redshift"});cA.exports=ys});var fA=l(bs=>{"use strict";Object.defineProperty(bs,"__esModule",{value:!0});bs.getDialectByNameOrAlias=void 0;var{resolveClientNameWithAliases:YY}=D(),XY=Object.freeze({"better-sqlite3":()=>ZE(),cockroachdb:()=>rx(),mssql:()=>Tx(),mysql:()=>Al(),mysql2:()=>Zx(),oracle:()=>Ll(),oracledb:()=>VT(),pgnative:()=>zT(),postgres:()=>qn(),redshift:()=>hA(),sqlite3:()=>au()});function ZY(r){let e=YY(r),t=XY[e];if(!t)throw new Error(`Invalid clientName given: ${r}`);return t()}bs.getDialectByNameOrAlias=ZY});var mA=l((zse,pA)=>{var e7=ze(),{SUPPORTED_CLIENTS:t7}=gi(),dA=Uq(),{getDialectByNameOrAlias:r7}=fA();function n7(r){let e,t,n=typeof r=="string"?Object.assign(dA(r),arguments[2]):r;if(arguments.length===0||!n.client&&!n.dialect)e=e7;else if(typeof n.client=="function")e=n.client;else{let i=n.client||n.dialect;if(!t7.includes(i))throw new Error(`knex: Unknown configuration option 'client' value ${i}. Note that it is case-sensitive, check documentation for supported values.`);e=r7(i)}return typeof n.connection=="string"?t=Object.assign({},n,{connection:dA(n.connection).connection}):t=Object.assign({},n),{resolvedConfig:t,Dialect:e}}pA.exports={resolveConfig:n7}});var yA=l((Jse,gA)=>{var i7=ze(),s7=Oe(),o7=fa(),a7=ga(),{KnexTimeoutError:u7}=ft(),{resolveConfig:l7}=mA(),c7=Pa(),h7=rr(),f7=on(),d7=Ba();function rt(r){let{resolvedConfig:e,Dialect:t}=l7(...arguments),n=a7(new t(e));return e.userParams&&(n.userParams=e.userParams),n}rt.Client=i7;rt.KnexTimeoutError=u7;rt.QueryBuilder={extend:function(r,e){s7.extend(r,e),o7.push(r)}};rt.SchemaBuilder={extend:function(r,e){c7.extend(r,e)}};rt.ViewBuilder={extend:function(r,e){h7.extend(r,e)}};rt.ColumnBuilder={extend:function(r,e){f7.extend(r,e)}};rt.TableBuilder={extend:function(r,e){d7.extend(r,e)}};gA.exports=rt});var wA=l((Kse,bA)=>{var p7=yA();bA.exports=p7});var qA=l((Yse,_A)=>{var xn=wA();xn.knex=xn;xn.default=xn;_A.exports=xn});var EA=l((Xse,m7)=>{m7.exports={name:"dotenv",version:"16.0.3",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{require:"./lib/main.js",types:"./lib/main.d.ts",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard","lint-readme":"standard-markdown",pretest:"npm run lint && npm run dts-check",test:"tap tests/*.js --100 -Rspec",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^17.0.9",decache:"^4.6.1",dtslint:"^3.7.0",sinon:"^12.0.1",standard:"^16.0.4","standard-markdown":"^7.1.0","standard-version":"^9.3.2",tap:"^15.1.6",tar:"^6.1.11",typescript:"^4.5.4"},engines:{node:">=12"}}});var vA=l((Zse,_s)=>{var g7=require("fs"),CA=require("path"),y7=require("os"),b7=EA(),w7=b7.version,_7=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function q7(r){let e={},t=r.toString();t=t.replace(/\r\n?/mg,`
`);let n;for(;(n=_7.exec(t))!=null;){let i=n[1],s=n[2]||"";s=s.trim();let o=s[0];s=s.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),o==='"'&&(s=s.replace(/\\n/g,`
`),s=s.replace(/\\r/g,"\r")),e[i]=s}return e}function Zl(r){console.log(`[dotenv@${w7}][DEBUG] ${r}`)}function E7(r){return r[0]==="~"?CA.join(y7.homedir(),r.slice(1)):r}function C7(r){let e=CA.resolve(process.cwd(),".env"),t="utf8",n=!!(r&&r.debug),i=!!(r&&r.override);r&&(r.path!=null&&(e=E7(r.path)),r.encoding!=null&&(t=r.encoding));try{let s=ws.parse(g7.readFileSync(e,{encoding:t}));return Object.keys(s).forEach(function(o){Object.prototype.hasOwnProperty.call(process.env,o)?(i===!0&&(process.env[o]=s[o]),n&&Zl(i===!0?`"${o}" is already defined in \`process.env\` and WAS overwritten`:`"${o}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[o]=s[o]}),{parsed:s}}catch(s){return n&&Zl(`Failed to load ${e} ${s.message}`),{error:s}}}var ws={config:C7,parse:q7};_s.exports.config=ws.config;_s.exports.parse=ws.parse;_s.exports=ws});var AA=l((eoe,TA)=>{"use strict";var xA=rc(vA());xA.default.config();var v7={development:{client:"postgresql",connection:{database:process.env.DB_NAME,user:process.env.DB_USER,password:process.env.DB_PASSWORD,host:process.env.DB_HOST}},staging:{client:"postgresql",connection:{database:process.env.DB_NAME,user:process.env.DB_USER,password:process.env.DB_PASSWORD,host:process.env.DB_HOST},pool:{min:2,max:10},migrations:{tableName:"knex_migrations"}},production:{client:"postgresql",connection:{database:process.env.DB_NAME,user:process.env.DB_USER,password:process.env.DB_PASSWORD,host:process.env.DB_HOST},pool:{min:2,max:10},migrations:{tableName:"knex_migrations"}},test:{client:"postgresql",connection:{database:process.env.TEST_DB_NAME,user:process.env.DB_USER,password:process.env.DB_PASSWORD,host:process.env.DB_HOST},pool:{min:2,max:10},migrations:{tableName:"knex_migrations"}}};TA.exports=v7});var SA=rc(qA()),x7=AA(),qs=(0,SA.default)(x7[process.env.NODE_ENV||"development"]);async function T7(){await qs.migrate.rollback(),console.log("%cMigration Rollback Done!","color:green;border:1px solid black"),await qs.migrate.latest(),console.log("%cMigration Latest Done!","color:green;border:1px solid black"),await qs.seed.run(),console.log("%cSeed Done!","color:green;border:1px solid black"),await qs.destroy()}T7();
